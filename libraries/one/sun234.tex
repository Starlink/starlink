\documentclass[twoside,11pt]{article}

% ? Specify used packages
% \usepackage{graphicx}        %  Use this one for final production.
% \usepackage[draft]{graphicx} %  Use this one for drafting.
% ? End of specify used packages

\pagestyle{myheadings}

% -----------------------------------------------------------------------------
% ? Document identification
% Fixed part
\newcommand{\stardoccategory}  {Starlink User Note}
\newcommand{\stardocinitials}  {SUN}
\newcommand{\stardocsource}    {sun\stardocnumber}
\newcommand{\stardoccopyright}
{Copyright \copyright\ 2000 Council for the Central Laboratory of the Research Councils}

% Variable part - replace [xxx] as appropriate.
\newcommand{\stardocnumber}    {234.4}
\newcommand{\stardocauthors}   {R.T.Platon \& T. Jenness}
\newcommand{\stardocdate}      {12th May 2011}
\newcommand{\stardoctitle}     {ONE -- Odds and Ends Library}
\newcommand{\stardocversion}   {Version 1.4}
\newcommand{\stardocmanual}    {User's Guide}
\newcommand{\stardocabstract}  {
This library is a set of Fortran and C routines
of a general nature and usefulness,
which are not suitable for inclusion in other more focussed libraries.
}
% ? End of document identification
% -----------------------------------------------------------------------------

% +
%  Name:
%     sun234.tex
%
%  Purpose:
%     This is a description of the Odds & Ends library
%
%  Authors:
%     RTP: Roy Platon (STARLINK, RAL)
%
%  History:
%      2-AUG-2000 (RTP):
%        Original version, based on Template (see SUN199).
%
% -

\newcommand{\stardocname}{\stardocinitials /\stardocnumber}
\markboth{\stardocname}{\stardocname}
\setlength{\textwidth}{160mm}
\setlength{\textheight}{230mm}
\setlength{\topmargin}{-2mm}
\setlength{\oddsidemargin}{0mm}
\setlength{\evensidemargin}{0mm}
\setlength{\parindent}{0mm}
\setlength{\parskip}{\medskipamount}
\setlength{\unitlength}{1mm}
\newcommand{\noteroutine}[2]{\textbf{#1}\hspace*{\fill}\nopagebreak \\
                             \hspace*{3em}\emph{#2}\hspace*{\fill}\par}

% -----------------------------------------------------------------------------
%  Hypertext definitions.
%  ======================
%  These are used by the LaTeX2HTML translator in conjunction with star2html.

%  Comment.sty: version 2.0, 19 June 1992
%  Selectively in/exclude pieces of text.
%
%  Author
%    Victor Eijkhout                                      <eijkhout@cs.utk.edu>
%    Department of Computer Science
%    University Tennessee at Knoxville
%    104 Ayres Hall
%    Knoxville, TN 37996
%    USA

%  Do not remove the %begin{latexonly} and %end{latexonly} lines (used by
%  LaTeX2HTML to signify text it shouldn't process).
%begin{latexonly}
\makeatletter
\def\makeinnocent#1{\catcode`#1=12 }
\def\csarg#1#2{\expandafter#1\csname#2\endcsname}

\def\ThrowAwayComment#1{\begingroup
    \def\CurrentComment{#1}%
    \let\do\makeinnocent \dospecials
    \makeinnocent\^^L% and whatever other special cases
    \endlinechar`\^^M \catcode`\^^M=12 \xComment}
{\catcode`\^^M=12 \endlinechar=-1 %
 \gdef\xComment#1^^M{\def\test{#1}
      \csarg\ifx{PlainEnd\CurrentComment Test}\test
          \let\html@next\endgroup
      \else \csarg\ifx{LaLaEnd\CurrentComment Test}\test
            \edef\html@next{\endgroup\noexpand\end{\CurrentComment}}
      \else \let\html@next\xComment
      \fi \fi \html@next}
}
\makeatother

\def\includecomment
 #1{\expandafter\def\csname#1\endcsname{}%
    \expandafter\def\csname end#1\endcsname{}}
\def\excludecomment
 #1{\expandafter\def\csname#1\endcsname{\ThrowAwayComment{#1}}%
    {\escapechar=-1\relax
     \csarg\xdef{PlainEnd#1Test}{\string\\end#1}%
     \csarg\xdef{LaLaEnd#1Test}{\string\\end\string\{#1\string\}}%
    }}

%  Define environments that ignore their contents.
\excludecomment{comment}
\excludecomment{rawhtml}
\excludecomment{htmlonly}

%  Hypertext commands etc. This is a condensed version of the html.sty
%  file supplied with LaTeX2HTML by: Nikos Drakos <nikos@cbl.leeds.ac.uk> &
%  Jelle van Zeijl <jvzeijl@isou17.estec.esa.nl>. The LaTeX2HTML documentation
%  should be consulted about all commands (and the environments defined above)
%  except \xref and \xlabel which are Starlink specific.

\newcommand{\htmladdnormallinkfoot}[2]{#1\footnote{#2}}
\newcommand{\htmladdnormallink}[2]{#1}
\newcommand{\htmladdimg}[1]{}
\newcommand{\hyperref}[4]{#2\ref{#4}#3}
\newcommand{\htmlref}[2]{#1}
\newcommand{\htmlimage}[1]{}
\newcommand{\htmladdtonavigation}[1]{}

\newenvironment{latexonly}{}{}
\newcommand{\latex}[1]{#1}
\newcommand{\html}[1]{}
\newcommand{\latexhtml}[2]{#1}
\newcommand{\HTMLcode}[2][]{}

%  Starlink cross-references and labels.
\newcommand{\xref}[3]{#1}
\newcommand{\xlabel}[1]{}

%  LaTeX2HTML symbol.
\newcommand{\latextohtml}{\LaTeX2\texttt{HTML}}

%  Define command to re-centre underscore for Latex and leave as normal
%  for HTML (severe problems with \_ in tabbing environments and \_\_
%  generally otherwise).
\renewcommand{\_}{\texttt{\symbol{95}}}

% -----------------------------------------------------------------------------
%  Debugging.
%  =========
%  Remove % on the following to debug links in the HTML version using Latex.

% \newcommand{\hotlink}[2]{\fbox{\begin{tabular}[t]{@{}c@{}}#1\\\hline{\footnotesize #2}\end{tabular}}}
% \renewcommand{\htmladdnormallinkfoot}[2]{\hotlink{#1}{#2}}
% \renewcommand{\htmladdnormallink}[2]{\hotlink{#1}{#2}}
% \renewcommand{\hyperref}[4]{\hotlink{#1}{\S\ref{#4}}}
% \renewcommand{\htmlref}[2]{\hotlink{#1}{\S\ref{#2}}}
% \renewcommand{\xref}[3]{\hotlink{#1}{#2 -- #3}}
%end{latexonly}
% -----------------------------------------------------------------------------
% ? Document specific \newcommand or \newenvironment commands.
%+
%  Name:
%     SST.TEX

%  Purpose:
%     Define LaTeX commands for laying out Starlink routine descriptions.

%  Language:
%     LaTeX

%  Type of Module:
%     LaTeX data file.

%  Description:
%     This file defines LaTeX commands which allow routine documentation
%     produced by the SST application PROLAT to be processed by LaTeX and
%     by LaTeX2html. The contents of this file should be included in the
%     source prior to any statements that make of the sst commnds.

%  Notes:
%     The style file html.sty provided with LaTeX2html needs to be used.
%     This must be before this file.

%  Authors:
%     RFWS: R.F. Warren-Smith (STARLINK)
%     PDRAPER: P.W. Draper (Starlink - Durham University)

%  History:
%     10-SEP-1990 (RFWS):
%        Original version.
%     10-SEP-1990 (RFWS):
%        Added the implementation status section.
%     12-SEP-1990 (RFWS):
%        Added support for the usage section and adjusted various spacings.
%     8-DEC-1994 (PDRAPER):
%        Added support for simplified formatting using LaTeX2html.
%     {enter_further_changes_here}

%  Bugs:
%     {note_any_bugs_here}

%-

%  Define length variables.
\newlength{\sstbannerlength}
\newlength{\sstcaptionlength}
\newlength{\sstexampleslength}
\newlength{\sstexampleswidth}

%  Define a \tt font of the required size.
\latex{\newfont{\ssttt}{cmtt10 scaled 1095}}
\html{\newcommand{\ssttt}{\tt}}

%  Define a command to produce a routine header, including its name,
%  a purpose description and the rest of the routine's documentation.
\newcommand{\sstroutine}[3]{
   \goodbreak
   \rule{\textwidth}{0.5mm}
   \vspace{-7ex}
   \newline
   \settowidth{\sstbannerlength}{{\Large {\bf #1}}}
   \setlength{\sstcaptionlength}{\textwidth}
   \setlength{\sstexampleslength}{\textwidth}
   \addtolength{\sstbannerlength}{0.5em}
   \addtolength{\sstcaptionlength}{-2.0\sstbannerlength}
   \addtolength{\sstcaptionlength}{-5.0pt}
   \settowidth{\sstexampleswidth}{{\bf Examples:}}
   \addtolength{\sstexampleslength}{-\sstexampleswidth}
   \parbox[t]{\sstbannerlength}{\flushleft{\Large {\bf #1}}}
   \parbox[t]{\sstcaptionlength}{\center{\Large #2}}
   \parbox[t]{\sstbannerlength}{\flushright{\Large {\bf #1}}}
   \begin{description}
      #3
   \end{description}
}

%  Format the description section.
\newcommand{\sstdescription}[1]{\item[Description:] #1}

%  Format the usage section.
\newcommand{\sstusage}[1]{\item[Usage:] \mbox{}
\\[1.3ex]{\raggedright \ssttt #1}}

%  Format the invocation section.
\newcommand{\sstinvocation}[1]{\item[Invocation:]\hspace{0.4em}{\tt #1}}

%  Format the arguments section.
\newcommand{\sstarguments}[1]{
   \item[Arguments:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Format the returned value section (for a function).
\newcommand{\sstreturnedvalue}[1]{
   \item[Returned Value:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Format the parameters section (for an application).
\newcommand{\sstparameters}[1]{
   \item[Parameters:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Format the examples section.
\newcommand{\sstexamples}[1]{
   \item[Examples:] \mbox{} \\
   \vspace{-3.5ex}
   \begin{description}
      #1
   \end{description}
}

%  Define the format of a subsection in a normal section.
\newcommand{\sstsubsection}[1]{ \item[{#1}] \mbox{} \\}

%  Define the format of a subsection in the examples section.
\newcommand{\sstexamplesubsection}[2]{\sloppy
\item[\parbox{\sstexampleslength}{\ssttt #1}] \mbox{} \vspace{1.0ex}
\\ #2 }

%  Format the notes section.
\newcommand{\sstnotes}[1]{\item[Notes:] \mbox{} \\[1.3ex] #1}

%  Provide a general-purpose format for additional (DIY) sections.
\newcommand{\sstdiytopic}[2]{\item[{\hspace{-0.35em}#1\hspace{-0.35em}:}]
\mbox{} \\[1.3ex] #2}

%  Format the implementation status section.
\newcommand{\sstimplementationstatus}[1]{
   \item[{Implementation Status:}] \mbox{} \\[1.3ex] #1}

%  Format the bugs section.
\newcommand{\sstbugs}[1]{\item[Bugs:] #1}

%  Format a list of items while in paragraph mode.
\newcommand{\sstitemlist}[1]{
  \mbox{} \\
  \vspace{-3.5ex}
  \begin{itemize}
     #1
  \end{itemize}
}

%  Define the format of an item.
\newcommand{\sstitem}{\item}

%% Now define html equivalents of those already set. These are used by
%  latex2html and are defined in the html.sty files.
\begin{htmlonly}

%  sstroutine.
   \newcommand{\sstroutine}[3]{
      \subsection{#1\xlabel{#1}-\label{#1}#2}
      \begin{description}
         #3
      \end{description}
   }

%  sstdescription
   \newcommand{\sstdescription}[1]{\item[Description:]
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstusage
   \newcommand{\sstusage}[1]{\item[Usage:]
      \begin{description}
         {\ssttt #1}
      \end{description}
      \\
   }

%  sstinvocation
   \newcommand{\sstinvocation}[1]{\item[Invocation:]
      \begin{description}
         {\ssttt #1}
      \end{description}
      \\
   }

%  sstarguments
   \newcommand{\sstarguments}[1]{
      \item[Arguments:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstreturnedvalue
   \newcommand{\sstreturnedvalue}[1]{
      \item[Returned Value:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstparameters
   \newcommand{\sstparameters}[1]{
      \item[Parameters:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstexamples
   \newcommand{\sstexamples}[1]{
      \item[Examples:] \\
      \begin{description}
         #1
      \end{description}
      \\
   }

%  sstsubsection
   \newcommand{\sstsubsection}[1]{\item[{#1}]}

%  sstexamplesubsection
   \newcommand{\sstexamplesubsection}[2]{\item[{\ssttt #1}] #2}

%  sstnotes
   \newcommand{\sstnotes}[1]{\item[Notes:] #1 }

%  sstdiytopic
   \newcommand{\sstdiytopic}[2]{\item[{#1}] #2 }

%  sstimplementationstatus
   \newcommand{\sstimplementationstatus}[1]{
      \item[Implementation Status:] #1
   }

%  sstitemlist
   \newcommand{\sstitemlist}[1]{
      \begin{itemize}
         #1
      \end{itemize}
      \\
   }
%  sstitem
   \newcommand{\sstitem}{\item}

\end{htmlonly}

%  End of "sst.tex" layout definitions.
%.


% ? End of document specific commands
% -----------------------------------------------------------------------------
%  Title Page.
%  ===========
\renewcommand{\thepage}{\roman{page}}
\begin{document}
\thispagestyle{empty}

%  Latex document header.
%  ======================
\begin{latexonly}
   CCLRC / \textsc{Rutherford Appleton Laboratory} \hfill \textbf{\stardocname}\\
   {\large Particle Physics \& Astronomy Research Council}\\
   {\large Starlink Project\\}
   {\large \stardoccategory\ \stardocnumber}
   \begin{flushright}
   \stardocauthors\\
   \stardocdate
   \end{flushright}
   \vspace{-4mm}
   \rule{\textwidth}{0.5mm}
   \vspace{5mm}
   \begin{center}
   {\Huge\textbf{\stardoctitle \\ [2.5ex]}}
   {\LARGE\textbf{\stardocversion \\ [4ex]}}
   {\Huge\textbf{\stardocmanual}}
   \end{center}
   \vspace{5mm}

% ? Add picture here if required for the LaTeX version.
%   e.g. \includegraphics[scale=0.3]{filename.ps}
% ? End of picture

% ? Heading for abstract if used.
   \vspace{10mm}
   \begin{center}
      {\Large\textbf{Abstract}}
   \end{center}
% ? End of heading for abstract.
\end{latexonly}

%  HTML documentation header.
%  ==========================
\begin{htmlonly}
   \xlabel{}
   \begin{rawhtml} <H1> \end{rawhtml}
      \stardoctitle\\
      \stardocversion\\
      \stardocmanual
   \begin{rawhtml} </H1> <HR> \end{rawhtml}

% ? Add picture here if required for the hypertext version.
%   e.g. \includegraphics[scale=0.7]{filename.ps}
% ? End of picture

   \begin{rawhtml} <P> <I> \end{rawhtml}
   \stardoccategory\ \stardocnumber \\
   \stardocauthors \\
   \stardocdate
   \begin{rawhtml} </I> </P> <H3> \end{rawhtml}
      \htmladdnormallink{CCLRC / Rutherford Appleton Laboratory}
                        {http://www.cclrc.ac.uk} \\
      \htmladdnormallink{Particle Physics \& Astronomy Research Council}
                        {http://www.pparc.ac.uk} \\
   \begin{rawhtml} </H3> <H2> \end{rawhtml}
      \htmladdnormallink{Starlink Project}{http://www.starlink.ac.uk/}
   \begin{rawhtml} </H2> \end{rawhtml}
   \htmladdnormallink{\htmladdimg{source.gif} Retrieve hardcopy}
      {http://www.starlink.ac.uk/cgi-bin/hcserver?\stardocsource}\\

%  HTML document table of contents.
%  ================================
%  Add table of contents header and a navigation button to return to this
%  point in the document (this should always go before the abstract \section).
  \label{stardoccontents}
  \begin{rawhtml}
    <HR>
    <H2>Contents</H2>
  \end{rawhtml}
  \htmladdtonavigation{\htmlref{\htmladdimg{contents_motif.gif}}
        {stardoccontents}}

% ? New section for abstract if used.
  \section{\xlabel{abstract}Abstract}
% ? End of new section for abstract
\end{htmlonly}

% -----------------------------------------------------------------------------
% ? Document Abstract. (if used)
%  ==================
\stardocabstract
% ? End of document abstract

% -----------------------------------------------------------------------------
% ? Latex Copyright Statement
%  =========================
\begin{latexonly}
\newpage
\vspace*{\fill}
\stardoccopyright
\end{latexonly}
% ? End of Latex copyright statement

% -----------------------------------------------------------------------------
% ? Latex document Table of Contents (if used).
%  ===========================================
  \newpage
  \begin{latexonly}
    \setlength{\parskip}{0mm}
    \tableofcontents
    \setlength{\parskip}{\medskipamount}
    \markboth{\stardocname}{\stardocname}
  \end{latexonly}
% ? End of Latex document table of contents
% -----------------------------------------------------------------------------

\cleardoublepage
\renewcommand{\thepage}{\arabic{page}}
\setcounter{page}{1}

%  End of "sst.tex" layout definitions.
% .
% %Z%%M%   %I%   %E% %U%   %D% %T%

% ? Main text
\section{Introduction}
The Odds and Ends  (ONE) library is a collection of
miscellaneous C and Fortran routines called from various packages
in the Starlink Software Collection.
In general these routines have been used in more than one package,
so are suitable to be included in a public library,
but are not suitable for inclusion in one of the other
public libraries of more focussed routines.
\section{List of routines}
These routines were collected by examining possible entries and
by a request for contributions.
Extra routines may be added when necessary.

The contents of the library are (in alphabetical order):\\
\\
\noteroutine{ONE\_EXEC( COMMAND, STATUS )}
    {Executes a shell command.
    Extracted from CCDPACK (submitted by P. Draper).}
\noteroutine{ONE\_FIND\_FILE( FILESPEC, LISDIR, FILENAME, CONTEXT, STATUS )}
    {Returns successive file names that match a file specification.
    Taken from FIGARO, SST, CONVERT, KAPPA and CCDPACK.}
\noteroutine{ONE\_FIND\_FILE\_END( CONTEXT, STATUS )}
    {.Terminate a sequence of FIND\_FILE calls.
    Taken from FIGARO, SST, CONVERT, KAPPA and CCDPACK.}
\noteroutine{ONE\_SCRSZ( WIDTH, HEIGHT, STATUS )}
    {A Fortran callable function to obtain the size of the output screen.
    Taken from CONVERT, KAPPA and IRCAMPACK.}
\noteroutine{ONE\_SHELL\_ECHO( FILESPEC, FILENAME, STATUS )}
    {Expands shell metacharacters in a string without file globbing.}
\noteroutine{one\_strlcat( dest, src, sizedest, status )}
    {Wrapper around the standard BSD strlcat C function (safer variant
      of strncat).}
\noteroutine{one\_strlcpy( dest, src, sizedest, status )}
   {Wrapper around the standard BSD strlcpy C function (safer variant of strncpy).}
\noteroutine{one\_strtod( instr, status )}
   {Extract a double precision value from a C string.}
\noteroutine{ONE\_WORDEXP\_FILE( WORDS, CONTEXT, EXPAN, STATUS)}
  {WORDEXP wrapper that verifies a file exists.}
\noteroutine{ONE\_WORDEXP\_NOGLOB( WORDS, EXPAN, STATUS)}
  {WORDEXP wrapper that expands shell variables without globbing.}
\section{Routines descriptions}
There follows a full description of the library routines in alphabetical order:

\sstroutine{
   ONE\_EXEC
}{
   Executes a shell command
}{
   \sstdescription{
      This routine gives FORTRAN programs access to the UNIX
      system(3) command. See the system(3) man page for how to
      construct a suitable command.
   }
   \sstinvocation{
      CALL ONE\_EXEC(COMMAND, STATUS)
   }
   \sstarguments{
      \sstsubsection{
         COMMAND = CHARACTER $*$ ( $*$ ) (Given)
      }{
         The command to be executed.
      }
      \sstsubsection{
         STATUS = INTEGER (Given and Returned)
      }{
         The global status. Set to SAI\_\_ERROR if command fails.
      }
   }
}
\sstroutine{
   ONE\_FIND\_FILE
}{
   Returns successive file names that match a file specification
}{
   \sstdescription{
      This routine is intended to provide some of the faciltes provided
      on a VAX by the standard VMS routine LIB\$FIND\_FILE.  It is passed
      a file specification that can contain wild card characters such as
      {\tt '}$*${\tt '}, eg {\tt '}$*$.$*${\tt '}. On the first call the Context variable should be set
      to zero, and the routine will return the name of the first file that
      matches the file specification. On subsequent calls the calling
      routine should continue to call using the value of Context returned
      by the previous call, and each call will return the name of the next
      file that matches the specification. When the last file that matches
      the specification has been returned, subsequent calls will return
      a blank string as the file name and an error code (an even value)
      as the function value. Finally, a call to ONE\_FIND\_FILE\_END with the
      last returned value of Context will close down any files opened or
      memory allocated by ONE\_FIND\_FILE.
   }
   \sstinvocation{
      FOUND = ONE\_FIND\_FILE (FILESPEC,LISDIR,FILENAME,CONTEXT,STATUS)
   }
   \sstarguments{
      \sstsubsection{
         FILESPEC = CHARACTER (Given)
      }{
         The file specification to be matched.  May contain wildcards.
         Case sensitive.
      }
      \sstsubsection{
         LISDIR = LOGICAL (Given)
      }{
         TRUE if directory contents are to be listed for directories
         that match the file specification. Should be set to FALSE
         if matching directory names should be returned without opening the
         directories themselves. Note that even if true, this routine
         will not recurse into all subsubdirectories that match. To be
         more explicit: TRUE is equivalent to {\tt '}ls{\tt '}, FALSE is equivalent to
         {\tt '}ls -d{\tt '}. Neither is equivalent to {\tt '}find . -name {\tt "}filespec{\tt "}{\tt '}
      }
      \sstsubsection{
         FILENAME = CHARACTER (Returned)
      }{
         The name of a file that matches FILESPEC.
      }
      \sstsubsection{
         CONTEXT = INTEGER (Given and Returned)
      }{
         A variable used to remember the context of
         a series of calls for the same file specification.
         Should be set to zero by the caller for the first call
         for a new specification and the value then returned
         by this routine should be used in subsequent calls.
      }
      \sstsubsection{
         STATUS = INTEGER (Given and Returned)
      }{
         A status code as follows
         \sstitemlist{

            \sstitem
            SAI\_\_OK for success

            \sstitem
            ONE\_\_NOFILES - No more files found

            \sstitem
            ONE\_\_LENGTHERR - Bad parameter length

            \sstitem
            ONE\_\_PIPEERR  - Pipe error

            \sstitem
            ONE\_\_MALLOCERR - Malloc error
         }
      }
   }
   \sstreturnedvalue{
      \sstsubsection{
         ONE\_FIND\_FILE = LOGICAL
      }{
         TRUE if File Found
         FALSE if error or no more files
      }
   }
   \sstnotes{
      This routine returns bad status (ONE\_\_NOFILES) even when the
      status is not technically bad. In general, the caller should
      annul this particular status condition before proceeding.
   }
   \sstbugs{
      This routine does not provide all the facilities offered by the
      original VAX version; it only accepts the first three arguments as
      listed above, and almost of necessity it uses and expects UNIX syntax
      for the file specs.  This means that {\tt '}/usr/users/ks/ $*$.$*${\tt '} is OK, but
      {\tt '}[ks]$*$.$*${\tt '} is not. Note that {\tt '}$*${\tt '} and {\tt '}$*$.$*${\tt '} will give quite different
      results under UNIX, whereas under VMS they would be the same. There
      is no way of specifying recursion; {\tt '}/usr/user/ks/...{\tt '} for example
      is meaningless. Nevertheless, it is hoped that it is close enough in
      functionality to the VMS original to act as a useable substitute in
      most cases. It cannot handle specifications that the standard shell
      (sh) cannot handle in an {\tt '}ls{\tt '} command - there are some variations of
      the {\tt '}ls{\tt '} command involving complex wildcarding that will cause sh
      on a SUN to hang, and they will also hang this routine.

      It is not at all clear that the method used here is  in any way
      the best solution to the problem, and there are a number of possible
      alternatives that could be tried, including using {\tt '}find{\tt '} rather than
      {\tt '}ls{\tt '}, or using routines such as readdir() to search the file system
      and do any pattern matching in this routine itself. The program as it
      stands should be regarded (tolerantly!) as an initial attempt and
      the author would be glad to be sent a better version.
   }
}
\sstroutine{
   ONE\_FIND\_FILE\_END
}{
   Terminate a sequence of ONE\_FIND\_FILE calls
}{
   \sstdescription{
      This routine should be called after a sequence of calls to ONE\_FIND\_FILE
      in order to release any resources used by ONE\_FIND\_FILE.  It should be
      passed in its Context argument the value of the Context argument
      as returned by the ONE\_FIND\_FILE in the last call in the sequence that
      is to be closed down.
   }
   \sstinvocation{
      CALL ONE\_FIND\_FILE\_END (CONTEXT, STATUS )
   }
   \sstarguments{
      \sstsubsection{
         CONTEXT = INTEGER (Given)
      }{
         The context argument returned by the last call to ONE\_FIND\_FILE
         in the sequence to be closed down.
      }
      \sstsubsection{
         STATUS = INTEGER (Given and Returned)
      }{
         Inherited status. Routine will attempt to free resources even
         if status is bad on entry.
      }
   }
}
\sstroutine{
   ONE\_SCRSZ
}{
   A Fortran callable function to obtain the size of the output screen
}{
   \sstdescription{
      This routine interrogates the system to find the width and height of the screen
      on which it is running.  Should an error occur or the width is
      not positive, set to the default of 80 characters by 0 lines.
   }
   \sstinvocation{
      CALL ONE\_SCRSZ( WIDTH, HEIGHT, STATUS )
   }
   \sstarguments{
      \sstsubsection{
         WIDTH = INTEGER (Returned)
      }{
         The width of the screen in characters. (default 80)
      }
      \sstsubsection{
         HEIGHT = INTEGER (Returned)
      }{
         The height of the screen in lines. (default 0)
      }
      \sstsubsection{
         STATUS = INTEGER (Given and Returned)
      }{
         The global status.
         Set to SAI\_\_ERROR if an error occurs..
      }
   }
   \sstnotes{
      This is the UNIX version.
   }
}
\sstroutine{
   ONE\_SHELL\_ECHO
}{
   Interpret shell metacharacters in a string, without file globbing.
}{
   \sstdescription{
      This routine is intended to expand shell metacharacters within
      a supplied file name, in the case where the file may not already
      exist. Any wild card characters within the string are ignored (i.e.
      there is no file globbing).
   }
   \sstinvocation{
      CALL ONE\_SHELL\_ECHO( FILESPEC, FILENAME, STATUS )
   }
   \sstarguments{
      \sstsubsection{
         FILESPEC = CHARACTER (Given)
      }{
         The file specification to be echoed.
      }
      \sstsubsection{
         FILENAME = CHARACTER (Returned)
      }{
         The result of expanding any shell metacharacters (except wild
         cards) within FILESPEC.
      }
      \sstsubsection{
         STATUS = INTEGER (Given and Returned)
      }{
         A status code as follows
         \sstitemlist{

            \sstitem
            SAI\_\_OK for success

            \sstitem
            ONE\_\_LENGTHERR - Bad parameter length

            \sstitem
            ONE\_\_PIPEERR  - Pipe error

            \sstitem
            ONE\_\_MALLOCERR - Malloc error
         }
      }
   }
}
\sstroutine{
   one\_strlcat
}{
   Starlink compliant wrapper around the BSD strlcat function
}{
   \sstdescription{
      The strlcat function is similar to the strncat function except
      that it guarantees to nul terminate the destination string
      and returns the number of characters that will have been copied.
      This wrapper function provides standard Starlink inherited status
      semantics.
   }
   \sstinvocation{
      len = one\_strlcat( char $*$ dest, const char $*$ src,
                         size\_t sizedest, int $*$ status );
   }
   \sstarguments{
      \sstsubsection{
         dest = char $*$ (Returned)
      }{
         Destination buffer for {\tt "}src{\tt "}. Must be nul-terminated.
         If status is bad on entry ''dest'' will not be touched.
      }
      \sstsubsection{
         src = const char $*$ (Given)
      }{
         String to be copied.
      }
      \sstsubsection{
         sizedest = size\_t (Given)
      }{
         The actual buffer size of {\tt "}dest{\tt "} including space for a nul.
      }
      \sstsubsection{
         status = int $*$ (Given and Returned)
      }{
         Inherited status. Will be set to ONE\_\_TRUNC if the string
         was truncated on copy.
      }
   }
   \sstreturnedvalue{
      \sstsubsection{
         size\_t retval
      }{
         Length of the string after appending. Will either be
         the length of the source string or one less than the
         size of the destination buffer.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         This is for use from C only.

         \sstitem
         If available the system strlcat routine will be used.
      }
   }
}
\sstroutine{
   one\_strlcpy
}{
   Starlink compliant wrapper around the BSD strlcpy function
}{
   \sstdescription{
      The strlcpy function is similar to the strncpy function except
      that it guarantees to nul terminate the destination string
      and returns the number of characters that will have been copied.
      This wrapper function provides standard Starlink inherited status
      semantics.
   }
   \sstinvocation{
      len = one\_strlcpy( char $*$ dest, const char $*$ src,
                         size\_t sizedest, int $*$ status );
   }
   \sstarguments{
      \sstsubsection{
         dest = char $*$ (Returned)
      }{
         Destination buffer for {\tt "}src{\tt "}. Will be nul-terminated.
         If status is bad on entry, dest will be nul-terminated
         if it is non-NULL.
      }
      \sstsubsection{
         src = const char $*$ (Given)
      }{
         String to be copied.
      }
      \sstsubsection{
         sizedest = size\_t (Given)
      }{
         The actual buffer size of {\tt "}dest{\tt "} including space for a nul.
      }
      \sstsubsection{
         status = int $*$ (Given and Returned)
      }{
         Inherited status. Will be set to ONE\_\_TRUNC if the string
         was truncated on copy.
      }
   }
   \sstreturnedvalue{
      \sstsubsection{
         size\_t retval
      }{
         Length of the string after copying. Will either be
         the length of the source string or one less than the
         size of the destination buffer.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         This is for use from C only.

         \sstitem
         If available the system strlcpy routine will be used.
      }
   }
}
\sstroutine{
   one\_strtod
}{
   Starlink compliant wrapper around the standard strtod function
}{
   \sstdescription{
      The strtod() function converts a string to a double precision
      number. This function is the same except that there is not endptr
      argument and it will set status to bad on failure and use inherited
      status.
   }
   \sstinvocation{
      dval = one\_strtod( const char $*$ instr, int $*$ status );
   }
   \sstarguments{
      \sstsubsection{
         instr = const char $*$ (Given)
      }{
         Input string to parse. Must be nul-terminated standard
         C string suitable for the strtod() library call.
      }
      \sstsubsection{
         status = int $*$ (Given and Returned)
      }{
         Inherited status. Will be set to ONE\_\_CNVERR if the string
         did not contain a number.
      }
   }
   \sstreturnedvalue{
      \sstsubsection{
         double dval
      }{
         Converted double precision value. VAL\_\_BADD on error.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         This is for use from C only.

         \sstitem
         Fortran D format is supported so 5.2D5 is converted to 5.2E5
           before involving strtod.
      }
   }
   \sstdiytopic{
      See Also
   }{
      \sstitemlist{

         \sstitem
         CHR\_CTOD subroutine.
      }
   }
}
\sstroutine{
   ONE\_WORDEXP\_FILE
}{
   WORDEXP wrapper that verifies a file exists
}{
   \sstdescription{
      A wrapper around PSX\_WORDEXP that only returns files that
      match the supplied WORDS string following expansion. EXPAN
      will be an empty string if there are no matches and CONECT
      will be set to 0.
   }
   \sstinvocation{
      CALL ONE\_WORDEXP\_FILE( WORDS, CONTEXT, EXPAN, STATUS )
   }
   \sstarguments{
      \sstsubsection{
         WORDS = CHARACTER$*$($*$) (Given)
      }{
         The string to be shell expanded.
      }
      \sstsubsection{
         CONTEXT = INTEGER (Given \& Returned)
      }{
         Should be initialised to 0 for initial shell expansion. Will
         be set to zero when no more results are available.
      }
      \sstsubsection{
         EXPAN = CHARACTER$*$($*$) (Given)
      }{
         Expanded string. A new string will be returned each call until
         all are returned an CONTEXT is set to 0.
      }
      \sstsubsection{
         STATUS = INTEGER (Given \& Returned)
      }{
         The global status.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         Continue to call this routine until CONTEXT is set to 0, otherwise
         there will be a possible memory leak.

         \sstitem
         If there are multiple returns from PSX\_WORDEXP that are not files
         this routine will loop internally until a valid file is located.
      }
   }
}
\sstroutine{
   ONE\_WORDEXP\_NOGLOB
}{
   WORDEXP wrapper that expands shell variables without globbing
}{
   \sstdescription{
      A wrapper around PSX\_WORDEXP that does shell expansion without
      doing globbing. Glob wildcard characters are escaped, as are
      illegal, to wordexp(), shell metacharacters such as {\tt "}({\tt "} and {\tt "}){\tt "}.

      Only a single expansion string is returned by this routine and it
      is an error for wordexp() to return multiple matches.
   }
   \sstinvocation{
      CALL ONE\_WORDEXP\_NOGLOB( WORDS, EXPAN, STATUS )
   }
   \sstarguments{
      \sstsubsection{
         WORDS = CHARACTER$*$($*$) (Given)
      }{
         The string to be shell expanded.
      }
      \sstsubsection{
         EXPAN = CHARACTER$*$($*$) (Given)
      }{
         Expanded string.
      }
      \sstsubsection{
         STATUS = INTEGER (Given \& Returned)
      }{
         The global status.
      }
   }
   \sstdiytopic{
      See Also
   }{
      ONE\_SHELL\_ECHO is similar except that it guarantees to fork
      whereas wordexp() might not fork.
   }
}

\end{document}
