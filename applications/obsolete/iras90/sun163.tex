\documentclass[11pt,nolof,noabs]{starlink}

%------------------------------------------------------------------------------
\stardoccategory    {Starlink User Note}
\stardocinitials    {SUN}
\stardocnumber      {163.3}
\stardocauthors     {David S. Berry, W. Gong, D. C. Parsons}
\stardocdate        {19 February 1995}
\stardoctitle     {IRAS90 --- IRAS Survey and PO Data Analysis
                                Package}
\stardocmanual{Reference Guide}
%------------------------------------------------------------------------------

%------------------------------------------------------------------------------
% Add any \providecommand or \newenvironment commands here

% centre an asterisk
\providecommand{\lsk}{\raisebox{-0.4ex}{\rm *}}

%------------------------------------------------------------------------------

\begin{document}
\scfrontmatter

\section{Introduction}
{\small IRAS90} is a package of applications which provides facilities for the
reduction and analysis of {\small IRAS} Survey and Pointed Observation (PO) data (also
known as ``Additional Observation'', or ``AO'' data). It does not provide
facilities for handling Low Resolution Spectrometer (LRS) data, or catalogue
data.

Specifically, {\small IRAS90} provides the following facilities:

\begin{itemize}

\item Creation of surface brightness images by the co-addition of Calibrated
Reconstructed Detector Data ({\small CRDD}) samples. This includes destriping,
background removal, and mapping of the {\small CRDD}.

\item Graphical inspection of individual {\small CRDD} files.

\item Creation of simulated {\small CRDD} from a trial sky image, using individual
detector Point Spread Functions (PSFs).

\item Preparation of {\small IRAS} {\small FITS} images prior to use by other
{\small IRAS90} applications, or other {\small ADAM} packages such as {\small
KAPPA, CCDPACK, PISA,} etc.

\item Creation of colour temperature maps, optical depth maps and colour
corrected surface brightness maps, based on optically thin greybody source
spectra.

\item Various astrometric operations such as returning celestial coordinates
at given image pixels, aligning a group of images, annotating a displayed
image with a celestial coordinates grid, etc.

\item Routines for assigning nominated ``qualities'' to selected elements of an
image or {\small CRDD} file.

\end{itemize}

{\small IRAS90} runs under the Starlink {\small ADAM} environment, on either
{\small VMS} or {\small UNIX} operating systems, and uses the ``Extensible
N-dimensional data format'' ({\small NDF}) for storing data in {\small HDS}
files. {\small IRAS90} uses an {\small NDF} ``extension'' named ``{\small
IRAS}'' to store package-specific information within each data file. \xref{SG/4}{sg4}{} gives
an overview of {\small ADAM}, {\small NDF} and {\small HDS} concepts.

\subsection{Use of KAPPA and SUN/95}
It is expected that users of {\small IRAS90} will also make extensive use of the
Starlink ``Kernel Application Package'' ({\small KAPPA}) to perform non-IRAS
specific tasks such as displaying images, modifying {\small NDF} components,
contouring data, etc. For this reason, (and also because the user interface to
{\small IRAS90} shares many things in common with {\small KAPPA}), users of
{\small IRAS90} should ensure that they are familiar with  the {\small KAPPA}
users guide, \xref{SUN/95}{sun95}{}. Don't be off-put by the fact that \xref{SUN/95}{sun95}{} is quite thick! It
is written in a form which makes it possible to dip in almost at random to
obtain information on specific points. A new user would be well advised to read
through the introduction and demonstrations given at the start of the document,
but then may want to jump straight into some ``hands-on'' experience. The best
way to do this is to become familiar with the contents of the ``Classified
list''  of {\small KAPPA} commands. This gives a brief description of which
{\small KAPPA} commands do  what. Having decided on an interesting command, look
up the full specification of the command in the relevant appendix, and skim
through it to get an idea of what it does and how the various application
parameters can be used to modify its behaviour. If the specification uses terms
with which you are unfamiliar, then you may want to look through the contents
table at the front of the document to find the sections which describe them.

\section{Obtaining IRAS Data}
{\small IRAS} data can be obtained from {\small FIIS/IPMAF} (the {\small IRAS}
User Support Group) at the Rutherford Appleton Laboratory ({\small RAL}).
Enquires should be sent by electronic mail to username {\small IRASMAIL} at
{\small RLVAD}. The ``{\small IRAS} Data Products Primer'' (\xref{SUN/82}{sun82}{}) should be
consulted for details of the available data.

\section{Recipes for Common Operations}
This section contains brief outlines of how several common {\small IRAS} data
reduction operations can be implemented using {\small IRAS90}. It does not give
a ``blow-by-blow'' account of each application. In general, {\small IRAS90}
applications can be run without needing to know the details of the algorithm or
the range of parameters available to modify the default behaviour. If the
parameter prompts displayed on the screen as the application progresses do not
make it clear to you what is required, then entering a single question mark
(``?'') will display more information about the current parameter, and then
repeat the parameter prompt. A double question mark (``??'') will leave the user
in the {\small IRAS90} help library so that other items of help can be read (the
parameter prompt is repeated when the help library is finally exited).

Having said that, it is strongly recommended that users read the full
application specifications in appendix \ref{ap:full}. These describe the full
range of facilities provided by each application, and also describe what each
application does to the data.

\subsection{Starting up IRAS90}
{\small IRAS90} comes in two forms.  One is a monolith that is activated within
the {\small ADAM} command language---{\small ICL}.  The other comprises
individual applications and is run from {\small DCL} (on {\small VMS}), or from
the the shell (on {\small UNIX}).  The monolith has the advantage that after the
initial pause while it loads, all its constituent applications are available
immediately.  There is no pause while each new application is fired up.  This is
fine when you wish to run several applications and/or the same application
several times. However, for single tasks it may be more convenient to run from
{\small DCL} or the shell.

To run {\small IRAS90} on {\small VMS} from {\small DCL} , just enter the
command

\small
\begin{terminalv}
$ IRAS90
\end{terminalv}
\normalsize

This executes a procedure setting up symbols for {\small IRAS90}'s command
names, and defines some logical names to make help information available.

The command to run the {\small IRAS90} monolith is almost the same except you
must be within the {\small ADAM} command language.  This requires just one extra
command, namely

\small
\begin{terminalv}
$ ADAM
\end{terminalv}
\normalsize

You will see any messages produced by system and user procedures, followed
by the \texttt{ICL>} prompt. Again there is a procedure for making the
commands known to the command language, and not unexpectedly, it too is

\small
\begin{terminalv}
ICL> IRAS90
\end{terminalv}
\normalsize

To run {\small IRAS90} on {\small UNIX} from the shell, first ensure that you
have a subdirectory \textbf{adam} within the directory identified by environment
variable \textbf{HOME}. Then enter the command

\small
\begin{terminalv}
% iras90
\end{terminalv}
\normalsize
This executes a script setting up aliases for {\small IRAS90}'s command names.

In all cases you'll see a message telling you which version of {\small IRAS90}
is ready for use.

\subsection{Getting Help}
{\small IRAS90} includes an on-line help library which contains most of the
information contained in this document, in a hierarchical VMS-like form. It can
be accessed in several ways:
\begin {itemize}
\item The command {\small I90HELP} (or \textbf{i90help} on {\small UNIX}) will put
the user at the top level of the help library. The user can then navigate
through the help library using the usual {\small VMS} techniques (even on
{\small UNIX}). \item When an {\small IRAS90} application issues a prompt, the
user can respond with a single or double question mark (``?'' or ``??''). The
former displays the description of the current parameter from the help library
and then re-issues the prompt for the parameter. The latter displays the same
information, but leaves the user in the help library, thus allowing other
information to be examined. The parameter prompt is re-issued when the help
library is finally exited.
\item Within {\small ICL}, the command

\small
\begin{terminalv}
ICL> HELP <application>
\end{terminalv}
\normalsize
will display information about the specified {\small IRAS90} application. Note,
the application must be specified on the {\small HELP} command line as shown. The user
will be left in the {\small IRAS90} help library after the information has been
displayed.
\end{itemize}

\subsection{Preparing FITS Images for use by IRAS90 and KAPPA}
The starting point for this process depends on where the data is stored. If the
data is in a {\small FITS} file on magnetic tape, then {\small KAPPA:FITSIN}
(i.e. the {\small FITSIN} application from the {\small KAPPA} package) should be used to
create an {\small NDF} holding the data. If the data is in a {\small FITS} file
on disk, then {\small KAPPA:FITSDIN} should be used. Both of these applications
create an {\small NDF} holding the main data array and key words from the
{\small FITS} file. However, the {\small FITS} keywords are not at this point
stored in a form in which they can easily be accessed by {\small IRAS90}
applications. In addition, some {\small IRAS} {\small FITS} files contain images
in an inconvenient form (CPC images for instance are stored in a three
dimensional stack, and {\small SKYFLUX} images are stored ``flipped'' so that
north is downwards). To circumvent these problems, the output from {\small
KAPPA:FITSIN} (or {\small FITSDIN}) should be processed using {\small IRAS90}
application {\small PREPARE}. One of the major tasks accomplished by {\small
PREPARE} is to create an ``astrometry structure'' within the {\small NDF} which
describes the position on the sky of each pixel in the image. This structure is
needed if any of the astrometric applications within {\small IRAS90} (such as
{\small SKYGRID, SKYPOS,} etc) are to be used.

\subsection{Creating Images from a Set of CRDD files}
\label{SEC:MAPS}
To map a group of {\small CRDD} files into a surface brightness image, the three
applications {\small DESTCRDD}, {\small BACKCRDD} and {\small MAPCRDD} should be
run. {\small DESTCRDD} performs detector-to-detector destriping within a {\small
CRDD} file, but leaves the mean background within the {\small CRDD} file
unaltered. {\small BACKCRDD} removes a background from the entire {\small CRDD}
file (the same background for all detectors), and can thus be used for reducing
scan-to-scan stripes. {\small MAPCRDD} converts the time ordered {\small CRDD}
samples into a two dimensional surface brightness image by co-adding the sample
values which contribute to each image pixel.

\begin{sloppypar}
I will assume that the current directory is empty except for a set of {\small
CRDD} files called \textbf{xxxx\_bisj.sdf} (where \textbf{xxxx} is a string
identifying the object, \textbf{i} is the waveband index (1, 2, 3 or 4 for the 12,
25, 60 and 100 $\mu$m bands) and \textbf{j} is a scan number varying from 1 to how
ever many {\small CRDD} files you have. The following commands perform the
standard mapping operations, using default behaviour (prompts are shown indented
from the commands, and the user response follows the \verb+>+ character.
\verb+<RET>+ indicates that the {\small RETURN} key should be pressed without
entering any other text):
\end{sloppypar}

\small
\begin{terminalv}
DESTCRDD
  IN - Input CRDD files // > xxxx_b1s*
  OUT - Output CRDD files > *_ds
BACKCRDD
  IN - Input CRDD files // > xxxx_b1s*_ds
  OUT - Output CRDD files > *|_ds|_bk|
MAPCRDD
  IN - The input CRDD files // > xxxx_b1s*_bk
  PIXSIZE - Output pixel dimensions in arc-minutes // > <RET>
  CENTRE_LON - Right Ascension (B1950) of the image centre // > <RET>
  CENTRE_LAT - Declination (B1950) of the image centre // > <RET>
  BOXSIZE - Dimensions of output image in arc-minutes // > <RET>
  OUT - The output NDF containing the mapped CRDD > xxxx_b1_image
\end{terminalv}
\normalsize

Any strings contained between the the two ``\verb+/+'' characters can be ignored
for the moment.
This sequence of commands will cause all the 12 $\mu$m {\small CRDD} files to be
mapped into an image stored in the file \textbf{xxxx\_b1\_image.sdf}. Note, all
{\small CRDD} files are processed together, there is no need to  re-invoke each
application for each {\small CRDD} file. The \verb+*+ characters are used as
wild-cards within input file specifications, and an output file specification
such as ``\verb+*|_ds|_bk|+'' means ``\emph{Create an output {\small NDF} for
every input {\small NDF}, with the output name being the same as the input name
except that} \textbf{\_ds} \emph{is replaced by} \textbf{\_bk}''. See section
\ref{SEC:GRP} for a full description of the use of wild-cards for specifying
input and output {\small NDF}s. Thus the above commands will create a set of
files \textbf{xxxx\_bisj\_ds.sdf} containing the destriped {\small CRDD} files, and
a set of files \textbf{xxxx\_bisj\_bk.sdf} containing the background subtracted
{\small CRDD} files.

\subsection{Displaying an Image Annotated with Celestial Coordinates}
To display a grey-scale image, use {\small KAPPA:DISPLAY}. Then use {\small
SKYGRID} to add a celestial coordinate grid round the image. By default,
SKYGRID displays equatorial coordinates (equinox 1950), but if necessary the
SKYGRID parameter COORDS can be used to specify a different equinox, or to
specify ecliptic or galactic coordinates (see section \ref{SEC:SKY}).

\subsection{Transforming Between Celestial and Pixel Coordinates}
If you want to find where-abouts in an image a particular point on the sky is
positioned, or conversely what celestial coordinates correspond to a given
position in the image, {\small SKYPOS} can be used. {\small SKYPOS} can also
give information about the local pixel dimensions and image orientation at any
position within an image. These can vary across large images because of
projection effects.

\subsection{Producing a Hard-Copy Contour Map Annotated with Celestial Coordinates}
\begin{sloppypar}
If the output were required on an image display device, the commands would be
just {\small KAPPA:TURBOCONT} followed by {\small SKYGRID}. Complications
arise when a hard-copy device is used because the two applications produce two
separate pages of output. However, all is not lost if you are willing to use a
{\small POSTSCRIPT} printer. In this case, the {\small PSMERGE} facility (see
\xref{SUN/164}{sun164}{}) can be used to stack together the two separate {\small POSTSCRIPT}
output files generated by the two applications. This operation has been
packaged
up into a procedure called {\small PSCONT} which is contained within {\small
IRAS90}. It provides only limited facilities, but can be used as the basis for
procedures written by the user.
\end{sloppypar}

\subsection{Obtaining Integrated Flux Densities within an Aperture}
The application {\small SKYPHOT} can be used to integrate the flux density
within a rectangular, elliptical or polygonal aperture. It displays the
integrated flux density, the mean surface brightness and the standard deviation
of the surface brightness within the aperture. A supplied constant background
surface brightness may be removed before estimating these values. A convenient
way to use {\small SKYPHOT} is to display the image first (eg using {\small
KAPPA:DISPLAY}) and then assign the value {\small CURSOR} to {\small SKYPHOT}
parameter {\small MODE}. The user can then use a cursor to select the centres of
rectangular or elliptical apertures, or to select the vertices of polygonal
apertures.

\subsection{Aligning Images}
The application {\small SKYALIGN} can be used to align a group of images. This
may be useful for instance if an image created by {\small MAPCRDD} is to be
compared, pixel by pixel, with a corresponding image from the {\small IRAS} Sky
Survey Atlas ({\small ISSA}). {\small SKYALIGN} uses the astrometry information
stored with the image in the {\small NDF} to perform the alignment. {\small
MAPCRDD} and {\small PREPARE} create such astrometry information.

\subsection{Producing Colour Temperature Maps}
\label{SEC:TMAP}
The task of producing colour temperature maps contains at least three separate
problems:
\begin{enumerate}
\item Producing two images with similar resolution from two different
wavebands.
\item Subtracting a suitable background from each image.
\item Calculating the temperature at each pixel.
\end{enumerate}
The first step can be accomplished using the following recipe:
\begin{itemize}
\item Create two images from the two separate wavebands as normal (see section
\ref{SEC:MAPS}).
\item Use each image to generate simulated {\small CRDD}, using application
{\small SIMCRDD}. The input {\small CRDD} files (which are used to define the
position and PSF for each sample) should be for the \emph{other} waveband. For
instance, if the two wavebands are 60 and 100 $\mu$m, then the 60 $\mu$m image
should be sampled at positions defined by the 100 $\mu$m {\small CRDD} files,
and likewise the 100 $\mu$m image should be sampled at positions defined by the
60 $\mu$m {\small CRDD files}.
\item The {\small CRDD} files generated by {\small SIMCRDD} should be mapped
using {\small MAPCRDD}. The resulting images should have similar resolution.
\item The images created by {\small MAPCRDD} will have inappropriate wavebands
stored within them (the stored wavebands will be those of the {\small CRDD}
files used to define sample positions when creating simulated data). Application
{\small SETIMAGE} should be used to correct this.

\end{itemize}

Having created two surface brightness images with similar resolution, the
facilities of {\small KAPPA} should be used to remove an appropriate background
from each image, leaving only the flux for which the temperature is required.

Having done that, the {\small IRAS90} application {\small COLTEMP} can be used
to produce a colour temperature map and an optical depth map from the two
surface brightness maps (a greybody source spectrum is assumed, with a
user-specified emissivity spectral index, $\beta$).

An example of a procedure which goes through the entire process of producing
a colour temperature map from two sets of ``raw'' {\small CRDD} files is
described in appendix \ref{APP:MAS}.

\subsection{Producing Colour Corrected Surface Brightness Images}
By default, flux density values calculated by {\small IRAS90} assume that the
flux density emitted by the source is inversely proportional to frequency.
Adjusting quoted flux density values to refer to some other known source
spectrum is known as ``colour correction'' and is described in the \emph{{\small
IRAS} Catalogs and Atlases Explanatory Supplement}, page VI-27. The application
{\small COLCORR} produces colour corrected images assuming that the source
spectrum is that of an optically thin greybody. The user should first produce
colour temperature and optical depth maps using the recipe described in section
\ref{SEC:TMAP}, and these should then be given as input to {\small COLCORR}.

\subsection{Improved Destriping and Background Removal}
Sometimes, a very bright extended source can ``fool''  {\small DESTCRDD} or
{\small BACKCRDD} into thinking that the background level in a given detector
data stream is higher than it actually is. If this artificially high
background is subtracted from the data, the resulting images can display lower
background levels on the in-scan sides of the source than on the cross-scan
sides. The applications {\small DESTCRDD} and {\small BACKCRDD} contain
filtering algorithms which can be tuned to reduce these sorts of effects, but if
necessary, the ``Quality'' system used by  {\small IRAS90} can also be used.
This requires the user to identify ``source regions'' which are to be excluded
from the estimation of the destriping constants and background levels. There
are several ways in which this can be done; for instance the {\small KAPPA}
applications {\small ZAPLIN} can be used to manually identify and remove
source regions from an initial map:

\begin{itemize}
\item Follow the procedure described in section \ref{SEC:MAPS} to produce a
first estimate of the map.
\item Use {\small KAPPA:ZAPLIN}  (with parameter ZAPTYPE set to ``bad'') to
create a copy of the image in which the area containing the offending source has
been replaced with ``bad'' values.
\item Use {\small SIMCRDD} to generate simulated {\small CRDD} files using the
output from {\small KAPPA:ZAPLIN} as the trial sky input, and the original
{\small CRDD} files to define the position and PSF for each sample. The
simulated samples corresponding to the source area will hold ``bad'' values.
\item Use {\small SETQUAL} to assign a quality name (let's assume you use the
quality name ``{\small SOURCE}'') to the samples in the original CRDD files
which fall in the source region. To do this the input {\small NDF}s should be
the original {\small CRDD} files, and the mask {\small NDF}s should be the ones
generated by {\small SIMCRDD}. The {\small SETQUAL} function should be ``HS''.
This ensures that the quality ``{\small SOURCE}'' is held by all the samples
which are bad in the {\small CRDD} files generated by {\small SIMCRDD} (i.e.
all samples falling within the source region).
\item Run {\small DESTCRDD} on the original input {\small CRDD} files,
specifying ``{\small .NOT.SOURCE}'' for parameter {\small QEXP}. This causes all
the samples with quality ``{\small SOURCE}'' to be excluded from the estimation
of the detector backgrounds. Note, it does \emph{not} mean that these samples
will be excluded from the output {\small CRDD} files!
\item Run {\small BACKCRDD} on the output {\small CRDD} files from {\small
DESTCRDD}, specifying ``{\small .NOT.SOURCE}'' for parameter {\small QEXP}. This
causes all the samples with quality ``{\small SOURCE}'' to be excluded from the
estimation of the {\small CRDD} file backgrounds.
\item Run {\small MAPCRDD} again on the output {\small CRDD} files from {\small
BACKCRDD}.
\end{itemize}

The {\small ICL} procedure ``{\small MASTER}'' described in appendix
\ref{APP:MAS} contains an alternative approach to improved destriping in which
the source regions are identified automatically. In addition, {\small MASTER}
uses the extra trick of running the data through {\small DESTCRDD} and {\small
BACKCRDD} twice.

\section{Using IRAS90 -- Details}
This section contains details of how to use various features of the {\small
IRAS90} user interface. It can be skipped over on an initial reading. The full
specifications of the {\small IRAS90} applications contained in appendix
\ref{ap:full} contain references to the sub-sections described below.

\subsection{Message Filtering}
\label{SEC:MSG}
Most applications have a parameter called {\small MSG\_FILTER} which
controls the display of informational messages normally sent to
the users terminal screen or batch job log file. These
parameters are usually defaulted, but the user can assign any of
the following three values by specifying it on the command line:
\begin{description}
\item [QUIET]   - This value suppresses all informational messages.
               Error messages are still displayed.

\item [NORMAL]  - This value causes the application to produce
               messages of primary interest to a typical user.

\item [VERBOSE] - This value causes extra messages to be displayed
               which further describe the processing performed
               by the application. These messages may well be of
               only secondary interest to a typical user.
\end{description}

Once a value has been assigned to an {\small MSG\_FILTER} parameter,
the same value is used as the default for all subsequent applications
until a new value is assigned to an {\small MSG\_FILTER} parameter.
This is achieved by associating the {\small MSG\_FILTER} parameter of
each application with the ``global'' parameter {\small MSG\_FILTER}.

\subsection{Group Expressions}
\label{SEC:GRP}
A ``group expression'' is a string which identifies a group of
objects (eg numerical values, {\small NDF}s, etc). A group expression can
specify a group of such objects in several ways:

\begin{itemize}
\item As a comma separated list ( e.g. ``12.1, 23.2, 1.3''
     or ``HH1\_B1S1,HH2\_B1S2'' ).

\item By reading them from a text file (see ``Indirection'').

\item By modifying an existing group of objects using editing
     specified by the user (see ``Modification'').
\end{itemize}
If the supplied group expression is terminated with a minus
sign, the user is re-prompted for another group expression. The
objects specified by this second group expression are added to
those specified by the first. This re-prompting continues until
a group expression is supplied which does not end with a minus
sign.

Certain classes of objects have additional features, for
instance if the objects are {\small NDF} names, then wild-card characters
are allowed in the supplied values (see section \ref{SEC:NDF}).

\subsubsection{Indirection}
It is sometimes convenient to store strings in a text file which specify the
objects to be used. The name of the text file can
then be given in response to a prompt for a group expression,
rather than giving a long list of explicit values. This is done
by preceeding the name of the text file with an up-arrow (``\verb+^+'')
character. For instance, the group expression ``\^{}{\small VALUES.DAT}''
would result in the file {\small VALUES.DAT} being opened and the strings
read from the file. Each line within the file is considered to
be a group expression, and is processed in the same way as a
group expression supplied directly. In particular, a text file
may contain references to other text files. If the file
{\small VALUES.DAT} contained the following two lines:

\small
\begin{terminalv}
A,B,C
D,^NEWFILE.DAT
\end{terminalv}
\normalsize

The the strings A, B, C and D would be returned to the
application, and in addition the file {\small NEWFILE.DAT} would be
searched for further strings. This nesting of text file can go
down to seven levels. Text files may also contain comments.
Anything occurring after a ``\verb+#+'' character is ignored. To ignore
an entire line the \verb+#+ character must be in column 1 (any blanks in
front of the \verb+#+ character are considered to be significant).

\subsubsection{Modification}
A group of objects can be given by specifying some editing to
apply to another already existing group of objects. For instance,
if the string \verb+NEW_*B|_DS|_IM|+ was given in response to a request
for a group expression, then the following steps occur:
\begin{itemize}
\item   Each element in some existing group of objects (identified in
     the description of the parameter concerned) is substituted
     in turn for the ``\lsk'' character.
\item  Any occurrences of the string ``\_DS'' is replaced by the string
     ``\_IM''.
\item  The string ``B'' is added to the end of the string.
\item  The string ``NEW\_'' is added to the start of the string.
\end{itemize}
Thus if the existing group contained the strings {\small FILE1\_DS} and
{\small FILE2\_DS}, the resulting group would be {\small NEW\_FILE1\_IMB} and
{\small NEW\_FILE2\_IMB}. Note, this facility is only available if the parameter
description identifies an existing group which will be used as the basis for the
modified strings.

\subsubsection{NDF Groups}
\label{SEC:NDF}
If a group expression is used to specify a list of input {\small NDF}s,
then {\small NDF} names may be specified which contain wild card
characters (``\lsk'' and ``\%'' on VMS, ``\lsk'' and ``?'' on {\small
UNIX}). These  will be expanded into a list of explicit {\small NDF}
names before returning the group to the application. Note, on {\small
UNIX} systems group expressions containing wild-cards must be enclosed
in quotes if they are supplied on the command line (this prevents the shell
from expanding the wild-cards itself). Environment variables should not be
included in {\small NDF} group expressions on {\small UNIX}.

If the final character in a group expression is a colon (:), then
a list of the {\small NDF}s represented by the group expression (minus the
colon) is displayed, but no {\small NDF}s are actually added to the
group of {\small NDF}s to be processed. The user is then re-prompted
for another group expression. Note, this facility only applies to group
expressions representing existing {\small NDF}s, not {\small NDF}s
which are to be created by the application.

If an {\small IRAS90} application creates more than one output {\small
NDF}, it will also create an output text file containing the names of
the output  {\small NDF}s in a form which can be used to specify the
{\small NDF}s as input to another {\small IRAS90} application. The text
file is called \textbf{iras90\_ndfs.lis} and is located in the users login
directory. Succesive {\small IRAS90} applications will over-write such
text files created by previous applications. If such a file is created, then
the global parameter {\small DATA\_ARRAY} will be modified so that
the suggested default for the input {\small NDF}s to the next application
becomes an indirection element specifying the output {\small NDF}s from
the previous application.

At the moment group expressions may only be used to specify {\small NDF}s
which are stored at the top level of a container file.



\subsubsection{Examples}
\begin{itemize}
\item If an application asks for a group of input {\small NDF}s, the following
are all possible responses:

\small
\begin{terminalv}
b1,b2,b3,b4
\end{terminalv}
\normalsize
\vspace{-3mm}
This means ``Use b1.sdf, b2.sdf, b3.sdf and b4.sdf''. It is  assumed that the
{\small NDF}s are the top level objects  within the .sdf files.

\small
\begin{terminalv}
cena_b1-
\end{terminalv}
\normalsize
\vspace{-3mm}
This means ``Use cena\_b1.sdf and then (because of the minus sign at the end)
asks the user for  more {\small NDF}s''.

\small
\begin{terminalv}
*
\end{terminalv}
\normalsize
\vspace{-3mm}
This means ``Use all .sdf files in the current directory''.

\small
\begin{terminalv}
hh1_b1s*_ds
\end{terminalv}
\normalsize
\vspace{-3mm}
This means ``Use hh1\_b1s1\_ds.sdf, hh1\_b1s2\_ds.sdf, etc''.

\small
\begin{terminalv}
^files.lis
\end{terminalv}
\normalsize
\vspace{-3mm}
This means ``Read the names of {\small NDF}s from the text file files.lis.

\small
\begin{terminalv}
../data/*
\end{terminalv}
\normalsize
\vspace{-3mm}
This means ``Use all .sdf files contained in the {\small UNIX} directory
../data''.

\item If an application asks for a group of output {\small NDF}s, the following
are possible responses:

\small
\begin{terminalv}
file1,file2,file3
\end{terminalv}
\normalsize
\vspace{-3mm}
This means ``Create file1.sdf, file2.sdf and file3.sdf''.

\small
\begin{terminalv}
^out.dat
\end{terminalv}
\normalsize
\vspace{-3mm}
This means ``Read the names of the output {\small NDF}s from
text file out.dat''.

\small
\begin{terminalv}
*_ds
\end{terminalv}
\normalsize
\vspace{-3mm}
This means ``Append the string ``\_ds'' to the end of all
                      the input {\small NDF} names.

\small
\begin{terminalv}
../bk/*|_ds|_bk|
\end{terminalv}
\normalsize
\vspace{-3mm}
This means ``Substitute the string ``\_bk'' for all  occurrences of the string
``\_ds'' in the  input {\small NDF} names, and put the files in {\small UNIX}
directory ../bk''.
\end{itemize}

Group expressions can be used to specify objects other than {\small
NDF}s. For instance,  if an application asks for a group of pixels to
be specified by  their X and Y pixel indices, then the pixels (10,11),
(21,-10) and (0,0) could be specified in any of the following ways:

\small
\begin{terminalv}
10,11,21,-10,0,0
\end{terminalv}
\normalsize
\vspace{-3mm}
This gives the indices as a comma separated list.

\small
\begin{terminalv}
10,11-
21,-10-
0,0
\end{terminalv}
\normalsize
\vspace{-3mm}
Ending each line with a minus  sign causes the user to be re-prompted for more
values.

\small
\begin{terminalv}
^pixels.dat
\end{terminalv}
\normalsize
\vspace{-3mm}
The file pixels.dat is read. The file could contain the  following four lines:

\small
\begin{terminalv}
#  Approximate star centres.
10,11
21,-10
0,0
\end{terminalv}
\normalsize

\subsection{Quality in IRAS90}
\label{SEC:QUAL}
See section \ref{SEC:QINT} for a general description of the use of
quality. Section \ref{SEC:QNAM} gives details of the strings which may
be used as quality names. Section \ref{SEC:QEXP} gives details of
the syntax of quality expressions.

\subsubsection{Introduction}
\label{SEC:QINT}
An {\small NDF} may optionally contain a component called {\small
QUALITY}. If this component exists, it will be an array with the same
bounds as the main {\small DATA} array. Each element in the {\small QUALITY}
array can be used to store several flags which are associated with the
corresponding element in the {\small DATA} array. These flags may be used to
indicate that the {\small DATA} value holds some specified property. For
instance, one of the flags may be used to indicate if the corresponding
{\small DATA} values are saturated, another may be used to indicate if
the {\small DATA}
value lies within a background area, and so on.

The user is free to use the flags in whatever way seems most
suited to the particular process being performed. The user can
set (or reset) any of the flags within any sub-region of the {\small NDF}
using application {\small SETQUAL} (or, {\small TRACECRDD} if the
{\small NDF} is a {\small CRDD}
file). Each of the flags is referred to by a ``Quality Name''
specified by the user. Names which reflect the nature of the
quality should be used, e.g. the quality name ``SATURATED'' could
be used to flag saturated data values. These quality names get
stored within the {\small NDF} and can be used to refer to the quality
flag when running later applications. The terminology adopted by
{\small IRAS90} is that an element of the {\small DATA} array ``holds'' the quality
``SATURATED'' (for instance) if the flag which is associated with
the quality name ``SATURATED'' is set for the corresponding
element within the {\small QUALITY} array.

The number of quality names which can be stored within an {\small NDF} is
limited and  therefore it may become necessary to remove quality
names which are no  longer needed to make room for new ones. The
applications {\small SHOWQUAL} and {\small REMQUAL} allow the user to do this.
{\small SHOWQUAL} displays a list of the quality names  currently defined
within an {\small NDF}, and {\small REMQUAL} removes specified quality names from
an {\small NDF}.

Many {\small IRAS90} applications have a parameter {\small QEXP} which may be used
to specify that the application is only to use data values which
hold a specified selection of qualities.  As an example, when
running {\small DESTCRDD} the user could (for instance) specify a value
of ``BACKGROUND'' for the {\small QEXP} parameter. This means that only
those data values for which the flag associated with the quality
name ``BACKGROUND'' is set, are to be used in the estimation of
the destripe parameters. The quality name ``BACKGROUND'' must
previously  have been defined and assigned to the appropriate
data values using application {\small SETQUAL} (or {\small TRACECRDD}).

The specification of the data values to be used by an application
can be more complex than this, and can depend on several
qualities combined together using ``Boolean'' operators. For
instance, assigning the value ``.NOT. (SOURCE\_A .OR. SOURCE\_B)''
would cause the application to use only those data values which
hold neither of the qualities SOURCE\_A and/or SOURCE\_B. These
sort of strings are  known as ``quality expressions''.

\subsubsection{Quality Names}
\label{SEC:QNAM}
Quality names are names by which the user refers to particular flags
stored  in the {\small QUALITY} component of the {\small NDF}. They
must not be longer than 15 characters. Leading blanks are ignored, and
they are always stored in upper case, even if they are supplied by the
user in lower case. Embedded blanks are considered to  be significant.
Quality names must not contain any period characters (``.''), and there
are three reserved names which cannot be used; these are ``ANY'',
``IRQ\_BAD\_SLOT'' and ``IRQ\_FREE\_SLOT''.

\subsubsection{Quality Expressions}
\label{SEC:QEXP}
Quality names may be combined together using Boolean operators
into complex ``quality expressions''. The quality expression is
evaluated at each element within the {\small NDF} by substituting a value
of true or false for each quality name used in the expression,
depending on whether or not that element holds the specified
quality. Elements are used if the quality expression evaluates
to a true value. Boolean operators are delimited on each side by
a period (eg ``.AND.'' ). The operands on which these operators
act must be either a quality name (which must be defined within
the {\small NDF}), or one of the Boolean constants .TRUE and .FALSE.
Parentheses can be used to nest expressions.

Quality expressions can be up to 254 characters long, and must
not contain more than 40 symbols (Boolean operators, constants,
or quality names). Some attempts are made to simplify a quality
expression to reduce the run time needed to evaluate the
expression for every data value.

The precedence of the Boolean  operators decreases in the following
order; .NOT., .AND., .OR., .XOR., .EQV. (the final two have equal
precedence). In an expression such as ( A .XOR. B .EQV. C .XOR. D ) in
which all operators have equal precedence, the evaluation proceeds from
left to right., i.e. the expression is evaluated as ( ( ( A .XOR. B )
.EQV. C ) .XOR. D ). If there is any doubt about the order in which an
expression will be evaluated, parentheses should be used to ensure the
required order of evaluation.

\begin{description}
\item [.NOT.] -
The expression (.NOT.A) is true only if A is false.

\item [.AND.] -
The expression (A.AND.B) is true only if A and B are both true.

\item [.OR.] -
The expression (A.OR.B) is true if either (or both) of A or B are
true.

\item [.XOR.] -
The expression (A.XOR.B) is true if either A is true and B is
false, or A is false and B is true.

\item [.EQV.] -
The expression (A.EQV.B) is true if either A is true and B is
true, or A is false and B is false.
\end{description}

\subsubsection{Examples}
Consider a {\small CRDD} file which contains four close point sources.
{\small TRACECRDD} can be  used to assign the quality ``SOURCE\_1'' to
the samples contained within the  first source (from any
detector), and equivalent qualities could be set up for the other three
sources. When running {\small DESTCRDD}, it would then be possible to
exclude the data from these four sources by giving the parameter
{\small QEXP} the following value:

\small
\begin{terminalv}
.NOT.( SOURCE_1 .OR. SOURCE_2 .OR. SOURCE_3 .OR. SOURCE_4 )
\end{terminalv}
\normalsize

\subsection{History in IRAS90}
\label{SEC:HIS}
There is an option for {\small IRAS90} to maintain a history of the
processing applied to each {\small NDF}. This history information is
automatically created by each application, and is
stored within the {\small NDF} in a ``{\small HISTORY}'' component. It may be
displayed, removed or added to manually using the {\small HISTORY}
application.

History information can become quite voluminous, causing the {\small NDF}s
to occupy correspondingly larger amounts of disk space. For this
reason, the default behaviour is for {\small IRAS90} applications not to
store any history information. This can be over-ridden using the
{\small HISTORY} parameters associated with many of the {\small IRAS90}
applications.

{\small HISTORY} parameters are used to specify if applications should
store history in their output {\small NDF}s or not. If {\small HISTORY} has a true
value then history information is stored in the output {\small NDF}. If
it has a false value then no history is added to the output and
any existing history is deleted. This ensures that if an {\small NDF}
does contain history, then the history is complete. As has often
been said, an incomplete history is more dangerous than no
history at all.

It is not necessary to repeatedly assign values to {\small HISTORY}
parameters for each successive application. Once a value has
been assigned to a {\small HISTORY} parameter, all subsequent
applications use the same value until a new value is assigned
to a {\small HISTORY} parameter. This is achieved by associating the
{\small HISTORY} parameter of each application with the ``global''
parameter {\small IRAS90\_HISTORY}.

\subsubsection{Example}
If {\small IRAS90} is currently in its default mode (i.e no history is
being produced by any application), then this can be changed by
assigning a true value to an application's {\small HISTORY} parameter; eg
if the next application which the user wishes to run is {\small SETQUAL},
then the command could be

\small
\begin{terminalv}
SETQUAL HISTORY=T
\end{terminalv}
\normalsize
{\small SETQUAL} (and all subsequent applications) will then add history
information to the output {\small NDF}s. The default behaviour can be
re-instated at some later time by assigning a false value to a
{\small HISTORY} parameter; eg

\small
\begin{terminalv}
QUALTOBAD HISTORY=F
\end{terminalv}
\normalsize
Note, not all {\small IRAS90} applications have {\small HISTORY}
parameters, only  those which modify existing {\small NDF}s or create
new {\small NDF}s. For  instance, {\small SHOWQUAL} does not make any
alterations to any {\small NDF}s and so does not have a {\small
HISTORY} parameter.

\subsection{Map Projections}
\label{SEC:PROJ}\xlabel{SEC:PROJ}
Some {\small IRAS90} applications need information describing projections
used to produce images. The following projections are recognised
by {\small IRAS90}:
\begin{description}
\item [GNOMONIC]     - Gnomonic projection.
\item [LAMBERT]      - Lambert normal equivalent cylindrical projection.
\item [AITOFF]       - Aitoff equal area projection.
\item [ORTHOGRAPHIC] - Orthographic projection.
\end{description}

In addition the following pseudonyms are recognised:
\begin{description}

\item [TANGENT\_PLANE] - Same as GNOMONIC.
\item [CYLINDRICAL]   - Same as LAMBERT.
\item [ALL\_SKY]       - Same as AITOFF.
\end{description}

Any unambiguous abbreviation may be supplied when specifying a
projection in response to a parameter prompt (case is ignored).

\subsubsection{Gnomonic}
The gnomonic (or tangent plane) projection is a geometric
projection from the centre of the celestial sphere onto a plane
which is tangent to the celestial sphere. The area of sky
covered by a pixel depends on how far it is from the tangent
point. For this reason this projection is not a good one to use
if large fields are being mapped. The gnomonic projection is
used (for example) for the {\small IRAS} 16.5 degree extended emission
{\small SKYFLUX} images, which suffer from a 6\% change in pixel area
across an image.

\subsubsection{Lambert}
The Lambert equivalent cylindrical projection is a geometric
projection from the polar axis of the celestial sphere onto a
cylinder which is tangential to the celestial sphere at the
equator. The projection proceeds normally to the polar axis. It
is used, for example, by the {\small IRAS} Galactic Plane images. It is
an equal area projection (i.e. all image pixels cover the same
area on the sky, but have different shapes in different parts of
the image).

\subsubsection{Aitoff}
The Aitoff projection is an equal area projection which can be
used to produce photometrically correct maps of the entire
celestial sphere. All-sky maps produced in this way have a
characteristic elliptical shape.

\subsubsection{Orthographic}
Like the Gnomonic projection, the Orthographic projection is a
geometric projection onto a plane which is tangent to the
celestial sphere. The difference between the two projections
lies in the point from which the projection proceeds. The
Gnomonic projection proceeds from the centre of the celestial
sphere, whereas the Orthographic projection proceeds from a
point at infinity, diametrically opposite the tangent point
(i.e. the projection lines are all normal to the tangent plane).
The Orthographic projection is used (for example) for the {\small IRAS}
Pointed Observation images. The area of the sky covered by a pixel
changes across the image, and so this projection is not a good
one to use for mapping large areas.

\subsection{Coordinate Files}
\label{SEC:COF}\xlabel{SEC:COF}
Certain applications read text files which contain a list of coordinate
positions (either sky or image coordinates). By default, these files are assumed
to contain image coordinates. This assumption may be over-riden by inserting a
line at the start of the file which specifies the sky coordinate system. This
must be a valid sky coordinate system specification (see section \ref{SEC:SKY}).
It is not necessary to specify a coordinate system if the coordinates in the
file are image coordinates (also known as pixel coordinates). The remaining
items in the file must be coordinates specifying the positions to be
transformed. The two coordinate values describing a single position should occur
together in the order X then Y or longitude then latitude.  Image coordinates
are given as simple decimal values, and the formats allowed for sky coordinates
are described in section \ref{SEC:SKY}. Adjacent items in the file should be
separated with commas or by placing them on separate lines.  Text occurring
after a comment character (``\verb+#+'') is ignored (up to the end of the line).
Blank lines are also ignored.

\subsection{Sky Coordinates}
\label{SEC:SKY}
{\small IRAS90} has facilities for recognising coordinates in any of the
following astronomical systems:

\begin{itemize}
\item Equatorial (FK4 and FK5, referenced to any specified equinox).
\item Ecliptic (IAU 1980, referenced to any specified equinox).
\item Galactic (IAU 1958)
\end{itemize}

Some applications have a {\small COORDS} parameter which allows the user
to specify the coordinate system which is to be used by the
application (eg when requesting sky positions from the user).
Once a value has been assigned to a {\small COORDS} parameter the same
value is used as the default for all subsequent applications,
until a new value is assigned to a {\small COORDS} parameters. This is
done by associating each {\small COORDS} parameter with the global
parameter {\small SKY\_COORDS}.

\subsubsection{Specifying Sky Coordinate Systems}
Any of the three strings {\small EQUATORIAL, ECLIPTIC} and {\small
GALACTIC} can
be assigned to a {\small COORDS} parameter. Case is insignificant, and
abbreviations may be given.

Ecliptic and equatorial coordinates are referred to the mean
equinox of a given epoch. This epoch is specified by
appending it to the end of the name of the sky coordinate
system, in parentheses; for instance {\small EQUATORIAL(1983.5)} (only
the four most significant decimal places are used). The epoch
may be preceded by a single character, B or J, indicating if the
epoch is a Besselian epoch (B) or a Julian epoch (J). If this
character is missing (as in the above example), then the epoch
is assumed to be a Besselian epoch. If no equinox is specified
in this way, then a default of B1950.0 is used.

If a Julian epoch is used to specify the reference equinox for
an equatorial coordinate system, then the equatorial coordinates
are assumed to be in the IAU 1976, FK5, Fricke system. If the
equinox is specified using a Besselian epoch, then the
coordinates are assumed to be in the FK4, Bessel-Newcomb system.

\subsubsection{Specifying Sky Positions}
A sky coordinate value can consist of a set of up to three
``fields''. Each field consists of a numeric value (which can have
a fractional part) followed by an optional character specifying
the units of the field.  The following characters are used to
specify particular units:

\begin{description}
\item [ h ] - hours
\item [ d ] - degrees
\item [ m ] - minutes or arc-minutes (depending on whether the leading
      field is an hours or degrees field).
\item [ s ] - seconds or arc-seconds (depending on whether the leading
      field is an hours or degrees field).
\item [ r ] - radians.
\end{description}

If no such characters are supplied, defaults are assumed for the
field units (eg if the string ``11 12 56'' is supplied as a Right
Ascension value it is treated the same as ``11h 12m 56s''). Note,
when making command line assignments to parameters from within {\small ICL},
it is necessary to enclose the string to be assigned to the parameter
in double quote marks.

Fields may be omitted, in which case they are assumed to have
the value zero. If a degrees or hours field is to be omitted,
then the leading field in the supplied string should always
include a character to specify its units. For instance, the
string ``15 23'' is treated as the RA value ``15h 23m''. If, in fact,
the leading field is a minutes field then ``15m 23'' could be
specified.

In addition, an input string may contain a single field
in an ``encoded'' form. ``Encoded'' fields are
identified by the fact that the field contains 5 or more digits
to the left of the decimal point (including leading zeros if
necessary).  These fields are decoded into hours or degrees as
follows: Any fractional part is taken as the fractional part of
the seconds field, the tens and units digits are taken as the
integer part of the seconds field, the hundreds and thousands
digits are taken as the minutes fields, the remaining digits are
taken as the degrees or hours field. Thus -12345.4 would be
interpreted as (- 1 hour 23 mins 45.4 seconds) or (- 1 degree 23
mins 45.4 seconds).

The supplied values must be in their ``normal'' ranges (i.e. 0h 0m
0s to 23h 59m 59.99s for RA values, -90d to +90d for DEC values,
etc). Values outside these ranges cause an error to be reported.
The exception to this is if the string is prefixed with a ``\lsk''
character, in which case any numeric value may be supplied.

Any coordinate value can be specified in degrees, hours or
radians. If a value is given in unusual units, the corresponding
normal units are used. For instance, if a declination value of
``1.105r'' was given (specifying 1.105 radians) the equivalent
value in degrees is used (i.e. 63.3118 degrees). A right
ascension of ``45d'' would cause a value of ``3h'' to be used, etc.

\subsubsection{Examples}
This section contains some examples of the many ways in which sky
positions can be specified:

\begin{description}
\item [Right Ascension values]: 11 hours, 34 minutes and 56.2 seconds
                          could be specified as
\begin{itemize}
\item ``11 34 56.2''
\item ``11h 34m 56.2s''
\item ``11 34.9366''
\item ``11.58228''
\item  ``113456.2''.
\end{itemize}

\item [Declination values]: -45 degrees 12 arc-minutes could be
                          specified as
\begin{itemize}
\item ``-45 12 00''
\item ``-45 12''
\item ``-45d 12m''
\item ``-45.2d''
\item ``-451200''
\item ``-0.78888r'' (this is a radians value).
\end{itemize}

\end{description}

Longitude and latitude values for sky coordinate systems other
than equatorial are specified like Declination values.

\subsection{Specifying Detectors}
\label{SEC:DET}
Detectors are identified by their ``detector numbers''. These are
integers varying from 1 to 62 and are described in paragraph C.4
of chapter II of the {\small IRAS} Catalogs and Atlases Explanatory
Supplement (``Exp. Supp.''). \footnote{Detectors 17, 20 and 36 were designated
as ``dead'' because they produced no usable data values.}

If the user is asked to select a group of detectors from a group
of ``available'' detectors, a group expression may be given (see
section \ref{SEC:GRP}) in which each string in the group
can be one of the following:
\begin{itemize}
\item An integer in the range 1 to 62 specifying an explicit
     detector number.
\item One of the strings ``12um'', ``25um'', ``60um'' and ``100um''. These
     cause all available detectors from the specified wave band to
     be selected.
\item A range of detectors, specified by two detector numbers
     separated by a colon (``:''). All available detectors whose
     cross scan positions are between those of the two detectors
     are selected. If the first detector number is omitted, no lower
     limit is imposed. If the second detector is omitted, no upper
     limit is imposed. Fig. II.C.6 and table II.C.3 in the Exp. Supp.
     list the positions of all 62 detectors.
\item The string ``{\small ALL}''. This specifies that all available detectors
     should be selected.
\item The string ``{\small SMALL}''. This specifies that all available small
     detectors (i.e. less than 4 arc-minutes cross-scan size) should
     be selected.
\item The string ``{\small LARGE}''. This specifies that all available detectors
     should be selected, excluding the small detectors.
\item The string ``{\small NONE}''. This specifies that no detectors should be
     selected, and may not be mixed with other options. A null
     parameter value is equivalent to ``{\small NONE}''.
\item The string ``{\small LIST}''. This causes a list of available detectors
     to be displayed, but no detectors are selected. The user is
     re-prompted if this option is selected. This option may not be
     mixed with any other options.
\end{itemize}
All key words can be abbreviated and are case insensitive.

The selection of detectors is made from a list of available
detectors. This is often all detectors for a given waveband. For
instance the available detectors may be all those from the same
band as the data supplied as input to the application. The help
on the parameter concerned should say what detectors are
available, and this list is displayed at run-time if the keyword
{\small LIST} is supplied for the parameter.

The union of the specified detectors are used. Thus for instance,
if all 62 detectors are available, and the group expression
``12$\mu$m,small'' is supplied, the returned set of detectors consists
of all 12$\mu$m detectors together with all small detectors from all
four bands, not just the small detectors from the 12$\mu$m band.

\subsection{Detector Bandwidths}
\label{SEC:BWID}
The following effective detector bandwidths are assumed for
all detectors from each band (in Hz):
\begin{description}
\item [12 $\mu$m] - 13.48E12
\item [25 $\mu$m] - 5.16E12
\item [60 $\mu$m] - 2.58E12
\item [100 $\mu$m] - 1.00E12
\end{description}

These values are taken from the {\small IRAS} Catalogs and Atlases
Explanatory Supplement, second edition, page X-13.

\subsection{Detector Solid Angles}
\label{SEC:SOLAN}
Each detector is assumed to have the following effective solid
angle (in units of 1.0E-7 steradians):

\small
\begin{terminalv}
 #1     #2     #3     #4     #5     #6     #7     #8     #9
14.1,  13.7,  12.9,  13.1,  13.2,  13.2,  13.6,  6.10,  6.04,

 #10    #11    #12    #13    #14    #15    #16    #17    #18
6.07,  1.92,  4.85,  6.10,  6.19,  6.56,  3.39,  DEAD   3.46,

 #19    #20    #21    #22    #23    #24    #25    #26    #27
3.40,   DEAD  3.48,  3.38,  3.21,  3.22,  3.17,  0.92,  2.41,

 #28    #29    #30    #31    #32    #33    #34    #35    #36
2.95,  3.25,  3.25,  1.97,  6.40,  6.32,  6.25,  6.36,   DEAD

 #37    #38    #39    #40    #41    #42    #43    #44    #45
6.37,  4.84,  1.82,  3.50,  3.44,  3.48,  3.50,  3.45,  3.46,

 #46    #47    #48    #49    #50    #51    #52    #53    #54
1.78,  0.89,  3.31,  3.22,  3.29,  3.25,  3.19,  3.24,  2.45,

 #55    #56    #57    #58    #59    #60    #61    #62
 7.9,  13.3,  14.0,  12.9,  14.0,  13.8,  14.2,   6.8
\end{terminalv}
\normalsize

These values were derived by M. Moshir at the Infrared
Processing and Analysis Centre ({\small IPAC}), CalTech, and are
consistent with the detector Point Spread Functions used by
{\small IRAS90} (see section \ref{SEC:PSF}).

\subsection{Point Spread Functions}
\label{SEC:PSF}
The {\small IRAS90} package contains {\small NDF}s holding estimates of the two
dimensional point spread function of each active survey detector. These {\small
NDF}s are called psfxx.sdf (or PSFxx.SDF on {\small VMS}) where ``xx'' is the
detector number (1 to 62). These {\small PSF} images were created at {\small
IPAC} by Merhdad Moshir, and are described in {\small IPAC} Interoffice
Memorandum 240-87-80(2), dated 29 June 1987. Each {\small NDF} consists of a
two dimensional {\small DATA} array, oriented so that the first array axis is
parallel to the focal plane $Z$ axis and the second array axis is parallel to
the
focal plane $Y$ axis. The size and position of each pixel in the data array are
specified in two ways; firstly, each {\small NDF} has two {\small AXIS}
structures which hold the focal plane coordinates $(Z,Y)$ at the centre of the
corresponding pixels (in arc-minutes). Secondly, each {\small NDF} has an
{\small IRAS} extension in which is stored a component called {\small TRANS},
consisting of a vector of six real values. These values specify a linear
transformation from  pixel indices within the {\small PSF} array, to focal
plane coordinates:

\begin{eqnarray*}
  DZ & = & C1 + C2*I + C3*J\\
  DY & = & C4 + C5*I + C6*J
\end{eqnarray*}

where $C1$ - $C6$ are the six elements of the {\small TRANS} component; $(I,J)$
are the pixel indices of a pixel in the {\small PSF}; $DZ$ is the offset in
the direction of the focal plane $Z$ axis, from the detector centre
to the centre of the {\small PSF} pixel (in radians); $DY$ is similarly the
offset in the direction of the focal plane $Y$ axis. The focal
plane coordinates of the detector centres are given in II.C.3 of
the {\small IRAS} Catalogs and Atlases Explanatory Supplement. In fact, $C3$
and $C5$ are always zero, and so the area of a {\small PSF} pixel (in
steradians) is thus given by $C2*C6$. In addition to the {\small TRANS}
component, the {\small IRAS} extension also contains a component called
{\small PSFDET}, which is a single integer value giving the detector
number to which the {\small PSF} refers.

The pixel values are normalised so that they represent ``efficiency''
values, and have a quoted relative error of 0.1. If the {\small PSF} pixel with
index $i$ has a value of $P_{i}$ and is illuminated with a mean surface
brightness of $S_{i}$ (in units of Jy/sr), then the incident flux is
$S_{i}*A$  (where $A$ is the solid angle of the {\small PSF} pixel,
i.e. $C2*C6$), but the {\small PSF} pixel measures a flux of
$P_{i}*S_{i}*A$ Janskys. Thus the total flux measured by a detector
would be $\sum_{i}( P_{i}*S_{i}*A)$. The effective detector solid
angles used by {\small IRAS90} are derived from these {\small PSF}s, in
fact they are just equal to $A*\sum_{i}(P_{i})$, so another way of
representing the total flux measured by a detector is $B*\sum_{i}(
P_{i}*S_{i} )/\sum_{i}( P_{i} )$, where $B$ is the effective solid
angle of the detector.

\subsection{Data Units}
\label{SEC:UNITS}
{\small IRAS90} recognises several different system of data units, which
may be specified using the following strings:

\begin{description}
\item [pW/(M\lsk\lsk2)] - Flux values in Pico-Watts per square metre.
                          (1pW = 10$^{-12}$W)
\item [(pW/M\lsk\lsk2)/sr] - Surface brightness values in Pico-Watts per
square metre, per steradian.
\item [Jy] - Flux density values in Janskys.
\item [Jy/sr] - Surface brightness values in Janskys per steradian.
\item [MJy/sr] - Surface brightness values in Mega-Janskys per steradian.
\item [Jy/PIXEL] - Surface brightness values in Janskys per pixel
\item [(pW/M\lsk\lsk2)/PIXEL] - Surface brightness values in Pico-Watts per
square metre, per pixel.
\end{description}
Note, the possible effects of varying pixel size should be borne
in mind when using either of the last two systems of units,
especially if dealing with very large areas of the sky. If this
may be a problem, then an equal area projection should be used
(see section \ref{SEC:PROJ}) when creating the pixel
values.

Some of these units are only available when dealing with {\small CRDD}
files (eg ``Jy''), and some when dealing with images (eg Jy/PIXEL).

Conversions between flux and flux density  values use the detector bandwidths
described in section \ref{SEC:BWID}. Conversions between flux density and
surface brightness  values use the effective detector solid angles described in
section \ref{SEC:SOLAN}.

\subsection{Time and Date Strings}
\label{SEC:TIM}
Time and dates should be specified in the same format as the
following example:

\small
\begin{terminalv}
1992-JAN-1 11:23:23.22
\end{terminalv}
\normalsize

Notes:
\begin{itemize}
\item The first field is the year. Years in the range 0 to 49
     are interpreted as 2000 to 2049; years in the range 50
     to 99 are interpreted as 1950 to 1999.
\item The second field is the first three letters of the month
     (case insensitive).
\item The third field is the day in the month.
\item The fourth field is the hour in the day.
\item The fifth field is the minute in the hour.
\item The sixth field is the second in the minute, with an
     optional fractional part.
\item If any leading fields are omitted in the string, they
     default to the values for the current time.
\item If any trailing fields are omitted in the string, they
     default to zero (or 1 for the day and month).
\item Leading spaces are ignored.
\item No spaces are allowed within the body of the string except
     to separate the time and date sections.
\end{itemize}

\section{Acknowledgements}
{\small IRAS90} was jointly developed by {\small FIIS/IPMAF} and
{\small STARLINK}. The programming team consisted of:
\begin{itemize}
\item David Berry (STARLINK --- MAVAD::DSB)
\item Wei Gong (FIIS/IPMAF --- QMCMV::WG)
\item Diana Parsons (FIIS/IPMAF --- RLVAD::DCP)
\item Helen Walker (FIIS/IPMAF --- RLVAD::HJW)
\end{itemize}

The assistance of the following people is gratefully acknowledged:
\begin{itemize}
\item Jim Emerson (IRAS SIG --- QMCMV::JPE)
\item Malcolm Currie (STARLINK --- RLVAD::CUR)
\item Rodney Warren-Smith (STARLINK --- RLVAD::RFWS)
\end{itemize}

\newpage
\appendix
\section{An Alphabetical Summary of IRAS90 Commands}
\label{ap:summary}

\begin{small}
\begin{aligndesc}
\menuitem{BACKCRDD}{ Remove a background from a group of CRDD files.}
\menuitem{COLCORR}{ Create colour corrected surface brightness images.}
\menuitem{COLTEMP}{ Create colour temperature and optical depth maps.}
\menuitem{COADDCRDD}{ Coadd CRDD traces crossing specified positions. }
\menuitem{DEGLCRDD}{ Deglitch a group of CRDD files. }
\menuitem{DESTCRDD}{ Equalise detector offsets within a group of CRDD files.}
\menuitem{FINDCRDD}{ Accepts a list of sources, and prepares files specifying
corresponding CRDD data to be extracted.}
\menuitem{FFIELD}{ Identify the ISSA fields covering a given position.}
\menuitem{HISTORY}{ Display history from a group of NDFs.}
\menuitem{I90HELP}{ Display help on IRAS90.}
\menuitem{IFIELD}{ Display IRAS SKY SURVEY ATLAS plate details for a
specified position.}
\menuitem{IRASTRACE}{ Display IRAS extension information from a group of NDF.}
\menuitem{MAPCRDD}{ Map a group of CRDD files into an image.}
\menuitem{NEWUNITS}{ Change the system of units in which an NDF is stored.}
\menuitem{POINTCRDD}{ Detects point sources along the trace(s) of CRDD NDF
file.}
\menuitem{POSCRDD}{ Locate the closest CRDD files to a given position.}
\menuitem{PREPARE}{ Prepare a FITS image for use by other IRAS90 routines.}
\menuitem{PSCONT}{ Make hard-copy contour map with sky coordinate grid.}
\menuitem{QUALTOBAD}{ Set NDF pixels bad which have a given set of qualities.}
\menuitem{REMQUAL}{ Remove the definition of pixel qualities from an NDF.}
\menuitem{SETIMAGE}{ Assign new global properties to an IRAS90 image.}
\menuitem{SETQUAL}{ Assign a quality to a group of pixels in an NDF.}
\menuitem{SHOWQUAL}{ Display the qualities currently defined within an NDF.}
\menuitem{SIMCRDD}{ Generate simulated CRDD from a supplied trial sky image.}
\menuitem{SKYALIGN}{ Align images using internally stored astrometric
information.}
\menuitem{SKYBOX}{ Report extent and position of a rectangular region of the
sky.}
\menuitem{SKYGRID}{ Annotate a picture with a celestial coordinates grid.}
\menuitem{SKYLINE}{ Draw meridians, parallels and great circles over an
image.}
\menuitem{SKYMARK}{ Draw markers over an image at specified celestial
coordinates.}
\menuitem{SKYPHOT}{ Calculate integrated fluxes within square, circular, or
polygonal apertures.}
\menuitem{SKYPOS}{ Transform positions between image and celestial
coordinates.}
\menuitem{SKYWRITE}{ Write text over an image at specified celestial
coordinates.}
\menuitem{TRACECRDD}{ Graphically display detector data streams from a CRDD
file.}
\end{aligndesc}
\end{small}

\newpage
\section{Classified IRAS90 commands}
\label{ap:classified}

{\small IRAS90} applications may be classified in terms of their
functions as follows:
\begin{description}

\item [Astrometric Utilities:]
\mbox{}
\begin{description}
\item[SKYALIGN: ] Align images using internally stored astrometric
information.
\item[SKYBOX:   ] Report extent and position of a rectangular region of the
sky.
\item[SKYGRID:  ] Annotate a picture with a celestial coordinates grid.
\item[SKYLINE:  ] Draw meridians, parallels and great circles over an
image.
\item[SKYMARK:  ] Draw markers over an image at specified celestial
coordinates.
\item[SKYPOS:   ] Transform positions between image and celestial
coordinates.
\item[SKYWRITE: ] Write text over an image at specified celestial
coordinates.
\end{description}

\item [Examining Data:]
\mbox{}
\begin{description}
\item[FFIELD:   ] Identify the ISSA fields covering a given position.
\item[HISTORY:  ] Display history from a group of NDFs.
\item[IFIELD:   ] Display IRAS SKY SURVEY ATLAS plate details for a
specified position.
\item[IRASTRACE:] Display IRAS extension information from a group of NDF.
\item[PSCONT:   ] Make a hard-copy contour map with sky coordinate grid.
\item[SHOWQUAL: ] Display the qualities currently defined within an NDF.
\item[SKYPHOT:  ] Calculate integrated fluxes in rectangular, elliptical or
polygonal regions.
\item[TRACECRDD: ] Graphically display detector data streams from a CRDD
file.
\end{description}

\item [Handling CRDD:]
\mbox{}
\begin{description}
\item[BACKCRDD: ] Remove a background from a group of CRDD files.
\item[COADDCRDD:] Coadd CRDD traces crossing specified positions.
\item[DEGLCRDD: ] Deglitch a group of CRDD files.
\item[DESTCRDD: ] Equalise detector offsets within a group of CRDD files.
\item[FINDCRDD: ] Accepts a list of sources, and prepares files specifying
corresponding CRDD data to be extracted.
\item[HISTORY:  ] Display history from a group of NDFs.
\item[IRASTRACE:] Display IRAS extension information from a group of NDF.
\item[MAPCRDD:  ] Map a group of CRDD files into an image.
\item[NEWUNITS: ] Change the system of units in which an NDF is stored.
\item[POINTCRDD:] Detects point sources along the trace(s) of CRDD NDF file.
\item[POSCRDD:  ] Locate the closest CRDD files to a given position.
\item[SIMCRDD:  ] Generate simulated CRDD from a supplied trial sky image.
\item[TRACECRDD: ] Graphically display detector data streams from a CRDD
file.
\end{description}

\item [Handling Images:]
\mbox{}
\begin{description}
\item[COLCORR:  ] Create colour corrected surface brightness images.
\item[COLTEMP:  ] Create colour temperature and optical depth maps.
\item[FFIELD:   ] Identify the ISSA fields covering a given position.
\item[HISTORY:  ] Display history from a group of NDFs.
\item[IRASTRACE:] Display IRAS extension information from a group of NDF.
\item[NEWUNITS: ] Change the system of units in which an NDF is stored.
\item[PREPARE:  ] Prepare a FITS image for use by other IRAS90 routines.
\item[PSCONT:   ] Make a hard-copy contour map with sky coordinate grid.
\item[SETIMAGE: ] Assign new global properties to an IRAS90 image.
\item[SKYALIGN: ] Align images using internally stored astrometric
information.
\item[SKYBOX:   ] Report extent and position of a rectangular region of the
sky.
\item[SKYGRID:  ] Annotate a picture with a celestial coordinates grid.
\item[SKYLINE:  ] Draw meridians, parallels and great circles over an
image.
\item[SKYMARK:  ] Draw markers over an image at specified celestial
coordinates.
\item[SKYPHOT:  ] Calculate integrated fluxes in rectangular, elliptical or
polygonal regions.
\item[SKYPOS:   ] Transform positions between image and celestial
coordinates.
\item[SKYWRITE: ] Write text over an image at specified celestial
coordinates.
\end{description}

\item [Handling Quality:]
\mbox{}
\begin{description}
\item[QUALTOBAD:] Set NDF pixels bad which have a given set of qualities.
\item[REMQUAL:  ] Remove the definition of pixel qualities from an NDF.
\item[SETQUAL:  ] Assign a quality to a group of pixels in an NDF.
\item[SHOWQUAL: ] Display the qualities currently defined within an NDF.
\end{description}

\item [Others:]
\mbox{}
\begin{description}
\item[I90HELP:  ] Display help on IRAS90.
\end{description}

\end{description}
\newpage
\section{Specifications of IRAS90 Applications}
\label{ap:full}
\subsection{Explanatory Notes}

In the routine specifications which follow, application parameters have the
following format.

\begin{terminalv}
name  =  type (access)
  description
\end{terminalv}

The \emph{name} is the string which should be used to refer to the parameter. The
\emph{type} is a description of the type of object or value which should be
assigned to the value. The \emph{access} string specifies if the parameter is
used to pass information from the environment to the application ( ``\emph{read}'' access), from the application to the environment ( ``\emph{write}''
access), or both ( ``\emph{update}'' access).

Each routine specifications includes a \emph{Usage\/} entry.  This shows how the
application is invoked from the command line.   It lists the parameters which
can be specified by position on the command line, in the order in which they
are used. Parameter which are not included in the \emph{Usage\/} entry can be
assigned a value on the command line by using a keyword assignment. Here is an
example. The \emph{Usage\/} entry for application SKYGRID is:

\begin{terminalv}
SKYGRID DEVICE IN
\end{terminalv}

If the following command line was used to invoke SKYGRID

\small
\begin{terminalv}
ICL> SKYGRID XWINDOWS M51 PENA=2 PENB=2 LINES
\end{terminalv}
\normalsize

then the positional parameters DEVICE and IN would be assigned the values
``XWINDOWS'' and ``M51'' respectively. Parameters PENA and PENB are not included
in the list of positional parameters in the \emph{Usage\/} entry and so need to
be specified using keyword assignments (eg ``PENA=2''). The parameter LINES
takes a logical value, and so including ``LINES'' on the command line is
equivalent to ``LINES=YES'' (similarly, ``NOLINES'' would have been equivalent
to ``LINES=NO'').

There is also an \emph{Examples\/} section for most applications.  This shows
how to run the application from the command line.  More often you'll enter the
command name and just some of the parameters, and be prompted for the rest.

The \emph{Parameters\/} section has a notation scheme to indicate
normally defaulted parameters, \textit{i.e.}\ those for which there will
be no prompt.
For such parameters a matching pair of square brackets ({\ssttt []})
terminates the description.  The content between the brackets mean
\begin{description}
\item[{\ssttt []}]
Empty brackets means that the default is created dynamically
by the application, and may depend on the values of other parameters.
Therefore, the default cannot be given explicitly. In this case, the parameter
description will include a description of how the dynamic default is generated.
\item[{\ssttt [,]}]
As above, but there are two default values that are created dynamically.
\item[{\ssttt [}{\rm default}{\ssttt ]}]
Occasionally, a description of the default is given in normal type,
\textit{e.g.}\ the size of the plotting region in a graphics application,
where the exact default values depend on the device chosen.
\item[{\ssttt [default]}]
If the brackets contain a value in teletype-fount, this is the explicit
default value.
\end{description}

\begin{small}
\newpage
\sstroutine{
   BACKCRDD
}{
   Estimate and remove backgrounds from a group of CRDD files
}{
   \sstdescription{
      This routine estimates and removes a variety of different
      backgrounds from a group of CRDD files. An output CRDD file is
      produced for each input CRDD file. Depending on the value of
      parameter OUTTYPE, this output CRDD file will hold either the
      input data with the estimated background subtracted from it, or
      the estimated background data itself. The type of background used
      is specified by parameter TYPE. The mean background surface
      brightness in the data after background subtraction can be
      controlled using parameter OUTBACK. This may for instance be
      given the value of the mean background surface brightness
      calculated by routine DESTCRDD, in which case the mean background
      in the data would be preserved.

      Only the DATA component of each NDF is modified by this routine;
      all other components are copied to the output without change. The
      exception to this is that any output VARIANCE component is deleted
      if parameter OUTTYPE had the value BACKGROUND.
   }
   \sstusage{
      BACKCRDD IN OUT
   }
   \sstparameters{
      \sstsubsection{
         CLIP = \_REAL (Read)
      }{
         The number of standard deviations at which data will be
         rejected.                                                 [3.0]
      }
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output CRDD files. See help on \texttt{"}History\_in\_IRAS90\texttt{"} for more
         information on history.  The history information will contain
         the names of the input CRDD files and BACKCRDD parameter
         values.                               [current history setting]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         Specifies a group of input CRDD files. This should be in the
         form of a group expression (see help on \texttt{"}Group\_expressions\texttt{"}).
         The CRDD files must contain data from the same IRAS waveband.
         There is no limit on the number of CRDD files which can be
         specified.
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         help on \texttt{"}Message\_filtering\texttt{"}).
                                        [current message filter setting]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         A group of output CRDD files corresponding one-for-one with
         the list of input CRDD files given for parameter IN.  This
         should be in the form of a group expression (see help on
         \texttt{"}Group\_expressions\texttt{"}). Expressions such as \texttt{"}$*$\_BAK\texttt{"} are expanded
         by replacing the \texttt{"}$*$\texttt{"} character with each input CRDD file in
         turn.
      }
      \sstsubsection{
         OUTBACK = \_REAL (Read)
      }{
         The mean background surface brightness required in the data
         after background subtraction. The same value is used for each
         CRDD file. The value should be given in Mega-Janskys per
         steradian.                                                [0.0]
      }
      \sstsubsection{
         OUTTYPE = LITERAL (Read)
      }{
         This can take the values DATA and BACKGROUND. DATA causes the
         output CRDD files to hold the background subtracted input data;
         BACKGROUND causes the output CRDD files to hold the estimated
         background data itself.                                  [DATA]
      }
      \sstsubsection{
         QEXP = LITERAL (Read)
      }{
         A quality expression giving the quality of samples which are
         to be included in the estimation of the backgrounds to be
         subtracted from each CRDD file. A value of \texttt{"}ANY\texttt{"} causes all
         samples to be used, without regard to quality.            [ANY]
      }
      \sstsubsection{
         QNAME = LITERAL (Read)
      }{
         The name of a quality to be assigned to all samples which do
         not contribute to the estimation of the scan background.
         Samples are omitted from the scan background calculations if
         they are bad in the input NDF, do not satisfy the quality
         expression given by parameter QEXP, or are rejected as source
         samples by the cleaning algorithm. A blank value for QNAME
         causes no quality values to be assigned.                     []
      }
      \sstsubsection{
         TYPE = LITERAL (Read)
      }{
         The type of background to be subtracted from the input CRDD
         files. Currently supported values are: UNIFORM, LINEAR.
                                                               [UNIFORM]
      }
      \sstsubsection{
         XNAME = LITERAL (Read)
      }{
         If any the input NDF do not already contain any quality name
         definitions then new quality names are put in the extension
         specified by XNAME. This extension is created if it does not
         already exist.                                  [QUALITY\_NAMES]
      }
      \sstsubsection{
         XTYPE = LITERAL (Read)
      }{
         If any new NDF extensions are created to hold quality names
         (see parameter XNAME), then parameter XTYPE is used to obtain
         the HDS data type for the created extensions. The run time
         default is to give the extension a type identical to its name.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         BACKCRDD ZCMA\_B1S1\_DS ZCMA\_B1S1\_BAK TYPE=UNIFORM
      }{
         This command causes a constant background value to be
         estimated for CRDD file ZCMA\_B1S1\_DS and the background
         subtracted data to be stored in ZCMA\_B1S1\_BAK.
      }
      \sstexamplesubsection{
         BACKCRDD $*$\_DS $*$$|$\_DS$|$\_FIT$|$ QEXP=.NOT.(SOURCE\_A.OR.SOURCE\_B) OUTTYPE=B
      }{
         This command attempts to estimate linear backgrounds for all
         NDFs in the current directory which have names ending with
         \texttt{"}\_DS\texttt{"}. The estimated backgrounds are stored in corresponding
         output NDFs in which \texttt{"}\_DS\texttt{"} is replaced by \texttt{"}\_FIT\texttt{"}. Any samples
         which have either of the two qualities SOURCE\_A and/or
         SOURCE\_B are excluded from the estimation of the background.
      }
   }
   \sstdiytopic{
      Excluding Samples from the Background Estimate
   }{
      The user may choose to exclude certain samples from the
      estimation of the background by giving a \texttt{"}quality expression\texttt{"} for
      parameter QEXP. Only those samples which have qualities
      satisfying the given quality expression are included in the
      estimation of the background. Qualities can be assigned to
      selected samples using routine SETQUAL.
   }
   \sstdiytopic{
      Estimation of Uniform Backgrounds
   }{
      After removing samples which do not satisfy the quality
      expression, the median surface brightness value in each CRDD file
      is found (see help on \texttt{"}Detector\_solid\_angles\texttt{"} and
      \texttt{"}Detector\_bandwidths\texttt{"} for lists of the detector effective solid
      angles and band widths used to convert between flux, flux density
      and surface brightness values). An attempt is then made to
      improve the fit to the background by iteratively removing any
      outlying data values from the median estimation. This is done by
      removing samples which lie further than a specified multiple of
      the noise from the current median value (see parameter CLIP). The
      noise is taken to be the RMS residual between the input data and
      the current median value.  After rejecting these outlying
      samples, a new median value is found. This rejection process is
      repeated until the RMS residual changes by less than 0.1\% between
      iterations. The required output background surface brightness
      (specified by parameter OUTBACK) is subtracted from the final
      median value. This value is converted back to the same units as
      the input CRDD to form the background estimate.
   }
   \sstdiytopic{
      Estimation of Linear Backgrounds
   }{
      After removing samples which do not satisfy the quality
      expression, the data is compressed in the cross-scan direction by
      taking the median of the cross-scan surface brightness values at
      a range of in-scan positions along the scan. This results in a
      single dimensional array holding an estimate of the background
      surface brightness at each in-scan position. A least squares
      linear fit is then made to this data, and the RMS residual of the
      data from the fit is found.  An attempt is then made to improve
      the fit to the background by iteratively removing any outlying
      data values from the estimation of the linear fit.  This is done
      by removing samples which lie far from the current linear fit.
      The threshold for rejection is the value of parameter CLIP times
      the RMS residual from the current fit.  After rejecting these
      outlying samples, a new linear fit is found. This rejection
      process is repeated until the RMS residual changes by less than
      0.1\% between iterations. The required output background surface
      brightness (specified by parameter OUTBACK) is subtracted from
      the final fit. This fit is converted back to the same units as
      the input CRDD to form the background estimate.
   }
}
\sstroutine{
   COLCORR
}{
   Calculate colour corrected surface brightness images
}{
   \sstdescription{
      This routine takes two aligned images, one holding colour
      temperature values and the other holding optical depth values,
      and creates an output image holding the corresponding surface
      brightness values, colour corrected for the central wavelength of
      any of the four IRAS wavebands. The temperature and optical depth
      images can be created by COLTEMP.

      The calculation of colour corrected surface brightness values is
      based on the assumption that all sources have greybody spectra
      with a constant emissivity spectral index, BETA. The value of BETA
      used is the same as was used when the optical depth image given
      for parameter TAU was created. It is assumed that all sources are
      optically thin.

      The input NDFs should be aligned pixel-for-pixel. If the bounds
      of the two NDFs do not match, the output image covers just the
      overlap area. Any QUALITY component present in the temperature
      NDF is propagated to the output NDF. All extensions are
      propagated from the temperature NDF.

      Variances for the calculated surface brightness values are
      created if both input NDFs have VARIANCE components.
   }
   \sstusage{
      COLCORR TEMP TAU BAND OUT
   }
   \sstparameters{
      \sstsubsection{
         BAND = \_INTEGER (Read)
      }{
         The wavelength (in microns) of the IRAS survey band for which
         colour corrected data is to be generated (12, 25, 60 or 100).
         Note, the value specified need not necessarily be the same as
         that supplied for the WAVEL parameter of application COLTEMP.
      }
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output NDF. See section \ref{SEC:HIS} for more
         information on history.
                                               [current history setting]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         The colour corrected output image, in units of MJy/sr.
      }
      \sstsubsection{
         TAU = NDF (Read)
      }{
         An optical depth image, in units of 1.0E-16 as created by
         COLTEMP. Note, it is assumed that these values are much less
         than unity (i.e. all sources are optically thin). A warning is
         issued if this is not the case.
      }
      \sstsubsection{
         TEMP = NDF (Read)
      }{
         A colour temperature image, as created by COLTEMP.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         COLCORR M51\_TEMP M51\_TAU 12 M51\_CC12
      }{
         This example generates a 12 micron colour corrected image
         called M51\_CC12 from the temperature map M51\_TEMP and the
         optical depth map M51\_TAU. COLTEMP would previously have been
         run to create the temperature and optical depth images.
      }
   }
}
\sstroutine{
   COLTEMP
}{
   Calculate colour temperature and optical depth maps
}{
   \sstdescription{
      This routine takes two aligned images from different wavebands as
      input, and creates two corresponding output images holding colour
      temperature and optical depth. An optically thin greybody source
      spectrum is assumed. The optical depth is assumed to vary as
      frequency to the power BETA, where BETA is a constant supplied by
      the user.  Temperatures outside the range 30 K to 10000 K cannot
      be handled and cause corresponding bad values to be introduced
      into the output NDFs. Negative values in either of the two input
      images also cause bad output values to be created.

      The input NDFs should be aligned pixel-for-pixel. If the bounds
      of the two NDFs do not match, the output images cover just the
      overlap area. Any QUALITY component present in the shorter
      waveband NDF is propagated to the output NDFs. All extensions are
      propagated from the short waveband NDF, but some information
      describing the origin of the input image is deleted from the
      IRAS extension.

      The calculation of colour temperature and optical depth is based
      on the use of the detector spectral response curves described in
      the IRAS Catalogs and Atlases Explanatory Supplement, table
      II.C.5. The uncertainty in these curves is not well known, but a
      description of the likely ranges is given on page VI-28
      (paragraph C3). The change in the calculated temperature and
      optical depth values caused by varying the spectral response
      curves slightly can be investigated using the parameters LERR and
      RERR.

      Variances for the calculated temperatures and optical depths can
      be created if both input NDFs have VARIANCE components (see
      parameter VAROUT). These variances do not take into account the
      uncertainties in the detector spectral response curves, but just
      describe the uncertainty in output data caused by the uncertainty
      in the input data.
   }
   \sstusage{
      COLTEMP IN1 IN2 BETA TEMP TAU WAVEL
   }
   \sstparameters{
      \sstsubsection{
         BETA = \_REAL (Read)
      }{
         The emissivity spectral index. A value of zero causes a
         blackbody source spectrum to be used.
      }
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output NDF. See help on \texttt{"}History\_in\_IRAS90\texttt{"} for more
         information on history.
                                               [current history setting]
      }
      \sstsubsection{
         IN1 = NDF (Read)
      }{
         The first input image.
      }
      \sstsubsection{
         IN2 = NDF (Read)
      }{
         The second input image.
      }
      \sstsubsection{
         LERR = \_REAL (Read)
      }{
         Specifies a shift in wavelength to apply to the published
         detector spectral response curves before using them. The
         wavelength of each tabulated point is increased by the value
         supplied. The value should be given in microns, and can be
         positive or negative.                                     [0.0]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         help on \texttt{"}Message\_filtering\texttt{"}).
                                        [current message filter setting]
      }
      \sstsubsection{
         RERR = \_REAL (Read)
      }{
         Specifies a factor by which to multiply the published detector
         spectral response values before using them.               [1.0]
      }
      \sstsubsection{
         TAU = NDF (Write)
      }{
         An output image containing the optical depth at the wavelength
         given by parameter WAVEL. The values stored in this image are
         in units of 1.0E-16. Thus an NDF value of 9678.2 represents an
         optical depth of 9678.2E-16. If a null value is supplied for
         this parameter, no optical depth image is created.
      }
      \sstsubsection{
         TEMP = NDF (Write)
      }{
         The temperature output image. Temperatures are stored in
         Kelvin.
      }
      \sstsubsection{
         VAROUT = \_LOGICAL (Read)
      }{
         Specifies if VARIANCE components should be created in the
         output NDFs. A warning is given if output variances are
         requested but cannot be calculated. The run time default is
         YES if both input NDFs have VARIANCE components, and NO
         otherwise.                                                   []
      }
      \sstsubsection{
         WAVEL = \_REAL (Read)
      }{
         The wavelength at which the optical depth is required, in
         microns. It can take any positive value (not just 12, 25, 60
         and 100). This parameter is not used if parameter TAU is given
         a null value.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         COLTEMP RING\_B1 12 RING\_B2 25 1.0 TEMP TAU 30
      }{
         This evaluates colour temperature and optical depth maps from
         the two images RING\_B1 and RING\_B2. The optical depth is
         assumed to vary linearly with frequency (BETA=1.0), and the
         optical depth is calculated at a wavelength of 30 microns.
      }
      \sstexamplesubsection{
         COLTEMP RING\_B1 12 RING\_B2 25 1.0 TEMP TAU 30 LERR=0.3
      }{
         This example is the same as the previous example except that
         the published detector spectral response curves are shifted by
         0.3 micron before being used. The change in the resulting
         temperatures and optical depths gives some idea of the
         uncertainty in their values.
      }
   }
}
\sstroutine{
   COADDCRDD
}{
   Coadd CRDD traces crossing specified positions
}{
   \sstdescription{
      The application takes a group of CRDD NDF files of any form
      (Survey, AO, etc) and coadds the data traces for any detector which
      crosses the specified expected point sources. Separate coadditions
      are carried out for each waveband for each source position.

      Any input CRDD NDF files should have been destriped previously, in
      order to remove detector to detector differences in calibration.

      The first stage of coadding is the selection of expected source
      positions. All the reference positions associated with any of the
      input CRDD NDFs will be taken as expected point sources by COADDCRDD.
      The user can also specify additional expected point source positions.

      By default both the displayed reference positions, and any positions
      of subsequent sources the user may want to enter, are specified in
      Equatorial(B1950) coordinates. If the user wants a different coordinate
      system  to be used he should enter the coordinate system he requires
      as the COORDS parameter.

      To enter additional expected point sources positions, the user should
      set the ADD\_SOURCE parameter TRUE. He will then be prompted for the
      name, title, longitude and latitude of each additional expected source
      position in the given coordinate system. This facility enables the user
      to examine several positions close together using only one set of
      extracted CRDD NDF files which cover all these positions. The user
      should be aware that apparent point sources in a coadded trace, but not
      at the expected source position may be spurious. He should coadd
      the traces again using the apparent position as an expected position,
      to see whether this source is real.

      The second stage is the selection and processing of the traces, this
      is carried out for each source at each wavelength. The processing
      consists of selecting those detector traces to be used, determining
      the weights to be applied to them, and aligning the trace correctly
      so that the correct samples are aligned at the expected point source.

      By default, a detector scan is about 4.5 arcmin wide, see Explanatory
      Supplement Table II.C.3 for exact width of each detector, and if a
      source position falls within that field of view, the detector
      scan is regarded as a crossing scan and will be coadded with other
      crossing scans. The user can modify this criterion by selecting a
      non zero detector width extension, see parameter WIDEXT.

      When coadding, the detector data can be weighted according to a
      combination of one or two factors, dependant on the reliability of
      the detectors and the distance of the crossing from the expected
      source position. The reliability factor can follow one of the
      following schemes, see parameter WEIGHT:

      1. Variance weighting: If the input CRDD files contain variance
         values associate with each CRDD sample, the samples can be
         weighted according to their variance so that the greater weight
         is given to the more accurate samples. Samples with zero
         variance are treated like bad samples and hence excluded from
         the coadding.

      2. NEFD Weight: The data from each detector can also be weighted
         according to the noise equivalent flux density (NEFD) of the
         detector, obtained from Exp. Supp. Fig IV.A.1., so that the
         most noisy detectors have the lowest weighting.

      3. Equal weighting: All data from the crossing detectors
         contribute equally to the coadded result.

      All above weighting schemes can be combined with a distance effect
      if required. If the distance effect is selected the weight(s) of a
      data trace is taken to be the product of the weight(s) decided
      from one of above schemes and a weight which is a Gaussian function
      of the distance of the trace centre from the expected source position.
      With this distance weight, the effect of the detector which crosses
      the expected source at its edge can be reduced. The Gaussian function
      can have different width by specifying its value at the edges of the
      detectors, see parameter GVDTEG. If distance weighting is not required
      the parameter DISTANCE should be set false.

      When the input CRDD files have variance components, the default
      weighting will be \texttt{'}distance-variance\texttt{'}, otherwise the weighting
      will be \texttt{'}distance-NEFD\texttt{'}.

      For each crossing scan, a sequence of about 80.0 arcmin length is
      extracted centered on the expected source position, these are usually
      sufficient for source signal and noise estimation. Should a user feel
      it is not adequate to his requirement, he can select another
      sequence length via parameter SCNLEN.

      During coadding, the traces are aligned with the trace which is
      closest to the expected source position. This consists of two phases.
      The detector traces are reversed if they traversed the sky in the
      opposite direction to the direction of the closest scan. Then the
      samples are aligned so that the samples crossing the source position
      coincide. The interpolation used when aligning the traces can be either
      \texttt{'}nearest\texttt{'} or \texttt{'}linear\texttt{'}. In nearest interpolation the sample nearest to
      the source position is used as a central point. In linear interpolation
      the central value is a linear combination of the two samples closest
      to the source position and the values for each sample worked outwards
      from this centre is also a linear combination of the corresponding samples
      in the original trace. The user should note that although this then
      aligns samples by their in-scan distance from the source point, it does
      not take account of the fact that scans may be crossing through the source
      at slightly different angles. Therefore the coadding may add signals that
      are in a slightly different position in the sky but at the same in-scan
      distance from the source. The effect can be neglected except if looking
      for point sources not at the expected position, where they should be
      recoadded (see above).

      If more than half of the samples in a crossing trace are bad, the trace
      is discarded.

      The adjusted weighted samples are then coadded together.

      For each expected point source there will be one NDF file created
      for each waveband where there was at least one detector which crossed
      the source position. Each NDF will inherit the IRAS specific information
      of the detector trace whose centre is closest to the expected source
      position among all crossing traces coadded in that NDF. This means
      that the position associated with each sample is likely to be very
      slightly wrong. The data will in fact refer to a tracelike series of
      positions passing through the source position and parallel to the
      nearest detector trace, while the associated positional data will give
      in effect the position of the center of the nearest detector trace. The
      maximum error in position caused by this effect will be half the width
      of the detector (after allowance for the users width extension).
      Thus more detector traces coadded gives a better result not only in
      the data reliability, but also in the positional accuracy. And the
      positional inaccuracy is only commensurate with the data inaccuracies
      caused by sampling at the edge of a detector.

      The reason for the use of this nearest detector inheritance is that
      it means that coadded NDF files can be processed by some other IRAS90
      applications, such as TRACECRDD in the same way as a normal CRDD NDF.
      But the user should be aware that some IRAS specific information, e.g.
      SOP, OBS and detector number, and such figures as cross scan distance
      reported by the applications may be irrelevant to data trace it contains.
      Thus TRACECRDD will report the correct reference position, a cross scan
      value and positions in \texttt{'}get data value\texttt{'} that may be out by the half
      detector width, an average point source profile for the waveband, and
      a detector number which is not applicable.

      Users should also be aware that they should not use coadded scans in
      subsequent coadding or image preparation with eg MAPCRDD. This is because
      of two things, firstly the positional inaccuracies noted above, and
      secondly that since the coadded scan already contains processed weighting
      applying a second weighting is going to use the wrong weight values, and
      assume only accuracy appropriate for a single scan.

      Under normal usage a logfile will be produced containing details of the
      crossing information which are not reported to the screen.
   }
   \sstparameters{
      \sstsubsection{
         ADD\_SOURCE = LOGICAL (Read)
      }{
         When this is true the user is prompted to supply details of
         additional source positions.
      }
      \sstsubsection{
         AUTOMATIC = LOGICAL (Read)
      }{
         When it has the value true, the application will run in the
         automatic mode, where output file names, titles and labels of
         the output NDF files (one for each expected source) will be
         generated by the application. Otherwise the user will be
         prompted for these values. [TRUE]
      }
      \sstsubsection{
         OUT = NDF (Read)
      }{
         The name of the output NDF file containing the coadded data
         trace for each expected point source. It will only be used when
         the application is running in non-automatic mode. If the
         application is running in automatic mode the default value will
         be \texttt{"}coadded\_\texttt{"}sourcename\texttt{"}\_b\texttt{"}waveband number eg coadded\_wola\_b3 .
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Sky coordinate system used to specify the additional expected
         point source positions. When reporting in the log file, this
         sky coordinate system will also be used to describe the crossed
         expected point source position. Valid values include ECLIPTIC,
         EQUATORIAL and GALACTIC. See help on \texttt{"}Sky\_coordinates\texttt{"} for more
         information on available sky coordinate systems.
         [current sky coordinate system]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         Specifies a group of input CRDD NDF files. This should be in the
         form of a group expression (see help on \texttt{"}Group\_expressions\texttt{"}).
         All files in the group should be from the same CRDD type, but can
         be from different waveband. If an expected source is crossed by
         the detector traces from the different wavebands, the coadding
         will be performed for each waveband.
      }
      \sstsubsection{
         DISTANCE = \_LOGICAL (Read)
      }{
         If it is true, the distance of the centre of a trace from the
         expected source position will be taken into account when
         deciding the weight used when coadding. Otherwise, the distance
         will not be taken into account. [TRUE]
      }
      \sstsubsection{
         GVDTEG = \_REAL (Read)
      }{
         The value of the Gaussian weighting function at the edge of the
         detector used when the distance of trace centre to the
         expected source position is taken into account. The default
         value is such that the detector traces which see the
         expected source at the edge of their field of view will have
         half weighting compared with the traces pass the expected
         source at their centre. [0.5]
      }
      \sstsubsection{
         INTER = LITERAL (Read)
      }{
         Specifies the interpolation method to be used when aligning the
         crossing traces. It can take following values:

          LINEAR - The linear interpolation method is to be used.

          NEAREST - The nearest neighborhood method is to be used.

         The input can be abbreviated to an unambiguous length and is
         case insensitive. [LINEAR]
      }
      \sstsubsection{
         LOGFILE = LITERAL (Read)
      }{
         The name of the logging file to contain the reporting of the
         crossing and related information for all expected point source
         position. [coaddcrdd.log]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Given)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         help on \texttt{"}Message\_filtering\texttt{"}).  [current message filter setting]
      }
      \sstsubsection{
         OFILTXT = LITERAL (Read)
      }{
         The name of the text file containning the names of the output
         NDF this file can be used as the input file for the following
         applications which accept group NDF specification.
         [outndf.log]
      }
      \sstsubsection{
         SCNLEN = \_REAL (Read)
      }{
         The length of the scan in aremin extracted around the expected
         source from a crossing trace to be coadded with the other
         crossing traces. [80.0]
      }
      \sstsubsection{
         SOURCE\_LAT = LITERAL (Read)
      }{
         The sky latitude of the additional expected source position,
         in the coordinate system specified by the parameter COORDS
         (eg if COORDS is EQUATORIAL then SOURCE\_LAT should be given
          the Declination of the image centre). See help on
         \texttt{"}Sky\_coordinates\texttt{"} for the formats allowed for this value.
         The application will keep prompting for the next expected
         source position until a null, \texttt{'}!\texttt{'}, value is given to the
         parameter SOURCE\_NAME.
      }
      \sstsubsection{
         SOURCE\_LON = LITERAL (Read)
      }{
         The sky longitude of the additional expected source position,
         in the coordinate system specified by the parameter COORDS
         (eg if COORDS is EQUATORIAL then source\_LON should be given the
         Right Ascension of the image centre). See help on
         \texttt{"}Sky\_coordinates\texttt{"} for the formats allowed for this value.
         The application will keep prompting for the next expected
         source position until a null, \texttt{'}!\texttt{'}, value is given to the
         parameter SOURCE\_NAME.
      }
      \sstsubsection{
         SOURCE\_NAME = LITERAL (Read)
      }{
         The name of the additional expected sources specified by the
         user. The application will keep prompting for the name of the
         next source until a null value,\texttt{'}!\texttt{'} is supplied. [!]
      }
      \sstsubsection{
         TITLE = LITERAL (Read)
      }{
         The title of the output NDF file which contains the coadded
         data trace. In the automation mode, the title of the NDF for a
         expected source will be created by the application by
         concatenating the string \texttt{'}COADDCRDD:\texttt{'} and the source name. And
         hance this parameter will not be used in this mode.
      }
      \sstsubsection{
         WEIGHT = LITERAL
      }{
         The weighting scheme used when coadding. It can take following
         values:

           VARIANCE - Samples in the traces are weighted according to
                      the variance associated with them.

           NEFD - The traces are weighted according to the noise equivalent
                  flux density (NEFD) of their detector.

           EQUAL - The traces are uniformly weighted.

         The input can be abbrievated to an unambiguous length and is
         case insensitive. []
      }
      \sstsubsection{
         WIDEXT = \_REAL (Read)
      }{
         The detector width extenion. With this parameter being non-
         zero, the detector width used by the application becomes
         DETWID $+$ WIDEXT $*$ DETWID, where DETWID is the width of the
         detector (about 4.5 arcmin, see exp. suppl. Table II.C.3 for
         its exact value for each detector), and if an expected source
         position falls within the scan field of this width, the detecor
         trace is regarded as a crossing trace. It is recommended that if
         this parameter is to be used, its value should be selected
         between 0.0 and -1.0 so that the detectors which see the soucre
         at the edge of their field of view will not be selected. [0.0]
      }
   }
}

\sstroutine{
   DEGLCRDD
}{
   Deglitch a group of CRDD files
}{
   \sstdescription{
      This application deglitches the detector data traces of a group
      of CRDD files.

      Glitches are defined as spikes in the data which exceed the local
      noise level, and which are of duration less than a specified
      width, see parameter GLWID.

      The samples in the detected glitches can either be replaced by a
      Starlink bad value or be flagged by a specified quality name, see
      parameter QNAME, (GLITCH by default).

      In case the samples in the glitches being replaced by Starlink
      bad values, there will be a new CRDD file created for each input
      CRDD file. Only the DATA component of each NDF is modified; all
      other components are copied from the input CRDD file to the output
      without change. If the samples in the glitches are being flagged,
      the QUALITY component of the input CRDD file is updated and there
      will no new CRDD file created.
   }
   \sstparameters{
      \sstsubsection{
         BOX = REAL (Read)
      }{
         The size of the smoothing box, given in times of the width of
         the point source profile, used when rejecting samples stay
         too far away from its local average, see section Algorithm.
         [2.0]
      }
      \sstsubsection{
         CLIP( NITER ) = REAL (Read)
      }{
         The times of standard deviations at which samples will
         regarded as staying too far away from its local average and
         being rejected hence in each iteration, see section Algorithm.
         If the given number of CLIP less then the number of iteration,
         the last CLIP value will be repeated for the remaining CLIP.
         [3.0]
      }
      \sstsubsection{
         COMMENT = LITERAL (Read)
      }{
         A comment to store with the quality name assigned to the
         samples in the detected glitches. If parameter will only be
         used when parameter SETBAD has a value of FALSE and the
         specified quality name (by parameter QNAME) is not currently
         defined within the input CRDD file.
         [Samples in the detected glitches]
      }
      \sstsubsection{
         GLWID = REAL (Read)
      }{
         The spikes whose duration less than this value times the size
         of a point source are regarded as a glitch and are either
         replaced by BAD values or flagged by a specified quality name.
         A value of zero will suppress all deglitching, whereas a value
         of 1.0 will give very strong deglitching which will probably
         reject point sources as well. [0.3]
      }
      \sstsubsection{
         HISTORY = LOGICAL (Read)
      }{
         Determines if history information is to be added to the input
         or output CRDD files. See help on \texttt{"}History\_in\_IRAS90\texttt{"} for more
         information on history.
         [Current history setting]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         Specifies a group of input CRDD files. This should be in the
         form of a group expression (see help on \texttt{"}Group\_expressions\texttt{"}).
         There is no limit on the number of CRDD files which can be
         specified.
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Given)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         help on \texttt{"}Message\_filtering\texttt{"}).
         [current message filter setting]
      }
      \sstsubsection{
         NITER = INTEGER (Given)
      }{
         The number of iterations to perform the \texttt{"}soomth-reject\texttt{"}
         procedure. [8]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         When the samples in the detected glitches are replaced by
         Starlink bad values, this parameter is used to give a group of
         output CRDD files corresponding one-for-one with the list of
         input CRDD files given for parameter IN. This should be in the
         form of a group expression (see help on \texttt{"}Group\_expressions\texttt{"}).
         Expressions such as \texttt{"}$*$\_DG\texttt{"} are expanded by replacing the \texttt{"}$*$\texttt{"}
         character with each input CRDD file in turn.
      }
      \sstsubsection{
         PROFILES = NDF (Read)
      }{
         An NDF holding in-scan profiles of ideal point sources. The
         width of a point source in a waveband are difined as the width
         of the profile, given here,  at its half max. value.
         The default value is the files \texttt{"}profiles.sdf\texttt{"} contained in
         the main IRAS90 directory, which contains profiles taken from
         the IRAS Catalogs and Atlases Explanatory Supplement, page
         V-14. [ ]
      }
      \sstsubsection{
         QNAME = LITERAL (Read)
      }{
         The quality name to be assigned to the samples in detected
         glitched. If the supplied name is not already defined within
         the input NDF, then a definition of the name is added to the
         NDF. The user is warned if the quality name is already defined
         with the NDF. [GLITCH]
      }
      \sstsubsection{
         SETBAD = LOGICAL (Read)
      }{
         If it is true, the samples in the detected glitches will be
         replaced by Starlink BAD values. And a output CRDD file will
         created for each input CRDD file to hold the modified data. If
         it is false, the quality components of the input CRDD files
         will be modified to hold specified quality name for these
         samples in the glitches. [TRUE]
      }
      \sstsubsection{
         XNAME = LITERAL (Read)
      }{
         If the NDF already contains any quality name definitions then
         new quality names are put in the same extension as the old
         names. If no previous quality names have been stored in the NDF
         then this parameter will be used to obtain the name of an NDF
         extension in which to store new quality name. The extension
         will be created if it does not already exit (see parameter
         XTYPE ). [QUALITY\_NAMES]
      }
      \sstsubsection{
         XTYPE = LITERAL (Read)
      }{
         If a new NDF extension is created to hold quality names (see
         parameter), then this parameter is used to obtained the HDS
         data type for the created extension. The default is to give the
         extension a type identical to its name. [ ]
      }
   }
      \sstsubsection{
         Algorithm
      }{
      The deglitching is based on an iterative scheme in which the input
      detector data stream is smoothed with a box filter of width
      specified by parameter BOX. An estimate of the RMS residual
      between input and smoothed data is formed, and input data
      corresponding to residuals of greater than CLIP (see parameter
      CLIP ) times the RMS residual are rejected. This smooth-reject
      procedure is repeaded NITER (see parameter NITER ) times. Glitches
      are then identified by looking for blocks of adjacent rejected
      output pixels. Any such block with sizes less than or equal to
      GLWID (see parameter GLWID ) times a point source width are
      regarded as a glitch. The samples in the detected glitches are
      either replaced by Starlink BAD values or have the quality being
      flagged by a specified quality name (see parameter SETBAD).
      All other input data is retained in its original form.
   }
}
\newpage
\sstroutine{
   DESTCRDD
}{
   Removes detector-to-detector stripes from a group of CRDD files
}{
   \sstdescription{
      This routine performs detector-to-detector destriping on a group
      of CRDD files. An output CRDD file is produced for each input
      CRDD file, holding the destriped data.  Each CRDD file is
      destriped by subtracting a constant offset from each detector
      data stream, so that all detectors in the output CRDD file have
      the same background surface brightness. The mean background
      surface brightness in each CRDD file (in MJy/sr) is preserved; no
      attempt is made to match backgrounds between different CRDD
      files.

      Only the DATA component of each NDF is modified by this routine;
      all other components are copied to the output without change.
   }
   \sstusage{
      DESTCRDD IN OUT
   }
   \sstparameters{
      \sstsubsection{
         BACKMEAN = \_REAL (Write)
      }{
         An output parameter to which is written the mean background
         surface brightness after destriping. The mean is taken over
         all the CRDD files specified by parameter IN, and is in units
         of Mega-Janskys per steradian. This value is also written
         to the screen once all the CRDD files have been processed.
      }
      \sstsubsection{
         BACKSIGMA = \_REAL (Write)
      }{
         An output parameter to which is written the standard deviation
         of the background surface brightness after destriping. The
         standard deviation is taken over all CRDD files specified by
         parameter IN, and is in units of Mega-Janskys per steradian.
         This value is also written to the screen once all the CRDD
         files have been processed.
      }
      \sstsubsection{
         BOX = \_INTEGER (Read)
      }{
         The size of the smoothing box used during the cleaning
         algorithm, given as a number of samples. This is roughly the
         extent of the largest source to be rejected from each detector
         data stream before going on to estimate the background surface
         brightness. A value of zero causes no cleaning to be
         performed.                                                 [40]
      }
      \sstsubsection{
         CLIP = \_REAL (Read)
      }{
         The number of standard deviations at which data will be
         rejected by the cleaning algorithm.                       [1.0]
      }
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output CRDD files. See help on \texttt{"}History\_in\_IRAS90\texttt{"} for more
         information on history. The history information will contain
         the names of the input CRDD files, DESTCRDD parameter values,
         and the offsets subtracted from each detector.
                                               [current history setting]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         Specifies a group of input CRDD files. This should be in the
         form of a group expression (see help on \texttt{"}Group\_expressions\texttt{"}).
         The CRDD files must contain data from the same IRAS waveband.
         There is no limit on the number of CRDD files which can be
         specified.
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         help on \texttt{"}Message\_filtering\texttt{"}).
                                        [current message filter setting]
      }
      \sstsubsection{
         NITER = \_INTEGER (Read)
      }{
         The number of cleaning iterations to perform. A value of zero
         causes no cleaning to be performed.                         [4]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         A group of output CRDD files corresponding one-for-one with
         the list of input CRDD files given for parameter IN.  This
         should be in the form of a group expression (see help on
         \texttt{"}Group\_expressons\texttt{"}). Expressions such as \texttt{"}$*$\_DS\texttt{"} are expanded
         by replacing the \texttt{"}$*$\texttt{"} character with each input CRDD file in
         turn.
      }
      \sstsubsection{
         QEXP = LITERAL (Read)
      }{
         A quality expression giving the quality of samples which are
         to be included in the estimation of the offset to be
         subtracted from each detector. A value of \texttt{"}ANY\texttt{"} causes all
         samples to be used, without regard to quality.            [ANY]
      }
      \sstsubsection{
         QNAME = LITERAL (Read)
      }{
         The name of a quality to be assigned to all samples which do
         not contribute to the estimation of a detector offset value.
         Samples are omitted from the detector offset calculations if
         they are bad in the input NDF, do not satisfy the quality
         expression given by parameter QEXP, or are rejected as source
         samples by the cleaning algorithm. A blank value for QNAME
         causes no quality values to be assigned.                     []
      }
      \sstsubsection{
         XNAME = LITERAL (Read)
      }{
         If any the input NDF do not already contain any quality name
         definitions then new quality names are put in the extension
         specified by XNAME. This extension is created if it does not
         already exist.                                  [QUALITY\_NAMES]
      }
      \sstsubsection{
         XTYPE = LITERAL (Read)
      }{
         If any new NDF extensions are created to hold quality names
         (see parameter XNAME), then parameter XTYPE is used to obtain
         the HDS data type for the created extensions. The run time
         default is to give the extension a type identical to its name.
                                                                      []
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         DESTCRDD ZCMA\_B1S1 ZCMA\_B1S1\_DS
      }{
         This command destripes CRDD file ZCMA\_B1S1 and puts the
         results in ZCMA\_B1S1\_DS.
      }
      \sstexamplesubsection{
         DESTCRDD $*$\_RAW $*$$|$\_RAW$|$\_DS$|$ QEXP=.NOT.(SOURCE\_A.OR.SOURCE\_B)
      }{
         This command attempts to destripe all NDFs in the current
         directory which have names ending with \texttt{"}\_RAW\texttt{"}, placing the
         results in corresponding output NDFs in which \texttt{"}\_RAW\texttt{"} is
         replaced by \texttt{"}\_DS\texttt{"}. Any samples which have either of the two
         qualities SOURCE\_A and/or SOURCE\_B are excluded from the
         estimation of the detector offsets.
      }
   }
   \sstdiytopic{
      Estimation of Detector Offsets
   }{
      The user may choose to exclude certain samples from the estimation
      of the detector offsets, by giving a \texttt{"}quality expression\texttt{"} for
      parameter QEXP. Only those samples which have qualities satisfying
      the given quality expression are included in the estimation of the
      detector offsets. Qualities can be assigned to selected samples
      using routine SETQUAL.

      After removing samples which do not satisfy the quality
      expression, each detector data stream is \texttt{"}cleaned\texttt{"} by removing
      any remaining bright sources which may adversly influence the
      estimation of the background surface brightness. To do this the
      detector data stream is smoothed with a box filter, the size of
      which is specified by parameter BOX. The RMS residual between the
      smoothed data and the original data is then found. All samples
      for which the residuals exceeds a given multiple of the RMS
      residual (specified by parameter CLIP) are rejected as belonging
      to a bright source. The process is then repeated, excluding the
      samples just rejected, a given number of times (specified by
      parameter NITER). This cleaning can be switched off by specifying
      a value of zero for either NITER or BOX.

      Next, the median value of the remaining data is found, and is
      converted into a surface brightness value in Mega-Janskys per
      steradian (see help on \texttt{"}Detector\_solid\_angles\texttt{"} and
      \texttt{"}Detector\_bandwidths\texttt{"} for lists of detector effective solid
      angles and band widths). The mean of the median surface
      brightnesses of all detectors in the CRDD file is found. The
      detector offsets are then calculated by subtracting this mean
      surface brightness from each individual detector\texttt{'}s median surface
      brightness. The offsets are finally converted back from
      Mega-Janskys per steradian to the units of the input CRDD file.

      The offsets are then subtracted from all input samples (including
      those previously rejected by the cleaning algorithm or the
      quality expression), and these are then stored in the output CRDD
      file.
   }
   \sstdiytopic{
      Background Levels in the Output CRDD Files
   }{
      Output CRDD files retain the mean background surface brightness
      of the input data. This may result in scan-to-scan stripes being
      visible in images formed from the output CRDD files. These
      stripes can be removed by processing the CRDD files produced by
      DESTCRDD with routine BACKCRDD before combining them into an
      image.

      After all CRDD files have been destriped, the mean background
      surface brightness (taken over all the output CRDD files) is
      displayed in Mega-Janskys per steradian. The spread in background
      values in the output CRDD files is also displayed. These values
      are written to the output parameters BACKMEAN and BACKSIGMA.
   }
}
\sstroutine{
   FINDCRDD
}{
   Accepts a list of sources, and prepares files specifying
   corresponding CRDD data to be extracted
}{
   \sstdescription{
      FINDCRDD enables the user to input and edit a list of source
      positions which may be started as a new list, or initiated from
      a previously prepared file. It then allows the user to input the
      source size and waveband requirements associated with the
      extraction of Survey CRDD data. It checks whether all the data for
      any source can be provided from a single archive CRDD file, and if
      not allows the user to return to the editing menu to put in dummy
      sources to extract data from other archive files if required.
      Finally it prepares files containing details of IRAS survey CRDD
      data to be extracted by the succeeding program, EXCRDD.
   }
   \sstparameters{
      \sstsubsection{
         AUGMENTNAME = \_CHAR (Read)
      }{
         Name of source to be augmented with size and wavebands.
      }
      \sstsubsection{
         BANDSREQ = LITERAL (Read)
      }{
         Bands required entered as 12,25 etc.. [12,25,60,100].
      }
      \sstsubsection{
         CONFIRMADDEDIT = \_LOGICAL (Read)
      }{
         Confirmation that added or edited source details are correct
         [Y].
      }
      \sstsubsection{
         CONFIRMDELETE = \_LOGICAL (Read)
      }{
         Confirmation that the source printed is to be deleted [N].
      }
      \sstsubsection{
         CONFIRMREQ = \_LOGICAL (Read)
      }{
         If .TRUE. added/ edited sources are to be confirmed.
      }
      \sstsubsection{
         CROSSCAN = \_REAL (Read)
      }{
         Size of required region in cross scan direction given in
         arcmins. [0.0]
      }
      \sstsubsection{
         DATATYPE = LITERAL (Read)
      }{
         (The facility that requires this is not available in FINDCRDD
         version 1.0).

         Type of survey data required: 0 = Don\texttt{'}t know, 2 = PASS 2 CRDD
         on tape, 3 = PASS 3 CRDD on exobyte.
      }
      \sstsubsection{
         DELETESONAME  = LITERAL (Read)
      }{
         Name of the source to be deleted. If more than one source with
         this name is present then each one is offered for deletion.

         If the user enters ! to this prompt no more sources are to be
         deleted.
      }
      \sstsubsection{
         DISPLAYORFILE = LITERAL (Read)
      }{
         Controls whether certain information is displayed at the
         terminal or written to a file.

         The types of information affected are:-

         Lists of sources prepared by selecting L from a menu,

         Details of source regions which may fall partly outside plate
            boundaries.

         The options are:-
         \sstitemlist{

            \sstitem
            D = Display on terminal

            \sstitem
            F = File

            \sstitem
            B = Both

            \sstitem
            A = Ask user which he wants at time the display is prepared.

         }
         If the user enters ! to this prompt no display or file will be
         prepared.
         [A]
      }
      \sstsubsection{
         EDITSOURCENAME = LITERAL (Read)
      }{
         Name of the source to be edited. If more than one source with
         this name is present then each one is offered for editing.

         If the user enters ! to this prompt no more sources are to be
         edited.
      }
      \sstsubsection{
         INSCAN = \_REAL (Read)
      }{
         Size of required region in in\_scan direction given in arcmins.
         [120.0]
      }
      \sstsubsection{
         INSOURCEFILE1 = FILENAME (Read)
      }{
         Name of a file from which source positions are to be read. It
         will have been created in this or a previous run of FINDCRDD.

         If the user enters ! to this prompt no file is read and the
         user is returned to the menu.
      }
      \sstsubsection{
         MAINCHOICE = LITERAL (Read)
      }{
         Main menu choice
         \sstitemlist{

            \sstitem
            I = Input or edit source positions

            \sstitem
            S = Find survey data

            \sstitem
            Q = Exit FINDCRDD
            [I]
         }
      }
      \sstsubsection{
         MENU11CHOICE = LITERAL (Read)
      }{
         Users choice from \texttt{'}Select data to use\texttt{'} menu within the Input
         Source Positions option:-
         \sstitemlist{

            \sstitem
            N = Input new list of sources,

            \sstitem
            C = Modify current list,

            \sstitem
            F = Modify list from file,

            \sstitem
            L = Display sources selected,

            \sstitem
            P = Change number of lines displayed on a page

            \sstitem
            R = Return to main menu,

            \sstitem
            Y = Accept selected source list.

         }
         If the user enters ! to this prompt the menu is redisplayed.
         [N].
      }
      \sstsubsection{
         MENU12CHOICE = LITERAL (Read)
      }{
         Users choice from \texttt{'}Edit source list\texttt{'} menu within the Input
         source positions option:-
         \sstitemlist{

            \sstitem
            A = Add new sources to current list,

            \sstitem
            E = Edit data in current list of sources,

            \sstitem
            D = Delete sources from current list,

            \sstitem
            L = Display current list of sources,

            \sstitem
            P = Change number of lines displayed on a page

            \sstitem
            C = Change coordinate system in which position is entered,

            \sstitem
            Y = Accept source list.

         }
         If the user enters ! to this prompt the menu is redisplayed.
         [Y]
      }
      \sstsubsection{
         MENU2CHOICE = LITERAL (Read)
      }{
         Option from input-size-and-waveband menu in survey data option.
         \sstitemlist{

            \sstitem
            Z = Enter region size for all sources

            \sstitem
            W = Enter wavebands required for all sources

            \sstitem
            I = Enter region size and wavebands for individual sources

            \sstitem
            L = Display current list of sources

            \sstitem
            P = Change number of lines displayed on a page

            \sstitem
            R = Return to main menu

            \sstitem
            Y = Accept source list

         }
         If the user enters ! to this prompt the menu is redisplayed
      }
      \sstsubsection{
         MSG\_FILTER = \_INTEGER (Read)
      }{
         Controls whether menus are displayed and updated source lists
         are displayed after each change. Sources can be listed by
         selecting L from a menu no matter what the value of MSG\_FILTER.
         \sstitemlist{

            \sstitem
            1 = Neither source lists nor menus are shown.

            \sstitem
            2 = Source lists are shown automatically, menus are not.

            \sstitem
            3 = Menus are shown automatically, source lists are not.

            \sstitem
            4 = Both source lists and menus are shown automatically.
            [3]
         }
      }
      \sstsubsection{
         NEXTPAGE = \_LOGICAL (Read)
      }{
         Press return to display next page of source listing, scan
         listing etc.

         If the user enters N or ! to this prompt the next page will not
         be displayed and the user will be returned to the menu.
         [Y]
      }
      \sstsubsection{
         OFFEDGEFILE = FILENAME (Read)
      }{
         Name of a file to contain details of sources which may have
         some of the required region off the edge of the plate.

         The default name of this file is generated automatically as
         \texttt{'}source name\texttt{'}\_OFFEDGE ( or the corresponding lower case on a
         UNIX machine) and offered to the user.
      }
      \sstsubsection{
         OUTDESCFILE = FILENAME (Read)
      }{
         Name of a file to contain messages about plate files created
         and tapes to be used in subsequent EXCRDD runs.

         The name of this file is generated automatically as
         FINDCRDD\_PLATES\_REQ. ( or the corresponding lower case on a
         UNIX machine)
      }
      \sstsubsection{
         OUTSOURCEFILE1 = FILENAME (Read)
      }{
         Name of file in which to save source positions created in
         input or edit source positions.

         If the user enters ! to this prompt no file will be saved.
      }
      \sstsubsection{
         OUTSOURCEFILE2 = FILENAME (Read)
      }{
         Name of file in which to save source positions created in
         input size and wavebands part of the survey data option.
      }
      \sstsubsection{
         PAGELENGTH = INTEGER (Read)
      }{
         Number of lines per page on display
      }
      \sstsubsection{
         RETURNMAIN = \_LOGICAL (Read)
      }{
         Option to return to main menu (.TRUE.) if at the end of the
         subroutine which find what plates the sources are on, it has
         found a part of a source region off the edge of the plate. It
         allows the user to put in a dummy source in the next plate.
      }
      \sstsubsection{
         RETURNSWMENU = \_LOGICAL (Read)
      }{
         Set .TRUE. if on finding some sources without size or wavebands
         the user wants to return to the Size and Wavebands Menu to add
         them. If set .FALSE. those sources for which there is either no
         inscan length, or no wavebands required will not be processed.
      }
      \sstsubsection{
         SOURCECOORD1 = \_CHAR (Read)
      }{
         First coordinate of source position in current coordinate
         system. The formats available for both coordinates, are:-

         Equatorial:-
         \sstitemlist{

            \sstitem
            Style 1 :- RA = 12hrs 3m 0.02s  DEC = -33deg 23m 0.0s

            \sstitem
            Style 2 :- 12h 3m 0.02s  -33d 23m 0.0s

            \sstitem
            Style 3 :- 120300.02   -332300.0  (hhmmss.ss and ddmmss.ss)

            \sstitem
            Style 4 :- 12 03 0.02  -33 23 00.0

            \sstitem
            Style 5 :- 12.050006  -33.383333  (fractional values in hrs
                                                  (RA) or deg (Dec))

         }
         Ecliptic:-
         \sstitemlist{

            \sstitem
            Style 1 :- ELONG= 12deg 3m 0.02s  ELAT= -33deg 23m 0.0s

            \sstitem
            Style 2 :- 12deg 3m 0.02s  -33d 23m 0.0s

            \sstitem
            Style 3 :- 0120300.02   -332300.0  (dddmmss.ss and
                                                    ddmmss.ss)

            \sstitem
            Style 4 :- 12 03 0.02  -33 23 00.0

            \sstitem
            Style 5 :- 12.050006  -33.383333  (fractional values in
                                                   degrees)

         }
         Galactic:-
         \sstitemlist{

            \sstitem
            Style 1 :- GLONG= 12deg 3m 0.02s  GLAT= -33deg 23m 0.0s

            \sstitem
            Style 2 :- 12deg 3m 0.02s  -33d 23m 0.0s

            \sstitem
            Style 3 :- 0120300.02   -332300.0  (dddmmss.ss and
                                                    ddmmss.ss)

            \sstitem
            Style 4 :- 12 03 0.02  -33 23 00.0

            \sstitem
            Style 5 :- 12.050006  -33.383333  (fractional values in
                                                   degrees)

         }
         See SOURCECOORDSYS for changing coordinate system
      }
      \sstsubsection{
         SOURCECOORD2 = \_CHAR (Read)
      }{
         Second coordinate of source position in current coordinate
         system. See SOURCECOORD1 for the formats available.

         See SOURCECOORDSYS for changing coordinate system
      }
      \sstsubsection{
         SOURCECOORDSYS = LITERAL (Read)
      }{
         The identifier of the coordinate system the user wants to make
         the current coordinate system. The options available are
         Equatorial, Ecliptic, and Galactic. For Equatorial and
         Ecliptic the user should also enter the equinox as (B1950) or
         (J2000). If the equinox is ommitted (B1950) is assumed. If the
         prefix B or J is ommitted B is assumed. Therefore the minimum
         abreviations are EQ (Equatorial(B1950)), EQ(J2000), EC
         (Ecliptic(B1950)), and GA. The default is the last coordinate
         system used or Equatorial(B1950).
      }
      \sstsubsection{
         SOURCELISTFILE = FILENAME (Read)
      }{
         The file name to which to file a source list as it would be
         displayed on a terminal, for printing afterwards.
      }
      \sstsubsection{
         SOURCENAME = LITERAL (Read)
      }{
         The source name for this source, may be up to eight characters
         and must be a valid file name. Any characters input in lower
         case will be translated to upper case automatically.
         Since the source name used as an identification prefix for
         all files relating to that source IT IS STRONGLY ADVISED THAT
         EACH SOURCE NAME SHOULD BE UNIQUE.
      }
      \sstsubsection{
         SOURCETITLE = LITERAL (Read)
      }{
         Full title of source for printout headings etc
         (up to 40 chars). [SOURCENAME]
      }
      \sstsubsection{
         SPFARCHFILE = FILENAME (Read)
      }{
         The name of the SPFARCH SDF file
         [FINDCRDD\_DIR:NEWSPFARCH]
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         No ADAM parameter is given for the OUTPUT HDS FILE. An output
         HDS file is generated for each plate, containing information on
         the data EXCRDD needs to extract form that plate. This file is
         automatically given the name \texttt{"}PLATExxxx\texttt{"} where xxxx is the plate
         number, and therefore the program does not need to access the
         parameter system. ( or the corresponding lower case name on a UNIX
         machine)
      }
   }
}
\sstroutine{
   HISTORY
}{
   Display, delete or add NDF history information
}{
   \sstdescription{

      IN UNIX THE USER CAN ONLY USE THIS APPLICATION BY TYPING
      iras90\_history TO AVIOD CONFLICT WITH UNIX history COMMAND

      This routine allows several operations to be performed on the
      history information stored within a group of NDFs...

      1) Existing history records can be displayed (specify using
      FUNCTION=DISPLAY). The history is displayed in pages on the
      terminal screen, and optionally logged to a text file. The
      history records to be displayed can be selected on the basis of
      their creation dates (see parameters SINCE and BEFORE), or on the
      basis of the command which created the history (see parameter
      COMMAND).

      2) All history information can be deleted (specify using
      FUNCTION=ERASE). There is no option to delete selected history
      records.

      3) Additional history records can be appended. The text is
      specified either by the contents of a text file or by typing at
      the keyboard. The same text is used for each specified NDF.
      (Specify using FUNCTION=ADD)

      The required operation is performed on each of the NDFs specified
      by parameter NDF in turn.  There is an option for the user to be
      re-prompted for further operations once the first has been
      completed (see parameter LOOP).  The default behaviour is to to
      display all history records from the supplied NDFs and then exit.

  }
   \sstusage{
      HISTORY NDF [FUNCTION] [LOGFILE]
   }
   \sstparameters{
      \sstsubsection{
         BEFORE = LITERAL (Read)
      }{
         Only those history records created before the date and time
         specified by BEFORE are displayed. See
         section \ref{SEC:TIM} for more information on specifying
         times and dates within IRAS90. A null or blank value results
         in BEFORE being ignored. If LOOP is false then the run time
         default is a null value, otherwise there is no run time
         default.                                                     []
      }
      \sstsubsection{
         COMMAND = LITERAL (Read)
      }{
         The COMMAND parameter can be used to select which history
         records are to be displayed on the basis of the application
         which created them. If the string given for COMMAND can be
         found as a sub-string within the name of the application which
         created the history record, then the record is displayed. The
         names of all IRAS90 applications are stored in the form
         IRAS90:xxx, where xxx is the name of the application. Thus if
         COMMAND was given the value \texttt{"}IRAS90:\texttt{"}, then only those history
         records which were created by IRAS90 applications would be
         displayed. A null value causes all history records to be
         displayed (subject to any other selection criteria). If LOOP
         is false then the run time default is a null value, otherwise
         there is no run time default.                                []
      }
      \sstsubsection{
         FUNCTION = LITERAL (Read)
      }{
         The operation to be performed. Options are DISPLAY, ERASE or
         ADD. If LOOP has a false value then the run time default is
         \texttt{'}DISPLAY\texttt{'}, otherwise there is no run time default.           []
      }
      \sstsubsection{
         LOGFILE = LITERAL (Write)
      }{
         The name of a text file to receive a copy of any displayed
         history records. The run time default is for no log file to be
         produced.                                                   [!]
      }
      \sstsubsection{
         LOOP = \_LOGICAL (Read)
      }{
         If true then the user is re-prompted for a new value for
         FUNCTION once the previously requested function has been
         performed. If false, then the application exits once the first
         function has been performed.                            [FALSE]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}). Output to the log file is not
         effected by the setting of this parameter.
                                        [current message filter setting]
      }
      \sstsubsection{
         NDF = NDF (Update)
      }{
         The group of NDFs to process. This should be in the form of a
         group expression (see section \ref{SEC:GRP}).
      }
      \sstsubsection{
         SINCE = LITERAL (Read)
      }{
         Only those history records which were created since the date
         and time specified by SINCE are displayed. See section \ref{SEC:TIM}
         for more information on specifying
         times and dates within IRAS90. A null or blank value results
         in SINCE being ignored. If LOOP is false then the run time
         default is a null value, otherwise there is no run time
         default.                                                     []
      }
      \sstsubsection{
         TEXT = LITERAL (Read)
      }{
         Text to be used to form a new history record. If the supplied
         text terminates with a minus sign, then the user is re-prompted
         for more text (the minus sign is removed before the text is
         stored in the NDF). The name of an existing text file can be
         specified, preceeded with an up-arrow character (\^{}), in which
         case the text will be read from the text file. If more than
         one NDF is being processed, the same text is used for each NDF.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         HISTORY CENA
      }{
         This will display all the history information contained within
         the NDF CENA on the terminal screen.
      }
      \sstexamplesubsection{
         HISTORY CENA COMMAND=MAPCRDD
      }{
         This will display all the history information within CENA
         which was created by the MAPCRDD application.
      }
      \sstexamplesubsection{
         HISTORY M51$*$ ERASE
      }{
         This will remove all history information from all NDFs with
         names which start with the string \texttt{"}M51\texttt{"}.
      }
      \sstexamplesubsection{
         HISTORY \texttt{"}CENA,M82\texttt{"} LOGFILE=HISTORY MSG\_FILTER=QUIET
      }{
         This will write all the history information contained within
         the two NDFs CENA and M82 to the text file HISTORY.DAT, but
         will display nothing on the screen.
      }
      \sstexamplesubsection{
         HISTORY M51 LOOP=Y SINCE=FEB-12 BEFORE=FEB-16
      }{
         This will display all the history records from M51 which were
         create between the 12th and 16th of february (this year), and
         then reprompt the user for a new operation.
      }
      \sstexamplesubsection{
         HISTORY M51 ADD TEXT=\texttt{"}So far so good\texttt{"}
      }{
         This will append a new history record to M51, containing the
         text \texttt{"}So far so good\texttt{"}.
      }
      \sstexamplesubsection{
         HISTORY M51 ADD TEXT=\^{}NEWHIST.LIS
      }{
         This will append a new history record to M51, taking the
         history text from the file NEWHIST.LIS.
      }
   }
}

\sstroutine{
   I90HELP
}{
   Gives help about IRAS90
}{
   \sstdescription{
      This routine displays help information, containing classified and
      alphabetical lists of commands, general information and related
      material; it describes individual commands in detail.

      Here are some of the main options:
\begin{description}
\item [I90HELP]
\item
            No parameter is given so the introduction and the top-level
            help index is displayed.
\item [I90HELP application/topic]
\item
            This gives help about the specified application or topic.
\item [I90HELP application/topic subtopic]
\item
            This lists help about a subtopic of the specified
            application or topic. The hierarchy of topics has a maximum
            of four levels.
\end{description}

      Once in the help library, it can be navigated in the same way
      as VMS help libraries.  CTRL/Z (on VMS) or CTRL/D (on UNIX) to exit from
      any level, and $<$RET$>$ to move up a level in the hierarchy.
   }
   \sstusage{
      I90HELP [TOPIC] [SUBTOPIC] [SUBSUBTOPIC] [SUBSUBSUBTOPIC]
   }
   \sstparameters{
      \sstsubsection{
         LIBRARY = LITERAL (Read)
      }{
         The Starlink help library from which help text is to be
         obtained.                              [IRAS90\_DIR:IRAS90\_HELP]
      }
      \sstsubsection{
         SUBSUBSUBTOPIC = LITERAL (Read)
      }{
         Subsubsubtopic for which help is to be given.             [\texttt{"} \texttt{"}]
      }
      \sstsubsection{
         SUBSUBTOPIC = LITERAL (Read)
      }{
         Subsubtopic for which help is to be given.                [\texttt{"} \texttt{"}]
      }
      \sstsubsection{
         SUBTOPIC = LITERAL (Read)
      }{
         Subtopic for which help is to be given.                   [\texttt{"} \texttt{"}]
      }
      \sstsubsection{
         TOPIC = LITERAL (Read)
      }{
         Topic for which help is to be given.                      [\texttt{"} \texttt{"}]
      }
   }
}
\sstroutine{
   IFIELD
}{
   Gives all the ISSA plates that lie with a certain box
}{
   \sstdescription{
      This program allows the user to determine which ISSA plates are of
      interest, and on which CDs they may be found.

      The user should determine a square area of the sky which contains the
      area of interest. The co-ordinates of the centre of this box and
      the box size in arcminutes are input as parameters.
      From this, the program calculates
      which ISSA plates are contained within (part of) the box. It
      also tells the user what CDs the plate is on, whether it is a
      reject, and the plate centre.
      In addition, it displays which corners of the box lie on each plate.
      The corners are labelled thus:
      Centre: C, Top-left: C1, Bottom-left: C2, Top-right: C3,
      Bottom-Right: C4.

      The program uses the following algorithm.

      Firstly, a list of plates which contain the centre point is generated,
      such that the best plate is first. Since there is no duplication of
      plates in this list, the entire list is copied to the final output
      list. Each plate in the output list has a corner string which lists
      all the corners of the box found on the plate. This string is initialised
      to include the box centre for all plates in the list.

      Assuming the user wanted a box rather than a point, the
      co-ordinates of each corner of the box are calculated. Then the
      following process is repeated for each corner in turn.

      Just as with the centre point, a list of all plates containing the
      corner is generated. For each plate, if the plate is already known
      in the final output list, the current corner is appended to the corner
      string. Otherwise the plate is added to the output list and the corner
      string is initialised to the current corner.

      The final output list is displayed. The ordering of the original lists
      means that the better plates will be first.
   }
   \sstparameters{
      \sstsubsection{
         AGAIN = Logical (Read)
      }{
         Whether to re-run the program
      }
      \sstsubsection{
         CSYS = LITERAL (Read)
      }{
         The sky co-ordinate system (and epoch) to use     [Equatorial (B1950)]
      }
      \sstsubsection{
         HCON = INTEGER (Read)
      }{
         The HCon of the ISSA plates. This is needed to determine which
         disks the plates may be found on.                                  [0]
      }
      \sstsubsection{
         LAT = LITERAL (Read)
      }{
         The latitude of the centre of the box, in the co-ordinate system
         defined by CSYS
      }
      \sstsubsection{
         LOGFILE = LITERAL (Read)
      }{
         The name of the logfile - null if a logfile is not required
      }
      \sstsubsection{
         LON = LITERAL (Read)
      }{
         The longitude of the centre of the box, in the co-ordinate system
         defined by CSYS
      }
      \sstsubsection{
         SIZE = DOUBLE (Read)
      }{
         The size of the box in arcminutes in which the user is interested.
         A value of 0.0 indicates that the user is interested in only the
         central point.                                                    [0.0]
      }
   }
}

\sstroutine{
   IRASTRACE
}{
   Display the attributes of a group of IRAS90 NDFs
}{
   \sstdescription{
      This routine displays the information stored in the IRAS
      extensions of a group of NDFs. Either CRDD files or images may be
      specified.
   }
   \sstusage{
      IRASTRACE IN [LOGFILE]
   }
   \sstparameters{
      \sstsubsection{
         IN = NDF (Read)
      }{
         The group of NDFs to process. This should be in the form of a
         group expression (see section \ref{SEC:GRP}).
      }
      \sstsubsection{
         LOGFILE = LITERAL (Write)
      }{
         The name of a text file to receive a copy of the displayed
         information. The run time default is for no log file to be
         produced.                                                   [!]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen and
         logged to the log file. This should take one of the values
         QUIET, NORMAL or VERBOSE (see section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         IRASTRACE CENA$*$ CENA.LIS
      }{
         This will display the contents of the IRAS extensions within
         all NDF beginning with the string \texttt{"}CENA\texttt{"}. The information will
         also be written to the text file CENA.LIS
      }
   }
}

\sstroutine{
   MAKEPROF
}{
   Create an NDF holding standard in-scan detector response profiles
}{
   \sstdescription{
      This routine creates an NDF holding typical in-scan detector
      point source profiles. The data is taken from the IRAS Catalogs
      and Atlases Explanatory Supplement (second edition), page V-14.

      The NDF contains four rows, each holding a typical point source
      profile for one of the four survey wavebands. The NDF contains
      AXIS structures which identify the wavebands and the in-scan
      offset from the source centre.
   }
   \sstusage{
      MAKEPROF OUT
   }
   \sstparameters{
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output NDF. See section \ref{SEC:HIS}, for more
         information on history.               [current history setting]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         The name of the output NDF.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         MAKEPROF PROFILES
      }{
         Create an NDF called PROFILES containing typical in-scan
         detector responses.
      }
   }
   \sstdiytopic{
      Allowed Formats for Profile NDFs
   }{
      If users wish to create their own in-scan detector profiles for
      use with TRACECRDD, etc, then they must ensure that the NDFs
      holding the profiles conform to the following requirements:

      \sstitemlist{

         \sstitem
         Each row of the NDF must contain a single in-scan profile.

         \sstitem
         Each profile should be normalised to a peak value of unity.

         \sstitem
         The NDF must contain either 1 or 4 rows of data; no other
         values are allowed. If the NDF holds 4 rows, then rows 1 to 4
         should contain the profiles for the 12, 25, 60 and 100 um bands
         respectively. If the NDF holds one row then the single profile
         will be used by TRACECRDD (etc) for all wave-bands.

         \sstitem
         If an NDF contains 4 profiles, each one must be sampled at
         the same in-scan positions. Any gaps left at the ends of shorter
         profiles should be filled with zeros.

         \sstitem
         The second dimension (i.e. the in-scan axis) should have an
         associated AXIS structure containing a CENTRE array and a UNITS
         component. The UNITS component must start with the string
         \texttt{"}ARC-MIN\texttt{"} (case is ignored), and the CENTRE array must contain the
         in-scan offset from the detector centre to each point in the
         profile, in arc-minutes. These values should be in the same sense
         as the focal plane Y axis.
      }
   }
}

\sstroutine{
   MAKERESP
}{
   Create NDFs holding IRAS spectral response data
}{
   \sstdescription{
      This routine creates an NDF holding the spectral response curve
      for a specified IRAS survey band. The NDF is one dimensional, and
      gives the normalised system response against wavelength. The
      wavelength corresponding to each element is stored in the NDFs
      AXIS component, in $\mu$ms. The values in the DATA component are
      normalised to that the peak response throughout all four bands is
      unity. The data is taken from the IRAS Catalogs and Atlasses
      Explanatory Supplement (second edition), table II.C.5.

      The NDF contains a VARIANCE component which holds values
      corresponding to a 1\% error on the response values. The AXIS
      component also has a variance array, holding the uncertainties in
      the wavelength at each element, corresponding to an error of 0.3
      $\mu$ms.  The size of these errors are not well known, but the
      Exp. Supp.  says these are the maximum expected values (paragraph
      C.3, page VI-28).
   }
   \sstusage{
      MAKERESP OUT BAND
   }
   \sstparameters{
      \sstsubsection{
         BAND = \_INTEGER (Read)
      }{
         The wavelength (in $\mu$ms) of the IRAS survey band for which
         spectral response data is required.
      }
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output NDF. See section \ref{SEC:HIS}, for more
         information on history.               [current history setting]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         The name of the output NDF.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         MAKERESP SPECRESP60 60
      }{
         Create an NDF called SPECRESP60 containing the spectral
         response for the 60 um band.
      }
   }
}

\sstroutine{
   MAPCRDD
}{
   Maps a group of CRDD files into a two dimensional image
}{
   \sstdescription{
      This routine maps a group of CRDD files into a two dimensional
      surface brightness image by coadding the data samples. The
      algorithm used is described below, together with the extensive
      facilities which exist for tailoring the behaviour of the
      application.
   }
   \sstusage{
      MAPCRDD IN PIXSIZE CENTRE\_LON CENTRE\_LAT BOXSIZE OUT
   }
   \sstparameters{
      \sstsubsection{
         BOXSIZE = \_REAL (Read)
      }{
         A pair of numbers giving the dimensions of the output image in
         arc-minutes, along the two image axes. The default values for
         CENTRE\_LON, CENTRE\_LAT and BOXSIZE offered to the user are
         chosen so that all the input data (excluding the short
         sections at the ends of each scan which have coverage by only
         half of the detectors) just fits in the image.  If the image
         is large, the distance between the sides (in terms of arc
         minutes) will change due to projection effects.  The given
         values are the distances between the centre points of opposite
         sides of the image. If only one value is given, the created
         image is square with the size of each side equal to the
         supplied value.
      }
      \sstsubsection{
         CENTRE\_LAT = LITERAL (Read)
      }{
         The sky latitude of the centre of the output image, in the
         coordinate system specified by the parameter COORDS (eg if
         COORDS is EQUATORIAL then CENTRE\_LAT should be given the
         Declination of the image centre). See section \ref{SEC:SKY}
         for the formats allowed for this value.
      }
      \sstsubsection{
         CENTRE\_LON = LITERAL (Read)
      }{
         The sky longitude of the centre of the output image, in the
         coordinate system specified by the parameter COORDS (eg if
         COORDS is EQUATORIAL then CENTRE\_LON should be given the Right
         Ascension of the image centre).See
section \ref{SEC:SKY}
         for the formats allowed for this value.
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the coordinate system used for referring to sky
         positions. Valid values include ECLIPTIC, EQUATORIAL,
         GALACTIC. See section \ref{SEC:SKY} for more information
         on available sky coordinate systems.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         EXCLUDE = LITERAL (Read)
      }{
         A group of detector numbers, selected from those available in
         the IRAS waveband of the data contained in the input CRDD
         files. All data from the specified detectors are excluded from
         the final map (dead detectors are automatically excluded). See
         section \ref{SEC:DET} for more information on
         specifying groups of detector numbers. The parameter INCLUDE
         can alternatively be used to specify the detectors to use. The
         default value of SMALL causes all the small detectors to be
         excluded.                                               [SMALL]
      }
      \sstsubsection{
         FWHM = \_REAL (Read)
      }{
         Two values specifying the full widths at half maximum of the
         Gaussian weighting functions for a full-size detector (in
         arc-minutes) in the cross-scan and in-scan directions.  The
         values actually used for each detector are scaled in
         proportion to the size of the detector. The weighting function
         is truncated to zero at the edge of the detector mask. The
         default values are the maximum cross-scan and in-scan detector
         sizes for the relevant waveband, and result in the weighting
         function falling to 0.5 before it is truncated at the edge of
         the detector.  If a single value is given, the same value is
         used for both cross-scan and in-scan widths.                 []
      }
      \sstsubsection{
         GAUSSIAN = \_LOGICAL (Read)
      }{
         If GAUSSIAN is set to a true value, then a Gaussian weighting
         function is applied to all input CRDD samples (i.e. each CRDD
         sample has a greater influence on pixels near the detector
         centre than it does on the pixels near the edge). This can
         decrease the noise and improve the resolution in the output
         image, but at the cost of a slightly greater run-time.   [TRUE]
      }
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output NDF. See section \ref{SEC:HIS} for more
         information on history. The history information will contain
         the names of the input CRDD files, MAPCRDD parameter values
         used to create the image, and the detector solid angles and
         effective bandwidth used.             [current history setting]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         Specifies a group of input CRDD files. This should be in the
         form of a group expression (see section \ref{SEC:GRP}).
         All CRDD files must contain data from the same IRAS waveband.
         There is no limit on the number of CRDD files which can be
         specified.
      }
      \sstsubsection{
         INCLUDE = LITERAL (Read)
      }{
         A group of detector numbers, selected from those available in
         the IRAS waveband of the data contained in the input CRDD
         files. Only data from the specified detectors are included in
         the final map. The parameter EXCLUDE can alternatively be used
         to specify the detectors to be omitted. Values specified for
         the INCLUDE parameter take precedence over those specified for
         the EXCLUDE parameter.  See section \ref{SEC:DET}
         for more information on specifying groups of detector numbers.
         The default group contains all the available detectors,
         excluding those specified by the EXCLUDE parameter.          []
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
      \sstsubsection{
         ORIENT = \_REAL (Read)
      }{
         The position angle of the second image axis( or \texttt{"}Y\texttt{"} axis), in
         degrees.  That is, the angle from north (defined by the
         coordinate system specified by parameter COORDS) to the image
         \texttt{"}Y\texttt{"} axis (\texttt{"}upwards\texttt{"} if the image is displayed normally).
         Positive angles are measured in the same sense as rotation
         from north through east.  The default value of zero puts
         north \texttt{"}upwards\texttt{"}.                                          [0.0]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         The name of the NDF to hold the output image. The output NDF
         may have defined VARIANCE or HISTORY components depending on
         the value of the VAROUT and HISTORY parameters, but never has
         defined QUALITY or AXIS components.
      }
      \sstsubsection{
         PIXSIZE = \_REAL (Read)
      }{
         The dimensions of a pixel in the output image, in arc-minutes.
         If a single value is given for PIXSIZE, then the output pixels
         are square. If two values are given then the output pixels are
         rectangular, having the specified dimensions. It should be
         remembered that the actual pixel size may vary slightly across
         the image depending on the type of projection. The values
         specified by parameter PIXSIZE give the actual pixel
         dimensions at the image centre.
      }
      \sstsubsection{
         PROJTYPE = LITERAL (Read)
      }{
         Specifies the type of projection to use when creating the
         output image. Valid values include GNOMONIC (i.e. tangent
         plane), ORTHOGRAPHIC, LAMBERT and AITOFF.  See
         section \ref{SEC:PROJ} for more information on available
         projections.                                         [GNOMONIC]
      }
      \sstsubsection{
         QEXP = LITERAL (Read)
      }{
         A quality expression (see section \ref{SEC:QUAL}).  Only
         those samples from the input CRDD files which have a QUALITY
         satisfying the given quality expression will be included in
         the mapping process. The default value of \texttt{"}ANY\texttt{"} causes all
         data to be used regardless of QUALITY.  If any of the quality
         names referenced in the quality expression are not defined for
         an input CRDD file, then the entire CRDD file is included in
         the map, irrespective of QUALITY. The user is warned if this
         happens. Note, the output image has no QUALITY component.
                                                                   [ANY]
      }
      \sstsubsection{
         SECSIZE = \_REAL (Read)
      }{
         The cross-scan and in-scan sizes of a full size detector
         \texttt{"}sector\texttt{"} in arc-minutes.  Smaller values will produce a more
         accurately Gaussian in-scan weighting function, but will
         increase the run-time in proportion. The default values are
         both equal to half of the minimum of the two pixel dimensions
         (given by parameter PIXSIZE). If a single value is given then
         the same value is used for both dimensions. The values used
         for SECSIZE are internally limited to be less than or equal to
         the pixel dimensions. Sector sizes for small detectors are
         reduced in proportion to the detector size (the sector weights
         are reduced by the same factor).                             []
      }
      \sstsubsection{
         TITLE = LITERAL (Read)
      }{
         A title to be stored with the output image. The default is the
         value of the TITLE component from the first input CRDD file. []
      }
      \sstsubsection{
         UNITS = LITERAL (Read)
      }{
         The units in which the output image values are required.  See
         section \ref{SEC:UNITS} for a list of the available units.  Note,
         when the selected units represent flux (or flux density) per
         pixel values, all pixels are considered to be the same size.
         This may not be the case if a large area is being mapped (more
         than a few degrees), resulting in erroneous output values. To
         avoid this, users are recommended to use an area preserving
         projection (such as AITOFF or LAMBERT, see parameter PROJTYPE)
         in these cases.                                        [MJy/sr]
      }
      \sstsubsection{
         VAROUT = LITERAL (Read)
      }{
         VAROUT specifies the type of output variances which are to be
         calculated. These variances represent the uncertainty in each
         pixel value in the output image, and are stored in the
         VARIANCE component of the output NDF. Legal values for VAROUT
         are INTERNAL, EXTERNAL or NONE. External is only allowed if
         all the input CRDD files have associated VARIANCE components.
         If EXTERNAL is specified, these externally calculated
         variances are used as the basis for the calculation of output
         variances.  If INTERNAL is specified, then the output
         variances are estimated internally from the spread of CRDD
         samples contributing to each output pixel. Users must be aware
         of the warnings about such variances contained in the \texttt{"}Notes\texttt{"}
         section below. A value of NONE for VAROUT causes no output
         variances to be calculated, with a corresponding reduction in
         run time.  If all input CRDD files have VARIANCES components,
         then the run-time default for VAROUT is EXTERNAL. Otherwise
         the run-time default is NONE.                                []
      }
      \sstsubsection{
         WEIGHT = \_LOGICAL (Read)
      }{
         If WEIGHT is set to a true value, then the total weight
         assigned to each input data sample will be proportional to the
         reciprocal of the sample variance value stored in the input
         CRDD file. If WEIGHT is false, each full size detector sample
         will have a total weight of unity (smaller detectors have
         lower weight because they influence fewer pixels). If any
         input CRDD files do not contain variance values then WEIGHT is
         always given a false value.  Care should be taken when using
         this option because bright samples usually have larger
         variances.  Selecting this option would therefore cause small,
         bright sources to be given lower weight than the surrounding
         background regions, resulting in sources being made
         systematically fainter.                                 [FALSE]
      }
   }
   \sstexamples{
      \sstexamplesubsection{ MAPCRDD \parbox[t]{12cm}{
         \^{}M51\_SCANS M51\_B1 COORDS=ECL ORIENT=10 HISTORY
                 QEXP=SOURCE.AND..NOT.SATURATED EXCLUDE=26-27}
      }{

         This will take the CRDD files listed in text file
         M51\_SCANS.DAT and produce an output map in M51\_B1.SDF. The
         output map will be oriented 10 degrees east of ecliptic north.
         Only data from detector \#47 with quality satisfying the
         expression SOURCE.AND..NOT. SATURATED will be included in the
         map. The quality names SOURCE and SATURATED must be set up by
         the user using the application SETQUAL). The output MAP
         includes a HISTORY component.
      }
   }
   \sstdiytopic{
      The Mapping Process
   }{
      A CRDD sample value represents the integrated flux over some
      small area of the sky (defined by the detector Point Spread
      Function).  When a sample value is divided by the detectors
      effective solid angle, it becomes a surface brightness estimate.
      Each pixel value in the output image is formed as the weighted
      mean of all the sample surface brightness values in the
      neighbourhood of the pixel. MAPCRDD provides two different
      weighting schemes:

      1) The sample has a constant weight at all pixels lying within
      the area covered by the relevant detector mask at the moment the
      sample was taken. The sample has zero weight at all other pixels.

      2) The sample has a weight which varies as a Gaussian with the
      distance between the detector centre and the pixel. The weights
      are truncated to zero at the edges of the detector mask. The
      Gaussian can have different widths in the in-scan and cross-scan
      directions (see parameter FWHM).

      The user can specify which scheme to use by means of the
      parameter GAUSSIAN. Scheme 1 is very slightly faster, but scheme
      2 results in less striping in the output image, and somewhat
      higher resolution.

      The algorithm proceeds for each data sample by first finding the
      centre of the detector within the output image. The area covered
      by the detector is then divided into rectangular \texttt{"}sectors\texttt{"} (see
      parameter SECSIZE).  The sample weight within each sector is
      found (it is considered to be constant across the sector), and
      multiplied by the sample value. The output pixel closest to the
      sector centre is found, and two images modified at that pixel.
      The first image holds the sum of the weighted data samples
      (expressed as surface brightness values), and the second hold the
      sum of the weights. After this has been done for all data
      samples, the first image is divided by the second.  Any pixels
      which have zero weight are set to the \texttt{"}bad\texttt{"} value.  Each output
      pixel value is thus the weighted mean of the neighbouring data
      samples.
   }
   \sstdiytopic{
      Reducing the Impact of Poor Data
   }{
      By default, each full size detector sample has a total weight of
      unity (smaller detectors have lower weight because they influence
      fewer pixels).  However, if all input data have associated
      variance estimates, there is an option (see parameter WEIGHT) for
      giving each sample a total weight proportional to the reciprocal
      of the sample\texttt{'}s variance. It should be borne in mind that
      brighter samples usually have larger variances, so this option
      will give lower weight to brighter samples, thus (for instance)
      systematically lowering point source fluxes. Samples with zero
      variance are treated like bad pixels if this option is selected.
   }
   \sstdiytopic{
      Estimating the Noise in the Output Image
   }{
      If the input sample values have associated variance values, then
      formal variance values can be defined for the output pixel values
      (albeit these variance values will be correlated because of the
      mapping algorithm). This is done by forming a third image holding
      the sum of the weighted input variance values. The weights used
      in this image are the square of the weights used in the first
      image. The final variances are formed by dividing this third
      image by the square of the second image. These variances represent
      the expected error between the \texttt{"}true\texttt{"} sky AFTER CONVOLUTION WITH
      THE DETECTOR PSFS, and the calculated surface brightness image.
      It should be remembered that Starlink software assumes that the
      NDF VARIANCE component holds variances related to independent,
      Gaussian errors. This is not the case with IRAS data, so the
      variance values should not be relied on too heavily.

      There is an option for creating output variance values based on
      the spread of input sample values at each pixel, rather than on
      the variance value stored for each input sample (see parameter
      VAROUT).  This facility allows output variances to be produced
      even when the input CRDD files do not have any associated
      variances. However, it must be emphasised that these variance
      estimates include a contribution caused by spatial structure in
      the image. For instance, the spread in input data values
      contributing to an output pixel which is close to a bright point
      source, will be completely dominated by the real variations
      caused by the point source. They will have only a relatively
      small contribution from the variations caused by noise. Caution
      should therefore be shown when using these \texttt{"}internally
      calculated\texttt{"} variance estimates.  Having said that, one benefit of
      using internal variance values, is that the resulting output
      variances will automatically include noise caused by residual
      striping in the input data. This will not usually be the case if
      input variance values are used. (This depends on how the input
      variances were calculated.)
   }
   \sstdiytopic{
      Colour Correction and Output Units
   }{
      The output image pixel values are not colour corrected and can be
      in one of several different systems of units. The available units
      are described in the section \ref{SEC:UNITS}. The detector effective
      solid angles and bandwidths used to produce the output values are
      listed in the section \ref{SEC:SOLAN} and
      \texttt{"}Detector\_bandwidths\texttt{"}. These values are also written to the
      HISTORY component of the output NDF (see parameter HISTORY).
   }
}

\sstroutine{
   NEWUNITS
}{
   Scale data into a new system of units
}{
   \sstdescription{
      The data and (if defined) variance values stored in the input
      NDFs are scaled into the units specified by parameter UNITS, and
      written to the output NDFs. The NDF component UNITS is modified to
      hold the name of the new units. NDFs holding either CRDD files or
      IRAS90 images (but not CPC images) may be given as input.
   }
   \sstusage{
      NEWUNITS IN OUT UNITS
   }
   \sstparameters{
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output NDF. See section \ref{SEC:HIS} for more
         information on history.               [current history setting]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         A group of input NDFs. This should be in the form of a group
         expression (see section \ref{SEC:GRP}).
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         A group of output NDFs corresponding one-for-one with the list
         of input NDFs given for parameter IN.  This should be in the
         form of a group expression (see section \ref{SEC:GRP}).
         Expressions such as \texttt{"}$*$\_NEW\texttt{"} are expanded by replacing the \texttt{"}$*$\texttt{"}
         character with each input NDF in turn.
      }
      \sstsubsection{
         UNITS = LITERAL (Read)
      }{
         The units in which the output values are required.  See
         section \ref{SEC:UNITS} for a list of the available units.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         NEWUNITS M51$*$ $*$\_SB MJy/sr
      }{
         This example copies all NDFs starting with the string \texttt{"}M51\texttt{"} to
         a set of corresponding output NDFs. The name of each output
         NDF is formed by extending the name of the input NDF with the
         string \texttt{"}\_SB\texttt{"}. The data values are converted into Mega-Janskys
         per steradian. If any of the inputs contain variance values,
         they are converted into units of (MJy/sr)$*$$*$2.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         If the conversion requires the solid angle of an image pixel
         to be known (eg from Jy/sr to Jy/PIXEL) the same nominal size is
         used for all pixels. If the image covers a large area of the sky
         this will not be appropriate unless the image is in an equal area
         projection.

         \sstitem
         If the conversion requires the solid angle of a CRDD sample
         to be used (eg from Jy to MJy/sr), the effective detector solid
         angles listed in section \ref{SEC:SOLAN} are used.

         \sstitem
         If the conversion requires the effective bandwidth of the
         detectors to be used (eg from pW/(M$*$$*$2) to Jy), the values listed
         in section \ref{SEC:BWID} are used. This includes no
         colour correction.
      }
   }
}

\sstroutine{
   POINTCRDD
}{
   Detects point sources along the detector trace(s) of CRDD NDF file
}{
   \sstdescription{
      This application is designed to detect point sources along the
      data traces of CRDD or CRDD-like NDF\texttt{'}s (e.g. the outputs of
      COADDCRDD, etc. ) files.

      The application will run in two modes, in non-automatic mode it will
      prompt the user for an expected source position, by default this will
      be the reference position of the scan. If the user accepts or enters
      a position the search for the point sources will be performed along a
      segment of the detector trace nearest to this expected source position.
      The two values SCAN\_NORTH and SCAN\_SOUTH are the lengths north and south
      of the source position to be used. If there is more than one detector
      the user is then also prompted for the detectors to use, which can
      be nearest, choose or all. If the user selects choose the detectors and
      their cross-scan distances will be presented and the user can accept or
      reject each. If the user enters null \texttt{'}!\texttt{'} to the source position the
      application will assume the full scan length should be searched for
      all detectors.

      If the application is run in automatic mode, the application assumes
      the reference position as the expected source position, the scan lengths
      as 40 arcminutes each, and the nearest detector.

      The source detection consists of the following steps
      For each detector trace
      i)   The overall noise is calculated for the scanlength specified
           or the whole scan. This includes an iterative proceedure
           which rejects samples more than THRESH\_SD times the standard
           deviation from the average.
      ii)  A zero sum filter is applied sucessively around each sample
           point. The filter adds a few samples centered at this point, where
           the strongest signal would be found if one was there, and subtracts
           a compensating number of outlying samples, so that if there is
           no signal the value would be approximately zero.
      iii) The mean and standard deviation of the filter output is calculated,
           again rejecting values more than THRESH\_SD times the standard
           deviation from average.
      iv)  The filter values are examined and any which are THRESH\_FILTER
           times the standard deviation are selected as candidate point
           source positions.
      v)   For each candidate position the correlation coefficient between
           the samples surrounding the position and the point source profile
           for an average detector in that band is calculated. If the
           correlation coefficient is greater than THRESH\_CORR, the candidate
           is accepted.
      vi)  The local noise around the candidate source is calculated. The
           range of samples used is two sections each of length NOISE\_SMPL
           on either side of a point source profile centered at the
           candidate position. Again the samples are iteratively rejected if
           they lie outside THRESH\_SD standard deviations. If more than 25\%
           of the sample are bad or rejected the range is extended to provide
           the neccessary 75\%.
      vii) A final test of the candidate position is applied. The signal at
           the position is compared with the local noise and it accepted as
           a point source if it exceeds THRESH\_S2N times the local noise.
           If THRESH\_S2N is given the null value \texttt{'}!\texttt{'} this test will not be
           applied and all candidates will be reported.

      The output results consist of three sections, the detection parameter
      values used, details of the scan, and details of each source.
      For each scan the details include the scan name, details of the expected
      source position, scan length and detectors used, and the mean sample
      value and noise value calculated together with the number of samples
      used in this calcuation.
      The information given for each point source includes its position,
      in-scan and cross-scan position relative to the expected point source
      position if given, average background, slope and local noise (including
      the number of samples used in calculating the noise), and the
      signal to noise ratio and correlation coefficient.
   }
   \sstparameters{
      \sstsubsection{
         AUTOMATIC = LOGICAL (Read)
      }{
         If AUTOMATIC is true the application assumes the expected source
         position is the reference position, the scan to be searched is 40
         arcmin on either side of this position, and the nearest detector
         is to be used.
         if AUTO is false the user is prompted for these values.
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Sky coordinate system used to specify the expected point source
         position and to decribe the sky positions of the found point sources
         when reporting the detection results.
         Valid values include ECLIPTIC, EQUATORIAL and GALACTIC.
         See help on \texttt{"}Sky\_coordinates\texttt{"} for more information on on available
         sky coordinate systems.
         [current sky coordinate system]
      }
      \sstsubsection{
         DET\_CHOICE = LITERAL (Read)
      }{
         Allows the user to select how detectors are to be chosen, and
         can take the values all(A), nearest(N), or choose(C). If all is
         entered all detectors are used, if nearest only the detector with
         the minimum crossscan distance from the expected source position
         is used. If choice is entered then detectors are chosen as described
         under DET\_REQ below. [nearest]
      }
      \sstsubsection{
         DET\_REQ = LOGICAL (Read)
      }{
         Allows the user to specify whether the detector whose details have
         just been presented to him should be included for examination or not.
         [TRUE]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         The name of the input CRDD or CRDD-like NDF file to be
         searched for the point source. The specified file can hold any
         of the supported forms of CRDD (eg. Survey, AO, etc).
      }
      \sstsubsection{
         LOGFILE = LITERAL (Read)
      }{
         The name of the text file to which the detection result will
         be written. No file will be created if a null value is supplied.
         [pointcrdd.log]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Given)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         help on \texttt{"}Message\_filtering\texttt{"}).  [current message filter setting]
      }
      \sstsubsection{
         NOISE\_SMPL = REAL (Read)
      }{
         The number of samples required in calculating local noise.
         Two segments each of half this length on either side of a point
         source profile surrounding a candidate source position are used
         to calculate local noise.
      }
      \sstsubsection{
         PROFILES = NDF (Read)
      }{
         An NDF holding in-scan point source profiles used as that
         expected from an ideal point source when comparing the data of
         the slected candidate sources with the ideal point source.
         The default value is the files \texttt{"}profiles.sdf\texttt{"} contained in
         the main IRAS90 directory, which contains profiles taken from
         the IRAS Catalogs and Atlases Explanatory Supplement, page
         V-14. [ ]
      }
      \sstsubsection{
         SCAN\_NORTH = REAL (Read)
      }{
         The length of scan segment in arcmin north of the expected point
         source position to be searched for point sources and used in the
         whole scan noise estimate. If a null, \texttt{'}!\texttt{'} response is given,
         the trace(s) will be searched from the beginning of that end.
         [40.0]
      }
      \sstsubsection{
         SCAN\_SOUTH = REAL (Read)
      }{
         The length of scan segment in arcmin south of the expected point
         source position to be searched for point sources and used in the
         whole scan noise estimate. If a null, \texttt{'}!\texttt{'} response is given,
         the trace(s) will be searched from the beginning of that end.
         [40.0]
      }
      \sstsubsection{
         SOURCE\_LAT = LITERAL (Read)
      }{
         The sky latitude of the expected source position, in the coordinate
         system specified by the parameter COORDS (eg if COORDS is EQUATORIAL
         then SOURCE\_LAT should be given the Declination of the position).
         See help on \texttt{"}Sky\_coordinates\texttt{"} for the formats allowed for this value.
         If a null, \texttt{'}!\texttt{'}, response is given, the search for the point source
         will be performed from the start to the end of all traces for all
         detectors in the CRDD file.
      }
      \sstsubsection{
         SOURCE\_LON = LITERAL (Read)
      }{
         The sky longitude of the expected source position, in the coordinate
         system specified by the parameter COORDS (eg if COORDS is EQUATORIAL
         then SOURCE\_LON should be given the Right Ascension of the position).
         See help on \texttt{"}Sky\_coordinates\texttt{"} for the formats allowed for this value.
         If a null, \texttt{'}!\texttt{'}, response is given, the search for the point source
         will be performed from the start to the end of all traces for all
         detectors in the CRDD file.
      }
      \sstsubsection{
         THRESH\_CORR = REAL (Read)
      }{
         The threshold of the correlation coeficient of the detected candidate
         with the point source profile for this band. Above this threshold
         a detected candidate would be accepted as a point source. See
         IRAS Explanatory Supplement C. 4. for details about the selection
         of the correlation coeficient threshold. [0.87]
      }
      \sstsubsection{
         THRESH\_FILTER = REAL (Read)
      }{
         The threshold of the signal to noise ratio above which a peak in the
         square-wave filter output will be taken as a candidate for a point
         source. See above for details of the square-wave filtering, and
         thresholding. [2.0]
      }
      \sstsubsection{
         THRESH\_SD = REAL (Read)
      }{
         The threshold used in rejcting samples in the iterative calculation
         of various noise values, samples which fall above this threshold times
         the standard deviation will be rejected in the next iteration. See
         details of the processing above for its use. [2.5]
      }
      \sstsubsection{
         THRESH\_S2N = REAL (Read)
      }{
         The threshold of the signal to local noise ration at which a candidate
         should be accepted as a point source. If this is entered as null this
         test is not performed and all candidates are reported. [2.5]
      }
      \sstsubsection{
         UNITS = LITERAL (Read)
      }{
         The units in which the data values are to be displayed. See
         help on \texttt{"}Data\_units\texttt{"} for a list of the available units.  [Jy]
      }
   }
}

\sstroutine{
   POSCRDD
}{
   Find CRDD samples which lie close to a given sky position
}{
   \sstdescription{
      This routine identifies CRDD files containing scans which pass
      close to a given sky position. The user supplies a group of CRDD
      files and the sky coordinates of the required position. A line of
      text is then displayed (and optionally logged to a text file) for
      each CRDD file containing the following items of information:

      1) The name of the CRDD file (minus directory specification).

      2) The Satellite Observation Plan (SOP) number.

      3) The observation number.

      4) The minimum cross scan distance (in arc-minutes) from the
      required position to the boresight track. Positive if the required
      position is on the sun-ward side of the boresight track.

      5) The in-scan distance between the required position and the
      reference position stored in the CRDD file, in arc-minutes. This
      is positive if the closest approach to the required position is
      reached later than the closest approach to the CRDD file
      reference position.

      6) The sample number at which the detector specified by item 7
      reaches its closest approach to the required position. This item
      is left blank if item 7 is blank.

      7) The number of the detector which is closest to the required
      position at its point of closest approach. If the position is
      beyond the edges of the focal plane (i.e. is seen by none of the
      detectors) then this item (together with item 6) is left blank.

      8) The position angle of the scan at the point of closest
      approach to the required position, in degrees. This is the angle
      from north to the focal plane Y axis, going positive through
      east.
   }
   \sstusage{
      POSCRDD IN LON LAT
   }
   \sstparameters{
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the coordinate system used for referring to sky
         positions. Valid values include ECLIPTIC, EQUATORIAL,
         GALACTIC. See section \ref{SEC:SKY} for more information
         on available sky coordinate systems.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         Specifies a group of input CRDD files. This should be in the
         form of a group expression (see section \ref{SEC:GRP}).
      }
      \sstsubsection{
         LAT = LITERAL (Read)
      }{
         The sky latitude of the required position, in the coordinate
         system specified by the parameter COORDS (eg if COORDS is
         EQUATORIAL then LAT should be given the Declination of the
         required position). See section \ref{SEC:SKY} for the
         formats allowed for this value. The suggested default is the
         reference position of the first CRDD file.
      }
      \sstsubsection{
         LOGFILE = LITERAL (Write)
      }{
         The name of a text file to receive a copy of the displayed
         information. The run time default is for no log file to be
         produced.                                                   [!]
      }
      \sstsubsection{
         LON = LITERAL (Read)
      }{
         The sky longitude of the required position, in the coordinate
         system specified by the parameter COORDS (eg if COORDS is
         EQUATORIAL then LON should be given the Right Ascension of the
         required position).See section \ref{SEC:SKY} for the
         formats allowed for this value. The suggested default is the
         reference position of the first CRDD file.
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}). Output to the log file is not
         effected by the setting of this parameter.
                                        [current message filter setting]
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         POSCRDD ZCMA$*$ \texttt{"}7 2 10\texttt{"} -12 LOGFILE=POS.LOG COORDS=EQ
      }{
         This example displays the distance of all CRDD files which
         start with the string \texttt{"}ZCMA\texttt{"} from the position RA=7h 2m 10s
         DEC=-12d 0m 0s. Any scans which actually pass through the
         position are indicated by the columns with titles \texttt{"}Sample\texttt{"} and
         \texttt{"}Det.\texttt{"} being non-blank. The output information is displayed on
         the screen and logged to the text file POS.LOG.
      }
   }
}

\sstroutine{
   PREPARE
}{
   Prepare a group of imported FITS images for use by IRAS90
}{
   \sstdescription{
      This routine prepares a group of FITS images previously converted
      to NDF format using KAPPA:FITSIN or KAPPA:FITSDIN (for instance)
      for use by IRAS90 and KAPPA. Each input NDF should contain a FITS
      extension containing the FITS header cards read from tape. These
      header cards are assumed to accurately represent the data. For
      this reason care should be exercised if any processing is
      performed on the images prior to using this application.

      The operations performed on the input NDFs depend on the type of
      image stored in the NDF and are described in detail below, but
      will always include the creation of an IRAS extension. The
      created IRAS extensions may be examined using IRAS90 application
      IRASTRACE. The FITS extension is retained without change in the
      output NDFs, even though some of the keywords may no longer
      accurately represent the data. For instance, BUNIT may no longer
      reflect the units in which the data is stored if a value is given
      for parameter UNITS.

      A facility exists for automatically identifying pairs of
      corresponding data and noise images which can be stored in the
      DATA and VARIANCE components of the same output NDF.
   }
   \sstusage{
      PREPARE IN OUT
   }
   \sstparameters{
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the sky coordinate system in which the field
         positions are to be stored in the output NDFs. See section
         \ref{SEC:SKY} for more information on available sky
         coordinate systems.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         FACTOR = REAL (Read)
      }{
         If the units of the input NDF are not one of the standard
         system of units recognised by IRAS90, then the user must use
         parameter FACTOR to supply the factor for converting input
         data values to the required output units (see also parameter
         UNITS).
      }
      \sstsubsection{
         FIELDLAT = LITERAL (Read)
      }{
         FIELDLAT may be used to specify the latitude (eg DEC, galactic
         latitude, etc, depending on the value of the parameter SCS) of
         a field reference position for each output NDF. This should be
         in the form of a group expression (see section \ref{SEC:GRP})
         containing an entry for each of the input NDFs
         specified by parameter IN.  If a null value is supplied for
         FIELDLAT (or for parameter FIELDLON), then the used values are
         derived from the FITS keyword CRVAL2.  See section \ref{SEC:SKY}
         for the formats allowed for these strings.
                                                                     [!]
      }
      \sstsubsection{
         FIELDLON = LITERAL (Read)
      }{
         FIELDLON may be used to specify the longitude (eg RA, galactic
         longitude, etc, depending on the value of the parameter SCS)
         of a field reference position for each output NDF. This should
         be in the form of a group expression (see section \ref{SEC:GRP})
          containing an entry for each of the input NDFs
         specified by parameter IN. If a null value is supplied for
         FIELDLON (or for parameter FIELDLAT), then the used values are
         derived from the FITS keyword CRVAL1.  See section \ref{SEC:SKY}
         for the formats allowed for these strings.
                                                                     [!]
      }
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output NDFs. See section \ref{SEC:HIS} for more
         information on history. The history information will contain
         the names of the input and output NDFs.
                                               [current history setting]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         Specifies a group of input NDFs. This should be in the
         form of a group expression (see section \ref{SEC:GRP}).
         The group may contain images of any type (including noise
         images), but every NDF should contain a FITS extension.
      }
      \sstsubsection{
         LABEL = LITERAL (Read)
      }{
         A group of strings to be used as the labels for the
         corresponding output NDFs. This should be in the form of a
         group expression (see section \ref{SEC:GRP}) containing
         an entry for each of the input NDFs specified by parameter IN.
         If a null value is supplied for this parameter then labels are
         generated automatically for each output NDF.                [!]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         A group of output NDFs corresponding one-for-one with the list
         of input NDFs given for parameter IN.  This should be in the
         form of a group expression (see section \ref{SEC:GRP}).
         Expressions such as \texttt{"}$*$\_NEW\texttt{"} are expanded by replacing the \texttt{"}$*$\texttt{"}
         character with each input NDF in turn. HISTORY and all
         extensions are propagated from the input to the output NDFs.
      }
      \sstsubsection{
         PROJTYPE = LITERAL (Read)
      }{
         If the input image is not of one of the types known to
         PREPARE, then the type of map projection used when the image
         was created should be given to parameter PROJTYPE, and will be
         stored as part of the astrometry information in the output
         NDF. The same projection type is assumed to apply for all
         input images of unknown type specified by parameter IN.  Valid
         projection types include GNOMONIC (i.e. tangent plane),
         ORTHOGRAPHIC, LAMBERT and AITOFF.  See section \ref{SEC:PROJ}
         for more information on available
         projections.                                         [GNOMONIC]
      }
      \sstsubsection{
         TITLE = LITERAL (Read)
      }{
         A group of strings to be used as the titles for the
         corresponding output NDFs. This should be in the form of a
         group expression (see section \ref{SEC:GRP}) containing
         an entry for each of the input NDFs specified by parameter IN.
         If a null value is supplied for this parameter then titles are
         generated automatically for each output NDF.                [!]
      }
      \sstsubsection{
         UNITS = LITERAL (Read)
      }{
         The units in which the data values in the output NDFs should
         be stored.  See section \ref{SEC:UNITS} for a list of the
         available units. If a null value is supplied then the output
         NDFs are produced with the same units as the input NDFs.
         Otherwise, the input data values are converted to the required
         system of units before being written to the output NDF.     [!]
      }
      \sstsubsection{
         VAROUT = LOGICAL (Read)
      }{
         If a true value is supplied for VAROUT, then any pairs of
         corresponding data and noise images supplied by parameter IN
         are combined into a single output NDF; the data image being
         stored in the DATA component and the square of the noise image
         being stored in the VARIANCE component.  Otherwise, input
         noise images are stored in the DATA component of an output
         NDF.                                                    [FALSE]
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         PREPARE M51 $*$\_PRE
      }{
         This example prepare the image contained in the NDF M51, and
         puts the result in the NDF M51\_PRE.
      }
      \sstexamplesubsection{
         PREPARE $*$ $*$\_PRE VAROUT
      }{
         This example prepare all NDFs in the current directory,
         putting the results in NDFs with same names but extended with
         the string \texttt{"}\_PRE\texttt{"}. If possible, any noise image found in the
         current directory are stored in the VARIANCE component of the
         associated data image.
      }
      \sstexamplesubsection{
         PREPARE \^{}OLD\_NAMES.LIS $*$\_PRE TITLE=\^{}TITLES.LIS LABEL=\^{}LABELS.LIS
      }{
         The NDFs listed in the file OLD\_NAMES.LIS are prepared and put
         into NDFs with the same names extended with the string \texttt{"}\_PRE\texttt{"}.
         The title and label to use for each NDF are read from the files
         TITLES.LIS and LABELS.LIS.
      }
   }
   \sstdiytopic{
      IRAS Sky Survey Atlas Images
   }{
      NDFs should be created from ISSA FITS files using one of the
      KAPPA applications FITSIN or FITSDIN, and PREPARE should then be
      run specifying these NDFs for parameter IN. ISSA images are
      identified automatically by looking at the value of the FITS
      keyword INSTRUME. If the input NDFs contain floating point values
      (either \_REAL or \_DOUBLE) then it is assumed that the data
      numbers stored in the FITS file have been converted into data
      values in the units specified by FITS keyword BUNIT. If the input
      NDFs have any other data type, then the conversion to data values
      is performed within PREPARE using the values of the FITS keywords
      BSCALE and BZERO.  In addition, an extra scaling is applied in
      order to produce values in the units specified by parameter UNITS
      (if these are different to the units specified by FITS keyword
      BUNIT).

      It is assumed that the input data array is a Gnomonic projection,
      and that the first axis is in the direction of decreasing RA and
      that the second axis is in the direction of increasing DEC. An
      IRAS extension is created in the output NDF holding astrometry
      information taken from the FITS keywords CRVAL1, CRVAL2, CRPIX1,
      CRPIX2, CDELT1 and CDELT2. The keywords CRVAL1 and CRVAL2 are
      assumed to be RA and DEC values (referred to the equinox at an
      epoch given by FITS keyword EPOCH).

      In addition, the waveband, ISSA field number and HCON number are
      stored in the IRAS extension, together with a string identifying
      the image as an ISSA image.
   }
   \sstdiytopic{
      Pointed Observation Images
   }{
      Pointed Observation images are processed in the same way as ISSA
      images, with the following exceptions:

      1) If the image is an INTENSITY data map, the background offset
      specified by the FITS keyword BIAS is added on to the output data
      values. No bias is added onto INTENSITY noise maps or FLUX grids.

      2) The images are assumed to be orthographic projections of the
      sky. The value of the keyword CROTA2 is assumed to be 360 degrees minus
      the position angle of the second image axis.

      3) The following information is stored in the IRAS extension;
      waveband, grid type (whether FLUX or INTENSITY), image type
      (whether noise or data), the SOP and observation numbers, the
      median noise (taken from the comments at the end of the FITS
      header).

      By default, any noise maps supplied by parameter IN are stored in
      separate output NDFs, independently of the associated data maps.
      However, if parameter VAROUT is given a true value, then an
      attempt is made to find any pairs of associated data and noise
      maps specified by parameter IN. If any such pairs are found then
      they are stored together in the same output NDF (the data map is
      stored in the DATA component and the square of the noise map is
      stored in the VARIANCE component). The user is told which input
      NDFs are being stored together if this happens. The values
      supplied for the noise map using parameters OUT, TITLE, LABEL,
      FIELDLON or FIELDLAT are discarded in this case (the values given
      for the data map are used in the output). In particular, note that
      the name of the output NDF is that associated with the input NDF
      holding the data map.
   }
   \sstdiytopic{
      SKYFLUX Images
   }{
      SKYFLUX images are processed in the same way as ISSA images,
      with the following exceptions:

      1) It is assumed that the second axis of the input data array is in the
      direction of decreasing DEC. The output data array is flipped in the
      second dimension to make the second axis increase in the direction of
      increasing DEC (i.e. so that north is upwards when the image is
      displayed normally).

      2) The following information is stored in the IRAS extension;
      waveband, HCON, plate number, maximum and minimum SOP numbers, and
      a flag indicating if this is an intensity or weight image.
   }
   \sstdiytopic{
      Galactic Plane Images
   }{
      Galactic plane images are processed in the same way as ISSA
      images, with the following exceptions:

      1) The images are assumed to be Lambert equivalent cylindrical
      projections of the sky, the first axis is assumed to be in the
      direction of decreasing galactic longitude and the the second
      axis in the direction of increasing galactic latitude. The image
      is not flipped along either axis. The FITS keywords CRVAL1 and
      CRVAL2 are assumed to give galactic longitude and latitude
      values.

      2) The following information is stored in the IRAS extension;
      waveband, HCON and Galactic plane map number.
   }
   \sstdiytopic{
      All Sky Images
   }{
      All sky images are processed in the same way as ISSA images, with
      the following exceptions:

      1) The images are assumed to be Aitoff projections of the sky,
      the first axis is assumed to be in the direction of decreasing
      galactic longitude and the the second axis in the direction of
      increasing galactic latitude. The image is not flipped along
      either axis. The FITS keywords CRVAL1 and CRVAL2 are assumed to
      give galactic longitude and latitude values.

      2) The following information is stored in the IRAS extension;
      waveband, HCON, maximum and minimum SOP numbers, and a flag
      indicating if this image is centred on the galactic centre or
      anti-centre.
   }
   \sstdiytopic{
      YORIC/HIRES Images
   }{
      Images produced by the YORIC processor at IPAC (also known as
      HIRES images), are identified automatically by looking at the
      value of the FITS keyword VERSION, which gives the version number
      of the YORIC processor which created the image. Different types
      of YORIC images are produced at IPAC. Some hold the surface
      brightness of a region of the sky, others hold resolution
      estimates, photometric noise estimates, correction factor
      variances, and the data coverage at each pixel. These types are
      identified automatically by looking at the comments at the end of
      the FITS header. The processing of these images is the same as for
      ISSA images, with the following exceptions:

      1) The images are assumed to be orthographic projections of the
      sky. The  value of the keyword CROTA2 is assumed to be 360 degrees
      minus the position angle of the second image axis.

      2) The following information is stored in the IRAS extension;
      waveband, and a string identifying the type of YORIC image.

      YORIC surface brightness maps and associated photometric noise
      maps can be stored together in the same output NDF in the same
      way as for PO images (see \texttt{"}Preparing Pointed Observation
      Images\texttt{"}).
   }
   \sstdiytopic{
      CPC Images
   }{
      A CPC FITS file consists of two images (the 50 and 100 um images)
      stacked together to form a three dimensional array. PREPARE
      splits this stack into two separate images, thus creating two
      output NDFs from one input NDF. It is important to note that only
      one output NDF name should be supplied for each input CPC file by
      the user (using parameter OUT). The names of the two output NDFs
      are derived automatically from the single supplied name by
      appending the strings \_50 (for the 50 um image) and \_100 (for the
      100 um image) to the end of the NDF name.  Likewise, any values
      given for parameters TITLE or LABEL are extended by appending one
      of the strings \texttt{"}(50 um)\texttt{"} or \texttt{"}(100 um)\texttt{"} to the end of the supplied
      value. Each individual CPC image is processed like an ISSA image
      with the following exceptions:

      1) The images are assumed to be orthographic projections of the
      sky. The value of the keyword CROTA2 is assumed to be 360 degrees
      minus the position angle of the second image axis.

      2) The following information is stored in the IRAS extension;
      waveband, and a flag indicating if it is a raw or cleaned CPC
      image.
   }
   \sstdiytopic{
      Other Images
   }{
      If any input images are supplied which cannot be identified as one
      of the types listed above, then certain assumptions need to be
      made about the interpretation of the image and the FITS keyword
      values. These assumptions may not be appropriate, so users should
      be aware of them and take corrective measures if possible (for
      instance by suitable modifying the FITS image to make it conform
      to the assumptions before running PREPARE). The assumptions made
      are:

      1) If the image is displayed normally, then rotation from north to
      east is anti-clockwise.

      2) The projection used to create the image is that given by
      parameter PROJTYPE.

      3) The data comes from the survey array of detectors.

      4) If non-zero, FITS keyword CROTA1 gives the position angle of
      the second image axis (i.e the angle from north, through east, to
      the second image axis). If CROTA1 is zero, then CROTA2 is used
      instead.

      5) The FITS keywords CRVAL1 and CRVAL2 give the coordinates of a
      reference point, in the sky coordinate system given by parameter
      SCS.

      The only extra information stored in the IRAS extension is the
      waveband, and a flag that the image is from an unknown source.

      If the units of the input image are unusual then the user will be
      asked for the factor for converting input data values into the
      units specified by parameter UNITS. The parameter FACTOR is used
      for this purpose.
   }
}
\sstroutine{
   PSCONT
}{
   Produce a contour map with sky coordinate grid for output on a POSTSCRIPT
printer
}{
   \sstdescription{
     This procedure uses the KAPPA application TURBOCONT to generate
     an encapsulated postscript file containing the contour plot.
     IRAS90 application SKYGRID is then used to produce another
     encapsulated postscript file containing the sky coordinates grid.
     These two files are then merged into one using the PSMERGE
     utility. The resulting file (called PSCONT.PS) can be printed as
     normal on a Postscript printer.
   }
   \sstusage{
      PSCONT NDF MODE NCONT
   }
   \sstparameters{
      \sstsubsection{
         NDF = NDF (Read)
      }{
         The NDF structure containing the image to be contoured.
      }
      \sstsubsection{
         MODE = LITERAL (Read)
      }{
         The method by which the contour levels are to be selected. See
         KAPPA:TURBOCONT parameter MODE.
      }
      \sstsubsection{
         NCONT = INTEGER (Read)
      }{
         The number of contours required. See KAPPA:TURBOCONT parameter NCONT.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
          PSCONT is a command procedure, or script.

         \sstitem
          This procedure provides limited facilities for customising the
          plot using the other parameter of TURBOCONT and SKYGRID. To do
          this the first argument (\texttt{"}NDF\texttt{"}) should be given the value PROMPT
          (any values supplied for MODE and NCONT are ignored). This causes
          the keyword PROMPT to be supplied to SKYGRID and TURBOCONT, thus
          causing the user to be prompted for all parameters used by these
          two applications (including the NDF parameter). If other
          facilities are required, then the applications TURBOCONT,
          SKYGRID and PSMERGE must be run individually rather than from
          within this command procedure.
      }
   }
}

\sstroutine{
   QUALTOBAD
}{
   Set selected NDF pixels bad on the basis of quality
}{
   \sstdescription{
      This routine copies a group of input NDFs to a group of
      corresponding output NDFs, setting selected pixels bad in the
      process. Such pixels are selected on the basis of quality; any
      pixel which holds a set of qualities which satisfies the quality
      expression given for parameter QEXP is set bad in the DATA and
      (if it is defined) VARIANCE components of the output NDF.  See
      section \ref{SEC:QUAL} for further information about the use
      of quality within IRAS90.
   }
   \sstusage{
      QUALTOBAD IN OUT QEXP
   }
   \sstparameters{
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output NDF. See section \ref{SEC:HIS} for more
         information on history.               [current history setting]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         A group of input NDFs. This should be in the form of a group
         expression (see section \ref{SEC:GRP}). If an input NDF
         does not contain definitions of all the quality names
         referenced within the quality expression given for parameter
         QEXP, then no corresponding output NDF is created, but
         processing continues with the other input NDFs.
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         A group of output NDFs corresponding one-for-one with the list
         of input NDFs given for parameter IN.  This should be in the
         form of a group expression (see section \ref{SEC:GRP}).
         Expressions such as \texttt{"}$*$\_NEW\texttt{"} are expanded by replacing the \texttt{"}$*$\texttt{"}
         character with each input NDF in turn.
      }
      \sstsubsection{
         QEXP = LITERAL (Read)
      }{
         The quality expression.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         QUALTOBAD M51$*$ $*$\_CLEAN SATURATED.OR.GLITCH
      }{
         This example copies all NDFs starting with the string \texttt{"}M51\texttt{"} to
         a set of corresponding output NDFs. The name of each output
         NDF is formed by extending the name of the input NDF with the
         string \texttt{"}\_CLEAN\texttt{"}. Any pixels which hold either of the qualities
         \texttt{"}SATURATED\texttt{"} or \texttt{"}GLITCH\texttt{"} are set to the bad value in the output
         NDFs.
      }
   }
}

\sstroutine{
   REMQUAL
}{
   Remove specified quality definitions from a group of NDFs
}{
   \sstdescription{
      This routine removes selected quality name definitions from each
      NDF specified by parameter NDF.  All quality names information may
      be removed by specifying a quality name of \texttt{"}ANY\texttt{"}.  For more
      information about using quality within the IRAS90 package see
      the section \ref{SEC:QUAL}.
   }
   \sstusage{
      REMQUAL NDF QNAMES
   }
   \sstparameters{
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be added to the NDFs.
         See section \ref{SEC:HIS} for more information on
         history.                              [current history setting]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}.
                                        [current message filter setting]
      }
      \sstsubsection{
         NDF = NDF (Update)
      }{
         A group of NDFs from which quality information is to be
         removed. This should be in the form of a group expression (see
         section \ref{SEC:GRP}).
      }
      \sstsubsection{
         QNAMES = LITERAL (Read)
      }{
         A list of up to 10 quality names to be removed from the input
         NDFs. This should be in the form of a group expression (see
         section \ref{SEC:GRP}). If more than 10 names are
         supplied, only the first 10 are used. If any of the supplied
         quality names are not defined in the NDF, then warning
         messages are given but the application continues to remove any
         other specified quality names. If the string ANY is specified,
         then all defined quality names are removed. If no defined
         quality names remain, the structure used to store quality name
         information is deleted. This feature can be used to get rid of
         corrupted quality name information.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         REMQUAL M51$*$ ANY
      }{
         This example will remove all defined quality names from all
         NDFs with names starting with the string \texttt{"}M51\texttt{"}.
      }
   }
}

\sstroutine{
   SETIMAGE
}{
   Set selected global properties for an IRAS90 image
}{
   \sstdescription{
      This routine can be used to change the waveband, units and/or
      image type of a group of existing IRAS90 images. The new values
      are copied from other specified IRAS90 images.
   }
   \sstusage{
      SETIMAGE NDF LIKE LIST
   }
   \sstparameters{
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         modified NDFs. See help on \texttt{"}History\_in\_IRAS90\texttt{"} for more
         information on history.
                                               [current history setting]
      }
      \sstsubsection{
         LIKE = NDF (Read)
      }{
         A group of IRAS90 images from which the new values are to be
         read. The values from these NDFs are stored in the
         corresponding NDF specified by parameter NDF.
      }
      \sstsubsection{
         LIST = LITERAL (Read)
      }{
         A group expression giving a list of the items of information
         which are to be modified in the image specified by parameter
         NDF. The following items can be specified; UNITS, BAND, TYPE.
                                                    [UNITS,BAND,TYPE]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         help on \texttt{"}Message\_filtering\texttt{"}).
                                        [current message filter setting]
      }
      \sstsubsection{
         NDF = NDF (Read and Write)
      }{
         A group of IRAS90 image in which new values are to be stored.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         SETIMAGE M51\_B3 M51\_B4\_SIM UNITS,BAND
      }{
         This example causes the waveband and units of image M51\_B3 to
         be set equal to those of image M51\_B4\_SIM.
      }
   }
}

\sstroutine{
   SETQUAL
}{
   Assign a specified quality to selected pixels within a group of
   NDFs
}{
   \sstdescription{
      This routine assigns (or optionally removes) the quality
      specified by parameter QNAME to (or from) selected pixels in each
      NDF specified by parameter NDF. For more information about using
      quality within the IRAS90 package see the help on
      \texttt{"}Quality\_in\_IRAS90\texttt{"}.

      The user can select the pixels to be operated on in one of three
      ways (see parameter SELECT):

      1) By giving a group of `mask\texttt{'} NDFs (one for each input NDF).
      Pixels with bad values in the mask NDFs will be selected from the
      corresponding input NDFs.

      2) By giving a list of pixel indices for the pixels which are to
      be selected (a single list is provided which is used for all input
      NDFs).

      3) By giving an ``ARD description\texttt{'}\texttt{'} for the regions of the NDFs
      which are to be selected. The ARD system (see \xref{SUN/183}{sun183}{}) uses a
      textual language to describe geometric regions of an array. Text
      files containing ARD description suitable for use with this
      routine can be created interactively using the KAPPA routine
      ARDGEN. This facility is only available on Unix machines.

      The operation to be performed on the pixels is specified by
      parameter FUNCTION. The given quality may be assigned to or
      removed from pixels within the NDFs. The pixels operated on
      can either be those selected by the user (as described above),
      or those not selected.  The quality of all other pixels is left
      unchanged (unless the parameter FUNCTION is given the value NS$+$HU
      or NU$+$HS). Thus for instance if pixel (1,1) already held the
      quality specified by QNAME, and the quality was then assigned to
      pixel (2,2) this would not cause the quality to be removed from
      pixel (1,1).

      All the input NDFs are presumed to be aligned with each other, but
      can be of different extent (but they must all have the same number
      of dimensions).
   }
   \sstusage{
      SETQUAL NDF QNAME COMMENT MASK
   }
   \sstparameters{
      \sstsubsection{
         ARD = LITERAL (Read)
      }{
         An ARD description for the `selected\texttt{'} regions of the input
         NDFs.  This should be supplied in the form of a group
         expression (see help on \texttt{"}Group Expressions\texttt{"}). See \xref{SUN/183}{sun183}{} or
         KAPPA:ARDGEN for further details of the syntax of an ARD
         description.  This routine expects positions within the ARD
         description to be given in terms of pixel co-ordinates. The
         same ARD description is used for all input NDFs.  The ARD
         parameter is only prompted for if the SELECT parameter is
         given the value \texttt{"}ARD\texttt{"}.
      }
      \sstsubsection{
         COMMENT = LITERAL (Read)
      }{
         A comment to store with the quality name.  This parameter is
         only prompted for if an NDF does not already contain a
         definition of the quality name.  The same comment is used for
         any other subsequent NDFs which do not contain a definition of
         the quality name.
      }
      \sstsubsection{
         FUNCTION = LITERAL (Read)
      }{
         This parameter specifies what function is to be performed on
         the \texttt{"}selected\texttt{"} pixels specified using parameters MASK, LIST or
         ARD. It can take any of the values \texttt{"}HS\texttt{"}, \texttt{"}HU\texttt{"}, \texttt{"}NS\texttt{"}, \texttt{"}NU\texttt{"},
         \texttt{"}HS$+$NU\texttt{"} or \texttt{"}HU$+$NS\texttt{"}

         HS - Ensure that the quality specified by QNAME is held by
              all the selected pixels. The quality of all other
              pixels is left un-changed.

         HU - Ensure that the quality specified by QNAME is held by all
              the pixels which have not been selected. The quality of
              the selected pixels is left un-changed.

         NS - Ensure that the quality specified by QNAME is not held by
              any of the selected pixels. The quality of all other
              pixels is left un-changed.

         NU - Ensure that the quality specified by QNAME is not held by
              any of the pixels which have not been selected. The
              quality of the selected pixels is left un-changed.

         HS$+$NU - Ensure that the quality specified by QNAME is held by
              all the selected pixels and not held by any of the other
              pixels.

         HU$+$NS - Ensure that the quality specified by QNAME is held by
              all the pixels which have not been selected and not held
              by any of the selected pixels.
                                                                    [HS]
      }
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be added to the NDFs.
         See help on \texttt{"}History\_in\_IRAS90\texttt{"} for more information on
         history.                              [current history setting]
      }
      \sstsubsection{
         LIST = LITERAL (Read)
      }{
         A list of the pixels within the input NDFs which are to be
         `selected\texttt{'} (see parameter FUNCTION). This should be in the
         form of a group expression (see help on \texttt{"}Group\_expressions\texttt{"})
         giving a list of pixel indices (eg X1, Y1, X2, Y2,...  for a
         two dimensional NDF). The same list is used for all input
         NDFs.  LIST is only prompted for if parameter SELECT is given
         the value LIST.
      }
      \sstsubsection{
         MASK = NDF (Read)
      }{
         A group of mask NDFs. Each mask is used to define the
         `selected\texttt{'} pixels within the corresponding input NDF (see
         parameter FUNCTION). The masks should be aligned
         pixel-for-pixel with the input NDFs.  Pixels which are bad in
         the mask NDFs are `selected\texttt{'}. The quality of any pixels which
         lie outside the bounds of the corresponding mask NDF is left
         unaltered.  This parameter is only prompted for if the
         parameter SELECT is given the value MASK.
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         help on \texttt{"}Message\_filtering\texttt{"}).
                                        [current message filter setting]
      }
      \sstsubsection{
         NDF = NDF (Update)
      }{
         A group of NDFs in which the quality information is to be
         stored. This should be in the form of a group expression (see
         help on \texttt{"}Group\_expresssions\texttt{"}).
      }
      \sstsubsection{
         QNAME = LITERAL (Read)
      }{
         The quality name. If the supplied name is not already defined
         within any of the input NDFs, then a definition of the name is
         added to the NDF. The user is warned if the quality name is
         already defined within any of the NDFs.
      }
      \sstsubsection{
         SELECT = LITERAL (Read)
      }{
         This parameter determines how the pixels are selected, and can
         take the values MASK, LIST or ARD (see parameters MASK, LIST
         and ARD).
                                                                  [MASK]
      }
      \sstsubsection{
         XNAME = LITERAL (Read)
      }{
         If an NDF already contains any quality name definitions then
         new quality names are put in the same extension as the old
         names.  If no previous quality names have been stored in the
         NDF then parameter XNAME will be used to obtain the name of an
         NDF extension in which to store the new quality name.  The
         extension will be created if it does not already exist (see
         parameter XTYPE). The same extension is used for all input
         NDFs.                                           [QUALITY\_NAMES]
      }
      \sstsubsection{
         XTYPE = LITERAL (Read)
      }{
         If a new NDF extension is created to hold quality names (see
         parameter XNAME), then parameter XTYPE is used to obtain the
         HDS data type for the created extension. The run time default
         is to give the extension a type identical to its name.       []
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         SETQUAL M51 SATURATED \texttt{"}Saturated pixels\texttt{"} M51\_CUT
      }{
         This example ensures that the quality \texttt{"}SATURATED\texttt{"} is defined
         within the NDF \texttt{"}M51\texttt{"}. The comment \texttt{"}Saturated pixels\texttt{"} is stored
         with the quality name if it did not already exist in the NDF.
         The quality SATURATED is then assigned to all pixels for which
         the corresponding pixel in NDF M51\_CUT is bad. The quality of
         all other pixels is left unchanged.
      }
      \sstexamplesubsection{
         SETQUAL \texttt{"}M51,CENA\texttt{"} SOURCE\_A SELECT=LIST LIST=$\wedge$SOURCE\_A.LIS FUNCTION=HS$+$NU
      }{
         This example ensures that pixels within the two NDFs M51 and
         CENA which are included in the list of pixel indices held in
         text file SOURCE\_A.LIS, have the quality \texttt{"}SOURCE\_A\texttt{"}, and also
         ensures that none of the pixels which were not included in
         SOURCE\_A.LIS have the quality.
      }
      \sstexamplesubsection{
         SETQUAL M51 SOURCE\_B SELECT=ARD ARD=\texttt{"}CIR(80,80,9).AND.CIR(70,70,7)\texttt{"}
      }{
         This example ensures that all pixels within the region of
         intersection of two circles have the quality \texttt{"}SOURCE\_B\texttt{"}. The
         first circle is centred on pixel co-ordinates (80,80) and has
         a radius of 9 pixels. The second circle is centred at (70,70)
         and has a radius of 7 pixels.
      }
      \sstexamplesubsection{
         SETQUAL M51 SOURCE\_B SELECT=ARD ARD=$\wedge$BACKGROUND.ARD
      }{
         This example assigns the quality \texttt{"}SOURCE\_B\texttt{"} to pixels of the
         NDF \texttt{"}M51\texttt{"} as described by an ARD description stored in the text
         file \texttt{"}BACKGROUND.ARD\texttt{"}. This text file could for instance have
         been created using KAPPA routine ARDGEN.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         All the quality names which are currently defined within an
         NDF can be listed by application SHOWQUAL.  Quality name
         definitions can be removed from an NDF using application REMQUAL.
         If there is no room for any more quality names to be added to the
         NDF then REMQUAL can be used to remove a quality name in order to
         make room for the new quality names.

         \sstitem
         Only the QUALITY and (optionally) HISTORY components, and the
         extension specified by parameter XNAME are altered by this
         application. All other NDF components remain unaltered.
      }
   }
}

\sstroutine{
   SHOWQUAL
}{
   Display the quality names defined in a group of NDFs
}{
   \sstdescription{
      This routine displays a list of all the quality names currently
      defined within each NDF specified by parameter IN. The
      descriptive comments which were stored with the quality names
      when they were originally defined are also displayed. An option
      exists for also displaying the number of pixels which hold each
      quality. For more information about using quality within the
      IRAS90 package see section \ref{SEC:QUAL}.
   }
   \sstusage{
      SHOWQUAL IN [COUNT]
   }
   \sstparameters{
      \sstsubsection{
         COUNT = \_LOGICAL (Read)
      }{
         If true, then the number of pixels in each NDF which holds
         each defined quality is displayed. These figures are shown
         in parentheses between the quality name and associated
         comment.  This option adds significantly to the run time.  [NO]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         A group of NDFs in which the quality information is to be
         stored. This should be in the form of a group expression (see
         section \ref{SEC:GRP}).
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         SHOWQUAL \texttt{"}M51,CENA\texttt{"} YES
      }{
         This example displays all the quality names currently defined
         for the two NDFs M51 and CENA, together with the number of
         pixels holding each quality.
      }
   }
}

\sstroutine{
   SIMCRDD
}{
   Produce simulated CRDD based on a supplied image of the sky
}{
   \sstdescription{
      This routine generates a group of artificial CRDD files
      containing simulated data derived by convolving the IRAS detector
      point spread functions with a supplied sky image. A group of
      input CRDD files are used to define the scan geometry required
      for the simulated scans. Note, no noise or positional errors are
      included in the simulated CRDD files. No VARIANCE or QUALITY
      components are included in the output CRDD files.
   }
   \sstusage{
      SIMCRDD IN SKY OUT
   }
   \sstparameters{
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output CRDD files. See help on \texttt{"}History\_in\_IRAS90\texttt{"} for more
         information on history. The history information will contain
         the names of the input CRDD files, trial sky image, and
         detector Point Spread Functions.      [current history setting]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         Specifies a group of input CRDD files. This should be in the
         form of a group expression (see help on \texttt{"}Group\_expressions\texttt{"}).
         The input CRDD files can be in any of the standard IRAS90
         systems of units.
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         help on \texttt{"}Message\_filtering\texttt{"}).
                                        [current message filter setting]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         A group of output CRDD files corresponding one-for-one with
         the list of input CRDD files given for parameter IN.  This
         should be in the form of a group expression (see help on
         \texttt{"}Group\_expressons\texttt{"}). Expressions such as \texttt{"}$*$\_SIM\texttt{"} are expanded
         by replacing the \texttt{"}$*$\texttt{"} character with each input CRDD file in
         turn. The output CRDD files are in the same units as the input
         CRDD files.
      }
      \sstsubsection{
         PSF = LITERAL (Read)
      }{
         A string which is used to specify the NDFs holding the
         detector point spread functions. NDF names are formed by
         appending the detector number. For instance, the PSF for
         detector \#12 is assumed to reside in an NDF with name $<$PSF$>$12
         (where $<$PSF$>$ is replaced by the value supplied for parameter
         PSF). The default value causes the standard PSFs supplied as
         part of the IRAS90 package to be used. See the help on
         \texttt{"}Point\_Spread\_Functions\texttt{"} for more information on the origin and
         format of these files.                                       []
      }
      \sstsubsection{
         SKY = NDF (Read)
      }{
         The IRAS90 image to use as the trial sky. This can be in any
         of the standard IRAS90 system of units.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         SIMCRDD ZCMA\_$*$\_DS NEWSKY $*$\_SIM
      }{
         This causes an artificial CRDD file to be created for each
         file in the current directory which satisfies the wild-card
         template ZCMA\_$*$\_DS. Each created CRDD file has the same name
         as the input except that the string \texttt{"}\_SIM\texttt{"} is appended to the
         end. The input CRDD files determine the sky position and
         detector number to use for each simulated CRDD value. The CRDD
         values are formed by convolving the standard detector PSFs with
         the image contained in NDF NEWSKY. Each pair of input and
         output CRDD files can be directly compared, value for value.
      }
      \sstexamplesubsection{
         SIMCRDD M51\_B1S1 MODEL MODEL\_CRDD PSF=MYPSF
      }{
         The CRDD file M51\_B1S1 is simulated, using the trial sky image
         MODEL, and the results are stored in MODEL\_CRDD. The point
         spread functions used to generate the simulated data are
         contained in NDFs MYPSF1, MYPSF2, (etc) to MYPSF62. If any of
         these NDFs do not exist, then the application continues but
         bad values are stored for the corresponding detectors in the
         output CRDD files.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         The waveband index of the data contained in the trial sky
         image is recorded in the IRAS extension of each output CRDD file,
         within an integer component called SKYBAND.
      }
   }
}
\sstroutine{
   SKYALIGN
}{
   Re-map a group of images so that they are aligned
}{
   \sstdescription{
      This routine re-projects a group of images so that they are
      aligned pixel-for-pixel with another specified reference image.
      Alternatively, instead of giving a reference image, the user can
      supply the parameters which explicitly describe the projection
      required for the output images (see parameter REF).

      Two methods exist for determining the bounds of the output
      images.  Firstly, the user can give values for parameters XY1
      and XY2 which are then used as the bounds for all output images.
      Secondly, if a null value is given for XY1 or XY2 , default
      values are generated separately for each output image so that the
      output image just encloses the entire area covered by the
      corresponding input image. Using the first method will ensure
      that all output images have the same pixel origin, and so the
      resulting images can be directly compared. However, this may
      result in the output images being larger than necessary. In
      general, the second method results in smaller images being
      produced, in less time. However, the output images will have
      differing pixel origins which need to be taken into account when
      comparing the aligned images.

      The output image values are formed by re-sampling the input image
      values using either nearest neighbour or bi-linear interpolation
      (see parameter METHOD). If the former method is used, then any
      QUALITY and VARIANCE values which are present in the input NDFs
      are copied to the corresponding positions in the output NDFs. If
      bi-linear interpolation is used, then the output NDFs contain no
      QUALITY or VARIANCE values.
   }
   \sstusage{
      SKYALIGN IN REF XY1 XY2 OUT
   }
   \sstparameters{
      \sstsubsection{
         ACC = REAL (Read)
      }{
         The positional accuracy required, as a a number of pixels. For
         highly non-linear projections, a recursive algorithm is used in
         which successively smaller regions of the projection are fitted
         with a least squares linear transformation. If such a
         transformation results in a maximum positional error greater
         than the value supplied for ACC (in pixels), then a smaller
         region is used. High accuracy is paid for by larger run times.
                                                                   [0.5]
      }
      \sstsubsection{
         CENTRE\_LAT = LITERAL (Read)
      }{
         The sky latitude of the projection centre for the output
         images, in the coordinate system specified by the parameter
         COORDS (eg if COORDS is EQUATORIAL then CENTRE\_LAT should be
         given the Declination of the image centre). See
section \ref{SEC:SKY} for the formats allowed for this value. This
         parameter is only used if the parameter REF is given a null
         value.
      }
      \sstsubsection{
         CENTRE\_LON = LITERAL (Read)
      }{
         The sky longitude of the projection centre for the output
         images, in the coordinate system specified by the parameter
         COORDS (eg if COORDS is EQUATORIAL then CENTRE\_LON should be
         given the Right Ascension of the image centre).See
section \ref{SEC:SKY} for the formats allowed for this value. This
         parameter is only used if the parameter REF is given a null
         value.
      }
      \sstsubsection{
         CENTRE\_XY = \_REAL (Read)
      }{
         A pair of (X,Y) pixel coordinates giving the projection centre
         for the output images. The default values will put the
         projection centre at the origin of the pixel coordinate
         system. This parameter is only used if the parameter REF is
         given a null value.                                   [0.0,0.0]
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the coordinate system used for referring to sky
         positions. Valid values include ECLIPTIC, EQUATORIAL,
         GALACTIC. See section \ref{SEC:SKY} for more information
         on available sky coordinate systems. This parameter is only
         used if the parameter REF is given a null value.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         EPOCH = DOUBLE PRECISION (Read)
      }{
         The Julian epoch at which the input images were obtained. The
         same value is used for all the input images.  This parameter
         is only accessed if the parameter REF is given a null value.
         A value of 1983.5 is acceptable for all IRAS data.
      }
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be stored within the
         output NDFs. See section \ref{SEC:HIS} for more
         information on history.               [current history setting]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         A group of input NDFs, each containing an image with
         associated astrometry information. This should be in the form
         of a group expression (see section \ref{SEC:GRP}).
      }
      \sstsubsection{
         METHOD = LITERAL (Read)
      }{
         The method to use when sampling the input pixel values, in
         order to find the corresponding output pixel value. It can
         take the following values:

         o  BILINEAR - This causes the output pixel values to be
         calculated by bilinear interpolation among the four nearest
         pixels values in the input image, resulting in smoother output
         images. If this method is selected then there is no one-to-one
         correspondence between input and output pixels and so no
         QUALITY or VARIANCE components will be propagated from the
         input to the output NDFs.

         o  NEAREST - This causes the output pixel values to be
         assigned the value of the single nearest input pixels If this
         method is selected then QUALITY or VARIANCE components are
         propagated from the input to the output NDFs. This method is
         faster than BILINEAR.                                 [NEAREST]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
      \sstsubsection{
         PIXSIZE = \_REAL (Read)
      }{
         The dimensions of a pixel at the centre of the output
         projection, in arc-minutes.  If a single value is given for
         PIXSIZE, then the output pixels are square. If two values are
         given then the output pixels are rectangular, having the
         specified dimensions. It should be remembered that the actual
         pixel size may vary slightly across the output projection
         depending on the type of projection. The values specified by
         parameter PIXSIZE give the actual pixel dimensions at the
         projection centre. This parameter is only used if the
         parameter REF is given a null value.
      }
      \sstsubsection{
         PROJTYPE = LITERAL (Read)
      }{
         Specifies the type of projection to use when creating the
         output images. Valid values include GNOMONIC (i.e. tangent
         plane), ORTHOGRAPHIC, LAMBERT and AITOFF.  See
section \ref{SEC:PROJ} for more information on available
         projections. This parameter is only used if the parameter REF
         is given a null value.
      }
      \sstsubsection{
         REF = NDF (Read)
      }{
         An NDF containing an image to which all the images specified
         by parameter IN are to be aligned. If a null value is supplied
         for this parameter, then the values supplied for parameters
         PROJTYPE, CENTRE\_LON, CENTRE\_LAT, CENTRE\_XY, PIXSIZE and
         COORDS are used to define the pixel grid to which output
         images are aligned.                                         [!]
      }
      \sstsubsection{
         ORIENT = \_REAL (Read)
      }{
         The position angle of the second axis (or \texttt{"}Y\texttt{"} axis) of the
         output image grid, in degrees.  That is, the angle from north
         (defined by the coordinate system specified by parameter
         COORDS) to the image \texttt{"}Y\texttt{"} axis (\texttt{"}upwards\texttt{"} if the image is
         displayed normally).  Positive angles are measured in the same
         sense as rotation from north through east.  The default value
         of zero puts north \texttt{"}upwards\texttt{"}. This parameter is only used if
         the parameter REF is given a null value.                  [0.0]
      }
      \sstsubsection{
         OUT = NDF (Write)
      }{
         A group of output NDFs corresponding one-for-one with the list
         of input NDFs given for parameter IN.  This should be in the
         form of a group expression (see section \ref{SEC:GRP}).
         Expressions such as \texttt{"}$*$\_AL\texttt{"} are expanded by replacing the \texttt{"}$*$\texttt{"}
         character with each input NDF name in turn.
      }
      \sstsubsection{
         XY1 = INTEGER (Read)
      }{
         A pair of values giving the pixel indices of the lower left
         corner of the output images. The same values are used for all
         output images.  NDFs.  If a null value is given then separate
         default values are calculated for each output NDF.
      }
      \sstsubsection{
         XY2 = INTEGER (Read)
      }{
         A pair of values giving the pixel indices of the upper right
         corner of the output images. The same values are used for all
         output images.  NDFs.  If a null value is given then separate
         default values are calculated for each output NDF.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         SKYALIGN IMAGE1 IMAGE2 [-100,-10] [200,100] $*$\_AL
      }{
         This example re-samples the image contained in IMAGE1 so that
         it is aligned with the image contained in IMAGE2, putting the
         output in IMAGE1\_AL. The output image covers pixel coordinates
         between -100 and 200 in X, and -10 and 100 in Y.
      }
   }
}

\sstroutine{
   SKYBOX
}{
   Define a rectangular region of sky
}{
   \sstdescription{
      This routine defines a rectangular region of an image, using
      either a cursor or the parameter interface to define the region,
      and reports the pixel coordinates and sky coordinates of the
      corners of the region, together with the extent of the region in
      arc-minutes and in pixels. The edges of the rectangular region are
      parallel to the image X and Y axes.  The outline of the region
      may optionally be drawn on a specified graphics device, and a
      picture corresponding to the region may be added to the graphics
      database.

      By default, the region is specified by giving the positions of two
      opposite corners. However, if parameter BOXSIZE is given a value
      (on the command line for instance) then the region is specified by
      giving the position of the centre, together with the size of the
      region is the X and Y directions.
   }
   \sstusage{
      SKYBOX DEVICE IN
   }
   \sstparameters{
      \sstsubsection{
         BOXSIZE = REAL (Read)
      }{
         A pair of values specifying the sizes of the rectangular region
         parallel to the X and Y image axes. If a single value is
         supplied, the same value is used for both axes. If a null
         value is supplied, then the corners of the region are used to
         specify the box. If parameter COSYS has the value SKY, then
         BOXSIZE should be supplied in units of arc-minutes. Otherwise,
         it should be supplied in units of pixels.                   [!]
      }
      \sstsubsection{
         CENTRE\_LAT = LITERAL (Read)
      }{
         The latitude of the box centre, in the coordinate system
         specified by COORDS (eg if COORDS was EQUATORIAL, CENTRE\_LAT
         should be given a Declination value). CENTRE\_LAT is only used
         if parameter CURSOR has a false value, if a value is supplied
         for parameter BOXSIZE, and if parameter COSYS is given the
         value SKY.  See the section \ref{SEC:SKY} for details of
         the formats allowed for this value.
      }
      \sstsubsection{
         CENTRE\_LON = LITERAL (Read)
      }{
         The longitude of the box centre, in the coordinate system
         specified by COORDS (eg if COORDS was EQUATORIAL, CENTRE\_LON
         should be given a Right Ascension value). CENTRE\_LON is only
         used if parameter CURSOR has a false value, if a value is
         supplied for parameter BOXSIZE, and if parameter COSYS is
         given the value SKY. See the section \ref{SEC:SKY} for
         details of the formats allowed for this value.
      }
      \sstsubsection{
         CENTRE\_XY = REAL (Read)
      }{
         The image coordinates (X and Y) of the box centre. CENTRE\_XY
         is only used if parameter CURSOR has a false value, if a value
         is supplied for parameter BOXSIZE, and if parameter COSYS has
         one of the values WORLD, IMAGE or PIXEL.
      }
      \sstsubsection{
         CLEAR = LOGICAL (Read)
      }{
         True if the area of the graphics device over which the box is
         to be drawn should be cleared before drawing it.           [NO]
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the sky coordinate system to use.  Valid values
         include ECLIPTIC, EQUATORIAL, GALACTIC. See
section \ref{SEC:SKY} for more information on available sky
         coordinate systems.             [current sky coordinate system]
      }
      \sstsubsection{
         COSYS = LITERAL (Read)
      }{
         Determines if the positions which specify the box are to be
         given in sky coordinates or image coordinates. It can take any
         of the values SKY, IMAGE, PIXEL or WORLD. The first is used to
         indicate that sky coordinates will be supplied (in the system
         specified by parameter COORDS). The other three are all
         synonymous and indicate that image coordinates will be
         supplied.                                                 [SKY]
      }
      \sstsubsection{
         CURSOR = LOGICAL (Read)
      }{
         If true, a cursor on a graphics device is used to specify
         positions. Otherwise, parameters CENTRE\_LON, CENTRE\_LAT,
         CENTRE\_XY, LAT1, LAT2, LON1, LON2, XY1 and XY2 are used.  [YES]
      }
      \sstsubsection{
         DEVICE = DEVICE (Read)
      }{
         The plotting device.     [Current image-display-overlay device]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         The NDF to which image coordinates relate. In CURSOR mode, the
         NDF will usually be identified using information stored in the
         AGI database, without the user needing to specify a value for
         parameter IN.
      }
      \sstsubsection{
         LAT1 = LITERAL (Read)
      }{
         The latitude at a corner of the box, in the coordinate system
         specified by COORDS. LAT1 is only used if parameter CURSOR has
         a false value, if a null value is supplied for parameter
         BOXSIZE, and if parameter COSYS is given the value SKY.  See
         the section \ref{SEC:SKY} for details of the formats
         allowed for this value.
      }
      \sstsubsection{
         LAT2 = LITERAL (Read)
      }{
         The latitude at the opposite corner of the box, in the
         coordinate system specified by COORDS.  LAT2 is only used if
         parameter CURSOR has a false value, if a null value is
         supplied for parameter BOXSIZE, and if parameter COSYS is
         given the value SKY. See the section \ref{SEC:SKY} for
         details of the formats allowed for this value.
      }
      \sstsubsection{
         LON1 = LITERAL (Read)
      }{
         The longitude at a corner of the box, in the coordinate system
         specified by COORDS. LON1 is only used if parameter CURSOR has
         a false value, if a null value is supplied for parameter
         BOXSIZE, and if parameter COSYS is given the value SKY. See
         the section \ref{SEC:SKY} for details of the formats
         allowed for this value.
      }
      \sstsubsection{
         LON2 = LITERAL (Read)
      }{
         The longitude at the opposite corner of the box, in the
         coordinate system specified by COORDS. LON2 is only used if
         parameter CURSOR has a false value, if a null value is
         supplied for parameter BOXSIZE, and if parameter COSYS is
         given the value SKY.  See the section \ref{SEC:SKY} for
         details of the formats allowed for this value.
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen and
         logged to the log file. This should take one of the values
         QUIET, NORMAL or VERBOSE (see section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
      \sstsubsection{
         OUTLINE = LOGICAL (Read)
      }{
         If true, a box is drawn on the graphics device specified by
         parameter DEVICE, representing the rectangular region. The
         run-time default for this parameter is YES if parameter CURSOR
         has a true value, and NO otherwise.                          []
      }
      \sstsubsection{
         PEN = INTEGER (Read)
      }{
         The SGS pen number used to draw the box on the displayed
         image.  Only used if parameter OUTLINE is given a true value.
                                                           [current pen]
      }
      \sstsubsection{
         PIC = LOGICAL (Read)
      }{
         If true, a picture is added to the graphics data base
         corresponding to the rectangular region. The new picture
         becomes the current picture. See parameters PICNAM and PICLAB.
                                                                    [NO]
      }
      \sstsubsection{
         PICLAB = LITERAL (Read)
      }{
         A Label to be given to the new picture. Only used if parameter
         PIC has a true value. No label is added if a null value is
         supplied.                                                   [!]
      }
      \sstsubsection{
         PICNAM = LITERAL (Read)
      }{
         The name to associated with the new picture. Only used if parameter
         PIC has a true value.                                    [DATA]
      }
      \sstsubsection{
         XY1 = REAL (Read)
      }{
         The image coordinates (X and Y) at a corner of the box. XY1 is
         only used if parameter CURSOR has a false value, if a null
         value is supplied for parameter BOXSIZE, and if parameter
         COSYS has one of the values WORLD, IMAGE or PIXEL.
      }
      \sstsubsection{
         XY2 = REAL (Read)
      }{
         The image coordinates (X and Y) at the opposite corner of the box.
         XY2 is
         only used if parameter CURSOR has a false value, if a null
         value is supplied for parameter BOXSIZE, and if parameter
         COSYS has one of the values WORLD, IMAGE or PIXEL.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         SKYBOX
      }{
         This command will display a cursor over the current image
         overlay device, and ask the user to identify two opposite
         corners of the box. An outline of the box will be drawn.  The
         image coordinates and sky coordinates of the corners and the
         centre of the box will then be displayed, together with the
         extent of the box in the X and Y directions. No picture will be
         added to the graphics database.
      }
      \sstexamplesubsection{
         SKYBOX NOCURSOR IN=M51 COSYS=IMAGE XY1=[1,1] XY2=[50,50]
      }{
         The box extends from pixel (1,1) to pixel (50,50) in the NDF
         \texttt{"}M51\texttt{"}. The sky coordinates of the corners and the centre of
         the box will then be displayed, together with the extent of
         the box in the X and Y directions. No picture will be added to
         the graphics database, and no outline will de drawn.
      }
      \sstexamplesubsection{
         SKYBOX BOXSIZE=[50,60] NOOUTLINE PIC PICNAM=\texttt{'}FRAME\texttt{'}
      }{
         A cursor is displayed and the user asked to identify the
         centre of the box. The box extends for 25 arc-minutes on each
         side of this centre position in the X direction, and for 30
         arc-minutes in the Y direction. The coordinates of the corners
         and centre, and the extent of the box are reported. No outline
         of the box is drawn, but a new FRAME picture corresponding to
         the box is added to the graphics data base.
      }
   }
}

\sstroutine{
   SKYGRID
}{
   Overlay a sky coordinate grid on a displayed picture
}{
   \sstdescription{
      This routine overlays a sky coordinate grid on top of a specified
      section of a previously displayed picture, using astrometry
      information stored with the picture in the AGI database, or
      stored in a specified NDF. If the current picture is a DATA
      picture, then the coordinate grid is overlayed on top of the
      current picture. Otherwise, it is overlayed on top of the most
      recent DATA picture to be created within the current picture.

      Many aspects of the display can be tailored using the parameters
      described below. Particularly, the general plotting accuracy can
      be controlled using parameter TOLERANCE. Greater accuracy is
      bought at the cost of greater run-time, so in general only use
      high accuracy if it is really necessary.
   }
   \sstusage{
      SKYGRID DEVICE IN
   }
   \sstparameters{
      \sstsubsection{
         CLEAR = \_LOGICAL (Read)
      }{
         True if the area of the graphics device over which the
         coordinate grid is to be drawn should be cleared before
         creating the grid.                                        [NO]
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the sky coordinate system to use. Valid values
         include ECLIPTIC, EQUATORIAL, GALACTIC. See
section \ref{SEC:SKY} for more information on available sky
         coordinate systems.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         COORDSIZE = REAL (Read)
      }{
         The text size to be used when writing formatted coordinate
         values, given as a fraction of the maximum dimension of the
         plotting zone. A negative or zero value suppresses coordinate
         labels.                                                  [0.01]
      }
      \sstsubsection{
         DEVICE = DEVICE (Read)
      }{
         The plotting device.     [Current image-display-overlay device]
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         The NDF from which to read the astrometry information. This
         will usually be the NDF holding the displayed image. A null
         value will cause the astrometry to be located using
         information stored within the AGI database. If this cannot be
         done, then the user will be re-prompted for an NDF using
         parameter IN.  If a section of an NDF is specified, the
         coordinate grid is only drawn over the specified section of
         the picture.                                                [!]
      }
      \sstsubsection{
         LABEL = \_LOGICAL (Read)
      }{
         True if the sky coordinate grid is to be labelled.       [TRUE]
      }
      \sstsubsection{
         LATACC = LITERAL (Read)
      }{
         The accuracy required for the displayed latitude labels, in
         the coordinate system specified by the parameter COORDS (eg if
         COORDS is EQUATORIAL then LATACC should be given the accuracy
         as a declination value; for instance, a value of 1 arc-minute
         will suppress the arc-seconds field in the displayed
         declination values). See section \ref{SEC:SKY} for the
         formats allowed for this value.  If a value of zero is
         supplied, a sensible default value will be used.            [0]
      }
      \sstsubsection{
         LATINT = LITERAL (Read)
      }{
         The interval between lines of constant latitude (parallels),
         in the coordinate system specified by the parameter COORDS (eg
         if COORDS is EQUATORIAL then LATINT should be given the
         interval in declination between parallels). See
section \ref{SEC:SKY} for the formats allowed for this value.  If
         a value of zero is supplied, a sensible default value will be
         used.                                                       [0]
      }
      \sstsubsection{
         LINES = LOGICAL (Read)
      }{
         True if lines of constant longitude and latitude should extend
         across the entire image. Otherwise, short sections at the ends
         of these lines are displayed (in the nature of tick marks).
                                                                 [FALSE]
      }
      \sstsubsection{
         LONACC = LITERAL (Read)
      }{
         The accuracy required for the displayed longitude labels, in
         the coordinate system specified by the parameter COORDS (eg if
         COORDS is EQUATORIAL then LONACC should be given the accuracy
         as a right ascension value; for instance, a value of 1 hour
         will suppress the minutes and seconds fields in the displayed
         RA values). See section \ref{SEC:SKY} for the formats
         allowed for this value. If a value of zero is supplied, a
         sensible default value will be used.                        [0]
      }
      \sstsubsection{
         LONINT = LITERAL (Read)
      }{
         The interval between lines of constant longitude (meridians),
         in the coordinate system specified by the parameter COORDS (eg
         if COORDS is EQUATORIAL then LONINT should be given the
         interval in right ascension between meridians). See
section \ref{SEC:SKY} for the formats allowed for this value.  If
         a value of zero is supplied, a sensible default value will be
         used.                                                       [0]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
      \sstsubsection{
         PENA = \_INTEGER (Read)
      }{
         Pen number to use when drawing the boundary round the
         coordinate grid.                                            [3]
      }
      \sstsubsection{
         PENB = \_INTEGER (Read)
      }{
         Pen number to use when drawing the curves and ticks.        [3]
      }
      \sstsubsection{
         PENC = \_INTEGER (Read)
      }{
         Pen number to use when drawing text labels.                 [1]
      }
      \sstsubsection{
         PEND = \_INTEGER (Read)
      }{
         Pen number to use when drawing coordinate labels.           [1]
      }
      \sstsubsection{
         TEXTSIZE = REAL (Read)
      }{
         The text size to be used when writing text labels, given as a
         fraction of the maximum dimension of the plotting zone. A
         negative or zero value suppresses text labels.           [0.02]
      }
      \sstsubsection{
         TOLERANCE = \_INTEGER (Read)
      }{
         The tolerance allowed when plotting the curves which make up
         the grid. The value should be between zero and ten. Values
         outside this range are take as being equal to the nearest end
         point of the range.  A value of zero gives minimum tolerance
         (i.e. maximum accuracy), at the cost of increased plotting
         time. A value of ten gives poorer accuracy but is faster.   [6]
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         SKYGRID XWINDOWS
      }{
         Overlay a coordinate grid on top of the most recent DATA
         picture on the XWINDOWS image display. The AGI database will
         usually contain the information needed to define the
         coordinate grid. If it does not, then the user will be prompted
         for parameter IN, and the name of the displayed NDF should be
         given in response.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         The astrometry information used to define the sky coordinate
         grid is located using the following search path:

         \sstitemlist{

            \sstitem Firstly, astrometry information is looked for in any NDF
            specified on the command line using parameter IN.

            \sstitem Secondly, astrometry information is looked for in any MORE
            structure associated with the AGI picture.

            \sstitem Thirdly, astrometry information is looked for in any
            reference object associated with the AGI picture.

            \sstitem If all else fails, the value of the IN parameter is
            cancelled, and the user is prompted for the NDF containing
            relevant astrometry information.
         }

         \sstitem
         This routine can only be used to display coordinate grids
         for NDFs which contain astrometry information in the form used by
         the IRAS90 package.
      }
   }
}

\sstroutine{
   SKYLINE
}{
   Draw curves over a displayed sky image
}{
   \sstdescription{
      This routine provides the user with facilities for drawing
      curves over a previously displayed data picture. The curves
      which can be drawn include:

        1. Arcs of meridians (lines of constant longitude)

        2. Arcs of parallels (lines of constant latitude)

        3. Arcs of great circles

        4. Poly-lines containing several sky positions. Each section of
           the poly line is an arc of a great circle.

      Many curves can be drawn by a single invocation of this routine
      (see parameter OPTION). The curves to be drawn can be specified
      either \texttt{"}interactively\texttt{"} (by positioning a graphics cursor or by
      suppling values in response to parameter prompts), or
      \texttt{"}non-interactively\texttt{"} (by supplying a text file containing the curve
      specifications); see parameter MODE. A text file can be created
      containing specifications of all the curves which have been
      drawn. This file can be supplied as input to a subsequent run of
      this routine.

      The parameter OPTION provides more facilities for modifying and
      editing the curves drawn by this routine, allowing astrometric
      diagrams to be created.
   }
   \sstusage{
      SKYLINE DEVICE IN
   }
   \sstparameters{
      \sstsubsection{
         ANGLE = LITERAL
      }{
         The position angle of an arc of a great circle (measured at
         the start of the arc). The angle is measured from north to the
         required direction with positive values in the sense of
         rotation from north to east. The formats allowed for this
         value are the same as those allowed for a declination value
         (see section \ref{SEC:SKY}).
      }
      \sstsubsection{
         ARCLEN = LITERAL (Read)
      }{
         Gives the length of the arc to be drawn. It can be positive or
         negative. The latitude at the end of an arc of a meridian is
         (LATITUDE $+$ ARCLEN). The longitude at the end of an arc of a
         parallel is (LONGITUDE $+$ ARCLEN). The section will be clipped
         by the boundary of the displayed image. The formats allowed
         for this value are the same as those allowed for a declination
         value (see section \ref{SEC:SKY}). If the supplied value is
         zero, the entire length of the arc visible within the picture
         will be drawn.
      }
      \sstsubsection{
         CLEAR = LOGICAL (Read)
      }{
         True if the area of the graphics device over which the curves
         are to be drawn should be cleared before drawing commences.[NO]
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the sky coordinate system to use. Valid values
         include ECLIPTIC, EQUATORIAL, GALACTIC. See
section \ref{SEC:SKY} for more information on available sky
         coordinate systems.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         DEVICE = DEVICE (Read)
      }{
         The plotting device.     [Current image-display-overlay device]
      }
      \sstsubsection{
         ERASE = LITERAL (Read)
      }{
         Erase a curve (or all curves ) just drawn. It can take the
         following values:

         MERIDIAN - Erase the last drawn meridian arc

         PARALLEL - Erase the last drawn parallel arc

         GREAT CIRCLE   - Erase the last drawn great circle arc

         POLYLINE - Erase the last drawn poly-line

         ALL - Erase all curves

         Only the facility to erase the last drawn curve of each type
         or to erase all curves is provided. After a curve is erased
         the one drawn just before it becomes the last and hence can be
         erased subsequently. If you have a complicated selection of
         curves to be erased, the best way to achieve this is: save the
         present drawing in a text file, erase all curves, edit the
         text file with a text editor to delete the entries
         corresponding to the curves to be erased and then draw the
         remaining curves in the file by running SKYLINE again,
         selecting non-interactive mode with the edited text file as
         its input.
      }
      \sstsubsection{
         FILE = LITERAL (Read)
      }{
         The name of the text file used to give the information about
         the curves to be drawn in non-interactive mode. See the \texttt{"}Notes\texttt{"}
         section below for a description of the format of this file
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         The NDF from which to read the astrometry information. This
         will usually be the NDF holding the displayed image. A null
         value will cause the astrometry to be located using
         information stored within the AGI database. If this cannot be
         done, then the user will be re-prompted for an NDF using
         parameter IN.  If a section of an NDF is specified, the curves
         are only drawn over the specified section of the picture.   [!]
      }
      \sstsubsection{
         LAT = LITERAL (Read)
      }{
         The latitude at the start of a curve, in the coordinate system
         specified by COORDS (eg if COORDS was EQUATORIAL, LAT should
         be given a Declination value).  See section \ref{SEC:SKY}
         for more information on available sky coordinate systems.
      }
      \sstsubsection{
         LOGFILE = LITERAL (Read)
      }{
         The name of the log text file containing the information
         about the present plotted curves. See the NOTES section about
         the format of this file.
      }
      \sstsubsection{
         LON = LITERAL (Read)
      }{
         A longitude at the start of a curve, in the coordinate system
         specified by COORDS (eg if COORDS was EQUATORIAL, LON should
         be given a Right Ascension value).  See
section \ref{SEC:SKY} for more information on available sky
         coordinate systems.
      }
      \sstsubsection{
         LOOP = LOGICAL (Read)
      }{
         If true then the routine does not exit when the final curve of
         the given type has been drawn. Instead, the user is allowed to
         modify the current drawing by selecting from the options
         provided by parameter OPTION.                              [NO]
      }
      \sstsubsection{
         MODE = LITERAL (Read)
      }{
         Specifies the source from which curve specifications will be
         obtained. It can be:

         CURSOR - All positions are specified by cursor. This mode will
         only be available on graphic devices which support cursors.

         KEYBOARD - Positions are specified in response to parameter
         prompts, using the keyboard.

         FILE - Curves are drawn according to the specifications
         contained within a text file (see parameter FILE). This is
         referred to as \texttt{"}non-interactive\texttt{"} mode. The run-time default is
         CURSOR if a cursor is available, and KEYBOARD otherwise.     []
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).  [current message filter setting]
      }
      \sstsubsection{
         OPTION = LITERAL (Read)
      }{
         The action to take once all curves of the type specified by
         parameter TYPE have been drawn. It can take following values:

         CONTINUE - Continue to draw further curves.

         ERASE - Select the curves to erase. This option will only
         be available on image\_overlay devices.

         SAVE - Save information describing the present drawing into a
         log file.

         MODE - Change the source from which curve specifications are
         obtained.

         PEN - Select a new SGS pen number.

         EXIT - Exit the application

         This parameter is only prompted for if parameter LOOP has a
         true value.
      }
      \sstsubsection{
         PEN = INTEGER (Read)
      }{
         The pen number used to draw the curves.                     [1]
      }
      \sstsubsection{
         TOLERANCE = INTEGER (Read)
      }{
         The tolerance allowed when plotting the curves.  The value
         should be between zero and ten. Values outside this range are
         take as being equal to the nearest end point of the range.  A
         value of zero gives minimum tolerance (i.e. maximum accuracy),
         at the cost of increased plotting time. A value of ten gives
         poorer accuracy but is faster.                              [6]
      }
      \sstsubsection{
         TYPE = LITERAL (Read)
      }{
         Specifies the type of curve to be drawn. It takes the
         following values (or any un-ambiguous abbreviation):

         MERIDIAN - Draw meridian arcs

         PARALLEL - Draw parallel arcs

         GREAT CIRCLE - Draw great circle arcs

         POLYLINE - Draw poly-lines connecting specified sky positions

         A null response will result in the routine terminating if LOOP
         is false. If LOOP is true a value will be obtained for
         parameter OPTION and the corresponding action will be
         performed.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         SKYLINE MODE=KEY LON=0 LAT=0 TYPE=PAR COORDS=GAL ARCLEN=0
      }{
         This causes a curve to be drawn over the displayed picture
         corresponding to the galactic equator. MODE=KEY causes the
         position supplied by parameters LON and LAT to be used in
         preference to the cursor. COORDS=GAL causes the values supplied
         by LON and LAT to be interpreted as galactic coordinates.
         ARCLEN=0 causes the entire length of the intersection of the
         curve with the picture to be drawn (if any). TYPE=PAR specifies
         that a parallel (i.e. a line of constant latitude) is to be
         drawn. LON=0 and LAT=0 causes the parallel to coincide with
         the galactic equator. Once the curve is drawn, the user will
         be prompted for a new value for parameter LON. A null value
         should be given to exit the routine, and then a null value
         should also be given for the subsequent prompt for TYPE.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         The curves are drawn within the current picture only if it is a
         DATA picture, otherwise curves are drawn in the last DATA picture
         to be created within the current picture.

         \sstitem
         The astrometry information used to draw the curves is located
         using the following search path:

         \sstitemlist{

            \sstitem Firstly, astrometry information is looked for in any NDF
            specified on the command line using parameter IN.

            \sstitem Secondly, astrometry information is looked for in any MORE
            structure associated with the AGI picture.

            \sstitem Thirdly, astrometry information is looked for in any
            reference object associated with the AGI picture.

            \sstitem If all else fails, the value of the IN parameter is
            cancelled, and the user is prompted for the NDF containing
            relevant astrometry information.
         }

         \sstitem
         This routine can only be used to display curves for NDFs which
         contain astrometry information in the form used by the IRAS90
         package.

         \sstitem
         The format of input and output text files is:

         \sstitemlist{

            \sstitem The file is divided into comments and fields. Comments
            consist of strings commencing with a \texttt{"}\#\texttt{"} character, and are
            considered to extend to the end of the line. Such comments are
            ignored. Fields are strings which specify any of the items of
            information described below. Each line in the file may contain
            any number of fields, multiple fields being separated by
            commas.

            \sstitem The first field should give the name of the sky coordinate
            system used (see section \ref{SEC:SKY}).

            \sstitem Fields containing the key words MERIDIAN, PARALLEL, GREAT
            CIRCLE or POLYLINE begin a block of specifications for arcs
            of the corresponding type.

            \sstitem The specification of an arc of a meridian or parallel takes
            three consecutive fields; the longitude at the start of the
            arc, the latitude at the start of the arc, and the arc-length.

            \sstitem The specification of an arc of a great circle takes four
            consecutive fields; the longitude at the start of the arc,
            the latitude at the start of the arc, the position angle at
            the start of the arc, and the arc-length.

            \sstitem A poly-line is specified by giving the longitude and latitude
            (in that order) of each vertex. A new POLYLINE keyword must be
            specified for each poly-line which is to be drawn.

            \sstitem Keywords can appear many times and in any order.
         }
      }
   }
}

\sstroutine{
   SKYMARK
}{
   Draw markers at specified positions
}{
   \sstdescription{
      This routine draws markers at a set of specified positions within
      the most recently created DATA picture, or alternatively draws a
      polyline through them. The positions can be specified by using a
      graphics cursor, or by reading them from a text file, or by
      supplying them in response to parameter prompts.

      There are 5 different markers available for selection: \texttt{'}.\texttt{'}, \texttt{'}$+$\texttt{'},
      \texttt{'}$*$\texttt{'},  \texttt{'}o\texttt{'} and \texttt{'}x\texttt{'}. Except the \texttt{'}.\texttt{'}, there is the option in which
      the size of the markers are proportional to the image data value
      at the selected position. In this case, a \texttt{'}.\texttt{'} will temporarily be
      put at each of the selected positions until the full range of
      image data values at all selected positions is known.  The
      temporary markers will then be replaced by the selected marker,
      with sizes ranging between the limits specified by parameter
      SIZE.

      The sky coordinates of the marked positions can be logged into
      a logging file, see parameter LOGFILE, which can be used in
      future by other IRAS90 applications as well as this application
      itself.
   }
   \sstusage{
      SKYMARK DEVICE IN
   }
   \sstparameters{
      \sstsubsection{
         CLEAR = LOGICAL (Read)
      }{
         True if the area of the graphics device over which the markers
         are to be drawn should be cleared before drawing any markers.
                                                                    [NO]
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the sky coordinate system to use. Valid values
         include ECLIPTIC, EQUATORIAL, GALACTIC. See
section \ref{SEC:SKY} for more information on available sky
         coordinate systems.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         DEVICE = DEVICE (Read)
      }{
         The plotting device.     [Current image-display-overlay device]
      }
      \sstsubsection{
         EPOCH = DOUBLE PRECISION (Read)
      }{
         The Julian epoch at which the supplied sky positions were
         determined. This is only used if sky coordinates supplied in a
         text file (in FILE mode) are stored in a coordinate system
         different to that specified by the COORDS parameter. In this
         case the epoch may be necessary to perform the conversion from
         one coordinate system to the other (depending on what the
         coordinate systems are). A value of 1983.5 is acceptable for
         all IRAS data.
      }
      \sstsubsection{
         FILE = FILENAME (Read)
      }{
         A file from which to read coordinates. This is only prompted
         for if parameter MODE has the value FILE. See the
section \ref{SEC:COF} for a description of the format required for
         this file.
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         The NDF to which image coordinates relate. In CURSOR mode, the
         NDF will usually be identified using information stored in the
         AGI database, without the user needing to specify a value for
         parameter IN.
      }
      \sstsubsection{
         LAT = LITERAL (Read)
      }{
         A latitude of a position to be marked, in the coordinate
         system specified by COORDS (eg if COORDS was EQUATORIAL, LAT
         should be given a Declination value). LAT is only prompted
         for if parameter MODE has the value KEYBOARD. See the
section \ref{SEC:SKY} for details of the formats allowed for this
         value.
      }
      \sstsubsection{
         LOGFILE = LITERAL (Read)
      }{
         The name of a text file to receive a copy of the displayed
         information. The run time default is for no log file to be
         produced. Log files are created in a format suitable for use
         with parameter FILE.                                        [!]
      }
      \sstsubsection{
         LON = LITERAL (Read)
      }{
         A longitude of a position to be marked, in the coordinate
         system specified by COORDS (eg if COORDS was EQUATORIAL, LAT
         should be given a Right Ascension value). LON is only prompted
         for if parameter MODE has the value KEYBOARD. See the
section \ref{SEC:SKY} for details of the formats allowed for this
         value.
      }
      \sstsubsection{
         LOOP = LOGICAL (Read)
      }{
         If true then application does not exit when the final input
         position has been given. Instead, the user is allowed to
         change some of the parameter values and to continue to
         mark more positions. See parameter OPTION.                 [NO]
      }
      \sstsubsection{
         MODE = LITERAL (Read)
      }{
         Specifies the working mode of the application. It can take
         following values:

          CURSOR - The positions are specified by the cursor. This
          option is only available when cursor is available on the
          graphic device in use.

          KEYBOARD - The positions are specified from the keyboard.

          FILE - The positions are read from a text file.

         The inputs can be abbrievated to one character and is case
         insensitive.                                         [KEYBOARD]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen and
         logged to the log file. This should take one of the values
         QUIET, NORMAL or VERBOSE (see section \ref{SEC:MSG}).
                                        [current message filter setting]
      }
      \sstsubsection{
         OPTION = LITERAL (Read)
      }{
         The action to perform once all positions have been marked.
         This is only prompted for if parameter LOOP is TRUE (otherwise
         a value of EXIT is assumed). It can take the following values;

          CLEAR - Clear the marks drawn in previous loops. This option
          is only available when the graphic device in use is the type
          of IMAGE-OVERLAY.

          TYPE - Select a new type of mark.

          PEN - Select a new pen to draw the mark.

          POLY - Toggle between polyline/marker mode.

          SIZE - Select a new mark size.

          MODE - Select a new working mode for the application.

          MARK - Perform the marking task with newly selected parameters

          EXIT - Exit the application.

         The application will keep prompt for a new value of this
         parameter until \texttt{'}MARK\texttt{'} or \texttt{'}EXIT\texttt{'} is given. The input can be
         abbrievated to an unambiguous length and is case insensitive.
      }
      \sstsubsection{
         PEN = INTEGER (Read)
      }{
         The SGS pen number used to draw the markers on the displayed
         image.                                                      [3]
      }
      \sstsubsection{
         POLYLINE = LOGICAL (Read)
      }{
         True if a polygonal line is to be drawn connecting the supplied
         positions, instead of the usual markers. The polyline is closed
         by connecting the last position with the first position.   [NO]
      }
      \sstsubsection{
         SIZE = REAL (Read)
      }{
         A pair of real value give the max. and min. size of the marks
         to be draw on the image. Given as the scale of the nominal
         size for the graphic device. The size of a mark is at somewhere
         between this two values according to the image magnitude at the
         mark position. Among all positions to be marked, the mark at
         the position with the max. image magnitude will has max. size
         and the mark at the position with the min. image magnitude will
         has min. size. If only one value is obtained from the user, the
         max size will be equal to the min size, that is, all marks will
         have the same size.                                       [1.0]
      }
      \sstsubsection{
         TYPE = LITERAL (Read)
      }{
         The marker to be used. The following markers are currently
         available \texttt{"}.\texttt{"}, \texttt{"}$+$\texttt{"}, \texttt{"}$*$\texttt{"}, \texttt{"}o\texttt{"}, \texttt{"}x\texttt{"}                           [$+$]
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem The displayed image should have name \texttt{'}DATA\texttt{'} and be either the
         current one of the most recent one with the name \texttt{'}DATA\texttt{'} in the
         AGI data base, that is, the picture should either be the most
         recently displayed, or be made current by using KAPPA application
         CURSOR or PICLIST etc (see \xref{SUN/95}{sun95}{} for more details about the
         usage of these KAPPA applications).

         \sstitem This application uses the astrometry information stored in the
         Astrometry Extension, created by IRA\_ package, of the underlying
         NDF file of the displayed image. Therefore the Astrometry
         Extension should be first created if it does not exist. For IRAS
         images, it is to require the user applying the I90 application
         PREPARE to the image NDFs right after extracting the images from
         the FITS tape with KAPPA application FITSIN.
      }
   }
}
\sstroutine{
   SKYPHOT
}{
   Calculate integrated fluxes in rectangular, elliptical or polygonal
   regions
}{
   \sstdescription{
      This routine calculates the integrated flux within a rectangular,
      elliptical or polygonal region of an image, optionally
      subtracting a supplied background surface brightness. Central
      positions and polygon vertices may be specified using a graphics
      cursor if an image is already displayed. Alternatively, sky
      coordinates may be specified in response to parameter prompts, or
      they may be read from a text file (see parameter MODE). The
      dimensions of rectangular or elliptical apertures are specified
      using parameter SIZE.
}
   \sstusage{
      SKYPHOT
   }
   \sstparameters{
      \sstsubsection{
         BACKVAL = REAL (Read)
      }{
         A background surface brightness to be subtracted from the data
         before integrating over the selected region. The value should
         be supplied in units of MJy/sr.                           [0.0]
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the coordinate system used for referring to sky
         positions. Valid values include ECLIPTIC, EQUATORIAL,
         GALACTIC. See help on \texttt{"}Sky\_coordinates\texttt{"} for more information
         on available sky coordinate systems.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         DEVICE = DEVICE (Read)
      }{
         The graphics workstation.         [The current graphics device]
      }
      \sstsubsection{
         FILE = FILENAME (Read)
      }{
         A file from which to read sky coordinates. This is only
         prompted for if parameter MODE has the value FILE. See the
         help on \texttt{"}Coordinate\_files\texttt{"} for a description of the format
         required for this file. Note, the file must contain sky
         coordinates, not image coordinates.
      }
      \sstsubsection{
         FLUX = REAL (Write)
      }{
         An output parameter holding the last displayed flux density
         value.
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         The input NDF.
      }
      \sstsubsection{
         LAT = LITERAL (Read)
      }{
         A latitude of a position (either the centre of a rectangular
         or elliptical region, or a vertex of a polygon), in the
         coordinate system specified by COORDS (eg if COORDS was
         EQUATORIAL, LAT should be given a Declination value). LAT is
         only prompted for if parameter MODE has the value KEYBOARD.
         See help on \texttt{"}Sky\_coordinates\texttt{"} for more information on
         available sky coordinate systems.
      }
      \sstsubsection{
         LOGFILE = FILENAME (Write)
      }{
         The name of a text file to receive a copy of the displayed
         information. The run time default is for no log file to be
         produced.                                                   [!]
      }
      \sstsubsection{
         LON = LITERAL (Read)
      }{
         The longitude corresponding to the latitude value given for
         parameter LAT. LON is only prompted for if parameter MODE has
         the value KEYBOARD. See help on \texttt{"}Sky\_coordinates\texttt{"} for more
         information on available sky coordinate systems.
      }
      \sstsubsection{
         LOOP = LOGICAL (Read)
      }{
         If true then application does not exit when the final input
         position has been given. Instead, the user is allowed to
         change some of the parameter values and to continue to
         perform more integrations. See parameter OPTION.            [NO]
      }
      \sstsubsection{
         MEAN = REAL (Write)
      }{
         An output parameter holding the last displayed mean surface
         brightness value.
      }
      \sstsubsection{
         MODE = LITERAL (Read)
      }{
         MODE specifies the source of input coordinates. It can take the
         following values;

         CURSOR - The graphics cursor is used to specify the positions.
         A DATA picture must previously have been created (eg a grey
         scale image or contour plot). The most recently created DATA
         picture contained within the current picture is used. The user
         is given instructions on the use of the cursor.

         FILE - The input positions are contained within the file
         specified by parameter FILE.

         KEYBOARD - The input positions are specified by parameters LON
         and LAT.                                               [CURSOR]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen and
         logged to the log file. This should take one of the values
         QUIET, NORMAL or VERBOSE (see help on \texttt{"}Message\_filtering\texttt{"}).
                                        [current message filter setting]
      }
      \sstsubsection{
         OPTION = LITERAL (Read)
      }{
         The action to perform once all positions have been processed.
         This is only prompted for if parameter LOOP is TRUE (otherwise
         a value of EXIT is assumed). It can take the following values;

         CONTINUE - Continue to process more positions using the current
         parameter settings.

         EXIT - Exit the application without processing any more
         positions.

         MODE - Change the value of the MODE parameter.

         PLOT - Change the value of the PLOT parameter.

         PEN - Change the value of the PEN parameter.

         SHAPE - Change the value of the SHAPE parameter.

         SIZE - Change the value of the SIZE parameter.

         BACKVAL - Change the value of the BACKVAL parameter.
      }
      \sstsubsection{
         PEN = INTEGER (Read)
      }{
         The SGS pen number used to draw the graphics specified by
         parameter PLOT.                                             [3]
      }
      \sstsubsection{
         PLOT = LOGICAL (Read)
      }{
         If a true value is supplied, then the area over which the flux
         is to be integrated is outline on the graphics device
         specified by parameter DEVICE. The pen colour specified by
         parameter PEN is used. This parameter is only used if
         parameter MODE is given the value CURSOR.                 [YES]
      }
      \sstsubsection{
         SHAPE = LITERAL (Read)
      }{
         The shape of the region to be integrated over. It can take the
         values RECTANGLE, ELLIPSE or POLYGON.                 [ELLIPSE]
      }
      \sstsubsection{
         SIGMA = REAL (Write)
      }{
         An output parameter holding the last displayed value for the
         standard deviation of the surface brightness.
      }
      \sstsubsection{
         SINGLE = LOGICAL (Read)
      }{
         If TRUE, then the application normally exits after the user
         has given a single input position. If parameter LOOP is TRUE
         then the user may continue to give further single positions.
         The value of this parameter is ignored when integrating
         polygonal regions.                                         [NO]
      }
      \sstsubsection{
         SIZE = REAL (Read)
      }{
         A pair of values giving the dimensions of the aperture
         parallel to X and Y, in arc-minutes. If a single value is
         given then the supplied value is used for both axes.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         SKYPHOT LOGFILE=FLUXES.LIS SIZE=10
      }{
         This displays a cursor on top of the most recently created
         DATA picture (within the current picture). The user may then
         repeatedly select points, and integrated flux within a
         circular aperture of diameter 10 arc-minutes is displayed on
         the terminal and written to text file FLUXES.LIS. Giving a
         point outside the picture causes the application to terminate.
      }
      \sstexamplesubsection{
         SKYPHOT SHAPE=RECT SIZE=[3,5] MODE=KEY SINGLE
      }{
         This prompts the user for a single pair of sky coordinates. The
         integrated flux within a rectangular aperture of 3 by 5
         arc-minutes is displayed, and the application exits.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         Flux density values are displayed in units of Janskys, and
         surface brightness values in mega-Janskys per steradian.

         \sstitem
         The last displayed values are written to output parameters
         FLUX, MEAN and SIGMA and can be accessed by subsequent
         applications.

         \sstitem
         The displayed total flux values include only whole pixel
         values.  No attempt is made to perform any interpolation for
         pixels which are only partly within the aperture. For this reason
         the actual aperture shape can only be considered to be accurate
         to one pixel.  If this is a problem, the image can be
         re-projected using application SKYALIGN so that it has smaller
         pixels before using SKYPHOT.
      }
   }
}
\sstroutine{
   SKYPOS
}{
   Find the sky coordinates of selected image positions, and
   vice-verse
}{
   \sstdescription{
      This routine returns the sky coordinates corresponding to
      selected image positions, or the image coordinates corresponding
      to selected sky positions, depending on the value of parameter
      INVERSE. Positions may be specified using a graphics cursor if an
      image is already displayed. Alternatively, coordinates may be
      specified in response to parameter prompts, or they may be read
      from a text file (see parameter MODE).
   }
   \sstusage{
      SKYPOS
   }
   \sstparameters{
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the coordinate system used for referring to sky
         positions. Valid values include ECLIPTIC, EQUATORIAL,
         GALACTIC. See help on \texttt{"}Sky\_coordinates\texttt{"} for more information
         on available sky coordinate systems.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         DEVICE = DEVICE (Read)
      }{
         The graphics workstation.         [The current graphics device]
      }
      \sstsubsection{
         EPOCH = DOUBLE PRECISION (Read)
      }{
         The Julian epoch at which the supplied sky positions were
         determined. This is only used if sky coordinates supplied in a
         text file (in FILE mode) are stored in a coordinate system
         different to that specified by the COORDS parameter. In this
         case the epoch may be necessary to perform the conversion from
         one coordinate system to the other (depending on what the
         coordinate systems are). A value of 1983.5 is acceptable for
         all IRAS data.
      }
      \sstsubsection{
         FILE = FILENAME (Read)
      }{
         A file from which to read coordinates. This is only prompted
         for if parameter MODE has the value FILE. See the help on
         \texttt{"}Coordinate\_files\texttt{"} for a description of the format required for
         this file.
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         The NDF to which image coordinates relate. In CURSOR mode, the
         NDF will usually be identified using information stored in the
         AGI database, without the user needing to specify a value for
         parameter IN.
      }
      \sstsubsection{
         INSIDE =  LOGICAL (Write)
      }{
         An output parameter which is set TRUE if the last supplied
         position lies within the bounds of the NDF. The position must
         also be within the bounds of the AGI DATA picture if CURSOR
         mode is being used. It is set FALSE otherwise.
      }
      \sstsubsection{
         INVERSE = LOGICAL (Read)
      }{
         SKYPOS usually expects the user to supply image coordinates as
         input. The corresponding sky coordinates are then found and
         displayed. However, if INVERSE is true then the user should
         supply sky coordinates and the corresponding image coordinates
         are found and displayed.                                   [NO]
      }
      \sstsubsection{
         LAT = LITERAL (Read)
      }{
         A latitude of a position to be transformed, in the coordinate
         system specified by COORDS (eg if COORDS was EQUATORIAL, LAT
         should be given a Declination value). LAT is only prompted
         for if parameter MODE has the value KEYBOARD. See help on
         \texttt{"}Sky\_coordinates\texttt{"} for more information on available sky
         coordinate systems.
      }
      \sstsubsection{
         LATOUT = LITERAL (Write)
      }{
         An output parameter to which is written the final displayed
         latitude, in the coordinate system specified by COORDS.
      }
      \sstsubsection{
         LOGFILE = FILENAME (Write)
      }{
         The name of a text file to receive a copy of the displayed
         information. The run time default is for no log file to be
         produced. Log files are created in a format suitable for use
         with parameter FILE.                                        [!]
      }
      \sstsubsection{
         LON = LITERAL (Read)
      }{
         A longitude of a position to be transformed, in the coordinate
         system specified by COORDS (eg if COORDS was EQUATORIAL, LON
         should be given a Right Ascension value). LON is only prompted
         for if parameter MODE has the value KEYBOARD. See help on
         \texttt{"}Sky\_coordinates\texttt{"} for more information on available sky
         coordinate systems.
      }
      \sstsubsection{
         LONOUT = LITERAL (Write)
      }{
         An output parameter to which is written the final displayed
         longitude, in the coordinate system specified by COORDS.
      }
      \sstsubsection{
         LOOP = LOGICAL (Read)
      }{
         If true then application does not exit when the final input
         position has been given. Instead, the user is allowed to
         change some of the parameter values and to continue to
         transform more positions. See parameter OPTION.            [NO]
      }
      \sstsubsection{
         MODE = LITERAL (Read)
      }{
         MODE specifies the source of input coordinates. It can take the
         following values;

         CURSOR - The graphics cursor is used to specify the positions.
         A DATA picture must previously have been created (eg a grey
         scale image or contour plot). The most recently created DATA
         picture contained within the current picture is used. The user
         is given instructions on the use of the cursor.

         FILE - The input positions are contained within the file
         specified by parameter FILE.

         KEYBOARD - The input positions are specified by parameters LON
         and LAT (if INVERSE is FALSE), or X and Y (if INVERSE is TRUE).
                                                                [CURSOR]
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen and
         logged to the log file. This should take one of the values
         QUIET, NORMAL or VERBOSE (see help on \texttt{"}Message\_filtering\texttt{"}).
                                        [current message filter setting]
      }
      \sstsubsection{
         OPTION = LITERAL (Read)
      }{
         The action to perform once all positions have been processed.
         This is only prompted for if parameter LOOP is TRUE (otherwise
         a value of EXIT is assumed). It can take the following values;

         CONTINUE - Continue to process more positions using the current
         parameter settings.

         EXIT - Exit the application without processing any more
         positions.

         MODE - Change the value of the MODE parameter.

         MAPPING - Change the value of the INVERSE parameter.

         COORDINATES - Change the value of the COORDS parameter.

         PLOT - Change the value of the PLOT parameter.

         PEN - Change the value of the PEN parameter.

         Note, if MAPPING or COORDINATES is selected, then a new log
         file will be created (if logging has been requested using
         parameter LOGFILE) to ensure that each log file contains
         coordinates of a single type.
      }
      \sstsubsection{
         ORIENT = REAL (Write)
      }{
         An output parameter to which is written the position angle of
         the Y axis (in degrees) at the last displayed position. This
         may vary across an image due to projection effects.
      }
      \sstsubsection{
         PEN = INTEGER (Read)
      }{
         The SGS pen number used to draw the graphics specified by
         parameter PLOT.                                             [3]
      }
      \sstsubsection{
         PIXSIZE = REAL (Write)
      }{
         An output parameter to which is written a pair of values
         giving the pixel dimensions (in arc-minutes) at the last
         displayed position. These may vary across an image due to
         projection effects.
      }
      \sstsubsection{
         PLOT = LITERAL (Read)
      }{
         Specifies the sort of graphics which are to be used to mark the
         positions selected in cursor mode. PLOT can take any of the
         values POLY,MARK,NONE. POLY causes a polygonal line to be drawn
         between the selected points, MARK causes a cross to be drawn at
         each point, NONE causes no graphics to be produced. The
         graphics are produced on the device specified by parameter
         DEVICE, using the pen specified by parameter PEN.        [MARK]
      }
      \sstsubsection{
         SINGLE = LOGICAL (Read)
      }{
         If TRUE, then the application normally exits after the user
         has given a single input position. If parameter LOOP is TRUE
         then the user may continue to give further single positions.
                                                                    [NO]
      }
      \sstsubsection{
         X = REAL (Read)
      }{
         An X image coordinate of a position to be transformed. X is
         only prompted for if parameter MODE has the value KEYBOARD.
      }
      \sstsubsection{
         XOUT = REAL (Write)
      }{
         An output parameter to which is written the final displayed
         X image coordinate.
      }
      \sstsubsection{
         Y = REAL (Read)
      }{
         A Y image coordinate of a position to be transformed. Y is
         only prompted for if parameter MODE has the value KEYBOARD.
      }
      \sstsubsection{
         YOUT = REAL (Write)
      }{
         An output parameter to which is written the final displayed
         Y image coordinate.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         SKYPOS LOGFILE=STARS.DAT
      }{
         This displays a cursor on top of the most recently created
         DATA picture (within the current picture). The user may then
         repeatedly select points, and the image and sky coordinates of
         each point are displayed on the terminal. Giving a point
         outside the picture causes the application to terminate. The
         coordinates are also recorded in a log file called STARS.DAT.
      }
      \sstexamplesubsection{
         SKYPOS MODE=FILE IN=STARFIELD FILE=STARS.DAT LOOP INVERSE
      }{
         This reads a list of sky coordinates from text file STAR.DAT
         and displays the corresponding image coordinates (within NDF
         STARFIELD) on the terminal. Once all the positions included in
         STAR.DAT have been processed, the user is prompted for further
         action using parameter OPTION. The user may choose (for
         instance) to continue selecting more positions using the
         cursor.
      }
      \sstexamplesubsection{
         SKYPOS SINGLE MSG\_FILTER=QUIET
      }{
         This allows the user to indicate a single point on a displayed
         DATA picture using the cursor, and the application then
         immediately exits. No coordinates (or other information) are
         displayed on the screen, but the sky coordinates of the
         selected position are written to output parameters LONOUT and
         LATOUT for use by subsequent applications.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         When converting from image to sky coordinates, the displayed
         sky coordinates correspond to the displayed image coordinates
         which have been rounded to one decimal place, not to the original
         supplied image coordinates before rounding.

         \sstitem
         If the current message filtering level (see parameter
         MSG\_FILTER) is VERBOSE, then additional information is displayed
         on the screen for each position, describing the position angle of
         the Y axis and the pixel dimensions. These can vary across an
         image because of projection effects. The last displayed values
         are written to the output parameters ORIENT and PIXSIZE.
      }
   }
}
\sstroutine{
   SKYWRITE
}{
   Write text strings at specified positions
}{
   \sstdescription{
      This routine provides users with facilities to write text
      strings at specified positions within the most recently created
      DATA picture. Particularly, it can:

         1. Write text strings at the sky positions specified by
         parameters.

         2. Write text strings at the sky positions specified within
         a text file.

         3. Write text strings at the cursor position.

      The attributes of the text, that is, the direction, the height,
      the aspect ratio, the justification, the font and the colour, can
      be set using various parameters.

      In interactive mode (cursor or keyboard), the application will
      keep prompting the user for the specifications of the next text
      string and/or position until a null response is obtained.

      In non-interactive mode, an input text file is required which can
      be the output of a previous run of this routine or can be created
      by the user. The format of this file is described in the \texttt{"}Notes:\texttt{"}
      section.

      After getting a null response when in interactive mode, or
      finishing writing in the non-interactive mode, the application
      will exit by default. But users can choose to use the application
      in a even greater loop, invisible to users by default, in which
      users can interactively and/or non-interactively write texts,
      change working mode, set new text attribute, save the information
      of present writing into a text file for later use and erase the
      last writing, etc., see parameter LOOP.
   }
   \sstusage{
      SKYWRITE DEVICE IN
   }
   \sstparameters{
      \sstsubsection{
         ATTRIBUTE = LITERAL (Read)
      }{
         This parameter is used to specify which attribute of the text
         is to be set. It takes the following values:

          DIRECTION - Set the text \texttt{'}up\texttt{'} direction.

          HEIGHT - Set the text height.

          ASPECT RATIO - Set aspect ratio (width/height) of the
          characters in the text.

          JUSTIFICATION - Set the text justification.

          SPACE - Set the space between characters in the text.

          FONT - Set the font for the text.

          PEN - Set the text colour.

          DEFAULT - Select the default settings for all text attributes.

          SHOW - Show the current text attribute settings.

         The application will keep prompting for more attributes until
         DEFAULT, or a null value is supplied.                 [DEFAULT]
      }
      \sstsubsection{
         CLEAR = LOGICAL (Read)
      }{
         True if the area of the graphics device over which the text is
         to be written should be cleared before writing commences.  [NO]
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the sky coordinate system to use. Valid values
         include ECLIPTIC, EQUATORIAL, GALACTIC. See
section \ref{SEC:SKY} for more information on available sky
         coordinate systems.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         DEVICE = DEVICE (Read)
      }{
         The plotting device.     [Current image-display-overlay device]
      }
      \sstsubsection{
         DIRECTION = Real (Read)
      }{
         A pair of values specifying character orientation in terms of a
         vector. Only the direction of the vector is significant. On
         entry, the text up direction is set as upwards, that is (0,1).
      }
      \sstsubsection{
         EPOCH = DOUBLE PRECISION (Read)
      }{
         The Julian epoch at which the supplied sky positions were
         determined. This is only used if sky coordinates supplied in a
         text file (in FILE mode) are stored in a coordinate system
         different to that specified by the COORDS parameter. In this
         case the epoch may be necessary to perform the conversion from
         one coordinate system to the other (depending on what the
         coordinate systems are). A value of 1983.5 is acceptable for
         all IRAS data.                                         [1983.5]
      }
      \sstsubsection{
         FILE = LITERAL (Read)
      }{
         The name of the text file containing specifications of the
         text strings to be written.
      }
      \sstsubsection{
         FONT = INTEGER (Read)
      }{
         Font number of the text string. See GKS user guide for details
         about the available fonts.
      }
      \sstsubsection{
         HEIGHT = REAL (Read)
      }{
         Specifies the height of the character in the text string. It
         should be given as the fraction of the horizontal dimension of
         the displayed image. On entry, it is 0.02, that is, 1/50 of
         the width of the displayed image.
      }
      \sstsubsection{
         IN = NDF (Read)
      }{
         The NDF from which to read the astrometry information. This
         will usually be the NDF holding the displayed image. A null
         value will cause the astrometry to be located using
         information stored within the AGI database. If this cannot be
         done, then the user will be re-prompted for an NDF using
         parameter IN.  If a section of an NDF is specified, the curves
         are only drawn over the specified section of the picture.   [!]
      }
      \sstsubsection{
         JUST = LITERAL (Read)
      }{
         Specifies the disposition of the text string with respect to
         the given position on the displayed image. The first character
         of JUST should be one of B, C and T, specifies whether the
         given position is to lie on the bottom, centre, or top edge of
         the string. The second should be one of L, C and R and
         specifies whether the given position is lie on the left,
         centre or right edge of the string. Only first two characters
         in JUST will be used. On entry it is set to \texttt{'}BC\texttt{'}.
      }
      \sstsubsection{
         LAT = LITERAL (Read)
      }{
         The latitude at which a text string is to be written, in the
         coordinate system specified by COORDS (eg if COORDS was
         EQUATORIAL, LAT should be given a Declination value).  See
         section \ref{SEC:SKY} for more information on available
         sky coordinate systems.
      }
      \sstsubsection{
         LOGFILE = LITERAL (Read)
      }{
         The name of the log text file containing the information
         about the written text strings. See the NOTES section about
         the format of this file.
      }
      \sstsubsection{
         LON = LITERAL (Read)
      }{
         The longitude at which a text string is to be written, in the
         coordinate system specified by COORDS (eg if COORDS was
         EQUATORIAL, LON should be given a Right Ascension value).  See
         section \ref{SEC:SKY} for more information on available
         sky coordinate systems.
      }
      \sstsubsection{
         LOOP = LOGICAL (Read)
      }{
         If true then the routine does not exit when the final text
         string has been written. Instead, the user is allowed to
         modify the current drawing by selecting from the options
         provided by parameter OPTION.                              [NO]
      }
      \sstsubsection{
         MODE = LITERAL (Read)
      }{
         The source from which text string specifications are obtained.

         CURSOR - All positions are specified by cursor. This mode will
         only be available on graphic devices which support cursors.

         KEYBOARD - Positions are specified in response to parameter
         prompts, using the keyboard.

         FILE - Strings are drawn according to the specifications
         contained within a text file (see parameter FILE). This is
         referred to as \texttt{"}non-interactive\texttt{"} mode. The run-time default is
         CURSOR if a cursor is available, and KEYBOARD otherwise.     []
      }
      \sstsubsection{
         MSG\_FILTER = LITERAL (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).  [current message filter setting]
      }
      \sstsubsection{
         OPTION = LITERAL (Read)
      }{
         The action to take once all strings have been written. It can
         take following values:

          CONTINUE - Continue to draw further text strings.

          MODE - Change the source from which further text string
          specifications will be obtained.

          ATTRIBUTES - Set the attributes of any further text strings to
          be written.

          SAVE - Save information describing the text strings written so
          far to a text file.

          ERASE - Erase the last write text string.

          EXIT - Exit the application.

         This parameter is only prompted for if parameter LOOP has a
         true value.
      }
      \sstsubsection{
         PEN = INTEGER (Read)
      }{
         Pen number used to write the texts. On entry the pen number is
         set to 3.
      }
      \sstsubsection{
         RATIO = REAL (Read)
      }{
         Specifies the aspect ration (Width/Height) of the characters
         in the text string. On entry it is set to 2/3.
      }
      \sstsubsection{
         SPACE = REAL (Read)
      }{
         The space between characters in text strings, as a fraction of
         the width of a character. On entry it is set to 0 which means
         no extra space between characters and results in the text
         being of normal appearance. It can be negative which results
         in the characters overlapping.
      }
      \sstsubsection{
         TEXT = LITERAL (Read)
      }{
         The text string to be written at a specified position.
      }
   }
   \sstnotes{
      \sstitemlist{

         \sstitem
         The strings are drawn within the current picture only if it is
         a DATA picture, otherwise strings are drawn in the last DATA
         picture to be created within the current picture.

         \sstitem
         The astrometry information used to position the strings is
         located using the following search path:

         \sstitemlist{

            \sstitem Firstly, astrometry information is looked for in any NDF
            specified on the command line using parameter IN.

            \sstitem Secondly, astrometry information is looked for in any MORE
            structure associated with the AGI picture.

            \sstitem Thirdly, astrometry information is looked for in any
            reference object associated with the AGI picture.

            \sstitem If all else fails, the value of the IN parameter is
            cancelled, and the user is prompted for the NDF containing
            relevant astrometry information.
         }

         \sstitem
         This routine can only be used to display strings over NDFs
         which contain astrometry information in the form used by the
         IRAS90 package.

         \sstitem
         The format of input and output text files is:

         \sstitemlist{

            \sstitem The file is divided into comments and fields. Comments
            consist of strings commencing with a \texttt{"}\#\texttt{"} character, and are
            considered to extend to the end of the line. Such comments are
            ignored. Fields are strings which specify any of the items of
            information described below. Each line in the file may contain
            any number of fields, multiple fields being separated by
            commas. Blank lines or fields are ignored.

            \sstitem The first field should give the name of the sky coordinate
            system used (see section \ref{SEC:SKY}).

            \sstitem There should then follow a block of fields defining the text
            strings to be written and the positions at which to write
            them. A position and text string takes three consecutive
            fields. The first and second fields are the longitude and
            latitude of the position. The third field is the string to be
            written to the position. The string may be delimited by single
            or double quote marks, which will be ignored. If a blank string
            is to be written, it MUST be delimited by quote marks.

            \sstitem Fields containing the key words DIRECTION, HEIGHT, ASPECT
            RATIO, JUSTIFICATION, FONT, SPACE, PEN and DEFAULT set up the
            attributes to be used for writing any remaining text strings.
            Keywords can be abbreviated, and are case insensitive.

            \sstitem A field containing the keyword DIRECTION should be followed
            by two fields giving the direction vector of the text with X
            component first, and Y component second.

            \sstitem A field containing the keyword HEIGHT should be followed by
            a single field giving the text height.

            \sstitem A field containing the keyword ASPECT RATIO should be
            followed by a single field giving the character aspect ration
            (width/height).

            \sstitem A field containing the keyword JUSTIFICATION should be
            followed by a single field giving the disposition of the text
            string with respect to the specified position.

            \sstitem A field containing the keyword FONT should be followed by a
            single field giving the font number.

            \sstitem A field containing the keyword SPACE should be followed by a
            single field giving the space between characters.

            \sstitem A field containing the keyword PEN should be followed by a
            single field giving the pen number.

            \sstitem A field containing the keyword DEFAULT causes the default
            text attributes to be re-established.
         }
      }
   }
}

\sstroutine{
   TRACECRDD
}{
   Display detector data streams from a CRDD file
}{
   \sstdescription{
      This routine displays a set of vertically displaced traces
      representing the data from selected detectors in a specified CRDD
      file. Many normally defaulted parameters provide control over the
      content and layout of the display. Some of the other features
      provided include:

      \sstitemlist{

         \sstitem
         The ability to loop round, re-drawing the display with
         modified parameter values until the required effect is produced,
         or using any of the other features listed below.

         \sstitem
         The ability to use a graphics cursor to read sample values and
         positions from the display.

         \sstitem
         The ability to overlay standard point source profiles on top of
         sources visible in the data traces.

         \sstitem
         The ability to assign a \texttt{"}quality\texttt{"} to samples selected using
         a graphics cursor (see section \ref{SEC:QUAL} for more
         information about the use of quality in IRAS90).

      }
      Some of these features may be controlled using a primative \texttt{"}Graphical
      User Interface\texttt{"}.
   }
   \sstusage{
      TRACECRDD NDF DETS XLIMIT YLIMIT
   }
   \sstparameters{
      \sstsubsection{
         COMMENT = LITERAL (Read)
      }{
         A comment to store with a quality name. This parameter is used
         if the quality specified by parameter QNAME is not currently
         defined within the input NDF.
      }
      \sstsubsection{
         COORDS = LITERAL (Read)
      }{
         Specifies the coordinate system used when displaying sample
         positions. Valid values include ECLIPTIC, EQUATORIAL,
         GALACTIC. See section \ref{SEC:SKY} for more information
         on available sky coordinate systems.
                                         [current sky coordinate system]
      }
      \sstsubsection{
         CURSOR = \_LOGICAL (Read)
      }{
         If a true value is supplied, then the \texttt{"}Graphical User
         Interface\texttt{"} will be used (if possible). Otherwise, a parameter
         interface will be used.                                 [FALSE]
      }
      \sstsubsection{
         DATA = \_REAL (Write)
      }{
         This is an output parameter to which is written the last data
         value displayed using the \texttt{"}Get Data Value\texttt{"} option (selected
         using parameter NEXT or through the \texttt{"}Graphical User
         Interface\texttt{"}).
      }
      \sstsubsection{
         DATDET = \_INTEGER (Write)
      }{
         This is an output parameter to which is written the last
         detector number displayed using the \texttt{"}Get Data Value\texttt{"} or \texttt{"}Draw
         Point Source\texttt{"} options (selected using parameter NEXT or
         through the \texttt{"}Graphical User Interface\texttt{"}).
      }
      \sstsubsection{
         DETS = LITERAL (Read)
      }{
         A group of detector numbers, selected from those available in
         the IRAS waveband of the data contained in the input CRDD
         file. The display includes traces for each of these detectors.
         See section \ref{SEC:DET} for more information on
         specifying groups of detector numbers. The suggested default
         consists of all the detectors which pass within the range of
         cross scan distances given by parameter XSCAN (the cross scan
         distance is the minimum distance between the detector track and
         the CRDD file reference point). If no detectors fall in this
         range then all detectors are included in the suggested default
         value.
      }
      \sstsubsection{
         DEVICE = DEVICE (Read)
      }{
         The plotting device.                  [Current graphics device]
      }
      \sstsubsection{
         HISTORY = \_LOGICAL (Read)
      }{
         Determines if history information is to be added to the NDF in
         the event of the \texttt{"}Assign Quality\texttt{"} option being selected using
         the parameter NEXT or through the \texttt{"}Graphical User Interface\texttt{"}.
         See section \ref{SEC:HIS} for more information on
         history.                              [current history setting]
      }
      \sstsubsection{
         LOGFILE = LITERAL (Read)
      }{
         The name of a text file to which the results of the \texttt{"}Get Data
         Value\texttt{"} and \texttt{"}Draw Point Source\texttt{"} options (selected using
         parameter NEXT or through the \texttt{"}Graphical User Interface\texttt{"}) will
         be written. No file is created if these options are not used,
         or if a null value is supplied.                             [!]
      }
      \sstsubsection{
         LOOP = LOGICAL (Read)
      }{
         If a false value is supplied, the application produces the
         display and then returns immediately without allowing the user
         to use any of the additional features. If a true value is
         supplied, then the user may repeatedly re-draw the display
         with different parameter values, or use any of the other
         features selected by parameter NEXT, or through the \texttt{"}Graphical
         User Interface\texttt{"}.                                         [TRUE]
      }
      \sstsubsection{
         MSG\_FILTER = INTEGER (Read)
      }{
         The level of information displayed on the users screen. This
         should take one of the values QUIET, NORMAL or VERBOSE (see
         section \ref{SEC:MSG}).  [current message filter setting]
      }
      \sstsubsection{
         NDF = NDF (Update)
      }{
         The NDF holding the CRDD to be displayed. This is updated by
         any new quality assignments made using the \texttt{"}Assign Quality\texttt{"}
         option selected using parameter NEXT or through the \texttt{"}Graphical
         User Interface\texttt{"}.
      }
      \sstsubsection{
         NEXT = LITERAL (Read)
      }{
         Specifies the action to be performed once the initial display
         has been produced. If parameter LOOP has a false value, this
         parameter is ignored. It can take the following values (or any
         un-ambiguous abbreviation):

            QUIT - Leave the application.

            REDRAW DISPLAY - Re-draw the display.

            CHANGE PARAMETERS - Change some of the parameters which
            determine the appearance of the display.

            GET DATA VALUE - Get the values and positions of samples
            selected using the graphics cursor.

            DRAW POINT SOURCE - Display a standard point source template
            overlayed on the display at a position specified either by
            the graphics cursor or by parameters SRCDET, SRCPSN and
            SRCPEAK.

            ASSIGN QUALITY - Assign a nominated quality to samples
            selected using the graphics cursor.

         If the \texttt{"}Graphical User Interface\texttt{"} is being used (see parameter
         CURSOR), then the parameter NEXT is not used, but these
         options can be selected from a menu using the graphics cursor.
      }
      \sstsubsection{
         OFFSET = \_REAL (Read)
      }{
         This parameter specifies an array of offsets by which each
         trace is to be vertically displaced in the display. It is only
         used if the parameter SPACE is given the value FREE.
      }
      \sstsubsection{
         OMIT = LITERAL (Read)
      }{
         A group expression specifying objects to be omitted from the
         display. Any combination of the following items can be
         specified:

            IN-LINE - The in-line detector number labels plotted within
            a gap in each data trace.

            LABEL\_X - The X axis label.

            LABEL\_Y - The Y axis label.

            SCANDIR - The scan direction indicator.

            MARKS\_RHS - The right hand detector offset markers.

            MARKS\_LHS - The left hand detector offset markers
            (including detector numbers).

            TABLE - The table of detector offsets.

            REF\_POS - The description of the reference position.

         In addition the string NOTHING can be given to indicate that
         no sections should be omitted from the display (a null value
         has the same effect).  Section names can be abbreviated. If an
         ambiguous abbreviation is supplied, than all sections matching
         the abbreviation are omitted from the display. Thus, for
         instance, the string \texttt{"}M\texttt{"} would cause both left and right hand
         markers to be omitted.                                [NOTHING]
      }
      \sstsubsection{
         PARAM = LITERAL (Read)
      }{
         Specifies which aspect of the display is to be modified if the
         \texttt{"}Change Parameters\texttt{"} option is selected using parameter NEXT.
         It can take the following values (or any un-ambiguous
         abbreviation):

            REDRAW DISPLAY - Redraw the display using the new parameter
            values.

            DET\# - Change the detectors which are displayed by giving a
            list of detector numbers. This also causes new Y limits and
            trace offsets to be calculated and used. New detectors may
            also be selected using the CROSS SCAN option.

            DEVICE - Change the graphics device. The display is redrawn
            immediately if this option is selected.

            X LIMIT - Change the limits of the X axis of the display.
            This also causes new Y limits and trace offsets to be
            calculated and used.

            Y LIMIT - Change the limits of the Y axis of the display.
            This causes new trace offsets to be calculated and used.

            TITLE - Change the title displayed at the top of the
            display.

            COMMAND SOURCE - Toggles between the \texttt{"}Graphical User
            Interface\texttt{"} and the parameter interface as the means of
            getting commands.

            OFFSET METHOD - Change the offsets by which each trace is
            displaced vertically in the display.

            DISPLAY STRUCTURE - Select a list of features to be omitted
            from the display.

            QUALITY EXPRESSION - Only display samples which satisfy a
            given quality expression.

            CROSS SCAN - Change the detectors which are displayed by
            giving a maximum cross scan distance. This also causes new
            Y limits and trace offsets to be calculated and used. New
            detectors may also be selected using the DET\# option.

         If the \texttt{"}Graphical User Interface\texttt{"} is being used (see parameter
         CURSOR), then the parameter PARAM is not used, but these
         options can be selected from a menu using the graphics cursor.
      }
      \sstsubsection{
         PEAK = \_REAL (Write)
      }{
         This is an output parameter to which is written the last
         source peak value displayed using the \texttt{"}Draw Point Source\texttt{"}
         option (selected using parameter NEXT or through the
         \texttt{"}Graphical User Interface\texttt{"}).
      }
      \sstsubsection{
         PROFILES = NDF (Read)
      }{
         An NDF holding in-scan point source profiles to be used by the
         \texttt{"}Draw Point Source\texttt{"} option selected using parameter NEXT or
         through the \texttt{"}Graphical User Interface\texttt{"}. The default value is
         the files \texttt{"}profiles.sdf\texttt{"} contained in the main IRAS90
         directory, which contains profiles taken from the IRAS Catalogs
         and Atlases Explanatory Supplement, page V-14.               []
      }
      \sstsubsection{
         PTITLE = LITERAL (Read)
      }{
         A title for the top of the display. The run time default value
         is the input NDF name.                                       []
      }
      \sstsubsection{
         PXSIZE = \_REAL (Read)
      }{
         The horizontal size of the display in metres. If a value less
         than the default is requested, the the display will appear at
         the bottom left of the current device.                       []
      }
      \sstsubsection{
         PYSIZE = \_REAL (Read)
      }{
         The vertical size of the display in metres. If a value less
         than the default is requested, then the display will appear at
         the bottom left of the current device.                       []
      }
      \sstsubsection{
         QEXP = LITERAL (Read)
      }{
         A quality expression giving the quality of samples which are
         to be included in the display. See section \ref{SEC:QUAL}
         for information about the use of quality.
         A value of \texttt{"}ANY\texttt{"} causes all samples to be used, without regard
         to quality.                                               [ANY]
      }
      \sstsubsection{
         QNAME = LITERAL (Read)
      }{
         The quality name to be assigned to the selected samples in the
         event of the \texttt{"}Assign Quality\texttt{"} option being selected (by the
         parameter NEXT or through the \texttt{"}Graphical User Interface\texttt{"}).  If
         the supplied name is not already defined within the input NDF,
         then a definition of the name is added to the NDF. The user is
         warned if the quality name is already defined within the NDF.
      }
      \sstsubsection{
         SCNPSN = \_REAL (Write)
      }{
         This is an output parameter consisting of an array of two
         values. The first is the last in-scan position and the second
         is the last cross-scan position displayed using the \texttt{"}Get Data
         Value\texttt{"} or \texttt{"}Draw Point Source\texttt{"} options (selected using parameter
         NEXT or through the \texttt{"}Graphical User Interface\texttt{"}).
      }
      \sstsubsection{
         SKYPSN = \_DOUBLE (Write)
      }{
         This is an output parameter consisting of an array of two
         values. The first is the last sky longitude and the second
         is the last sky latitude displayed using the \texttt{"}Get Data
         Value\texttt{"} or \texttt{"}Draw Point Source\texttt{"} options (selected using parameter
         NEXT or through the \texttt{"}Graphical User Interface\texttt{"}). Both values
         are in radians.
      }
      \sstsubsection{
         SPACE = LITERAL (Read)
      }{
         Specifies the method by which the vertical offset for each
         detector trace is to be found. It can take any of the following
         values (or any un-ambiguous abbreviation):

            FREE - The user specifies the offsets explicitly using
            parameter OFFSET.

            CONSTANT - The offset markers are evenly spaced along the
            display Y axis. This results in the actual traces not being
            evenly spaced unless the input data has been destriped.

            AVERAGE - The offset markers are spaced so that the average
            data value in each traces are evenly spaced. Thus the traces
            are evenly spaced but the offset markers may not be.
                                                               [AVERAGE]
      }
      \sstsubsection{
         SRCDET = \_INTEGER (Read)
      }{
         The detector number specifying the trace on which a point
         source template is to be overlayed. This parameter is only
         used if no graphics cursor is available.
      }
      \sstsubsection{
         SRCPEAK = \_REAL (Read)
      }{
         The peak value of the point source template to be overlayed (in
         the same units as the Y axis). This parameter is only used if
         no graphics cursor is available.
      }
      \sstsubsection{
         SRCPSN = \_REAL (Read)
      }{
         The in-scan positions (in arc-minutes) at which a point source
         template is to be overlayed. This parameter is only used if no
         graphics cursor is available.
      }
      \sstsubsection{
         UNITS = LITERAL (Read)
      }{
         The units in which the data values are to be displayed. See
         section \ref{SEC:UNITS} for a list of the available units.    [Jy]
      }
      \sstsubsection{
         XLIMIT = \_REAL (Read)
      }{
         The upper and lower limits of the X axis, in arc-minutes. The
         origin of the X axis is the position of closest approach to
         the reference position specified within the input CRDD file.
         The suggested default values include all the data in the input
         NDF.
      }
      \sstsubsection{
         XNAME = LITERAL (Read)
      }{
         If the NDF already contains any quality name definitions then
         new quality names are put in the same extension as the old
         names. If no previous quality names have been stored in the
         NDF then parameter XNAME will be used to obtain the name of an
         NDF extension in which to store new quality name. The
         extension will be created if it does not already exist (see
         parameter XTYPE).                               [QUALITY\_NAMES]
      }
      \sstsubsection{
         XSCAN = REAL (Read)
      }{
         A range of cross-scan distance (in arc-minutes) from the CRDD
         file reference point to be used when selecting the list of
         detectors. If only a single value is supplied, the limits are
         considered to be equal and opposite.                     [-5,5]
      }
      \sstsubsection{
         XTYPE = LITERAL (Read)
      }{
         If a new NDF extension is created to hold quality names (see
         parameter XNAME), then parameter XTYPE is used to obtain the
         HDS data type for the created extension. The run time default
         is to give the extension a type identical to its name.       []
      }
      \sstsubsection{
         YLIMIT = \_REAL (Read)
      }{
         The upper and lower limits of the Y axis, in the units
         specified by parameter UNITS.
      }
   }
   \sstexamples{
      \sstexamplesubsection{
         TRACECRDD CENA\_B1S3
      }{
         This command would display traces from the CRDD file CENA\_B1S3.
         The user is prompted for parameters DETS, XLIMIT and YLIMIT
         before the traces are drawn. After the traces have been drawn
         the user is prompted for parameter NEXT which gives options for
         re-drawing the display with different parameter values, using
         the cursor to get data values from the display, etc.
      }
      \sstexamplesubsection{
         TRACECRDD CENA\_B1S3 DEVICE=CANON NOLOOP $\backslash$
      }{
         This is like the previous example except that the NOLOOP
         keyword causes the application to terminate as soon as the
         display has been drawn, and the output goes to a Canon laser
         printer. Note, the \texttt{"}$\backslash$\texttt{"} character causes the suggested defaults
         for parameters DETS, XLIMIT and YLIMIT to be accepted without
         prompting the user. This sort of command is useful if a plot
         is to be produced in a situation in which there is no user to
         interact with (eg from a batch job). The statement NEXT=QUIT
         is equivalent to the NOLOOP keyword.
      }
      \sstexamplesubsection{
         TRACECRDD CENA\_B1S3 CURSOR QEXP=FRED.AND.TOM
      }{
         This causes the \texttt{"}Graphical User Interface\texttt{"} to be used for
         obtaining values for the parameters NEXT and PARAM, rather than
         the keyboard. In addition, only those samples which have both
         the qualities FRED and TOM are displayed.
      }
   }
   \sstdiytopic{
      The Display
   }{
      The contents of the display can be controlled using the parameter
      OMIT. This allows various parts of the display to be optionally
      omitted.

      The main item in the display is the rectangular area containing
      the actual data traces (the \texttt{"}data area\texttt{"}). The bottom edge of this
      rectangle has a scale indicating distance along the scan in
      arc-minutes. The value zero is assigned to the point in the scan
      which is closest to the reference position of the input CRDD
      file. This reference position is displayed to the left of the
      data area. The extent of this scale is determined by parameter
      XLIMIT.

      The right hand edge of the data area has a scale indicating data
      value. The units of this scale are specified by the parameter
      UNITS, and its extent is specified by parameter YLIMIT.

      The detectors from which data is to be displayed are specified
      using parameter DETS. The data traces are offset vertically
      within the data area, and are shifted horizontally so that the
      \texttt{"}mis-alignment\texttt{"} caused by the detectors being at varying in-scan
      positions within the focal plane, is removed. The detector
      corresponding to each trace is indicated by means of an \texttt{"}in-line
      label\texttt{"} towards the left end of the trace. If the default KAPPA
      pallette is in effect, the in-line labels will be green (on
      colour devices). Only those samples which satisfy the quality
      expression given by parameter QEXP are included in the traces.
      Bad or missing sample values are indicated by gaps in the traces.
      The base level for each trace is indicated by a pair of \texttt{"}offset
      markers\texttt{"}, one on each of the vertical edges of the data area.
      These offset markers are short green horizontal lines placed at
      the position which corresponds to zero flux for the trace to
      which they refer (the detector number to which the offset markers
      refer is displayed just above the left hand offset marker).

      The data area is surrounded by a \texttt{"}frame area\texttt{"} containing
      annotation of various types. This includes a title above the data
      area specified by parameter PTITLE. The X axis label is fixed, and
      the Y axis label indicates the units used on the Y axis.

      The traces are always drawn such that the end of the scan which is
      closest to the southern ecliptic pole is at the left, and this is
      indicated by annotations \texttt{"}South\texttt{"} and \texttt{"}North\texttt{"} at the left and right
      ends of the bottom edge of the data area. An arrow placed between
      these annotations indicates the direction in which the scan was
      taken (south to north or north to south). The arrow indicates the
      direction of increasing time (i.e a sample at the blunt end of
      the arrow was taken earlier than one at the sharp end).

      A table of detector offsets is displayed to the left of the data
      area. This lists the offsets of each displayed trace. So to
      determine a sample value by eye, one would read off the data value
      from the scale on the left hand edge of the data area, and then
      subtract the offset for the detector listed in the offset table.
      In fact it is much easier to use the \texttt{"}Get Data Value\texttt{"} option to do
      this! (see parameter NEXT). The table also lists the \texttt{"}cross scan
      distance\texttt{"} of each trace. This is the offset (in arc-minutes) from
      the CRDD file reference position to the detector track (positive
      in the same sense as the focal plane Z coordinate).

      All graphics are produced within the sub-region of the current
      AGI picture, specified by parameters PXSIZE and PYSIZE (by default
      the entire picture is used). Two new pictures are created within
      the AGI database; a DATA picture corresponding to the data area,
      and a FRAME picture corresponding to the frame area.
   }
   \sstdiytopic{
      Modifying Parameter Values
   }{
      The default parameter values usually produce a reasonable
      display.  However there may be some situations in which
      parameters need to be changed, for instance to \texttt{"}zoom in\texttt{"} on a
      particular feature of interest, to change the graphics device, or
      to omit sections of the display prior to producing a hard copy.
      If the parameter LOOP is given a true value (which is the
      default), the user is asked to specify a further action once the
      display has been produced (see parameter NEXT). One option is
      \texttt{"}Change Parameters\texttt{"}. This allows several of the parameters which
      determine the appearance of the display to be changed before
      redrawing the display. The parameter to change is specified by
      giving an appropriate value for the parameter PARAM.
   }
   \sstdiytopic{
      Getting Sample Values and Positions
   }{
      Sample values and positions can be estimated by eye from the
      display, but it is generally easier and more accurate to use a
      graphics cursor. This can be done by taking the \texttt{"}Get Data Value\texttt{"}
      option (specified by the parameter NEXT or through the \texttt{"}Graphical
      User Interface\texttt{"}). If the current graphics device has a cursor,
      the user is asked to position the cursor at the point of
      interest. The user does not need to position the cursor exactly
      on a trace; the closest trace will always be used. Various items
      of information are then displayed about the selected point; the
      sample value (without the offset used to vertically displace the
      traces), the sample coordinates (in the coordinate system
      specified by parameter COORDS), the sample number, detector
      number, NDF row number and in-scan position.  The user may then
      give another position. Control returns to the application when
      the user gives a position which lies outside the data area.

      The information displayed by this option is logged to the text
      file specified by parameter LOGFILE, and is also written to the
      output parameters DATA, DATDET, SCNPSN and SKYPSN.
   }
   \sstdiytopic{
      Overlaying Point Source Profiles
   }{
      An NDF containing four standard point source profiles (one for
      each wave band) is distributed with IRAS90. These profiles are
      taken from the IRAS Catalogs and Atlases Explanatory Supplement
      (page V-14). They may be displayed at any point within the data
      area in order to compare a feature in the data with a point
      source. This is done by selecting the \texttt{"}Draw Point Source\texttt{"} option
      for parameter NEXT or through the \texttt{"}Graphical User Interface\texttt{"}. The
      user is then requested to place the graphics cursor at the
      position at which the peak of the profile should be put. A sloping
      background is then estimated from the neighbouring data in the
      closest trace, and the profile is drawn (in red assuming the
      standard KAPPA pallette is in use) so that the peak is at the
      requested position and the zero level corresponds to the local
      background in the data. The position and peak value of the source
      is then displayed, and the user is asked to repeat the process
      until a position outside the data area is given.

      The information displayed by this option is logged to the text
      file specified by parameter LOGFILE, and is also written to the
      output parameters PEAK, DATDET, SCNPSN and SKYPSN.

      If the graphics device has no cursor, then the position of the
      peak may be specified by parameters SRCDET, SRCPSN, and SRCPEAK.
      If for any reason the user wishes to display profiles other than
      those taken from the Explanatory Supplement, then a copy of the
      file \texttt{"}profiles.sdf\texttt{"} (contained in the main IRAS90 directory)
      should be taken and suitable modifications made.  The modified
      file may then be given for parameter PROFILES.
   }
   \sstdiytopic{
      Assigning a Quality to Selected Samples
   }{
      A general introduction to the use of quality is described in the
      section \ref{SEC:QUAL}. TRACECRDD provides a means of
      assigning nominated qualities to samples in a CRDD file selected
      using a graphical interface. To do this the user should select
      the \texttt{"}Assign Quality\texttt{"} option for the parameter NEXT (or through
      the \texttt{"}Graphical User Interface\texttt{"}). The user is then asked to
      position the graphics cursor to indicate two diagonally opposite
      corners of a box on the display. A quality name is then obtained
      using parameter QNAME and this quality is assigned to all the
      samples which fall within the box defined by the two corner
      positions.  Note, the input CRDD file is updated rather than a
      new output CRDD file being created). The samples to which the
      quality is assigned are highlighted in the display by being
      re-drawn in red (assuming the default KAPPA pallette is in use).
      If the quality name is not defined in the CRDD file then a
      definition is created, including a comment string given by
      parameter COMMENT. If necessary, an extension is created within
      the NDF to hold the quality name. The HDS name and type of this
      extension are given by parameters XNAME and XTYPE.
   }
   \sstdiytopic{
      The Graphical User Interface
   }{
      By default, the user selects options by assigning suitable values
      to the parameters described in the \texttt{"}ADAM parameters\texttt{"} section.
      Alternatively, a primative form of \texttt{"}Graphical User Interface\texttt{"} (GUI)
      can be used for selecting the options normally determined by
      parameters NEXT and PARAM. This alternative is only available if
      the graphics workstation has a graphics cursor and also has the
      facility for clearing sub-regions of the display. If this is the
      case, the user may select the GUI either by giving the parameter
      CURSOR a true value on the command line, or by selecting the
      \texttt{"}Command Source\texttt{"} option for the parameter PARAM.

      The GUI provides the user with menus of options displayed on the
      graphics display as a series of boxes, each containing a
      description of an option. The user selects an option by
      positioning the cursor over a box and pressing any key. The menu
      is erased once a valid choice has been made. The parameter
      interface can be reinstated by selecting the \texttt{"}Command Source\texttt{"}
      option from the menu produced by selecting the \texttt{"}Change Parameters\texttt{"}
      option.
   }
}

\end{small}
\newpage
\section{IRAS90 Under UNIX}
\label{ap:unixdif}
Although the {\small UNIX} and {\small VMS} implementations of {\small
IRAS90} are similar, there are differences. These are the same as for
{\small KAPPA} and are described in \xref{SUN/95}{sun95}{} (``{\small UNIX}
Differences'').

\section{The IRAS NDF Extension}
Various {\small IRAS90} applications store information within an ``{\small NDF}
extension''. This is an {\small HDS} data structure which is ``tagged on'' to
the main {\small NDF} structure, and is named ``IRAS''. It is used to store
information which futher describes the data in the main {\small NDF} data array.
Typical items are the waveband (12, 25, 60 or 100 $\mu$m), the instrument
(survey array or {\small CPC}), etc. The contents of the extension depends on
what sort of data is stored in the {\small NDF} and on what processing has been
applied to the data. {\small IRAS90} applications will read the information
stored in the {\small IRAS} extension, use it, and write new information to it,
as necessary.

The extension contains some components which are data structures rather than
simple numerical or string values. Of these, the most important are:

\begin{description}
\item [CRDD\_INFO] - Used to store information describing {\small IRAS90}
{\small CRDD} files (waveband, boresight pointing information, etc).
\item [IMAGE\_INFO] - Used to store information describing {\small IRAS90}
images (waveband, name of the application which created the image, etc)
\item [ASTROMETRY] - Used to store information describing the position on the
sky of each image pixel.
\item [QUALITY\_NAMES] - Used to store the quality names which are currently
defined in an image or {\small CRDD } file.
\end{description}

The structure and content of the {\small IRAS} extension is described in detail
in various additional {\small IRAS90} documents, distributed with the package.
These documents are intended for people who want to write their own {\small
IRAS90} applications, and are described in the ``{\small IRAS90} Programmers
Guide'', \xref{SUN/165}{sun165}{}.

\section{Converting IRAS Data in BDF Format to NDF Format}
The application {\small NDFOUT} from the {\small INTERIM} package
{\small EDRSX}, (see \xref{SUN/38}{sun38}{} and \xref{SUN/39}{sun39}{}) can be used to convert old data
files in the ``Bulk Data File '' ({\small BDF}) format into {\small
NDF} format suitable for use by  {\small IRAS90} and {\small KAPPA}.
{\small NDFOUT} can convert both {\small CRDD} files and image files,
and creates an {\small IRAS NDF} extension containing information read
from  the {\small BDF} descriptors. For this reason  it is to be
preferred to the {\small BDF2NDF} application from the {\small CONVERT}
package. To start up {\small NDFOUT}, use the following commands:

\small
\begin{terminalv}
$ DSCL GO EDRSX
EDRSX> NDFOUT
\end{terminalv}
\normalsize

\section{An Example of a Colour Temperature Procedure}
\label{APP:MAS}
This appendix describes an {\small ICL} procedure called {\small MASTER}
which is distributed with the {\small VMS} version of {\small IRAS90}. It
performs an entire reduction process, starting from two groups of ``raw''
{\small CRDD} files (covering the same region of the sky but at different
wavelengths), and produces surface brightness, colour temperature and optical
depth maps. The procedure was optimised for a particular field and may well
not be ideally suited to other types of field. It should be use as the
basis for further experimentation and customisation. The source for the
procedure is in the file {\small IRAS90\_DIR:MASTER.ICL} ({\small VMS} only).
To run the procedure as it stands, the following commands should be used:

\small
\begin{terminalv}
$ ADAM
ICL> IRAS90
ICL> KAPPA
ICL> LOAD IRAS90_DIR:MASTER
ICL> MASTER ^HCON2_B1.LIS ^HCON2_B2.LIS M51_TEMP M51_TAU
\end{terminalv}
\normalsize

This assumes that the text files {\small HCON2\_B1.LIS} and {\small HCON2\_B2.LIS}
contain lists of the raw {\small CRDD} files to be used. The temperature and
optical depth images are put in {\small M51\_TEMP.SDF} and {\small M51\_TAU.SDF}. Other
files are created by {\small MASTER} as described in the procedure prologue.

The production of a colour temperature map involves dividing one of
the surface brightness images by the other. This process tends to amplify any
residual stripes present in the two surface brightness images, especially in
background regions. For this reason, {\small MASTER} pays particular
attention to achieving good destriping.

\small
\begin{terminalv}
PROC MASTER INA INB TEMP TAU
{+
{  Name:
{     MASTER
{
{  Purpose:
{     Create colour temperature and optical depth maps from two sets
{     of raw CRDD files.
{
{  Type of Module:
{     ICL command procedure.
{
{  Invocation:
{     MASTER INA INB TEMP TAU
{
{  Description:
{     This procedure is an example of the way IRAS90 can be used to
{     create surface brightness maps and colour temperature maps.
{     It is intended to form a basis for users own experimentation,
{     and is not intended to be a fool proof, all-singing, all-dancing
{     tool.
{
{     Particular attention is paid to achieving low stripes in the
{     surface brightness maps. The resolution of the surface
{     brightness maps are matched by simulating data from each of the
{     two original maps using the detector PSFs of the other band. The
{     resulting simulated data is then mapped again. Background
{     subtraction is performed by BACKCRDD, resulting in the image
{     having a global background of (roughly) zero.
{
{  Parameters:
{     INA = LITERAL (Read)
{        A group expression giving the raw CRDD files from the first
{        band.
{     INB = LITERAL (Read)
{        A group expression giving the raw CRDD files from the second
{        band.
{     TEMP = NDF (Write)
{        The output NDF which is to receive the colour temperature
{        map.
{     TAU = NDF (Write)
{        The output NDF which is to receive the optical depth map.
{
{  Notes:
{     -  In addition to the above parameters which must be supplied
{     on the command line, the user is prompted for:
{
{        1)  Dimensions of the mapped area. If one value is given a
{        square area is assumed.
{
{        2)  Dimensions of a map pixel. If one value is given the
{        pixels are assumed to be square.
{
{        3) The emmisivity spectral index (see COLTEMP parameter
{        BETA).
{
{        4) The optical depth wavelength (see COLTEMP parameter
{        WAVEL).
{
{     -  The following intermediate files are left on disk after the
{     procedure has completed (where * represents the group of input
{     CRDD files):
{
{        1) *_DS.SDF - The final destriped CRDD files.
{
{        2) *_BK.SDF - The final background subtracted CRDD files.
{
{        3) MAPA.SDF - The surface brightness image formed from the
{           CRDD files specified by parameter INA.
{
{        4) MAPA.SDF - The surface brightness image formed from the
{           CRDD files specified by parameter INB.
{
{        5) MAPA_SM.SDF - MAPA smoothed to a common resolution.
{
{        6) MAPB_SM.SDF - MAPB smoothed to a common resolution.
{
{        7) MAPA_SMT.SDF - MAPA_SM thresholded to remove values close
{           to zero.
{
{        8) MAPB_SMT.SDF - MAPB_SM thresholded to remove values close
{           to zero.
{
{  Authors:
{     D.S. Berry (STARLINK)
{     {enter_new_authors_here}
{
{  History:
{     23-JUN-1993 (DSB):
{        Original version.
{     {enter_changes_here}
{
{  Bugs:
{     {note_any_bugs_here}
{
{-
{
{  Get all required information.
{
INPUT  "Dimensions of map (arc-mins): " (BSIZ)
INPUTR "Pixel size in arcminutes: " (PIXSIZ)
INPUTR "Emmisivity spectral index: " (BETA)
INPUTI "Wavelength at which optical depth is required (microns): " ~
       (WAVEL)
PRINT
{
{  An initial map is made using the standard destriping and background
{  removal technique. Samples excluded from the estimation of detector
{  offsets by DESTCRDD are also excluded from the scan background
{  estimates. This is done by flagging such samples with the quality
{  MASTER_SOURCE. Note, a list of the background subtracted CRDD
{  files is kept in file BK.LIS.
{
PRINT "  Making initial map from " (INA)
DESTCRDD IN=(INA) OUT=*_DS QNAME=MASTER_SOURCE BACKSIGMA=(SIGMA)
BACKCRDD OUT=*|_DS|_BK| QEXP=.NOT.MASTER_SOURCE ACCEPT
DCL COPY SYS$LOGIN:IRAS90_NDFS.LIS []BK.LIS
MAPCRDD OUT=MASTER_MAP1 PIXSIZE=(PIXSIZ) BOXSIZE=(BSIZ) ACCEPT
{
{  Save MAPCRDD parameters which define the map centre. These values
{  will be used for all other maps in order to ensure that they are
{  aligned.
{
GETPAR MAPCRDD CENTRE_LON (LON)
GETPAR MAPCRDD CENTRE_LAT (LAT)
{
{  Create an image in which source regions hold bad values. This is
{  done by thresholding the initial map created above. All pixels with
{  values outide the range -5*SIGMA to +5*SIGMA are set bad, where
{  SIGMA is the spread in background values found by DESTCRDD. Note,
{  THRESH does not currently use NDF origins (in effect the origin is
{  assumed to be at [1,1]) and so the origin of the thresholded image
{  must be set back to its correct value by using SETORIGIN. When
{  THRESH is upgraded to use the ful facilities of the NDF structure,
{  the following section can be simplified.
{
PRINT "  Identifing source regions"
THRESH OUTPIC=MASTER_MAP2 THRLO=(-5*SIGMA) THRHI=(5*SIGMA) NEWLO=BAD ~
       NEWHI=BAD ACCEPT
SETORIGIN LIKE=MASTER_MAP1 ACCEPT
{
{  Generate simulated CRDD from the background map. Source samples
{  will be bad in these CRDD files.
{
SIMCRDD IN=(INA) SKY=MASTER_MAP2 OUT=MM_*_SIM
{
{  Asssign quality MASTER_SOURCE to samples in the background
{  subtracted CRDD files which corrrespond to bad samples in the
{  simulated CRDD.
{
SETQUAL NDF=^BK.LIS QNAME=MASTER_SOURCE MASK=^SYS$LOGIN:IRAS90_NDFS.LIS
{
{  Now CRDD files with better destriping, by omiting source samples
{  from the destriping and background estimation. Note, the cleaning
{  algorithms used by DESTCRDD and BACKCRDD are switched off to avoid
{  backcrdd samples being rejected. A linear background is fitted to
{  each CRDD file.
{
PRINT "  Repeating the destriping and background removal on " (INA)
DESTCRDD IN=^BK.LIS OUT=*|_BK|_DS| QEXP=.NOT.MASTER_SOURCE BOX=0 ~
         BACKSIGMA=(SIGA)
BACKCRDD TYPE=LINEAR CLIP=1E6 OUT=*|_DS|_BK| QEXP=.NOT.MASTER_SOURCE ~
         ACCEPT
{
{  Now do it again, using the new _BK CRDD files as input.
{
DESTCRDD IN=^BK.LIS OUT=*|_BK|_DS| QEXP=.NOT.MASTER_SOURCE BOX=0 ~
         BACKSIGMA=(SIGA)
BACKCRDD TYPE=LINEAR CLIP=1E6 OUT=*|_DS|_BK| QEXP=.NOT.MASTER_SOURCE ~
         ACCEPT
{
{  Now create a map.
{
MAPCRDD OUT=MAPA PIXSIZE=(PIXSIZ) CENTRE_LON=(LON) CENTRE_LAT=(LAT) ~
        BOXSIZE=(BSIZ) ACCEPT
{
{  Now do just the same for band B.
{
PRINT "  Making initial map from " (INB)
DESTCRDD IN=(INB) OUT=*_DS QNAME=MASTER_SOURCE BACKSIGMA=(SIGMA)
BACKCRDD OUT=*|_DS|_BK| QEXP=.NOT.MASTER_SOURCE ACCEPT
DCL COPY SYS$LOGIN:IRAS90_NDFS.LIS []BK.LIS
MAPCRDD OUT=MASTER_MAP1 CENTRE_LON=(LON) CENTRE_LAT=(LAT) ~
        PIXSIZE=(PIXSIZ) BOXSIZE=(BSIZ) ACCEPT
PRINT "  Identifing source regions"
THRESH OUTPIC=MASTER_MAP2 THRLO=(-5*SIGMA) THRHI=(5*SIGMA) NEWLO=BAD ~
       NEWHI=BAD ACCEPT
SETORIGIN LIKE=MASTER_MAP1 ACCEPT
SIMCRDD IN=(INB) SKY=MASTER_MAP2 OUT=MM_*_SIM
SETQUAL NDF=^BK.LIS QNAME=MASTER_SOURCE MASK=^SYS$LOGIN:IRAS90_NDFS.LIS
PRINT "  Repeating the destriping and background removal on " (INB)
DESTCRDD IN=^BK.LIS OUT=*|_BK|_DS| QEXP=.NOT.MASTER_SOURCE BOX=0 ~
         BACKSIGMA=(SIGB)
BACKCRDD TYPE=LINEAR CLIP=1E6 OUT=*|_DS|_BK| QEXP=.NOT.MASTER_SOURCE ~
         ACCEPT
DESTCRDD IN=^BK.LIS OUT=*|_BK|_DS| QEXP=.NOT.MASTER_SOURCE BOX=0 ~
         BACKSIGMA=(SIGB)
BACKCRDD TYPE=LINEAR CLIP=1E6 OUT=*|_DS|_BK| QEXP=.NOT.MASTER_SOURCE ~
         ACCEPT
MAPCRDD OUT=MAPB PIXSIZE=(PIXSIZ) CENTRE_LON=(LON) CENTRE_LAT=(LAT) ~
        BOXSIZE=(BSIZ) ACCEPT
{
{  Now smooth the band A map using the satellite response for band B.
{
PRINT "  Smoothing first map"
SIMCRDD SKY=MAPA IN=(INB) OUT=MM_*_SIM
MAPCRDD PIXSIZE=(PIXSIZ) OUT=MAPA_SM CENTRE_LON=(LON) CENTRE_LAT=(LAT) ~
        BOXSIZE=(BSIZ) ACCEPT
SETIMAGE NDF=MAPA_SM LIKE=MAPA ACCEPT
{
{  Now smooth the band B map using the satellite response for band A.
{
PRINT "  Smoothing second map"
SIMCRDD SKY=MAPB IN=(INA) OUT=*_SIM
MAPCRDD PIXSIZE=(PIXSIZ) OUT=MAPB_SM CENTRE_LON=(LON) CENTRE_LAT=(LAT) ~
        BOXSIZE=(BSIZ) ACCEPT
SETIMAGE NDF=MAPB_SM LIKE=MAPB ACCEPT
{
{  Now threshold the two images to remove values close to zero (such
{  values can cause very large temperatures).
{
PRINT "  Thresholding the smoothed images"
THRESH INPIC=MAPA_SM OUTPIC=MAPA_SMT THRLO=(3*SIGA) THRHI=1E12 ~
       NEWLO=BAD NEWHI=BAD
SETORIGIN LIKE=MAPA_SM ACCEPT
THRESH INPIC=MAPB_SM OUTPIC=MAPB_SMT THRLO=(3*SIGB) THRHI=1E12 ~
       NEWLO=BAD NEWHI=BAD
SETORIGIN LIKE=MAPB_SM ACCEPT
{
{  Now produce the colour termperature and optical depth maps
{
PRINT "  Creating colour temperature and optical depth images"
COLTEMP IN1=MAPA_SMT IN2=MAPB_SMT BETA=(BETA) TEMP=(TEMP) TAU=(TAU) ~
        WAVEL=(WAVEL)
{
{  Tidy up.
{
DCL DELETE MASTER_MAP%.SDF;*,MM_*_SIM.SDF;*,BK.LIS;*
DCL PURGE *_DS.SDF,*_BK.SDF
{
ENDPROC
\end{terminalv}
\normalsize

\end{document}

