^$STARLINK_DIR/share/smurf/dimmconfig.lis

# *** Specialized config for measuring flatfields with fridge oscillations ***
#
# The purpose of this config is to measure the amplitude of the fridge
# fluctuations. Polynomial baselines are removed from both the
# bolometer and dark-squid data (hopefully removes the bulk of
# presumed longer-timescale sky fluctuations). The solution uses the
# COM/GAI model to fit the primary oscillations which are produced by
# fridge variations, and DKS is also used in case there is strong
# magentic field pickup. Otherwise there is no special filtering of
# the data. The relative amplitudes of each detector are stored in the
# exported "GAI" model component (first 2d plane). There is no
# extinction correction because we are not interested in astronomical
# signal units.
#
# Note that if this configuration is used with a scan of a
# particularly bright source there could be significant contamination.
#
# It is probably a good idea to use large map pixel sizes. We're not
# really interested in the map at all, and this will probably help
# reduce the impact of astronomical sources (which will be wrong from
# detector-to-detector because we don't flatfield the data in advance
# using the heaters).
#
# ****************************************************************************

# Don't flatfield using heaters since the point is an independent measurement
ensureflat = 0

# Just a fixed number of iterations
numiter = 5

# Just common-mode and dark-squids
modelorder = (com,gai,dks,ast,noi)
exportndf = (com,gai,qua)

# ----------------------------------------------------------------------------
# The following parameters control data-cleaning before iterations start
# ----------------------------------------------------------------------------

# No padding
padstart = 0
padend = 0

# No apodization
apod = 0

# higher-order polynomial for baselines
order = 5

# Match dark squid apodization to main data array
cleandk.apod = 0
cleandk.order = 5

# ----------------------------------------------------------------------------
# These parameters control the iterative model components
# ----------------------------------------------------------------------------

# weaker bolo rejection
com.corr_tol = 7
com.gain_tol = 7
com.gain_abstol = 5

# treat common-mode using a single chunk
com.gain_box = 600000

# Only fit a gain for the common-mode, no offset.
com.offset_is_zero = 1

# weaker spike detection
noi.spikethresh = 50
noi.spikebox = 50

# Switch off apodisation in the FLT model
flt.apod = 0

