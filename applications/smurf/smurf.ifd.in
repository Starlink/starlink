# -*- tcl -*-
#+
#  Name:
#     smurf.ifd

#  Purpose:
#     Specify interface files and package structure for SMURF.

#  Language:
#     Tcl

#  Type of Module:
#     Full IFD file.

#  Invocation:
#     ifd2star smurf

#  Description:
#     This file controls the generation of all the interface files for
#     the SMURF package (.ifl files for the ADAM environment) By processing
#     it using  IFD commands (see SSN/68) all of the following files are
#     produced without further intervention:
#
#        ifd2star:
#           task.ifl (for each task)
#           monolith.ifl (for each monolith)
#           smurf.csh
#           smurf.sh
#           smurf.icl
#
#     The task and monolith files are generated by including individual
#     .ifd files (using the tcl core command 'source') to make source
#     control easier.  The smurf.{csh,icl,cl} files are generated to
#     some extent automatically from the contents of the individual task
#     .ifd files included here, but additional sections are added using
#     the csh, icl and cl commands in this file.

#  Notes:
#     The files generated by processing this file (as listed above) are
#     to be included without modification in the built SMURF package
#     with the following exceptions.
#
#     This file is tcl source code.

#  Copyright:
#     Copyright (C) 2007-2012 Science and Technology Facilities Council.
#     Copyright (C) 2005-2009 University of British Columbia.
#     Copyright (C) 2005-2006 Particle Physics & Astronomy Research Council.
#     All Rights Reserved.

#  Licence:
#     This program is free software; you can redistribute it and/or
#     modify it under the terms of the GNU General Public License as
#     published by the Free Software Foundation; either Version 3 of
#     the License, or (at your option) any later version.
#
#     This program is distributed in the hope that it will be
#     useful, but WITHOUT ANY WARRANTY; without even the implied
#     warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
#     PURPOSE. See the GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program; if not, write to the Free Software
#     Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
#     02110-1301, USA.

#  Authors:
#     TIMJ: Tim Jenness (JAC, Hawaii)
#     AGG: Andy Gibb (UBC)
#     EC: Ed Chapin (UBC)
#     JB: Jennifer Balfour (UBC)
#     COBA: Coskun Oba (UoL)
#     MJC: Malcolm J. Currie (JAC, Hawaii)
#     MS: Matt Sherwood (UoL)
#     {enter_new_authors_here}

#  History:
#     27-SEP-2005 (TIMJ):
#        Original version.
#     28-SEP-2005 (EC):
#        Add makemap.
#     04-NOV-2005 (AGG):
#        Add flatfield.
#     10-NOV-2005 (AGG):
#        Add TAU to EXTINCTION
#     17-JAN-2006 (EC):
#        Add PIXRES to MAKEMAP.
#     25-JAN-2006 (AGG):
#        Add new EXTINCTION parameters.
#     04-FEB-2006 (AGG):
#        Add QUICK parameter to EXTINCTION.
#     18-FEB-2006 (AGG):
#        Add REMSKY.
#     24-FEB-2006 (AGG):
#        Add FIT parameter to REMSKY.
#     18-MAR-2006 (AGG):
#        Add QLMAKEMAP.
#     05-MAY-2006 (AGG):
#        Add SCANFIT.
#     16-MAY-2006 (EC):
#        Add METHOD to MAKEMAP.
#     29-MAY-2006 (EC):
#        Add ASTMODEL, ATMMODEL and NOISEMODEL to MAKEMAP.
#     06-JUN-2006 (AGG):
#        Add SIM and DREAMWTS actions.
#     13-JUN-2006 (AGG):
#        Add DREAMSOLVE (rename of DREAMWTS).
#     14-JUN-2006 (JB):
#        Add SIMTYPE to SIM and add positional args to SIM.
#     17-JUN-2006 (EC):
#        Add CONFIG to MAKEMAP and modify the output NDF parameter settings.
#     14-JUL-2006 (JB):
#        Rename SIM to SC2SIM.
#     27-JUL-2006 (TIMJ):
#        Add initial MAKECUBE parameters.
#     13-SEP-2006 (JB):
#        Add BADBOLOS & made SC2SIM seed optional.
#     15-SEP-2006 (AGG):
#        Rename DREAMWEIGHTS.
#     22-SEP-2006 (JB):
#        Changed OBSXMLFILE & SIMXMLFILE to OBSFILE & SIMFILE
#     12-OCT-2006 (AGG):
#        Add GROUP keyword for REMSKY.
#     13-OCT-2006 (JB):
#        Add USEBAD to MAKEMAP.
#     26-OCT-2006 (AGG):
#        Add STARECALC.
#     01-NOV-2006 (TIMJ):
#        Add SMURFHELP.
#        Add help location.
#     20-NOV-2006 (DSB):
#        Added AUTOGRID parameter for MAKECUBE.
#     29-NOV-2006 (DSB):
#        Added SPECBOUNDS parameter for MAKECUBE.
#     11-JAN-2007 (DSB):
#        Added UBOUND and LBOUND parameters for MAKECUBE.
#     12-JAN-2007 (AGG):
#        Added SYSTEM parameter for MAKEMAP and QLMAKEMAP.
#     26-JAN-2007 (AGG):
#        Added OVERWRITE parameter for SC2SIM.
#     30-JAN-2007 (TIMJ):
#        Add jcmtstate2cat.
#     01-MAR-2007 (AGG):
#        Add SIMSTATS parameter for SC2SIM.
#     28-MAR-2007 (TIMJ):
#        Add missing helpkey.
#     10-MAY-2007 (TIMJ):
#        Add dumpocscfg.
#     15-JUN-2007 (TIMJ):
#        Add gettsys.
#     05-OCT-2007 (AGG):
#        Add default value of 1.8 for skynoise exponent
#     19-OCT-2007 (TIMJ):
#        Add RAWUNPRESS.
#     25-OCT-2007 (DSB):
#        Added SPECUNION, POLBINSIZE and NPOLBIN for MAKECUBE.
#     8-NOV-2007 (DSB):
#        Added action TIMESORT.
#     18-DEC-2007 (DSB):
#        Added parameter REF to MAKECUBE.
#     17-JAN-2008 (DSB):
#        Added parameter ALIGNSYS to MAKECUBE.
#     25-JAN-2008 (DSB):
#        Add UNMAKECUBE.
#     05-FEB-2008 (JB):
#        Added action GSD2ACSIS.
#     12-FEB-2008 (DSB):
#        Added parameter POLBINZERO to MAKECUBE.
#     12-FEB-2008 (AGG):
#        Add USEBAD parameter to QLMAKEMAP.
#     13-FEB-2008 (AGG):
#        Add SPREAD and PARAMS to MAKEMAP and QLMAKEMAP.
#     16-MAR-2008 (BZ):
#        Added action SC2FTS.
#     27-MAR-2008 (EC):
#        Add SC2CLEAN.
#     16-APR-2008 (AGG):
#        Remove USEBAD, add GENVAR for QLMAKEMAP.
#     21-APR-2008 (JB):
#        Add action GSDSHOW.
#     24-APR-2008 (AGG):
#        Change SIMFILE/OBSFILE to SIMPAR/OBSPAR for SKYNOISE.
#     24-APR-2008 (EC):
#        Added MAXMEM to MAKEMAP.
#     09-MAY-2008 (AGG):
#        Remove USEBAD parameter, set MAXMEM default to 2048 for MAKEMAP.
#     09-MAY-2008 (TIMJ):
#        Add EXTINCTION:HASSKYREM
#     05-JUN-2008 (TIMJ):
#        Add F* parameters to MAKEMAP.
#        Add ALIGNSYS to MAKEMAP.
#        Add REF to MAKEMAP.
#     23-JUL-2008 (EC):
#        Add SC2FFT.
#     27-JUL-2008 (EC):
#        Add OUT parameter to SC2CONCAT.
#     13-NOV-2008 (AGG):
#        Add NAVER parameter to STARECALC.
#     12-DEC-2008 (TIMJ):
#        Add BPM masking param.
#     01-JAN-2009 (EC):
#        Add FLAGSTAT to SC2CLEAN.
#     27-MAR-2009 (TIMJ):
#        Add CALCRESP.
#     2009-03-30 (TIMJ):
#        Add OUTFILES to all routines.
#     2-JUL-2009 (DSB):
#        Added EXTRACOLS parameter to MAKECUBE.
#     29-JUL-2009 (TIMJ):
#        Change MSG_FILTER defaulting from NORM to ! to support
#        new msgIfget behaviour.
#     14-OCT-2009 (TIMJ):
#        Alphabetize. Remove MSG_FILTER definitions.
#     2010-01-20 (TIMJ):
#        Use starperl in perl aliases.
#     2010-02-09 (AGG):
#        Add NGOOD output parameter for SC2FFT.
#     2010-07-15 (TIMJ):
#        Remove REFRES parameters since now included in RESIST config file.
#     2010-07-19 (COBA):
#        Add FTS2_FLATFIELD, FTS2_FREQCORR, FTS2_PORTIMBAL,
#            FTS2_REMOVEBSE, FTS2_SPATIALWCS, FTS2_TRANSCORR.
#     2010-09-17 (COBA):
#        Add FTS2_DEGLITCH.
#     2010-09-20 (COBA):
#        Add FTS2_PHASECORR.
#     2010-09-21 (COBA):
#        FTS2 ADAM params are alphabetically ordered.
#     2010-09-30 (COBA):
#        Add FTS2_EQSLICED.
#     2010-10-04 (COBA):
#        Replace zpdIndex with 2D zpd array ndf for FTS2_PHASECORR.
#     2010-10-28 (COBA):
#        Minor changes to FTS2 interface.
#     2010-11-03 (COBA):
#        Add FTS2SPECRE.
#     2010-11-25 (COBA):
#        Add FTS2INIT.
#     2010-11-26 (COBA):
#        - Removed ZPD param from FTS2DEGLITCH.
#        - Removed ZPD param from FTS2PHASECORR.
#     2011-03-18 (EC):
#        Add sc2pca.
#     2011-05-28 (RPT):
#        Add mcehead2cat.
#     2011-06-08 (DSB):
#        Add UNMAKEMAP.
#     2011-07-18 (COBA):
#        Remove FTS2EQSLICED.
#        Remove FTS2SPECRE.
#        Add FTS2SPECTRUM.
#        Update FTS2PHASECORR
#     2011-08-04 (COBA):
#        Replaced FTS2PHASECORR with FTS2PHASECORRDS and FTS2PHASECORRSS
#     2011-09-07 (TIMJ):
#        On balance I think the RESIST parameter should always use the default
#        unless there is a specific override. Silently reusing an old value
#        can be confusing.
#     2011-10-18 (COBA):
#        Updated FTS2PHASECORR, FTS2PHASECORRDS and FTS2SPECTRUM
#     2012-04-20 (TIMJ):
#        Remove QLMAKEMAP
#     2012-05-10 (AGG):
#        Added STEPTIME to rawfitmeta
#     2012 August 23 (MJC):
#        Restore alphabetical order.
#     2012 September 17 (MJC):
#        Replace SC/19 with SC/21 in startup messages.
#     2013-05-08 (MSHERWOOD):
#        Add FTS2SPLIT
#     2013-07-03 (MSHERWOOD):
#        Add fts2gaia
#     2013-09-04 (MS):
#        Add low resolution bandpass parameter (in +/- mm from centre) to fts2split
#     2013-11-10 (MS):
#        Add optional rtsdelay parameter to compensate for RTS timing delay for FTS-2 mirror position
#     2014-03-28 (MS):
#        Add optional spectral filter profile (sfp) parameter to fts2spectrum for sub-array specific calibration files
#     2014-04-16 (MS):
#        Add optional Nyquist frequency (fNyquist) parameter to fts2init
#        to override default calculated value of 50.0 when SCANVEL is at the usual rate of 4.2 mm/sec
#     2014-04-17 (MS):
#        Revise fts2spectrum resolution parameter to directly enter the desired spectral resolution value
#        The default resolution is 0.005, but one could enter any sensible alternative as an override
#     2014-06-06 (MS):
#        Add optional fts2spectrum SFP WN range overrides
#        - This applies to either the 850 or 450 band spectral filter profile wave number ranges, whichever is current
#     {enter_further_changes_here}

#  Bugs:
#     {note_any_bugs_here}

#-
package @PACKAGE@ {
    version @PACKAGE_VERSION@
    prefix @PACKAGE@

    executable @PACKAGE@_mon {

        action badbolos {

            helplib {$SMURF_HELP}

            parameter ard {
                type _CHAR
                access READ
                vpath {PROMPT }
                prompt {Input ARD Description File}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter bad_bolos {
                position 4
                type _INTEGER
                prompt {Number of additional bad individual bolometers}
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter bad_columns {
                position 2
                type _INTEGER
                prompt {Number of bad columns of bolometers}
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter bad_rows {
                position 3
                type _INTEGER
                prompt {Number of bad rows of bolometers}
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter in {
                position 1
                type _CHAR
                access READ
                vpath {PROMPT }
                prompt {Input Simulated NDF File}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter method {
                type _CHAR
                prompt {Bad bolometer generation method}
                default RANDOM
                helpkey *
            }

            parameter seed {
                position 5
                type _INTEGER
                vpath DEFAULT
                default !
                helpkey *
            }

        }

        action calcdark {

            helplib {$SMURF_HELP}

            parameter bbm {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Bad bolometer masks}
                default !
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input dark timeseries}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Processed darks}
                helpkey *
            }

        }

        action calcflat {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input flatfield files}
                helpkey *
            }

            parameter method {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath PROMPT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter ngood {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                prompt {Number of good responsivities}
                default 0
                helpkey *
            }

            parameter order {
                type _INTEGER
                access READ
                vpath PROMPT
                vpath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                ppath DYNAMIC
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Processed flatfield file}
                helpkey *
            }

            parameter resist {
                position 3
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter resp {
                type NDF
                access WRITE
                vpath {PROMPT }
                ppath CURRENT DEFAULT
                prompt {Responsivity map}
                default !
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                ppath CURRENT
                default TRUE
                helpkey *
            }

            parameter snrmin {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

        }

        action calcnoise {

            helplib {$SMURF_HELP}

            parameter config {
                type LITERAL
                access READ
                ppath CURRENT DEFAULT
                default {^$STARLINK_DIR/share/smurf/dimmconfig_calcnoise.lis}
                prompt {Configuration parameters for cleaning}
                helpkey *
            }

            parameter effnep {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                prompt {Effective NEP of subarray}
                default 0
                helpkey *
            }

            parameter effnoise {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                prompt {Effective noise of subarray}
                default 0
                helpkey *
            }

            parameter flow {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                prompt {Frequency to use for noise ratio image}
                helpkey *
            }

            parameter freq {
                size *
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                prompt {Frequency limits for white noise calculation}
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input files containing flatfield parameters}
                helpkey *
            }

            parameter nepcliphigh {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                prompt {Clip NEP values this many standard deviations above median}
                helpkey *
            }

            parameter nepcliplog {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                prompt {Clip based on log of the NEP}
                helpkey *
            }

            parameter nepcliplow {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default 3
                prompt {Clip NEP values this many standard deviations below median}
                helpkey *
            }

            parameter nepgoodbol {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                prompt {Number of bolometers with good NEP measurements}
                default 0
                helpkey *
            }

            parameter noicliphigh {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                prompt {Clip NOISE values this many standard deviations above median}
                helpkey *
            }

            parameter noicliplog {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                prompt {Clip based on log of the NOISE}
                helpkey *
            }

            parameter noicliplow {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default 3
                prompt {Clip NOISE values this many standard deviations below median}
                helpkey *
            }

            parameter noisegoodbol {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                prompt {Number of bolometers with good NOISE measurements}
                default 0
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                ppath DYNAMIC CURRENT
                vpath {PROMPT }
                prompt {Noise images}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter power {
                type NDF
                access WRITE
                ppath CURRENT DEFAULT
                vpath {PROMPT }
                default !
                prompt {Power spectra files}
                helpkey *
            }

            parameter tseries {
                type NDF
                access WRITE
                ppath CURRENT DEFAULT
                vpath {PROMPT }
                default !
                prompt {Cleaned time-series files}
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action calcqu {

            helplib {$SMURF_HELP}

            parameter arcerror {
                type _REAL
                prompt {Max spatial shift in one time-slice block (arc-secs)}
                vpath DYNAMIC CURRENT DEFAULT
                ppath DYNAMIC CURRENT DEFAULT
                default 1.0
                helpkey *
            }

            parameter config {
                type LITERAL
                access READ
                ppath CURRENT DEFAULT
                vpath DEFAULT
                prompt {Configuration parameters}
                default !
                helpkey *
            }

            parameter harmonic {
                type _INTEGER
                prompt {The half-wave plate harmonic to use}
                vpath DEFAULT
                ppath DEFAULT
                default 4
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter fix {
                type _LOGICAL
                prompt {Fix triggering issue?}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

            parameter lsqfit {
                type _LOGICAL
                prompt {Use least-squares method?}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

            parameter maxsize {
                type _INTEGER
                prompt {Max no. of time slices in one block (0=no limit)}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default 0
                helpkey *
            }

            parameter minsize {
                type _INTEGER
                prompt {Min no. of time slices in one block}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default 200
                helpkey *
            }

            parameter north {
                type LITERAL
                prompt {System to use as the reference direction}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default TRACKING
                helpkey *
            }

            parameter outf {
                type NDF
                access WRITE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                prompt {Output fitted data NDFs}
                helpkey *
            }

            parameter outfilesi {
                type LITERAL
                prompt {New text file holding list of output I NDFs}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter outfilesq {
                type LITERAL
                prompt {New text file holding list of output Q NDFs}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter outfilesu {
                type LITERAL
                prompt {New text file holding list of output U NDFs}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter outi {
                type NDF
                access WRITE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                prompt {Output I NDFs}
                helpkey *
            }

            parameter outq {
                position 2
                type NDF
                access WRITE
                association ->GLOBAL.DATA_ARRAY
                prompt {Output Q NDFs}
                helpkey *
            }

            parameter outu {
                position 3
                type NDF
                access WRITE
                prompt {Output U NDFs}
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action calcresp {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input files containing flatfield parameters}
                helpkey *
            }

            parameter ngood {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                prompt {Number of good responsivities in each file}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                ppath DYNAMIC CURRENT
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Responsivity images}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

        }

        action checkcoords {
            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input timeseries}
                helpkey *
            }

        }

        action copyflat {

            helplib {$SMURF_HELP}

            parameter in {
                position 2
                type NDF
                access WRITE
                ppath DYNAMIC CURRENT
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Files to receive the updated flatfield information}
                helpkey *
            }

            parameter ref {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input file containing flatfield parameters to copy}
                helpkey *
            }

        }

        action dreamsolve {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input data file}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association ->GLOBAL.DATA_ARRAY
                prompt {Output data file}
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action dreamweights {

            helplib {$SMURF_HELP}

            parameter config {
                position 3
                type LITERAL
                access READ
                vpath {PROMPT }
                ppath CURRENT DEFAULT
                default !
                prompt {DREAM reconstruction parameters}
                helpkey *
            }

            parameter ndf {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input raw data file}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association ->GLOBAL.DATA_ARRAY
                prompt {Output weights file}
                helpkey *
            }

        }

        action dsutils {

            helplib {$SMURF_HELP}

            parameter bmap {
                type LITERAL
                prompt {File in which to put focal plane pixel to sky mapping}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter border {
                type _INTEGER
                prompt {Width of border to exclude form each time slice (in pixels)}
                default 4
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter colname {
                type LITERAL
                prompt {Name of a columne to write to an output NDF}
                ppath CURRENT DEFAULT
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter colndf {
                type NDF
                access WRITE
                prompt {Output NDF for values read from COLNAME column}
                ppath CURRENT
                helpkey *
            }

            parameter forward {
                type _LOGICAL
                prompt {Produce code for forward transformation?}
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

            parameter fpixsize {
                type _DOUBLE
                prompt {Pixel size in focal plane units (mm)}
                vpath CURRENT DEFAULT
                default 1
                helpkey *
            }

            parameter fxhi {
                type _DOUBLE
                prompt {Upper focal plane X limit, in mm}
                vpath CURRENT DEFAULT
                default 50
                helpkey *
            }

            parameter fxlo {
                type _DOUBLE
                prompt {Lower focal plane X limit, in mm}
                vpath CURRENT DEFAULT
                default -50
                helpkey *
            }

            parameter fxoff {
                type _DOUBLE
                prompt {Focal plane X value at ref point, in mm}
                ppath CURRENT DEFAULT
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter fyhi {
                type _DOUBLE
                prompt {Upper focal plane Y limit, in mm}
                vpath CURRENT DEFAULT
                default 50
                helpkey *
            }

            parameter fylo {
                type _DOUBLE
                prompt {Lower focal plane Y limit, in mm}
                vpath CURRENT DEFAULT
                default -50
                helpkey *
            }

            parameter fyoff {
                type _DOUBLE
                prompt {Focal plane Y value at ref point, in mm}
                ppath CURRENT DEFAULT
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input time series cube}
                helpkey *
            }

            parameter infitx {
                type NDF
                access READ
                vpath DEFAULT
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                default !
                prompt {NDF containing polynomial fit for X distortion}
                helpkey *
            }

            parameter infity {
                type NDF
                access READ
                vpath DEFAULT
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {NDF containing polynomial fit for Y distortion}
                default !
                helpkey *
            }

            parameter incat {
                type LITERAL
                prompt {Name of input catalogue text file}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter itime {
                type _INTEGER
                prompt {Index of time slice to dump to an output NDF}
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter lowfactor {
                type _REAL
                prompt {Factor for lowest usable data sum}
                ppath CURRENT DEFAULT
                default 0.5
                helpkey *
            }

            parameter niter {
                type _INTEGER
                prompt {Number of sigma clips}
                default 3
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter outang {
                type NDF
                access WRITE
                prompt {Output NDF holding focal-plane distortion angles}
                ppath CURRENT
                helpkey *
            }

            parameter outcat {
                type LITERAL
                prompt {Name of output catalogue text file}
                ppath CURRENT
                helpkey *
            }

            parameter outcode {
                type LITERAL
                prompt {Name of output C source file}
                ppath CURRENT
                helpkey *
            }

            parameter outdx {
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF holding focal-plane X offsets}
                helpkey *
            }

            parameter outdy {
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF holding focal-plane Y offsets}
                helpkey *
            }


            parameter outfx {
                type NDF
                access WRITE
                vpath {DEFAULT}
                default !
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF holding focal-plane X coords}
                helpkey *
            }

            parameter outfy {
                type NDF
                access WRITE
                vpath {DEFAULT}
                default !
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF holding focal-plane Y coords}
                helpkey *
            }

            parameter outmag {
                type NDF
                access WRITE
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF holding focal-plane distortion magnitudes}
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                default !
                helpkey *
            }

            parameter outslice {
                type NDF
                access WRITE
                prompt {Output NDF holding time slice data}
                ppath CURRENT
                helpkey *
            }

            parameter radius {
                type _REAL
                prompt {Radius of test circle (in bolometers)}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }
            parameter subarray {
                type LITERAL
                prompt {SCUBA-2 sub-array name}
                ppath CURRENT DEFAULT
                default s8d
                helpkey *
            }
            parameter xbol {
                type _INTEGER
                prompt {X GRID index of test bolometer}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }
            parameter ybol {
                type _INTEGER
                prompt {Y GRID index of test bolometer}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }
            parameter zbox {
                type _INTEGER
                prompt {Smoothing box for timeslice data (in slices)}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

        }

        action extinction {

            helplib {$SMURF_HELP}

            parameter bbm {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Bad bolometer masks}
                default !
                helpkey *
            }

            parameter csotau {
                type _REAL
                prompt {Zenith optical depth at 225 GHz}
                ppath DYNAMIC CURRENT
                helpkey *
            }

            parameter filtertau {
                type _REAL
                prompt {Zenith optical depth for current filter}
                ppath DYNAMIC CURRENT
                helpkey *
            }

            parameter hasskyrem {
                type _LOGICAL
                vpath {DEFAULT}
                prompt {Has sky removal been applied?}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter method {
                position 4
                type _CHAR
                vpath {PROMPT }
                prompt {Method to use for airmass calculation}
                ppath CURRENT
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF data structure}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter taurel {
                type LITERAL
                default !
                prompt {Group containing tau relationships}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter tausrc {
                position 3
                type _CHAR
                prompt {Source of opacity data}
                helpkey *
            }

            parameter wvmlog {
                type LITERAL
                prompt {Text file in which to write processed WVM data}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action findslices {

            helplib {$SMURF_HELP}

            parameter closest {
                type _LOGICAL
                access READ
                vpath default
                ppath current default
                prompt {Display only closest time slices?}
                default TRUE
                helpkey *
            }

            parameter frame {
                position 5
                type NDF
                access READ
                vpath default
                ppath current default
                prompt {NDF defining coordinate frame}
                default !
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                association <-GLOBAL.DATA_ARRAY
                prompt {NDFs containing time-series data}
                helpkey *
            }

            parameter radius {
                position 4
                type _DOUBLE
                access READ
                vpath default
                ppath current default
                prompt {Radius of search circle in arc-sec}
                default 300
                helpkey *
            }

            parameter xpos {
                position 2
                type LITERAL
                access READ
                ppath CURRENT
                prompt {X position at search centre}
                helpkey *
            }

            parameter ypos {
                position 3
                type LITERAL
                access READ
                ppath CURRENT
                prompt {Y position at search centre}
                helpkey *
            }

        }

        action fit1d {

            helplib {$SMURF_HELP}

            parameter config {
                position 4
                type LITERAL
                access READ
                ppath CURRENT
                vpath CURRENT
                prompt {Config file with fit parameters}
                helpkey *
                default !
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {NDF with profiles to be fitted}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {NDF for fitted profiles}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter parcomp {
                position 8
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                prompt {Component parameter files files}
                helpkey *
                default !
            }

            parameter pardir {
                position 6
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                prompt {Directory with component parameter files}
                helpkey *
                default !
            }

            parameter parndf {
                position 7
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                prompt {Input NDF with component parameter files}
                helpkey *
                default !
            }

            parameter rms {
                position 3
                type _DOUBLE
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                prompt {RMS in cube [data units]}
                helpkey *
            }

            parameter userval {
                position 5
                type LITERAL
                access READ
                ppath DEFAULT
                vpath DEFAULT
                prompt {File with user values for parameters}
                helpkey *
                default !
            }

        }

        action fitsmerge {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath PROMPT
                ppath CURRENT
                prompt {Files containing input FITS headers}
                helpkey *
            }

            parameter ndf {
               position 2
               type NDF
               access UPDATE
               vpath PROMPT
               ppath CURRENT
               prompt {File to receive merged FITS headers}
               helpkey *
            }
        }

        action fixsteps {
            helplib {$SMURF_HELP}

            parameter changed {
                type _LOGICAL
                access WRITE
                vpath DEFAULT
                prompt {Were and significant changes found?}
                default FALSE
                helpkey *
            }

            parameter config {
                type LITERAL
                access READ
                ppath CURRENT DEFAULT
                vpath CURRENT DEFAULT
                prompt {Cleaning parameters}
                default !
                helpkey *
            }

            parameter continue {
                type _LOGICAL
                prompt {Continue to report further changes?}
                ppath DEFAULT
                default YES
                helpkey *
            }

            parameter dcfitbox {
                type _INTEGER
                prompt {Number of samples in fitting box}
                ppath DYNAMIC
                vpath DYNAMIC
                helpkey *
            }

            parameter dclimcorr {
                type _INTEGER
                prompt {Threshold for correction of correlated steps}
                ppath DYNAMIC
                vpath DYNAMIC
                helpkey *
            }

            parameter dcmaxsteps {
                type _INTEGER
                prompt {Max. no. of steps before bolo is flagged as bad}
                ppath DYNAMIC
                vpath DYNAMIC
                helpkey *
            }

            parameter dcsmooth {
                type _INTEGER
                prompt {Width of median filter used to smooth data}
                ppath DYNAMIC
                vpath DYNAMIC
                helpkey *
            }

            parameter dcthresh {
                type _DOUBLE
                prompt {Threshold signal to noise ratio to detect and flag steps}
                ppath DYNAMIC
                vpath DYNAMIC
                helpkey *
            }

            parameter first {
                type _INTEGER
                prompt {Index of first changed step to report}
                ppath CURRENT DEFAULT
                vpath DEFAULT
                default 1
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input timeseries}
                helpkey *
            }

            parameter meanshift {
                type _LOGICAL
                prompt {Use a mean-shift filter before fixing steps?}
                ppath DEFAULT
                default NO
                helpkey *
            }

            parameter newsteps {
                type LITERAL
                prompt {Name of output text file holding new step descriptions}
                vpath DEFAULT
                ppath CURRENT
                default !
                helpkey *
            }

            parameter nfixed {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                prompt {Number of fixed steps}
                default 0
                helpkey *
            }

            parameter nrejected {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                prompt {Number of rejected bolometers}
                default 0
                helpkey *
            }

            parameter oldsteps {
                type LITERAL
                prompt {Name of input text file holding old step descriptions}
                vpath DEFAULT
                ppath CURRENT
                default !
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                association ->GLOBAL.DATA_ARRAY
                prompt {Cleaned timeseries}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter sizetol {
                type _DOUBLE
                prompt {Minimum significant relative error in step height}
                ppath CURRENT
                vpath DEFAULT
                default 0.05
                helpkey *
            }

        }

        action flatfield {

            helplib {$SMURF_HELP}

            parameter bbm {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Bad bolometer masks}
                default !
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input timeseries}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Flatfielded timeseries}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action fts2deglitch {

            helplib {$SMURF_HELP}

            parameter ccsize {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Core cluster size}
                default 20
                helpkey *
            }

            parameter deglitchmode {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Deglitching mode: 1=CORE, 2=TAIL and 0=ALL}
                default 0
                helpkey *
            }

            parameter dshalflength {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Double-sided interferogrm half-length}
                default 500
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }

            parameter tcsigma {
                type _DOUBLE
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Tail cutoff standard deviation as percentage}
                default 0.80
                helpkey *
            }

            parameter tcsigmamul {
                type _DOUBLE
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Tail cutoff standard deviation multiplier}
                default 4
                helpkey *
            }

            parameter tcsize {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Tail cluster size}
                default 60
                helpkey *
            }
        }

        action fts2flatfield {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }
        }

        action fts2freqcorr {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }

            parameter theta {
                position 3
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Theta file storing the off-axis angles}
                helpkey *
            }
        }

        action fts2init {

            helplib {$SMURF_HELP}

            parameter centre {
                type _REAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default 225.0
                prompt {Moving mirror position at centre of travel (mm)}
                helpkey *
            }

            parameter fnyquist {
                type _DOUBLE
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Override the default Nyquist frequency}
                default 0
                helpkey *
            }

           parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }

            parameter rtsdelay {
                type _REAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default 0.0
                prompt {RTS delay (ms)}
                helpkey *
            }

            parameter zpd {
                position 3
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {ZPD calibration file}
                helpkey *
            }
        }

        action fts2maskmap {

            helplib {$SMURF_HELP}

            parameter ftsport {
                access READ
                default TRACKING
                helpkey *
                position 3
                ppath CURRENT DEFAULT
                prompt {FTS-2 port: tracking or image}
                type _CHAR
                vpath PROMPT
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath PROMPT
                ppath CURRENT
                prompt {Input time series cubes}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output time series cubes}
                helpkey *
            }
        }

        action fts2opcorr {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }
        }

        action fts2phasecorr {

            helplib {$SMURF_HELP}

            parameter apodization {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Apodization method}
                default 0
                helpkey *
            }

            parameter degree {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Fitting polynomial degree}
                default 1
                helpkey *
            }

            parameter dshalflength {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Double-sided interferogram half-length}
                default 512
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }

            parameter pcfhalflength {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Phase correction function half-length}
                default 128
                helpkey *
            }

            parameter wnlbound {
                type _DOUBLE
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {The lower bound of the wavenumber range}
                default 0
                helpkey *
            }

            parameter wnubound {
                type _DOUBLE
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {The upper bound of the wavenumber range}
                default 0
                helpkey *
            }

        }

        action fts2phasecorrds {

            helplib {$SMURF_HELP}

            parameter degree {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Fitting polynomial degree}
                default 1
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }

            parameter wnlbound {
                type _DOUBLE
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {The lower bound of the wavenumber range}
                default 0
                helpkey *
            }

            parameter wnubound {
                type _DOUBLE
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {The upper bound of the wavenumber range}
                default 0
                helpkey *
            }
        }

        action fts2portimbal {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }
        }

        action fts2removebse {

            helplib {$SMURF_HELP}

            parameter bse {
                position 3
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Beamsplitter self emission file}
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }
        }

        action fts2spectrum {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }

            parameter resolution {
                type _DOUBLE

                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Spectral Resolution: }
                default 0.0
                helpkey *
            }

            parameter sfp {
                position 3
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {SFP calibration file}
                default !
                helpkey *
            }

            parameter wnSfpFirst {
                type _DOUBLE

                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Spectral Filter Profile Wave Number range starting from}
                default 0.0
                helpkey *
            }

            parameter wnSfpLast {
                type _DOUBLE

                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Spectral Filter Profile Wave Number range ending with}
                default 0.0
                helpkey *
            }

            parameter zeropad {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath CURRENT DEFAULT
                prompt {Zero padding}
                default 1
                helpkey *
            }
        }

        action fts2split {

            helplib {$SMURF_HELP}

            parameter bandpass {
                position 3
                type _REAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default 0.0
                prompt {Distance to extract on either side of centre (mm)}
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }
        }

        action fts2transcorr {

            helplib {$SMURF_HELP}

            parameter debug {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {If debug, does NOT include dry component!}
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Input data files}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }

            parameter tau {
                position 3
                type NDF
                access READ
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Atmospheric transmission calibration file}
                helpkey *
            }
        }

        action gau2fit {

            helplib {$SMURF_HELP}

            parameter amp2 {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                prompt {Amplitude of second Gaussian}
                default 0
                helpkey *
            }

            parameter back {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                prompt {Background level}
                default 0
                helpkey *
            }

            parameter centre {
                type LITERAL
                access WRITE
                vpath DEFAULT
                default { }
                helpkey *
            }

            parameter fitback {
                type _LOGICAL
                access READ
                ppath CURRENT DEFAULT
                vpath DEFAULT
                default TRUE
                prompt {Allow the background level to vary?}
                helpkey *
            }

            parameter fittwo {
                type _LOGICAL
                access READ
                ppath CURRENT DEFAULT
                vpath DEFAULT
                default TRUE
                prompt {Use a two-component beam?}
                helpkey *
            }

            parameter fwhm1 {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                prompt {FWHM of first Gaussian (arc-sec)}
                default 0
                helpkey *
            }

            parameter fwhm2 {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                prompt {FWHM of second Gaussian (arc-sec)}
                default 0
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter initcentre {
                type LITERAL
                access READ
                ppath DYNAMIC CURRENT
                vpath PROMPT
                prompt {WCS coords at initial source centre}
                helpkey *
            }

            parameter logfile {
                type LITERAL
                access READ
                ppath CURRENT DEFAULT
                vpath DEFAULT
                prompt {Name of log file}
                default !
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                prompt {Output data files}
                helpkey *
            }

            parameter radius {
                type _DOUBLE
                size *
                access READ
                prompt {Source radius (arc-sec)}
                helpkey *
            }

            parameter rms {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                prompt {RMS residual}
                default 0
                helpkey *
            }

        }

        action gsd2acsis {
            helplib {$SMURF_HELP}

            parameter directory {
                position 2
                type _CHAR
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output Directory}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter in {
                position 1
                type _CHAR
                access READ
                vpath {PROMPT }
                prompt {Input DAS or AOSC GSD File}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter obsnum {
                position 3
                type _INTEGER
                access WRITE
                vpath DYNAMIC PROMPT
                association ->GLOBAL.DATA_ARRAY
                prompt {Observation Number}
                ppath DYNAMIC
                helpkey *
            }

        }

        action gsdshow {
            helplib {$SMURF_HELP}

            parameter descriptions {
                position 2
                type _LOGICAL
                prompt {Show descriptions?}
                ppath DEFAULT CURRENT
                default FALSE
                helpkey *
            }

            parameter in {
                position 1
                type _CHAR
                access READ
                vpath {PROMPT }
                prompt {Input DAS or AOSC GSD File}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter showdata {
                position 3
                type _LOGICAL
                prompt {Print out data array?}
                ppath DEFAULT CURRENT
                default FALSE
                helpkey *
            }

        }

        action impaztec {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type _CHAR
                access READ
                vpath {PROMPT }
                prompt {Input AzTEC NETCDF File}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter out {
                position 2
                type _CHAR
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF file}
                ppath GLOBAL CURRENT
                helpkey *
            }

        }

        action jsadicer {
            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input map or cube}
                helpkey *
            }

            parameter instrument {
                type LITERAL
                access READ
                ppath DYNAMIC CURRENT DEFAULT
                vpath DYNAMIC PROMPT
                prompt {JCMT instrument}
                default {SCUBA-2(850)}
                helpkey *
            }

            parameter jsatilelist {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter ntile {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter out {
                position 2
                type LITERAL
                access WRITE
                prompt {Basename for output NDFs}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter trim {
                type _INTEGER
                vpath DEFAULT
                ppath CURRENT
                prompt {How to trim the output NDFs}
                default 2
                helpkey *
            }

            parameter proj {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {JSA projection}
                default "HPX"
                helpkey *
            }
        }

        action jsapaster {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input JSA tiles}
                helpkey *
            }

            parameter instrument {
                type LITERAL
                access READ
                ppath DYNAMIC CURRENT DEFAULT
                vpath DYNAMIC PROMPT
                prompt {JCMT instrument}
                default {SCUBA-2(850)}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output mosaic}
                helpkey *
            }

        }

        action jsatileinfo {
            helplib {$SMURF_HELP}

            parameter allsky {
                type NDF
                access WRITE
                vpath DEFAULT
                prompt {Output NDF containing all-sky tile indices}
                default !
                helpkey *
            }

            parameter create {
                position 3
                type _LOGICAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                prompt {Create tile NDF if it does not already exist?}
                default FALSE
                helpkey *
            }

            parameter deccen {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter exists {
                type _LOGICAL
                access WRITE
                vpath DEFAULT
                default FALSE
                helpkey *
            }

            parameter header {
                position 5
                type LITERAL
                access READ
                ppath CURRENT
                vpath DEFAULT
                prompt {File to receive a FITS header for the tile}
                default !
                helpkey *
            }

            parameter instrument {
                position 2
                type LITERAL
                access READ
                ppath DYNAMIC CURRENT DEFAULT
                vpath DYNAMIC PROMPT
                prompt {JCMT instrument}
                default {SCUBA-2(450)}
                helpkey *
            }

            parameter itile {
                position 1
                type _INTEGER
                access READ
                ppath CURRENT
                prompt {Zero-based tile index}
                helpkey *
            }

            parameter lbnd {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter local {
                type _LOGICAL
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Put the reference point at the centre of the tile?}
                default FALSE
                helpkey *
            }

            parameter maxtile {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter racen {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter region {
                position 4
                type LITERAL
                access READ
                ppath CURRENT
                vpath DEFAULT
                prompt {File to receive an AST Region for the tile}
                default !
                helpkey *
            }

            parameter size {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter target {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT
                prompt {The target Region or NDF}
                default !
                helpkey *
            }

            parameter tilendf {
                type LITERAL
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter tlbnd {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter tubnd {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter ubnd {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter proj {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {JSA projection}
                default "HPX"
                helpkey *
            }

        }

        action jsatilelist {
            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input Region or NDF}
                helpkey *
            }

            parameter instrument {
                position 2
                type LITERAL
                access READ
                ppath DYNAMIC CURRENT DEFAULT
                vpath DYNAMIC PROMPT
                prompt {JCMT instrument}
                default {SCUBA-2(850)}
                helpkey *
            }

            parameter proj {
                type _CHAR
                access WRITE
                vpath DEFAULT
                default UNKNOWN
                helpkey *
            }

            parameter tiles {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter vertex_dec {
                type _DOUBLE
                size *
                access READ
                prompt {ICRS Dec at vertices (deg.s)}
                helpkey *
            }

            parameter vertex_ra {
                type _DOUBLE
                size *
                access READ
                prompt {ICRS RA at vertices (deg.s)}
                helpkey *
            }

        }

        action makecube {

            helplib {$SMURF_HELP}

            parameter alignsys {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT
                prompt {Align data in the output spatial co-ordinate system?}
                default FALSE
                helpkey *
            }

            parameter autogrid {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT
                prompt {Determine projection parameters automatically?}
                default FALSE
                helpkey *
            }

            parameter badmask {
                type LITERAL
                ppath DEFAULT
                vpath DEFAULT
                prompt {Scheme for determining the output bad bolometer mask}
                helpkey *
                default OR
            }

            parameter catepoch {
                type _DOUBLE
                ppath DYNAMIC CURRENT
                prompt {Output catalogue epoch}
                helpkey *
            }

            parameter catframe {
                type LITERAL
                ppath DEFAULT
                vpath DEFAULT
                prompt {Output catalogue coordinate Frame}
                helpkey *
                default !
            }

            parameter crota {
                type _REAL
                prompt {Angle of north from second pixel axis in output (degs)}
                ppath DYNAMIC
                vpath DYNAMIC
                helpkey *
            }

            parameter detectors {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Names of detectors to be included}
                default !
                helpkey *
            }

            parameter extracols {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {JCMTState items to include in output catalogue}
                default !
                helpkey *
            }

            parameter fbl {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter fbr {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }


            parameter flbnd {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter fubnd {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter ftl {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter ftr {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter genvar {
                type LITERAL
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Method for calculating output variances}
                default {TSYS}
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter inweight {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Weight input spectra when combining them?}
                default TRUE
                helpkey *
            }

            parameter jsatiles {
                type _LOGICAL
                access READ
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Create the cube as a set of JSA tiles?}
                default FALSE
                helpkey *
            }

            parameter jsatilelist {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter lbnd {
                size *
                type _INTEGER
                access READ
                vpath DYNAMIC
                ppath DYNAMIC
                prompt {Lower pixel index bounds for output spatial axes}
                helpkey *
            }

            parameter lbound {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter npolbin {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter ntile {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF data structure}
                helpkey *
            }

            parameter outcat {
                type LITERAL
                access WRITE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                association ->GLOBAL.CATALOGUE
                prompt {Output positions list}
                default !
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter params {
                size *
                type _DOUBLE
                vpath PROMPT
                ppath CURRENT
                prompt {Auxiliary rebinning parameters}
                helpkey *
            }

            parameter pixref {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter pixsize {
                position 3
                type _REAL
                prompt {Output pixel size(s) for spatial part of map (arcsec)}
                ppath DYNAMIC
                vpath DYNAMIC
                helpkey *
            }

            parameter pointing {
                type _CHAR
                prompt {Text file containing pointing corrections}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter polbinsize {
                type _REAL
                prompt {Angular size of analyser angle bins (degs)}
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter polbinzero {
                type _REAL
                prompt {Angle at centre of first polarisation bin (degs)}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default 0.0
                helpkey *
            }

            parameter poserrfatal {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                prompt {Report error if RECEPPOS and FPLANEX/Y disagree?}
                default FALSE
                helpkey *
            }
            parameter poserrmax {
                type _REAL
                vpath DEFAULT
                ppath DEFAULT
                prompt {Max error between RECEPPOS and FPLANEX/Y (arcsec)}
                default 3.0
                helpkey *
            }
            parameter ref {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Reference NDF}
                default !
                helpkey *
            }

            parameter reflat {
                type LITERAL
                access READ
                ppath DYNAMIC
                vpath DYNAMIC
                prompt {Celestial latitude at output reference point}
                helpkey *
            }

            parameter reflon {
                type LITERAL
                access READ
                ppath DYNAMIC
                vpath DYNAMIC
                prompt {Celestial longitude at output reference point}
                helpkey *
            }

            parameter refpix1 {
                type _DOUBLE
                access READ
                ppath DYNAMIC
                vpath DEFAULT
                default !
                prompt {X pixel coord at output reference point}
                helpkey *
            }

            parameter refpix2 {
                type _DOUBLE
                access READ
                ppath DYNAMIC
                vpath DEFAULT
                default !
                prompt {Y pixel coord at output reference point}
                helpkey *
            }

            parameter sparse {
                type _LOGICAL
                vpath DYNAMIC DEFAULT
                ppath DYNAMIC DEFAULT
                prompt {Create a sparse output array?}
                default FALSE
                helpkey *
            }

            parameter specbounds {
                type LITERAL
                ppath DYNAMIC
                vpath DYNAMIC
                prompt {Low and high bounds for output spectral axis}
                helpkey *
            }

            parameter specunion {
                type _LOGICAL
                ppath CURRENT DEFAULT
                vpath DEFAULT
                prompt {Use union of input spectral ranges as default for SPECBOUNDS?}
                default FALSE
                helpkey *
            }

            parameter spread {
                type LITERAL
                vpath DEFAULT
                ppath DEFAULT
                prompt {Pixel spreading method}
                helpkey *
                default {Nearest}
            }

            parameter system {
                position 4
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Celestial coord system for output cube}
                default TRACKING
                helpkey *
            }

            parameter telposerrmax {
                type _DOUBLE
                vpath DEFAULT
                ppath DEFAULT
                prompt {Maximum separation between TCS ACn and DCn (arcsec)}
                default 0.0
                helpkey *
            }

            parameter tileborder {
                type _INTEGER
                prompt {Width of tile overlap in pixels}
                ppath CURRENT DEFAULT
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter tiledims {
                type _INTEGER
                prompt {Output tile dimensions in pixels}
                ppath CURRENT DEFAULT
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter trim {
                type _LOGICAL
                vpath DEFAULT
                prompt {Trim the output cube to excluded unused detectors?}
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

            parameter trimtiles {
                type _LOGICAL
                vpath DEFAULT
                prompt {Trim the output tiles?}
                ppath CURRENT DEFAULT
                default FALSE
                helpkey *
            }

            parameter ubnd {
                size *
                type _INTEGER
                access READ
                vpath DYNAMIC
                ppath DYNAMIC
                prompt {Upper pixel index bounds for output spatial axes}
                helpkey *
                type _INTEGER
            }

            parameter ubound {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter usedetpos {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT
                prompt {Read detector positions from the input NDF?}
                default TRUE
                helpkey *
            }
            parameter weights {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT
                prompt {Save pixel weights in the output NDF?}
                default FALSE
                helpkey *
            }

        }

        action makemap {

            helplib {$SMURF_HELP}

            parameter abortedat {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter abortsoon {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT
                prompt {Abort as soon as convergence seems unlikely?}
                default FALSE
                helpkey *
            }

            parameter alignsys {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT
                prompt {Align data in the output spatial co-ordinate system?}
                default FALSE
                helpkey *
            }

            parameter bbm {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Bad bolometer masks}
                default !
                helpkey *
            }

            parameter chunkchange {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter config {
                type LITERAL
                access READ
                ppath CURRENT
                prompt {Map-maker tuning parameters}
                helpkey *
            }

            parameter crota {
                type _REAL
                prompt {Angle of north from second pixel axis in output (degs)}
                ppath DYNAMIC
                vpath DYNAMIC
                helpkey *
            }

            parameter fbl {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter fbr {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter flbnd {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter fubnd {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter ftl {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter ftr {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter ftsport {
                access READ
                default !
                helpkey *
                ppath DEFAULT
                prompt {FTS-2 port: tracking, image or null}
                type _CHAR
                vpath DEFAULT
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter intoption {
                type _INTEGER
                access READ
                vpath {PROMPT}
                ppath DEFAULT
                prompt {What to do now (1-3)}
                default 3
                helpkey *
            }

            parameter ipref {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Total intensity map for IP calculation}
                default !
                helpkey *
            }

            parameter itermaps {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {The file to receive any itermaps that are requested}
                default !
                helpkey *
            }

            parameter jsatiles {
                type _LOGICAL
                access READ
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Create the map as a set of JSA tiles?}
                default FALSE
                helpkey *
            }

            parameter jsatilelist {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter lbnd {
                size *
                type _INTEGER
                access READ
                vpath DYNAMIC
                ppath DYNAMIC
                prompt {Lower pixel index bounds for output spatial axes}
                helpkey *
            }

            parameter lbound {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter mask2 {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Second mask NDF}
                default !
                helpkey *
            }

            parameter mask3 {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Third mask NDF}
                default !
                helpkey *
            }

            parameter maxmem {
                type _INTEGER
                prompt {Maximum memory available for map-making in Mb}
                ppath DYNAMIC
                vpath DYNAMIC
                helpkey *
            }

            parameter method {
                type _CHAR
                prompt {Map-making method}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default ITERATE
                helpkey *
            }

            parameter nboloeff {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter ncontchunk {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter nmcnvg {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter nminsmp {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter nomfcf {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter ntile {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF data structure}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter params {
                size *
                type _DOUBLE
                vpath PROMPT
                ppath CURRENT
                prompt {Auxiliary rebinning parameters}
                helpkey *
            }

            parameter pixref {
                size *
                type _DOUBLE
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter pixsize {
                position 3
                type _REAL
                prompt {Output pixel size(s) for the map (arcsec)}
                ppath DYNAMIC
                vpath DYNAMIC
                helpkey *
            }

            parameter pointing {
                type _CHAR
                prompt {Text file containing pointing corrections}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter rate_limited {
                type _LOGICAL
                access WRITE
                vpath DEFAULT
                prompt {Was MAPTOL_RATE limit hit?}
                default FALSE
                helpkey *
            }

            parameter ref {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Reference NDF}
                default !
                helpkey *
            }

            parameter reflat {
                type LITERAL
                access READ
                ppath DYNAMIC
                vpath DYNAMIC
                prompt {Celestial latitude at output reference point}
                helpkey *
            }

            parameter reflon {
                type LITERAL
                access READ
                ppath DYNAMIC
                vpath DYNAMIC
                prompt {Celestial longitude at output reference point}
                helpkey *
            }

            parameter refpix1 {
                type _DOUBLE
                access READ
                ppath DYNAMIC
                vpath DEFAULT
                default !
                prompt {X pixel coord at output reference point}
                helpkey *
            }

            parameter refpix2 {
                type _DOUBLE
                access READ
                ppath DYNAMIC
                vpath DEFAULT
                default !
                prompt {Y pixel coord at output reference point}
                helpkey *
            }

            parameter spread {
                type LITERAL
                vpath DEFAULT
                ppath DEFAULT
                prompt {Pixel spreading method}
                helpkey *
                default {Nearest}
            }

            parameter system {
                position 4
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Celestial coord system for output cube}
                default TRACKING
                helpkey *
            }

            parameter tausrc {
                type _CHAR
                access WRITE
                vpath DEFAULT
                default UNKNOWN
                helpkey *
            }

            parameter tileborder {
                type _INTEGER
                prompt {Width of tile overlap in pixels}
                ppath CURRENT DEFAULT
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter tiledims {
                type _INTEGER
                prompt {Output tile dimensions in pixels}
                ppath CURRENT DEFAULT
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter trim {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT
                prompt {Trim bad border from output image?}
                default FALSE
                helpkey *
            }

            parameter trimtiles {
                type _LOGICAL
                vpath DEFAULT
                prompt {Trim the output tiles?}
                ppath CURRENT DEFAULT
                default FALSE
                helpkey *
            }

            parameter ubnd {
                size *
                type _INTEGER
                access READ
                vpath DYNAMIC
                ppath DYNAMIC
                prompt {Upper pixel index bounds for output spatial axes}
                helpkey *
            }

            parameter ubound {
                size *
                type _INTEGER
                access WRITE
                vpath INTERNAL
                helpkey *
            }

            parameter wchisq {
                type _DOUBLE
                access WRITE
                vpath DEFAULT
                default 0.0
                helpkey *
            }

            parameter wvmlog {
                type LITERAL
                prompt {Text file in which to write processed WVM data}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action nanten2acsis {
            helplib {$SMURF_HELP}

            parameter directory {
                position 2
                type _CHAR
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output Directory}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter in {
                position 1
                type _CHAR
                access READ
                vpath {PROMPT }
                prompt {Input NANTEN2 FITS Files}
                ppath GLOBAL CURRENT
                helpkey *
            }

        }

        action pol2check {
            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDFs}
                helpkey *
            }

            parameter junkfile {
                type LITERAL
                prompt {File in which to put non-POL2 NDF paths}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter junkfound {
               type _LOGICAL
               access WRITE
               vpath DEFAULT
               default FALSE
               helpkey *
            }

            parameter mapfile {
                type LITERAL
                prompt {File in which to put POL-2 map NDF paths}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter mapfound {
               type _LOGICAL
               access WRITE
               vpath DEFAULT
               default FALSE
               helpkey *
            }

            parameter mapinfo {
                type LITERAL
                prompt {File in which to put Stokes map NDF information}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter missing {
                type LITERAL
                prompt {File in which to put missing raw sub-scans}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter multiobject {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default FALSE
                prompt {Allow data for multiple objects?}
                helpkey *
            }

            parameter rawfile {
                type LITERAL
                prompt {File in which to put raw POL2 time-series NDF paths}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter rawfound {
               type _LOGICAL
               access WRITE
               vpath DEFAULT
               default FALSE
               helpkey *
            }

            parameter rawinfo {
                type LITERAL
                prompt {File in which to put raw data time-series NDF information}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter stokesfile {
                type LITERAL
                prompt {File in which to put Stokes POL2 time-series NDF paths}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter stokesinfo {
                type LITERAL
                prompt {File in which to put Stokes time-series NDF information}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter stokesfound {
               type _LOGICAL
               access WRITE
               vpath DEFAULT
               default FALSE
               helpkey *
            }

        }

        action pol2ipcor {
            helplib {$SMURF_HELP}

            parameter in {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Input I Q and U maps}
                default !
                helpkey *
            }

            parameter inlogs {
                type LITERAL
                prompt {Group of existing pol2ipcor log files}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter logfile {
                type LITERAL
                prompt {Text file to receive output table}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter mapdir {
                position 1
                type LITERAL
                prompt {Path to directory holding input maps}
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter modelfile {
                type LITERAL
                prompt {Text file to receive model values}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }
            parameter modeltype {
                type LITERAL
                prompt {Type of model (single or double component)}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default SINGLE
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                ppath CURRENT DEFAULT
                vpath DEFAULT
                association ->GLOBAL.DATA_ARRAY
                prompt {Corrected Q and U maps}
                helpkey *
                default !
            }

        }

        action qucovar {
            helplib {$SMURF_HELP}

            parameter qres {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input Q residuals time-stream NDF}
                helpkey *
            }

            parameter ures {
                position 2
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input U residuals time-stream NDF}
                helpkey *
            }

            parameter qlut {
                position 3
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input Q LUT time-stream NDF}
                helpkey *
            }

            parameter ulut {
                position 4
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input U LUT time-stream NDF}
                helpkey *
            }

            parameter ref {
                position 5
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input reference map}
                helpkey *
            }

            parameter out {
                position 6
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output Q/U co-variance map}
                helpkey *
            }

        }

        action rawfixmeta {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input timeseries}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Uncompressed timeseries}
                helpkey *
            }

            parameter steptime {
                    type _DOUBLE
                    access WRITE
                    vpath DEFAULT
                    default 0
                    helpkey *
            }

        }

        action rawpress {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input timeseries}
                helpkey *
            }

            parameter method {
                position 3
                type LITERAL
                default DELTA
                prompt {Compression method}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Compressed timeseries}
                helpkey *
            }

        }

        action rawrecreatewcs {

            helplib {$SMURF_HELP}

            parameter ndf {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input ACSIS timeseries}
                helpkey *
            }

        }

        action rawrewrtsc2wcs {

            helplib {$SMURF_HELP}

            parameter ndf {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input SCUBA-2 timeseries to be fixed}
                helpkey *
            }

        }

        action rawunpress {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input timeseries}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Uncompressed timeseries}
                helpkey *
            }

        }

        action remsky {

            helplib {$SMURF_HELP}

            parameter bbm {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Bad bolometer masks}
                default !
                helpkey *
            }

            parameter fit {
                type _CHAR
                vpath {PROMPT }
                prompt {Remove mean, slope or plane?}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter group {
                position 4
                type _LOGICAL
                prompt {Group related files?}
                ppath DEFAULT CURRENT
                default FALSE
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input timeseries}
                helpkey *
            }

            parameter method {
                position 3
                type _CHAR
                prompt {Sky removal method}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Sky-subtracted timeseries}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action sc2clean {
            helplib {$SMURF_HELP}

            parameter bbm {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Bad bolometer masks}
                default !
                helpkey *
            }

            parameter com {
                type _LOGICAL
                prompt {Write common-mode to NDF if calculated?}
                default FALSE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter config {
                type LITERAL
                access READ
                ppath CURRENT
                prompt {Cleaning parameters}
                helpkey *
            }

            parameter flat {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {If set ensure data are flatfielded}
                ppath GLOBAL CURRENT
                default TRUE
                helpkey *
            }

            parameter gai {
                type _LOGICAL
                prompt {Write common-mode gain to NDF if calculated?}
                default FALSE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input timeseries}
                helpkey *
            }

            parameter maxlen {
                type _DOUBLE
                access READ
                ppath CURRENT DEFAULT
                prompt {Maximum concatenated length in seconds}
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Cleaned timeseries}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter padend {
                type _INTEGER
                access READ
                ppath CURRENT DEFAULT
                prompt {Number of samples to pad at start}
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter padstart {
                type _INTEGER
                access READ
                ppath CURRENT DEFAULT
                prompt {Number of samples to pad at end}
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter usedarks {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {If set mask data using darks}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action sc2concat {

            helplib {$SMURF_HELP}

            parameter flat {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {If set ensure data are flatfielded}
                ppath GLOBAL CURRENT
                default TRUE
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter maxlen {
                type _DOUBLE
                access READ
                ppath CURRENT DEFAULT
                prompt {Maximum concatenated length in seconds}
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                ppath CURRENT
                default {'./\*_con'}
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF data structure}
                helpkey *
            }

            parameter outbase {
                type LITERAL
                ppath CURRENT
                vpath DEFAULT
                prompt {Base-name for output NDF data structures}
                default !
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter padend {
                type _INTEGER
                access READ
                ppath CURRENT DEFAULT
                prompt {Number of samples to pad at start}
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter padstart {
                type _INTEGER
                access READ
                ppath CURRENT DEFAULT
                prompt {Number of samples to pad at end}
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter usedarks {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {If set mask data using darks}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action sc2expandmodel {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                ppath CURRENT
                default {'./\*_con'}
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF data structure}
                helpkey *
            }

        }

        action sc2fft {

            helplib {$SMURF_HELP}

            parameter avpspec {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {Calculate average power spectrum of good detectors?}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter avpspecthresh {
                type _DOUBLE
                vpath {DEFAULT}
                prompt {N-sigma threshold for defining good detectors for average power spectrum}
                default 5
                helpkey *
            }

            parameter bbm {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Bad bolometer masks}
                default !
                helpkey *
            }

            parameter flat {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {If set ensure data are flatfielded}
                ppath GLOBAL CURRENT
                default TRUE
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter inverse {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {Perform inverse transformation if set}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter ngood {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                prompt {Number of good bolometers in average power spectrum}
                helpkey *
                default 0
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF data structure}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter polar {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {Use polar instead of cartesian representation of FFT?}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter power {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {Calculate power spectrum (in polar coordinates)?}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter weightavpspec {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {Weight bolos in avpspec as 1/noise^2?}
                ppath GLOBAL CURRENT
                default TRUE
                helpkey *
            }

            parameter zerobad {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {Set bad values to 0 before calculating FFT?}
                ppath GLOBAL CURRENT
                default TRUE
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action sc2filtermap {

            helplib {$SMURF_HELP}

            parameter filt_edgehigh {
                type _REAL
                access UPDATE
                vpath {DEFAULT }
                prompt {High-pass filter frequency (1/arcsec)?}
                ppath GLOBAL CURRENT
                default 0
                helpkey *
            }

            parameter filt_edgelow {
                type _REAL
                access UPDATE
                vpath {DEFAULT }
                prompt {Low-pass filter frequency (1/arcsec)?}
                ppath GLOBAL CURRENT
                default 0
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF data structure}
                helpkey *
            }

            parameter outfilter {
                type NDF
                access WRITE
                vpath {DEFAULT }
                ppath GLOBAL CURRENT
                prompt {Output NDF container for filter}
                default !
                helpkey *
            }

            parameter whiten {
                type _LOGICAL
                access UPDATE
                vpath {DEFAULT }
                prompt {Whiten the map power spectrum?}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter whiterefmap {
                type NDF
                access READ
                vpath {DEFAULT }
                prompt {Reference map for whitening filter}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter zerobad {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {Set bad values to 0 before calculating FFT?}
                ppath GLOBAL CURRENT
                default TRUE
                helpkey *
            }

        }

        action sc2mapfft {

            helplib {$SMURF_HELP}

            parameter azavpspec {
                type _LOGICAL
                access READ
                vpath {DEFAULT}
                prompt {Calculate azimuthally averaged angular power spectrum?}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter inverse {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {Perform inverse transformation if set}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF data structure}
                helpkey *
            }

            parameter polar {
                type _LOGICAL
                access UPDATE
                vpath {DEFAULT }
                prompt {Use polar instead of cartesian representation of FFT?}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter power {
                type _LOGICAL
                access UPDATE
                vpath {DEFAULT }
                prompt {Calculate power spectrum (in polar coordinates)?}
                ppath GLOBAL CURRENT
                default FALSE
                helpkey *
            }

            parameter zerobad {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {Set bad values to 0 before calculating FFT?}
                ppath GLOBAL CURRENT
                default TRUE
                helpkey *
            }

        }

        action sc2pca {

            helplib {$SMURF_HELP}

            parameter bbm {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Bad bolometer masks}
                default !
                helpkey *
            }

            parameter flat {
                type _LOGICAL
                vpath {DEFAULT }
                prompt {If set ensure data are flatfielded}
                ppath GLOBAL CURRENT
                default TRUE
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input timeseries}
                helpkey *
            }

            parameter outamp {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Amplitude files of the principal component}
                helpkey *
            }

            parameter outampfiles {
                type LITERAL
                prompt {Text file in which to put the output amplitude NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter outcomp {
                position 3
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Principal component files}
                helpkey *
            }

            parameter outcompfiles {
                type LITERAL
                prompt {Text file in which to put the output component NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            # These are the generic flatfield parameters. Not in alphabetical order
            # with the other parameters to make it easier to do bulk copies

            parameter flatmeth {
                type _CHAR
                prompt {Flatfield calculation method}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default POLYNOMIAL
                helpkey *
            }

            parameter flatorder {
                type _INTEGER
                access READ
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                prompt {Order of polynomial to use for flatfield fitting}
                default 1
                helpkey *
            }

            parameter flatsnr {
                type _DOUBLE
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default 3.0
                prompt {Signal-to-noise threshold for responsivity data}
                helpkey *
            }

            parameter flatusenext {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                default !
                prompt {Should we compare with following flatfield?}
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter respmask {
                type _LOGICAL
                vpath {PROMPT }
                prompt {Mask bolometers with bad responsivity?}
                vpath CURRENT DEFAULT
                ppath CURRENT DEFAULT
                default TRUE
                helpkey *
            }

        }

        action sc2sim {

            helplib {$SMURF_HELP}

            parameter badbol {
                type _CHAR
                access READ
                vpath {DEFAULT }
                default !
                prompt {ARD Description File for Bad Bolometer mask}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter maxwrite {
                position 4
                type _INTEGER
                prompt {Number of samples to write in output file}
                vpath DEFAULT
                default 12000
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter obspar {
                position 1
                type _CHAR
                prompt {Observation parameters}
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter overwrite {
                position 5
                type _LOGICAL
                prompt {Overwrite existing files?}
                vpath DEFAULT
                default TRUE
                ppath CURRENT
                helpkey *
            }

            parameter seed {
                position 3
                type _INTEGER
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter simpar {
                position 2
                type _CHAR
                prompt {Simulation parameters}
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter simstats {
                position 6
                type _LOGICAL
                prompt {Report simulation statistics only?}
                vpath DEFAULT
                default FALSE
                ppath CURRENT
                helpkey *
            }

            parameter simtype {
                position 7
                type _CHAR
                prompt {Simulation type (FULL or WEIGHTS)}
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                helpkey *
            }

        }

        action sc2threadtest {

            helplib {$SMURF_HELP}

            parameter nchunks {
                type _INTEGER
                vpath  {DEFAULT}
                prompt {Number of time chunks}
                default 2
                helpkey *
            }

            parameter nsub {
                type _INTEGER
                vpath  {DEFAULT}
                prompt {Number of subarrays}
                default 4
                helpkey *
            }

            parameter nthread {
                type _INTEGER
                vpath  {DEFAULT}
                prompt {Number of threads to use}
                default 2
                helpkey *
            }

            parameter tsteps {
                type _INTEGER
                vpath  {DEFAULT}
                prompt {Number of time samples in simulated data chunk}
                default 6000
                helpkey *
            }

        }

        action skynoise {

            helplib {$SMURF_HELP}

            parameter exponent {
                position 4
                type _DOUBLE
                prompt {Power-Law Exponent}
                vpath DEFAULT
                default 1.8
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter filename {
                type _CHAR
                vpath DEFAULT
                default atm
                helpkey *
            }

            parameter obspar {
                position 1
                type _CHAR
                prompt {Observation file}
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter seed {
                position 3
                type _INTEGER
                vpath DEFAULT
                default !
                helpkey *
            }

            parameter simpar {
                position 2
                type _CHAR
                prompt {Simulation file}
                vpath {PROMPT}
                ppath GLOBAL CURRENT
                helpkey *
            }

        }

        action smurfcopy {

            helplib {$SMURF_HELP}

            parameter ftsport {
                access READ
                default !
                helpkey *
                ppath DEFAULT
                prompt {FTS-2 port: tracking, image or null}
                type _CHAR
                vpath DEFAULT
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input timeseries}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output filename}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter pointing {
                type _CHAR
                prompt {Text file containing pointing corrections}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter resist {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath DEFAULT
                default {^$STARLINK_DIR/share/smurf/resist.cfg}
                prompt {Heater resistance information}
                helpkey *
            }

            parameter slice {
                position 3
                type _INTEGER
                access READ
                ppath  DYNAMIC CURRENT
                prompt {Index of time slice to extract (0 for last)}
                helpkey *
            }

        }

        action smurfhelp {
            alias {smurfh(elp)}

            helplib {$SMURF_HELP}

            parameter subtopic {
                position 2
                type LITERAL
                access READ
                vpath DEFAULT
                prompt {Help subtopic}
                default {         }
                helpkey *
            }

            parameter subsubtopic {
                position 3
                type LITERAL
                access READ
                vpath DEFAULT
                prompt {Help subsubtopic}
                default {         }
                helpkey *
            }

            parameter subsubsubtopic {
                position 4
                type LITERAL
                access READ
                vpath DEFAULT
                prompt {Help subsubsubtopic}
                default {         }
                helpkey *
            }

            parameter topic {
                position 1
                type LITERAL
                access READ
                vpath DEFAULT
                prompt {Help topic}
                default {         }
                helpkey *
            }

        }

        action stackframes {

            helplib {$SMURF_HELP}

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                association <-GLOBAL.DATA_ARRAY
                prompt {Input processed 2d frames}
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Stacked frames}
                helpkey *
            }

            parameter sort {
                position 3
                type _LOGICAL
                access READ
                vpath PROMPT
                ppath CURRENT DYNAMIC DEFAULT
                default TRUE
                helpkey *
            }

            parameter sortby {
                position 4
                type LITERAL
                access READ
                vpath PROMPT
                prompt {Sort key}
                helpkey *
            }

        }

        action starecalc {

            helplib {$SMURF_HELP}

            parameter bbm {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Bad bolometer masks}
                default !
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input data file(s)}
                helpkey *
            }

            parameter naver {
                type _INTEGER
                prompt {Number of samples to average together to produce an image}
                vpath DEFAULT
                default !
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association ->GLOBAL.DATA_ARRAY
                prompt {Output data file(s)}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

        }

        action supercam2acsis {
            helplib {$SMURF_HELP}

            parameter directory {
                position 2
                type _CHAR
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output Directory}
                ppath GLOBAL CURRENT
                helpkey *
            }

            parameter in {
                position 1
                type _CHAR
                access READ
                vpath {PROMPT }
                prompt {Input SuperCam SDFITS File}
                ppath GLOBAL CURRENT
                helpkey *
            }

        }

        action timesort {

            helplib {$SMURF_HELP}

            parameter detectors {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Names of detectors to be included}
                default !
                helpkey *
            }

            parameter detpurge {
                type _LOGICAL
                prompt {Remove dead detectors?}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default FALSE
                helpkey *
            }

            parameter genvar {
                type _LOGICAL
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input NDF data structure}
                helpkey *
            }

            parameter limittype {
                type LITERAL
                prompt {Type of limit specified by LIMITSIZE}
                default FILESIZE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter merge {
                type _LOGICAL
                prompt {Merge input NDFs?}
                vpath DYNAMIC
                ppath CURRENT DYNAMIC
                helpkey *
            }

            parameter nout {
                type _INTEGER
                access WRITE
                vpath DEFAULT
                default 0
                helpkey *
            }

            parameter out {
                position 2
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output NDF data structure}
                helpkey *
            }

            parameter outfiles {
                type LITERAL
                prompt {Text file in which to put the output NDF names}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter sizelimit {
                type _INTEGER
                prompt {Size limit for each output NDF}
                default !
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

            parameter specbnd {
                type LITERAL
                prompt {How to choose pixel bounds on output spectral axis}
                default FIRST
                vpath DEFAULT
                ppath CURRENT DEFAULT
                helpkey *
            }

        }

        action unmakecube {

            helplib {$SMURF_HELP}

            parameter detectors {
                type LITERAL
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Names of detectors to be included}
                default !
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input sky cubes}
                helpkey *
            }

            parameter interp {
                type LITERAL
                vpath DEFAULT
                ppath DEFAULT
                prompt {Pixel interpolation method}
                helpkey *
                default {Nearest}
            }

            parameter out {
                position 3
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output time series cubes}
                helpkey *
            }

            parameter params {
                size *
                type _DOUBLE
                vpath PROMPT
                ppath CURRENT
                prompt {Auxiliary interpolation parameters}
                helpkey *
            }

            parameter ref {
                position 2
                type NDF
                access READ
                vpath PROMPT
                ppath CURRENT
                prompt {Template time series cubes}
                helpkey *
            }

            parameter usedetpos {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT
                prompt {Read detector positions from the input NDF?}
                default TRUE
                helpkey *
            }

        }
        action unmakemap {

            helplib {$SMURF_HELP}

            parameter alignsys {
                type _LOGICAL
                vpath DEFAULT
                ppath CURRENT
                prompt {Align data in the spatial co-ordinate system of the map?}
                default FALSE
                helpkey *
            }

            parameter amp2 {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Amplitude of 2 Hz signal as a fraction of I}
                default 0.0
                helpkey *
            }

            parameter amp4 {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Amplitude of 4 Hz signal as a fraction of I}
                default 0.0
                helpkey *
            }

            parameter amp16 {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Amplitude of 16 Hz signal as a fraction of I}
                default 0.0
                helpkey *
            }

            parameter angrot {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Angle from focal plane X to fixed analyser (degs)}
                default 90.0
                helpkey *
            }

            parameter com {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                default !
                prompt {Common-mode time-series NDFs}
                helpkey *
            }

            parameter comval {
                type _DOUBLE
                size *
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Constant comon-mode value for all time slices (pW)}
                default !
                helpkey *
            }

            parameter gai {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                default !
                prompt {2-dimensional GAI model NDFs}
                helpkey *
            }

            parameter harmonic {
                type _INTEGER
                prompt {The half-wave plate harmonic to use}
                vpath DEFAULT
                ppath DEFAULT
                default 4
                helpkey *
            }

            parameter in {
                position 1
                type NDF
                access READ
                vpath {PROMPT }
                ppath GLOBAL CURRENT
                association <-GLOBAL.DATA_ARRAY
                prompt {Input sky map}
                helpkey *
            }

            parameter instq {
                type NDF
                access READ
                ppath CURRENT
                prompt {Instrumental Q value for each boloemeter}
                helpkey *
            }

            parameter instu {
                type NDF
                access READ
                ppath CURRENT
                prompt {Instrumental U value for each boloemeter}
                helpkey *
            }

            parameter interp {
                type LITERAL
                vpath DEFAULT
                ppath DEFAULT
                prompt {Pixel interpolation method}
                helpkey *
                default {Nearest}
            }

            parameter ipform {
                type LITERAL
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Instrumental polarisation model to use}
                helpkey *
                default {PL3}
            }

            parameter jkdata {
                type LITERAL
                vpath DEFAULT
                ppath DEFAULT
                prompt {Johnstone/Kennedy IP model data}
                helpkey *
                default {$STARLINK_DIR/share/smurf/ipdata.sdf}
            }

            parameter out {
                position 3
                type NDF
                access WRITE
                vpath {PROMPT }
                association ->GLOBAL.DATA_ARRAY
                prompt {Output time series cubes}
                helpkey *
            }

            parameter params {
                size *
                type _DOUBLE
                vpath PROMPT
                ppath CURRENT
                prompt {Auxiliary interpolation parameters}
                helpkey *
            }

            parameter paoff {
                type _DOUBLE
                vpath DEFAULT
                ppath DEFAULT
                prompt {Angle from fixed analyser to POL_ANG=0 (degs)}
                default 18.65
                helpkey *
            }

            parameter pasign {
                type _LOGICAL
                vpath DEFAULT
                ppath DEFAULT
                prompt {POL_ANG in sense of rotation from focal plane X to Y?}
                default FALSE
                helpkey *
            }

            parameter perror {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Sigma of random pointing errors to add, in arc-seconds}
                default 0.0
                helpkey *
            }

            parameter phase2 {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Phase of 2 Hz signal in degrees}
                default 0.0
                helpkey *
            }

            parameter phase4 {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Phase of 4 Hz signal in degrees}
                default 0.0
                helpkey *
            }

            parameter phase16 {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT, DEFAULT
                prompt {Phase of 16 Hz signal in degrees}
                default 0.0
                helpkey *
            }

            parameter pldata {
               size *
               type _DOUBLE
               vpath DEFAULT
               ppath DEFAULT
               prompt {Parameter values for PL1 PL2 or PL3  IP model}
               default 2.624E-3 4.216E-2 -2.410E-2 -3.400E-2
               helpkey *
            }

            parameter qin {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                prompt {Input map of sky Q values}
                helpkey *
            }

            parameter pointing {
                type _CHAR
                prompt {Text file containing pointing corrections}
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                helpkey *
            }

            parameter ref {
                position 2
                type NDF
                access READ
                vpath PROMPT
                ppath CURRENT
                prompt {Template time series cubes}
                helpkey *
            }

            parameter sigma {
                type _DOUBLE
                vpath DEFAULT
                ppath CURRENT DEFAULT
                prompt {Stndard deviation of Gaussian noise to add}
                default 0.0
                helpkey *
            }

            parameter uin {
                type NDF
                access READ
                vpath DEFAULT
                ppath CURRENT DEFAULT
                default !
                prompt {Input map of sky U values}
                helpkey *
            }

            parameter useaxis {
                type LITERAL
                vpath DEFAULT
                ppath DYNAMIC DEFAULT
                default !
                prompt {The sky map WCS axes to use}
                helpkey *
            }
        }

    }

    command jcmtstate2cat {
        obey {starperl $SMURF_DIR/jcmtstate2cat}
    }

    command mcehead2cat {
        obey {starperl $SMURF_DIR/mcehead2cat}
    }

    command dumpocscfg {
        obey {starperl $SMURF_DIR/dumpocscfg}
    }

    command gettsys {
        obey {starperl $SMURF_DIR/gettsys}
    }

    command cbas {
        obey {$SMURF_DIR/cbas}
    }

    command smas {
        obey {$SMURF_DIR/smas}
    }

    command matched-filter {
        obey {$SMURF_DIR/matched-filter}
    }

    command distortion {
        obey {$SMURF_DIR/distortion}
    }

    command sc2tsnoise {
        obey {$SMURF_DIR/sc2tsnoise}
    }

    command showdistortion {
        obey {$SMURF_DIR/showdistortion}
    }

    command tobeam {
        obey {$SMURF_DIR/tobeam}
    }

    command scuba2_index {
        obey {starperl $SMURF_DIR/print_index -scuba2}
    }

    command acsis_index {
        obey {starperl $SMURF_DIR/print_index }
    }

    command pol2cat {
        obey {python3 $SMURF_DIR/pol2cat.py}
    }

    command pol2ip {
        obey {python3 $SMURF_DIR/pol2ip.py}
    }

    command pol2scan {
        obey {python3 $SMURF_DIR/pol2scan.py}
    }

    command pol2map {
        obey {python3 $SMURF_DIR/pol2map.py}
    }

    command pol2noise {
        obey {python3 $SMURF_DIR/pol2noise.py}
    }

    command pol2sim {
        obey {python3 $SMURF_DIR/pol2sim.py}
    }

    command pol2stack {
        obey {python3 $SMURF_DIR/pol2stack.py}
    }

    command skyloop {
        obey {python3 $SMURF_DIR/skyloop.py}
    }

    command configmeld {
        obey {python3 $SMURF_DIR/configmeld.py}
    }

    command fts2gaia {
        obey {python3 $SMURF_DIR/fts2gaia.py}
    }

    command tilepaste {
        obey {python3 $SMURF_DIR/tilepaste.py}
    }

    command tilecutout {
        obey {python3 $SMURF_DIR/tilecutout.py}
    }

    command jsajoin {
        obey {python3 $SMURF_DIR/jsajoin.py}
    }

    command jsasplit {
        obey {python3 $SMURF_DIR/jsasplit.py}
    }

    command jsatilemoc {
        obey {python3 $SMURF_DIR/jsatilemoc.py}
    }

    command rawregion {
        obey {python3 $SMURF_DIR/rawregion.py}
    }

    command sc2compare {
        obey {python3 $SMURF_DIR/sc2compare.py}
    }

    command startester {
        obey {python3 $SMURF_DIR/startester.py}
    }

    command matchbeam {
        obey {python3 $SMURF_DIR/matchbeam.py}
    }

    icl {defhelp @PACKAGE@ $@PACKAGE_UPCASE@_HELP 0}

    display {

        @PACKAGE_UPCASE@ commands are now available -- (Version @PACKAGE_VERSION@)

        Type smurfhelp for help on @PACKAGE_UPCASE@ commands.
        Type "showme sun258" to browse the hypertext documentation.
        Type "showme sc20" to view the Heterodyne DR cookbook.
        Type "showme sc21" to view the SCUBA-2 DR cookbook.
        Type "showme sc22" to view the POL-2 DR cookbook.

    }

}
