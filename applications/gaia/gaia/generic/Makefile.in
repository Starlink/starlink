#*******************************************************************************
# E.S.O. - VLT project
#
# "@(#) $Id$"
#
# ------------------------------------------------------------------------
# 	Makefile for RtdImage library
# ------------------------------------------------------------------------

# ------------------------------------------------------------------------

CC           	= @CC@
CXX           	= @CXX@
CFLAGS  	= @CXXDEBUGFLAGS@
TOPDIR      	= @DESTDIR@
LIBDIR      	= @LIBDIR@
DEPEND_TARGET	= @DEPEND_TARGET@

FC              = @FC@
GC              = @STARLINK@/bin/generic
FCFLAGS         = @FCFLAGS@
STAR_FCFLAGS    = @STAR_FCFLAGS@
STAR_INC        = @STARLINK@/include
LINK            = @LINK@
# ------------------------------------------------------------------------
# 	Directories containing Tcl and Tk include files and libraries
# ------------------------------------------------------------------------

TCL_INCLUDE   	= @TCLINCSW@
TK_INCLUDE    	= @TKINCSW@
X_INCLUDE     	= @XINCSW@

# ------------------------------------------------------------------------
CPPSRCS =  \
 GaiaSkySearch.C StarRtdImage.C Gaia.C NDFIO.C StarWCS.C GaiaLocalCatalog.C  \
 StarFitsIO.C bitmaps.C Contour.C colormaps.C GaiaRtdRemote.C \
 XYProfile.C RegionStats.C GaiaUtilsTcl.C GaiaFITS.C GaiaFITSTcl.C

CSRCS =  \
 ast_tclerr.c patch.c gaiaNDF.c writeslice.c centroid.c rotated.c \
 rtdRotBoxEllipse.c rtdDtrn.c rtdSegment.c grf_tkcan.c \
 rtdMark.c rtdWord.c rtdPolyline.c dencode.c \
 gaiaSpectralPlot.c gaiaNDFTcl.c gaiaArray.c gaiaArrayTcl.c \
 gaiaHDS.c gaiaHDSTcl.c gaiaUtils.c gaiaSlaTcl.c

FSRCS =  \
 ardstat.f asc2tab.f autocrop.f cat2tab.f gai1_bswapb.f gai1_bswapd.f \
 gai1_bswapi.f gai1_bswapr.f gai1_bswapub.f gai1_bswapuw.f gai1_bswapw.f \
 gai1_bswapk.f \
 gai1_nxtab.f gai1_s2ang.f gai1_t2cg.f gai1_t2cn.f gai_a2tab.f \
 gai_c2tab.f gai_t2asc.f gai_t2cat.f rpatch.f \
 rtd1_aqual.f rtd1_ardst.f rtd1_binom.f rtd1_chead.f rtd1_crfit.f \
 rtd1_dewcs.f rtd1_dofit.f rtd1_dtrn.f rtd1_enwcs.f rtd1_evert.f \
 rtd1_gkeyc.f rtd1_isrt.f rtd1_patch.f rtd1_ploc.f \
 rtd1_prsh2.f rtd1_repl.f rtd1_setar.f rtd1_sndfh.f rtd1_stint.f \
 rtd1_wcard.f rtd1_wndfh.f rtd1_wrcrd.f \
 rtd_cent.f rtd_rdndf.f rtd_slice.f rtd_wrndf.f tab2asc.f \
 tab2cat.f \
 ardspectra.f

GSRCS =  \
 rtd_cpx.gen rtd1_mstx.gen rtd1_sufitx.gen rtd1_dofilx.gen rtd1_statx.gen \
 rtd1_gbndx.gen rtd1_eterpx.gen rtd1_cenx.gen \
 gai1_ardsp.gen

SGSRCS = \
  rtd1_wrftx.gsc rtd1_wkeyx.gsc

NGSRCS =  \
 rtd1_gkeyx.gsn

OBJS =  \
 $(CPPSRCS:.C=.o) $(CSRCS:.c=.o) $(GSRCS:.gen=.o) $(FSRCS:.f=.o) \
 $(SGSRCS:.gsc=.o) $(NGSRCS:.gsn=.o)

libname  	= ../lib/libgaia.a
INCLUDES	= -I../include  \
                  -I../bitmaps \
                  -I../../skycat/skycat/interp/include \
                  -I../../skycat/rtd/rtdimg/include \
                  -I../../skycat/rtd/rtdstar/include \
                  -I../../skycat/rtd/rtilib/include \
                  -I../../skycat/rtd/rtdutl/include \
                  -I../../skycat/rtd/rtdevt/include \
                  -I../../skycat/tclutil/util/include \
                  -I../../skycat/tclutil/tclutil/include \
                  -I../../skycat/astrotcl/imageio/include \
                  -I../../skycat/astrotcl/wcslib/include \
                  -I../../skycat/cat/astrocat/include \
                  -I../../skycat/cat/tclcat/include \
                  -I../../skycat/tclutil/tix/unix \
	          $(TK_INCLUDE) $(TCL_INCLUDE) $(X_INCLUDE) \
	          $(ADDINCS) -I$(STAR_INC)

DEFINES         = \
                -DGAIA_VERSION=\"@GAIA_VERSION@\" \
                -DGAIA_LIBRARY=\"@GAIA_BUILD_LIBRARY@\" \
                -DIWIDGETS_VERSION=\"@IWIDGETS_VERSION@\" \
                -DIWIDGETS_LIBRARY=\"@IWIDGETS_LIBRARY@\"

CC_SWITCHES	= $(DEFINES) $(INCLUDES) $(CFLAGS)
DEPEND_FLAGS    = $(CC_SWITCHES) @CXX_INCLUDE@ @CXX_DEPEND_FLAGS@
INSTALL  	= @INSTALL@
INSTALL_DATA  	= @INSTALL_DATA@
RANLIB   	= @RANLIB@
SHELL    	= /bin/sh
AR       	= ar rc
RM       	= rm -f
LINT		= lint
LINTFLAGS	= -axhbn
srcdir 		= @srcdir@
VPATH		= @srcdir@

all: dirs $(libname)

$(libname): $(OBJS)
	$(RM) $@
	$(AR) $@ $(OBJS)
	$(RANLIB) $@

All:
	cd ../..; $(MAKE)


install: $(libname) install-dirs
	$(INSTALL_DATA) $(libname) $(LIBDIR)
	$(RANLIB) $(LIBDIR)/$(libname)

dirs:
	@test -d ../lib || mkdir ../lib
	@test -d ../bin || mkdir ../bin

install-dirs:
	@for i in $(TOPDIR) $(LIBDIR) ; do \
	    if test ! -d $$i ; then \
		mkdir $$i ; \
	    fi ; \
        done

clean:
	$(RM) $(OBJS) $(libname) *\~ "#"* $(LINKS)

distclean: clean
	echo > make.dep
	rm -f Makefile

tags:
	etags ../../*/*/*.[Cch]

.SUFFIXES: .o .C .f .gen .gsc .gsn
.c.o:
	$(CC) -c $(CC_SWITCHES) $<

.C.o:
	$(CXX) -c $(CC_SWITCHES) $<

.f.o:
	$(FC) -c $(FCFLAGS) $(STAR_FCFLAGS) $<

.gen.o:
	$(GC) -t n $<
	$(FC) -c $(FCFLAGS) $(STAR_FCFLAGS) $(<:.gen=.f)
	rm -f $(<:.gen=.f)

.gsc.o:
	$(LINK) $< $(<:.gsc=.gen)
	$(GC) -t rlidc $(<:.gsc=.gen)
	$(FC) -c $(FCFLAGS) $(STAR_FCFLAGS) $(<:.gsc=.f)
	rm -f $(<:.gsc=.f) $(<:.gsc=.gen)

.gsn.o:
	$(LINK) $< $(<:.gsn=.gen)
	$(GC) -t rlid $(<:.gsn=.gen)
	$(FC) -c $(FCFLAGS) $(STAR_FCFLAGS) $(<:.gsn=.f)
	rm -f $(<:.gsn=.f) $(<:.gsn=.gen)

man:
